{"version":3,"file":"raster.js","sources":["../../../src/map/renderer/raster.js"],"sourcesContent":["/**\n * raster renderer component\n *\n * @module  sszvis/map/renderer/raster\n *\n * Used for rendering a raster layer within a map (can also be used in other contexts, but the map usage\n * is the most straightforward). Requires a width and a height for the raster layer, a function which\n * returns raster positions, and one which returns fill colors.\n *\n * @property {Boolean} debug         Whether to activate debug mode, which shows a red square over the whole\n *                                   canvas, for testing alignment with other map layers.\n * @property {Number} width          The width of the canvas\n * @property {Number} height         The height of the canvas\n * @property {Function} position     A function which takes a datum and returns a position for the corresponding\n *                                   raster square, returned as [x, y] pairs.\n * @property {Number} cellSide       The length (in pixels) of one side of each raster cell\n * @property {Function} fill         The fill function. Takes a datum and should return a fill color for the datum's pixel.\n * @property {Number} opacity        The opacity of the canvas. Defaults to 1\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../../fn.js\";\nimport { component } from \"../../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"debug\")\n    .debug(false)\n    .prop(\"width\")\n    .prop(\"height\")\n    .prop(\"position\")\n    .prop(\"cellSide\")\n    .cellSide(2)\n    .prop(\"fill\", fn.functor)\n    .prop(\"opacity\")\n    .opacity(1)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const canvas = selection\n        .selectAll(\".sszvis-map__rasterimage\")\n        .data([0])\n        .join(\"canvas\")\n        .classed(\"sszvis-map__rasterimage\", true);\n\n      canvas\n        .attr(\"width\", props.width)\n        .attr(\"height\", props.height)\n        .style(\"opacity\", props.opacity);\n\n      const ctx = canvas.node().getContext(\"2d\");\n\n      ctx.clearRect(0, 0, props.width, props.height);\n\n      if (props.debug) {\n        // Displays a rectangle that fills the canvas.\n        // Useful for checking alignment with other render layers.\n        ctx.fillStyle = \"rgba(255, 0, 0, 0.2)\";\n        ctx.fillRect(0, 0, props.width, props.height);\n      }\n\n      const halfSide = props.cellSide / 2;\n      for (const datum of data) {\n        const position = props.position(datum);\n        ctx.fillStyle = props.fill(datum);\n        ctx.fillRect(\n          position[0] - halfSide,\n          position[1] - halfSide,\n          props.cellSide,\n          props.cellSide\n        );\n      }\n    });\n}\n"],"names":["component","prop","debug","cellSide","fn","opacity","render","data","selection","select","props","canvas","selectAll","join","classed","attr","width","height","style","ctx","node","getContext","clearRect","fillStyle","fillRect","halfSide","datum","position","fill"],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAOe,eAAY,IAAA;AACzB,EAAA,OAAOA,SAAS,EAAE,CACfC,IAAI,CAAC,OAAO,CAAC,CACbC,KAAK,CAAC,KAAK,CAAC,CACZD,IAAI,CAAC,OAAO,CAAC,CACbA,IAAI,CAAC,QAAQ,CAAC,CACdA,IAAI,CAAC,UAAU,CAAC,CAChBA,IAAI,CAAC,UAAU,CAAC,CAChBE,QAAQ,CAAC,CAAC,CAAC,CACXF,IAAI,CAAC,MAAM,EAAEG,OAAU,CAAC,CACxBH,IAAI,CAAC,SAAS,CAAC,CACfI,OAAO,CAAC,CAAC,CAAC,CACVC,MAAM,CAAC,UAAUC,IAAI,EAAE;AACtB,IAAA,MAAMC,SAAS,GAAGC,MAAM,CAAC,IAAI,CAAC;AAC9B,IAAA,MAAMC,KAAK,GAAGF,SAAS,CAACE,KAAK,EAAE;IAE/B,MAAMC,MAAM,GAAGH,SAAS,CACrBI,SAAS,CAAC,0BAA0B,CAAC,CACrCL,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CACTM,IAAI,CAAC,QAAQ,CAAC,CACdC,OAAO,CAAC,yBAAyB,EAAE,IAAI,CAAC;IAE3CH,MAAM,CACHI,IAAI,CAAC,OAAO,EAAEL,KAAK,CAACM,KAAK,CAAC,CAC1BD,IAAI,CAAC,QAAQ,EAAEL,KAAK,CAACO,MAAM,CAAC,CAC5BC,KAAK,CAAC,SAAS,EAAER,KAAK,CAACL,OAAO,CAAC;IAElC,MAAMc,GAAG,GAAGR,MAAM,CAACS,IAAI,EAAE,CAACC,UAAU,CAAC,IAAI,CAAC;AAE1CF,IAAAA,GAAG,CAACG,SAAS,CAAC,CAAC,EAAE,CAAC,EAAEZ,KAAK,CAACM,KAAK,EAAEN,KAAK,CAACO,MAAM,CAAC;IAE9C,IAAIP,KAAK,CAACR,KAAK,EAAE;AACf;AACA;MACAiB,GAAG,CAACI,SAAS,GAAG,sBAAsB;AACtCJ,MAAAA,GAAG,CAACK,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAEd,KAAK,CAACM,KAAK,EAAEN,KAAK,CAACO,MAAM,CAAC;AAC/C;AAEA,IAAA,MAAMQ,QAAQ,GAAGf,KAAK,CAACP,QAAQ,GAAG,CAAC;AACnC,IAAA,KAAK,MAAMuB,KAAK,IAAInB,IAAI,EAAE;AACxB,MAAA,MAAMoB,QAAQ,GAAGjB,KAAK,CAACiB,QAAQ,CAACD,KAAK,CAAC;MACtCP,GAAG,CAACI,SAAS,GAAGb,KAAK,CAACkB,IAAI,CAACF,KAAK,CAAC;MACjCP,GAAG,CAACK,QAAQ,CACVG,QAAQ,CAAC,CAAC,CAAC,GAAGF,QAAQ,EACtBE,QAAQ,CAAC,CAAC,CAAC,GAAGF,QAAQ,EACtBf,KAAK,CAACP,QAAQ,EACdO,KAAK,CAACP,QACR,CAAC;AACH;AACF,GAAC,CAAC;AACN;;;;"}