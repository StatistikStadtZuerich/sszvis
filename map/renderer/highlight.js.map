{"version":3,"file":"highlight.js","sources":["../../../src/map/renderer/highlight.js"],"sourcesContent":["/**\n * highlight renderer component\n *\n * @module sszvis/map/renderer/highlight\n *\n * A component used internally for rendering the highlight layer of maps.\n * The highlight layer accepts an array of data values to highlight, and renders\n * The map entities associated with those data values using a special stroke.\n *\n * @property {GeoJson} geoJson                        The GeoJson object to be rendered by this map layer.\n * @property {d3.geo.path} mapPath                    A path-generator function used to create the path data string of the provided GeoJson.\n * @property {String} keyName                         The data object key which will return a map entity id. Default 'geoId'.\n * @property {Array} highlight                        An array of data elements to highlight. The corresponding map entities are highlighted.\n * @property {String, Function} highlightStroke       A function for the stroke of the highlighted entities\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../../fn.js\";\nimport { GEO_KEY_DEFAULT } from \"../mapUtils.js\";\nimport { component } from \"../../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"keyName\")\n    .keyName(GEO_KEY_DEFAULT) // the name of the data key that identifies which map entity it belongs to\n    .prop(\"geoJson\")\n    .prop(\"mapPath\")\n    .prop(\"highlight\")\n    .highlight([]) // an array of data values to highlight\n    .prop(\"highlightStroke\", fn.functor)\n    .highlightStroke(\"white\") // a function for highlighted entity stroke colors (default: white)\n    .prop(\"highlightStrokeWidth\", fn.functor)\n    .highlightStrokeWidth(2)\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      const highlightBorders = selection.selectAll(\".sszvis-map__highlight\");\n\n      if (props.highlight.length === 0) {\n        highlightBorders.remove();\n        return true; // no highlight, no worry\n      }\n\n      const groupedMapData = props.geoJson.features.reduce((m, feature) => {\n        m[feature.id] = feature;\n        return m;\n      }, {});\n\n      // merge the highlight data\n      const mergedHighlight = props.highlight.reduce((m, v) => {\n        if (v) {\n          m.push({\n            geoJson: groupedMapData[v[props.keyName]],\n            datum: v,\n          });\n        }\n        return m;\n      }, []);\n\n      highlightBorders\n        .data(mergedHighlight)\n        .join(\"path\")\n        .classed(\"sszvis-map__highlight\", true)\n        .attr(\"d\", (d) => props.mapPath(d.geoJson))\n        .style(\"stroke\", (d) => props.highlightStroke(d.datum))\n        .style(\"stroke-width\", (d) => props.highlightStrokeWidth(d.datum));\n    });\n}\n"],"names":["component","prop","keyName","GEO_KEY_DEFAULT","highlight","fn","highlightStroke","highlightStrokeWidth","render","selection","select","props","highlightBorders","selectAll","length","remove","groupedMapData","geoJson","features","reduce","m","feature","id","mergedHighlight","v","push","datum","data","join","classed","attr","d","mapPath","style"],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAQe,6BAAA,IAAY;AACzB,EAAA,OAAOA,SAAS,EAAE,CACfC,IAAI,CAAC,SAAS,CAAC,CACfC,OAAO,CAACC,eAAe,CAAC;AAAC,GACzBF,IAAI,CAAC,SAAS,CAAC,CACfA,IAAI,CAAC,SAAS,CAAC,CACfA,IAAI,CAAC,WAAW,CAAC,CACjBG,SAAS,CAAC,EAAE,CAAC;AAAC,GACdH,IAAI,CAAC,iBAAiB,EAAEI,OAAU,CAAC,CACnCC,eAAe,CAAC,OAAO,CAAC;AAAC,GACzBL,IAAI,CAAC,sBAAsB,EAAEI,OAAU,CAAC,CACxCE,oBAAoB,CAAC,CAAC,CAAC,CACvBC,MAAM,CAAC,YAAY;AAClB,IAAA,MAAMC,SAAS,GAAGC,MAAM,CAAC,IAAI,CAAC;AAC9B,IAAA,MAAMC,KAAK,GAAGF,SAAS,CAACE,KAAK,EAAE;AAE/B,IAAA,MAAMC,gBAAgB,GAAGH,SAAS,CAACI,SAAS,CAAC,wBAAwB,CAAC;AAEtE,IAAA,IAAIF,KAAK,CAACP,SAAS,CAACU,MAAM,KAAK,CAAC,EAAE;MAChCF,gBAAgB,CAACG,MAAM,EAAE;MACzB,OAAO,IAAI,CAAC;AACd,IAAA;AAEA,IAAA,MAAMC,cAAc,GAAGL,KAAK,CAACM,OAAO,CAACC,QAAQ,CAACC,MAAM,CAAC,CAACC,CAAC,EAAEC,OAAO,KAAK;AACnED,MAAAA,CAAC,CAACC,OAAO,CAACC,EAAE,CAAC,GAAGD,OAAO;AACvB,MAAA,OAAOD,CAAC;IACV,CAAC,EAAE,EAAE,CAAC;;AAEN;AACA,IAAA,MAAMG,eAAe,GAAGZ,KAAK,CAACP,SAAS,CAACe,MAAM,CAAC,CAACC,CAAC,EAAEI,CAAC,KAAK;AACvD,MAAA,IAAIA,CAAC,EAAE;QACLJ,CAAC,CAACK,IAAI,CAAC;UACLR,OAAO,EAAED,cAAc,CAACQ,CAAC,CAACb,KAAK,CAACT,OAAO,CAAC,CAAC;AACzCwB,UAAAA,KAAK,EAAEF;AACT,SAAC,CAAC;AACJ,MAAA;AACA,MAAA,OAAOJ,CAAC;IACV,CAAC,EAAE,EAAE,CAAC;AAENR,IAAAA,gBAAgB,CACbe,IAAI,CAACJ,eAAe,CAAC,CACrBK,IAAI,CAAC,MAAM,CAAC,CACZC,OAAO,CAAC,uBAAuB,EAAE,IAAI,CAAC,CACtCC,IAAI,CAAC,GAAG,EAAGC,CAAC,IAAKpB,KAAK,CAACqB,OAAO,CAACD,CAAC,CAACd,OAAO,CAAC,CAAC,CAC1CgB,KAAK,CAAC,QAAQ,EAAGF,CAAC,IAAKpB,KAAK,CAACL,eAAe,CAACyB,CAAC,CAACL,KAAK,CAAC,CAAC,CACtDO,KAAK,CAAC,cAAc,EAAGF,CAAC,IAAKpB,KAAK,CAACJ,oBAAoB,CAACwB,CAAC,CAACL,KAAK,CAAC,CAAC;AACtE,EAAA,CAAC,CAAC;AACN;;;;"}