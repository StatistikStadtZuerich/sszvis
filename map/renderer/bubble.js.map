{"version":3,"file":"bubble.js","sources":["../../../src/map/renderer/bubble.js"],"sourcesContent":["/**\n * @module sszvis/map/anchoredCircles\n *\n * Creates circles which are anchored to the positions of map elements. Used in the \"bubble chart\".\n * You will usually want to pass this component, configured, as the .anchoredShape property of a base\n * map component.\n *\n * @property {Object} mergedData                    Used internally by the base map component which renders this. Is a merged dataset used to render the shapes\n * @property {Function} mapPath                     Used internally by the base map component which renders this. Is a path generation function which provides projections.\n * @property {Number, Function} radius              The radius of the circles. Can be a function which accepts a datum and returns a radius value.\n * @property {Color, Function} fill                 The fill color of the circles. Can be a function\n * @property {Color, Function} strokeColor          The stroke color of the circles. Can be a function\n * @property {Boolean} transition                   Whether or not to transition the sizes of the circles when data changes. Default true\n *\n * @return {sszvis.component}\n */\n\nimport { dispatch, select } from \"d3\";\nimport { component } from \"../../d3-component.js\";\nimport * as fn from \"../../fn.js\";\nimport translateString from \"../../svgUtils/translateString.js\";\nimport { defaultTransition } from \"../../transition.js\";\nimport { getGeoJsonCenter } from \"../mapUtils.js\";\n\nconst datumAcc = fn.prop(\"datum\");\n\nexport default function () {\n  const event = dispatch(\"over\", \"out\", \"click\");\n\n  const anchoredCirclesComponent = component()\n    .prop(\"mergedData\")\n    .prop(\"mapPath\")\n    .prop(\"radius\", fn.functor)\n    .prop(\"fill\", fn.functor)\n    .prop(\"strokeColor\", fn.functor)\n    .strokeColor(\"#ffffff\")\n    .prop(\"strokeWidth\", fn.functor)\n    .strokeWidth(1)\n    .prop(\"transition\")\n    .transition(true)\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      const radiusAcc = fn.compose(props.radius, datumAcc);\n\n      const anchoredCircles = selection\n        .selectGroup(\"anchoredCircles\")\n        .selectAll(\".sszvis-anchored-circle\")\n        .data(props.mergedData, (d) => d.geoJson.id)\n        .join(\"circle\")\n        .attr(\"class\", \"sszvis-anchored-circle sszvis-anchored-circle--entering\")\n        .attr(\"r\", radiusAcc)\n        .on(\"mouseover\", function (d) {\n          event.call(\"over\", this, d.datum);\n        })\n        .on(\"mouseout\", function (d) {\n          event.call(\"out\", this, d.datum);\n        })\n        .on(\"click\", function (d) {\n          event.call(\"click\", this, d.datum);\n        })\n        .attr(\"transform\", (d) => {\n          const position = props.mapPath.projection()(getGeoJsonCenter(d.geoJson));\n          return translateString(position[0], position[1]);\n        })\n        .style(\"fill\", (d) => props.fill(d.datum))\n        .style(\"stroke\", (d) => props.strokeColor(d.datum))\n        .style(\"stroke-width\", (d) => props.strokeWidth(d.datum))\n        .sort((a, b) => props.radius(b.datum) - props.radius(a.datum));\n\n      // Remove the --entering modifier from the updating circles\n      anchoredCircles.classed(\"sszvis-anchored-circle--entering\", false);\n\n      if (props.transition) {\n        const t = defaultTransition();\n        anchoredCircles.exit().transition(t).attr(\"r\", 0).remove();\n\n        anchoredCircles.transition(t).attr(\"r\", radiusAcc);\n      } else {\n        anchoredCircles.exit().remove();\n        anchoredCircles.attr(\"r\", radiusAcc);\n      }\n    });\n\n  anchoredCirclesComponent.on = function () {\n    const value = event.on.apply(event, arguments);\n    return value === event ? anchoredCirclesComponent : value;\n  };\n\n  return anchoredCirclesComponent;\n}\n"],"names":["datumAcc","fn","event","dispatch","anchoredCirclesComponent","component","prop","strokeColor","strokeWidth","transition","render","selection","select","props","radiusAcc","radius","anchoredCircles","selectGroup","selectAll","data","mergedData","d","geoJson","id","join","attr","on","call","datum","position","mapPath","projection","getGeoJsonCenter","translateString","style","fill","sort","a","b","classed","t","defaultTransition","exit","remove","value","apply","arguments"],"mappings":"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"}