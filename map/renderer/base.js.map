{"version":3,"file":"base.js","sources":["../../../src/map/renderer/base.js"],"sourcesContent":["/**\n * base renderer component\n *\n * @module sszvis/map/renderer/base\n *\n * A component used internally for rendering the base layer of maps.\n * These map entities have a color fill, which is possibly a pattern that represents\n * missing values. They are also event targets. If your map has nothing else, it should have a\n * base layer.\n *\n * @property {GeoJson} geoJson                        The GeoJson object to be rendered by this map layer.\n * @property {d3.geo.path} mapPath                    A path-generator function used to create the path data string of the provided GeoJson.\n * @property {Object} mergedData                      This should be an array of merged data objects. Each object should have a datum property (the datum for\n *                                                    the map entity) and a geoJson property (the geoJson shape for the map entity). This component renders the\n *                                                    geoJson data and uses the datum to get properties of the shape, like fill color and tooltip data.\n * @property {Boolean, Function} defined              A predicate function used to determine whether a datum has a defined value.\n *                                                    Map entities with data values that fail this predicate test will display the missing value texture.\n * @property {String, Function} fill                  A string or function for the fill of the map entities\n * @property {Boolean} transitionColor                Whether or not to transition the fill color of the map entities. (default: true)\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../../fn.js\";\nimport ensureDefsElement from \"../../svgUtils/ensureDefsElement.js\";\nimport { mapMissingValuePattern } from \"../../patterns.js\";\nimport { slowTransition } from \"../../transition.js\";\nimport tooltipAnchor from \"../../annotation/tooltipAnchor.js\";\nimport { getGeoJsonCenter } from \"../mapUtils.js\";\nimport { component } from \"../../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"mergedData\")\n    .prop(\"geoJson\")\n    .prop(\"mapPath\")\n    .prop(\"defined\", fn.functor)\n    .defined(true) // a predicate function to determine whether a datum has a defined value\n    .prop(\"fill\", fn.functor)\n    .fill(() => \"black\") // a function for the entity fill color. default is black\n    .prop(\"transitionColor\")\n    .transitionColor(true)\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      // render the missing value pattern\n      ensureDefsElement(selection, \"pattern\", \"missing-pattern\").call(mapMissingValuePattern);\n\n      // map fill function - returns the missing value pattern if the datum doesn't exist or fails the props.defined test\n      function getMapFill(d) {\n        return props.defined(d.datum) ? props.fill(d.datum) : \"url(#missing-pattern)\";\n      }\n\n      const mapAreas = selection\n        .selectAll(\".sszvis-map__area\")\n        .data(props.mergedData)\n        .join(\"path\")\n        .classed(\"sszvis-map__area\", true)\n        .classed(\"sszvis-map__area--entering\", true)\n        .attr(\"data-event-target\", \"\")\n        .attr(\"fill\", getMapFill)\n        .classed(\"sszvis-map__area--entering\", false);\n\n      selection.selectAll(\".sszvis-map__area--undefined\").attr(\"fill\", getMapFill);\n\n      // change the fill if necessary\n      mapAreas\n        .classed(\n          \"sszvis-map__area--undefined\",\n          (d) => !fn.defined(d.datum) || !props.defined(d.datum)\n        )\n        .attr(\"d\", (d) => props.mapPath(d.geoJson));\n\n      if (props.transitionColor) {\n        mapAreas.transition().call(slowTransition).attr(\"fill\", getMapFill);\n      } else {\n        mapAreas.attr(\"fill\", getMapFill);\n      }\n\n      // the tooltip anchor generator\n      const ta = tooltipAnchor().position((d) =>\n        props.mapPath.projection()(getGeoJsonCenter(d.geoJson))\n      );\n\n      const tooltipGroup = selection.selectGroup(\"tooltipAnchors\").datum(props.mergedData);\n\n      // attach tooltip anchors\n      tooltipGroup.call(ta);\n    });\n}\n"],"names":["component","prop","fn","defined","fill","transitionColor","render","selection","select","props","ensureDefsElement","call","mapMissingValuePattern","getMapFill","d","datum","mapAreas","selectAll","data","mergedData","join","classed","attr","mapPath","geoJson","transition","slowTransition","ta","tooltipAnchor","position","projection","getGeoJsonCenter","tooltipGroup","selectGroup"],"mappings":"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"}