<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Line chart</title>
  <style>

.line {
  fill: none;
  stroke: steelblue;
  stroke-width: 1.5px;
}

.sailor{
  fill: steelblue;
  stroke: none;
}

</style>
</head>
<body style="margin:0;padding:0;">
<link href='../../sszvis.css' rel='stylesheet' />
<script src="../../vendor/d3/d3.min.js"></script>
<script src="../../sszvis.js"></script>

<div id="sszvis-chart"></div>

<script data-catalog-project-expose="script.js">
(function(d3, sszvis) {
  'use strict';
 
  var xAcc = function(d){
    return d.x;
  }

  var yAcc = function(d){
    return d.y;
  }

  var speed = 0.1;
  var xScale;
  var yScale;
  var saildot;

  /* Application state
  ----------------------------------------------- */
  var state = {
    data: [],
    sailor: {}
  };


  /* State transitions
  ----------------------------------------------- */
  var actions = {
    prepareState: function(data) {
      console.log('prepareState');
      state.data = data;
      state.sailor.x = state.data[0].x;
      state.sailor.y = state.data[0].y;
      state.sailor.vx = speed*(state.data[1].x - state.data[0].x);
      state.sailor.vy = speed*(state.data[1].y - state.data[0].y);
      render(state);
    },
    update: function(){
      console.log('udpate');
      var start = new Date().getTime();
     // state.data[0] = Math.random()*10;
     state.sailor.x += state.sailor.vx;
     state.sailor.y += state.sailor.vy;
     
      //saildot = d3.selectAll('.sailor');//.data([state.sailor]);
     saildot
         // .transition()
         // .duration(1000)
          .attr('cx', function(d){
            return xScale(xAcc(d));
          })
          .attr('cy', function(d){return yScale(yAcc(d));});
         // .attr('r', 7);

    var end = new Date().getTime();
    var time = end - start;
    console.log('time',time);
    }
  };

  var dat = [{x: 100, y: 250}, {x: 30, y: 50}];


  actions.prepareState(dat);

  /* Render
  ----------------------------------------------- */
  function render(state) {

    var start = new Date().getTime();

    var width = 600;
    var height = 400;
    console.log('render');
    console.log(state.data);

     xScale = d3.scale.linear().range([0,width]).domain([0,d3.max(state.data,xAcc)+50]);
     yScale = d3.scale.linear().range([height,0]).domain([0,d3.max(state.data,yAcc)+50]);


    var line = d3.svg.line()
      .x(function(d){return xScale(xAcc(d));})
      .y(function(d){return yScale(yAcc(d));});


//container creation 
var svg = d3.select("body").selectAll('svg').data([0]);
    var svgEnter = svg.enter().append('svg')
        .attr("width", width)
      .attr("height", height);

var viewport =  svg.selectAll('.dataLayer').data([0]);
viewport.enter().append('g').classed('dataLayer',true).attr("transform", "translate(" + 0 + "," + 0 + ")");



//console.log('viewport',viewport);
    var path = viewport.selectAll('.line')
          .data([state.data]);
    
        path.enter().append('path')
        .classed('line', true);

        path.exit().remove();

      path
          .transition()
          .duration(1000)
          .attr('d', line);


     var dots = viewport.selectAll('.circle')
          .data(state.data);

        dots.enter()
          .append('circle')
          .classed('circle', true);

        dots.exit().remove();

        dots
          .transition()
          .duration(1000)
          .attr('cx', function(d){
            return xScale(xAcc(d));
          })
          .attr('cy', function(d){return yScale(yAcc(d));})
          .attr('r', 5);

     saildot = viewport.selectAll('.sailor').data([state.sailor]);
      saildot.enter()
          .append('circle')
          .classed('sailor', true);
        saildot.exit().remove();

        saildot
          .transition()
          .duration(1000)
          .attr('cx', function(d){
            return xScale(xAcc(d));
          })
          .attr('cy', function(d){return yScale(yAcc(d));})
          .attr('r', 7);
  
    //interaction
    d3.select("body").on("keydown", actions.update);

    var end = new Date().getTime();
    var time = end - start;
    console.log('time',time);
  }

}(d3, sszvis));
</script>
</body>
</html>
