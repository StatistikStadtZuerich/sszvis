<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Line chart</title>
  <style>

.line {
  fill: none;
  stroke: steelblue;
  stroke-width: 1.5px;
}

</style>
</head>
<body style="margin:0;padding:0;">
<link href='../sszvis.css' rel='stylesheet' />
<script src="../vendor/d3/d3.min.js"></script>
<script src="../sszvis.js"></script>

<div id="sszvis-chart"></div>

<script data-catalog-project-expose="script.js">
(function(d3, sszvis) {
  'use strict';

 


  /* Application state
  ----------------------------------------------- */
  var state = {
    data: []
  };


  /* State transitions
  ----------------------------------------------- */
  var actions = {
    prepareState: function(data) {
      console.log('prepareState');
      state.data = data;
      render(state);
    },
    changeData: function(){
      console.log('changeData');
     // state.data[0] = Math.random()*10;
     state.data = dat2;
      render(state);
    }
  };

  var dat = [{ key: 'a', val: 1},{key: 'b',val: 5},{key: 'c',val: 10}];
  var dat2 = [{ key: 'c', val: 5},{key: 'b',val: 3},{key: 'a',val: 10}];

  actions.prepareState(dat);

  /* Render
  ----------------------------------------------- */
  function render(state) {

    var width = 600;
    var height = 400;
    console.log('render');
    console.log(state.data);
    var maxVal = d3.max(state.data,function(d){return d.val;});
    var xScale = d3.scale.linear().range([0,width]).domain([0,state.data.length]);
    var yScale = d3.scale.linear().range([height,0]).domain([0,10]);
    var rScale = d3.scale.linear().range([3,30]).domain([0,maxVal]);

/*
    var line = d3.svg.line()
      .x(function(d,i) { return xScale(i); })
      .y(function(d,i) { return yScale(d.val); });
      */

//container creation 
var svg = d3.select("body").selectAll('svg').data([0]);
    var svgEnter = svg.enter().append('svg')
        .attr("width", width)
      .attr("height", height);

var viewport =  svg.selectAll('.dataLayer').data([0]);
viewport.enter().append('g').classed('dataLayer',true).attr("transform", "translate(" + 0 + "," + 0 + ")");


/*
    var svg = d3.select("body").append("svg")
      .attr("width", width)
      .attr("height", height)
      .append("g")
      .attr("transform", "translate(" + 0 + "," + 0 + ")");
*/

//console.log('viewport',viewport);
   /* var path = viewport.selectAll('.line')
          .data([state.data]);
    
        path.enter().append('path')
        .classed('line', true);

        path.exit().remove();

      path
          .transition()
          .duration(1000)
          .attr('d', line);*/


     var dots = viewport.selectAll('.circle')
          .data(state.data,function(d,i){ return d.key;});

        dots.enter()
          .append('circle')
          .classed('circle', true);

        dots.exit().remove();

        dots
          .transition()
          .duration(1000)
          .attr('cx', function(d,i){
            return xScale(i);
          })
          .attr('cy', 100)
          .attr('r', function(d){
            return rScale(d.val);
          });
  
    //interaction
    d3.select("body").on("keydown", actions.changeData);

  }

}(d3, sszvis));
</script>
</body>
</html>
