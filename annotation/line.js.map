{"version":3,"file":"line.js","sources":["../../src/annotation/line.js"],"sourcesContent":["/**\n * Line annotation\n *\n * A component for creating reference line data areas. The component should be passed\n * an array of data values, each of which will be used to render a reference line\n * by passing it through the accessor functions. You can specify a caption to display,\n * which will be positioned by default at the midpoint of the line you specify,\n * aligned with the angle of the line. The caption can be offset from the midpoint\n * by specifying dx or dy properties.\n *\n * @module sszvis/annotation/line\n *\n * @param {any} x1             The x-value, in data units, of the first reference line point.\n * @param {any} x2             The x-value, in data units, of the second reference line point.\n * @param {any} y1             The y-value, in data units, of the first reference line point.\n * @param {any} y2             The y-value, in data units, of the second reference line point.\n * @param {function} xScale         The x-scale of the chart. Used to transform the given x- values into chart coordinates.\n * @param {function} yScale         The y-scale of the chart. Used to transform the given y- values into chart coordinates.\n * @param {number} [dx]           The x-offset of the caption\n * @param {number} [dy]           The y-offset of the caption\n * @param {string} [caption]      A reference line caption. (default position is centered at the midpoint of the line, aligned with the slope angle of the line)\n * @returns {sszvis.component} a linear data area component (reference line)\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { component } from \"../d3-component.js\";\n\n// reference line specified in the form y = mx + b\n// user supplies m and b\n// default line is y = x\n\nexport default function () {\n  return component()\n    .prop(\"x1\")\n    .prop(\"x2\")\n    .prop(\"y1\")\n    .prop(\"y2\")\n    .prop(\"xScale\")\n    .prop(\"yScale\")\n    .prop(\"dx\", fn.functor)\n    .dx(0)\n    .prop(\"dy\", fn.functor)\n    .dy(0)\n    .prop(\"caption\", fn.functor)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const x1 = props.xScale(props.x1);\n      const y1 = props.yScale(props.y1);\n      const x2 = props.xScale(props.x2);\n      const y2 = props.yScale(props.y2);\n\n      const line = selection\n        .selectAll(\".sszvis-referenceline\")\n        .data(data)\n        .join(\"line\")\n        .classed(\"sszvis-referenceline\", true);\n\n      line.attr(\"x1\", x1).attr(\"y1\", y1).attr(\"x2\", x2).attr(\"y2\", y2);\n\n      if (props.caption) {\n        const caption = selection\n          .selectAll(\".sszvis-referenceline__caption\")\n          .data([0])\n          .join(\"text\")\n          .classed(\"sszvis-referenceline__caption\", true);\n\n        caption\n          .attr(\"transform\", () => {\n            const vx = x2 - x1;\n            const vy = y2 - y1;\n            const angle = (Math.atan2(vy, vx) * 180) / Math.PI;\n            return \"translate(\" + (x1 + x2) / 2 + \",\" + (y1 + y2) / 2 + \") rotate(\" + angle + \")\";\n          })\n          .attr(\"dx\", props.dx)\n          .attr(\"dy\", props.dy)\n          .text(props.caption);\n      }\n    });\n}\n"],"names":["component","prop","fn","dx","dy","render","data","selection","select","props","x1","xScale","y1","yScale","x2","y2","line","selectAll","join","classed","attr","caption","vx","vy","angle","Math","atan2","PI","text"],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAOA;AACA;AACA;;AAEe,aAAA,IAAY;AACzB,EAAA,OAAOA,SAAS,EAAE,CACfC,IAAI,CAAC,IAAI,CAAC,CACVA,IAAI,CAAC,IAAI,CAAC,CACVA,IAAI,CAAC,IAAI,CAAC,CACVA,IAAI,CAAC,IAAI,CAAC,CACVA,IAAI,CAAC,QAAQ,CAAC,CACdA,IAAI,CAAC,QAAQ,CAAC,CACdA,IAAI,CAAC,IAAI,EAAEC,OAAU,CAAC,CACtBC,EAAE,CAAC,CAAC,CAAC,CACLF,IAAI,CAAC,IAAI,EAAEC,OAAU,CAAC,CACtBE,EAAE,CAAC,CAAC,CAAC,CACLH,IAAI,CAAC,SAAS,EAAEC,OAAU,CAAC,CAC3BG,MAAM,CAAC,UAAUC,IAAI,EAAE;AACtB,IAAA,MAAMC,SAAS,GAAGC,MAAM,CAAC,IAAI,CAAC;AAC9B,IAAA,MAAMC,KAAK,GAAGF,SAAS,CAACE,KAAK,EAAE;IAE/B,MAAMC,EAAE,GAAGD,KAAK,CAACE,MAAM,CAACF,KAAK,CAACC,EAAE,CAAC;IACjC,MAAME,EAAE,GAAGH,KAAK,CAACI,MAAM,CAACJ,KAAK,CAACG,EAAE,CAAC;IACjC,MAAME,EAAE,GAAGL,KAAK,CAACE,MAAM,CAACF,KAAK,CAACK,EAAE,CAAC;IACjC,MAAMC,EAAE,GAAGN,KAAK,CAACI,MAAM,CAACJ,KAAK,CAACM,EAAE,CAAC;IAEjC,MAAMC,IAAI,GAAGT,SAAS,CACnBU,SAAS,CAAC,uBAAuB,CAAC,CAClCX,IAAI,CAACA,IAAI,CAAC,CACVY,IAAI,CAAC,MAAM,CAAC,CACZC,OAAO,CAAC,sBAAsB,EAAE,IAAI,CAAC;IAExCH,IAAI,CAACI,IAAI,CAAC,IAAI,EAAEV,EAAE,CAAC,CAACU,IAAI,CAAC,IAAI,EAAER,EAAE,CAAC,CAACQ,IAAI,CAAC,IAAI,EAAEN,EAAE,CAAC,CAACM,IAAI,CAAC,IAAI,EAAEL,EAAE,CAAC;IAEhE,IAAIN,KAAK,CAACY,OAAO,EAAE;MACjB,MAAMA,OAAO,GAAGd,SAAS,CACtBU,SAAS,CAAC,gCAAgC,CAAC,CAC3CX,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CACTY,IAAI,CAAC,MAAM,CAAC,CACZC,OAAO,CAAC,+BAA+B,EAAE,IAAI,CAAC;AAEjDE,MAAAA,OAAO,CACJD,IAAI,CAAC,WAAW,EAAE,MAAM;AACvB,QAAA,MAAME,EAAE,GAAGR,EAAE,GAAGJ,EAAE;AAClB,QAAA,MAAMa,EAAE,GAAGR,EAAE,GAAGH,EAAE;AAClB,QAAA,MAAMY,KAAK,GAAIC,IAAI,CAACC,KAAK,CAACH,EAAE,EAAED,EAAE,CAAC,GAAG,GAAG,GAAIG,IAAI,CAACE,EAAE;QAClD,OAAO,YAAY,GAAG,CAACjB,EAAE,GAAGI,EAAE,IAAI,CAAC,GAAG,GAAG,GAAG,CAACF,EAAE,GAAGG,EAAE,IAAI,CAAC,GAAG,WAAW,GAAGS,KAAK,GAAG,GAAG;MACvF,CAAC,CAAC,CACDJ,IAAI,CAAC,IAAI,EAAEX,KAAK,CAACN,EAAE,CAAC,CACpBiB,IAAI,CAAC,IAAI,EAAEX,KAAK,CAACL,EAAE,CAAC,CACpBwB,IAAI,CAACnB,KAAK,CAACY,OAAO,CAAC;AACxB,IAAA;AACF,EAAA,CAAC,CAAC;AACN;;;;"}