{"version":3,"file":"tooltipAnchor.js","sources":["../../src/annotation/tooltipAnchor.js"],"sourcesContent":["/**\n * Tooltip anchor annotation\n *\n * Tooltip anchors are invisible SVG <rect>s that each component needs to\n * provide. Because they are real elements we can know their exact position\n * on the page without any calculations and even if the parent element has\n * been transformed. These elements need to be <rect>s because some browsers\n * don't calculate positon information for the better suited <g> elements.\n *\n * Tooltips can be bound to by selecting for the tooltip data attribute.\n *\n * @module sszvis/annotation/tooltipAnchor\n *\n * @example\n * var tooltip = sszvis.tooltip();\n * bars.selectAll('[data-tooltip-anchor]').call(tooltip);\n *\n * Tooltips use HTML5 data attributes to clarify their intent, which is not\n * to style an element but to provide an anchor that can be selected using\n * Javascript.\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Using_data_attributes\n * @see https://developer.mozilla.org/en-US/docs/Web/CSS/Attribute_selectors\n *\n * To add a tooltip anchor to an element, create a new tooltip anchor function\n * and call it on a selection. This is usually the same selection that you have\n * added the visible elements of your chart to, e.g. the selection that you\n * render bar <rect>s into.\n *\n * @example\n * var tooltipAnchor = sszvis.tooltipAnchor()\n *   .position(function(d) {\n *     return [xScale(d), yScale(d)];\n *   });\n * selection.call(tooltipAnchor);\n *\n * @property {function} position A vector of the tooltip's [x, y] coordinates\n * @property {boolean}  debug    Renders a visible tooltip anchor when true\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\nimport { component } from \"../d3-component.js\";\nimport * as fn from \"../fn.js\";\nimport translateString from \"../svgUtils/translateString.js\";\n\n/* Helper functions\n  ----------------------------------------------- */\nfunction vectorToTranslateString(vec) {\n  return translateString.apply(null, vec);\n}\n\nexport default function () {\n  return component()\n    .prop(\"position\")\n    .position(fn.functor([0, 0]))\n    .prop(\"debug\")\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const anchor = selection\n        .selectAll(\"[data-tooltip-anchor]\")\n        .data(data)\n        .join(\"rect\")\n        .attr(\"height\", 1)\n        .attr(\"width\", 1)\n        .attr(\"fill\", \"none\")\n        .attr(\"stroke\", \"none\")\n        .attr(\"visibility\", \"none\")\n        .attr(\"data-tooltip-anchor\", \"\");\n\n      // Update\n\n      anchor.attr(\"transform\", fn.compose(vectorToTranslateString, props.position));\n\n      // Visible anchor if debug is true\n      if (props.debug) {\n        const referencePoint = selection\n          .selectAll(\"[data-tooltip-anchor-debug]\")\n          .data(data)\n          .join(\"circle\")\n          .attr(\"data-tooltip-anchor-debug\", \"\");\n\n        referencePoint\n          .attr(\"r\", 2)\n          .attr(\"fill\", \"#fff\")\n          .attr(\"stroke\", \"#f00\")\n          .attr(\"stroke-width\", 1.5)\n          .attr(\"transform\", fn.compose(vectorToTranslateString, props.position));\n      }\n    });\n}\n"],"names":["vectorToTranslateString","vec","translateString","apply","component","prop","position","fn","render","data","selection","select","props","anchor","selectAll","join","attr","debug","referencePoint"],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAOA;AACA;AACA,SAASA,uBAAuBA,CAACC,GAAG,EAAE;AACpC,EAAA,OAAOC,eAAe,CAACC,KAAK,CAAC,IAAI,EAAEF,GAAG,CAAC;AACzC;AAEe,sBAAA,IAAY;AACzB,EAAA,OAAOG,SAAS,EAAE,CACfC,IAAI,CAAC,UAAU,CAAC,CAChBC,QAAQ,CAACC,OAAU,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAC5BF,IAAI,CAAC,OAAO,CAAC,CACbG,MAAM,CAAC,UAAUC,IAAI,EAAE;AACtB,IAAA,MAAMC,SAAS,GAAGC,MAAM,CAAC,IAAI,CAAC;AAC9B,IAAA,MAAMC,KAAK,GAAGF,SAAS,CAACE,KAAK,EAAE;IAE/B,MAAMC,MAAM,GAAGH,SAAS,CACrBI,SAAS,CAAC,uBAAuB,CAAC,CAClCL,IAAI,CAACA,IAAI,CAAC,CACVM,IAAI,CAAC,MAAM,CAAC,CACZC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC,CACjBA,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,CAChBA,IAAI,CAAC,MAAM,EAAE,MAAM,CAAC,CACpBA,IAAI,CAAC,QAAQ,EAAE,MAAM,CAAC,CACtBA,IAAI,CAAC,YAAY,EAAE,MAAM,CAAC,CAC1BA,IAAI,CAAC,qBAAqB,EAAE,EAAE,CAAC;;AAElC;;AAEAH,IAAAA,MAAM,CAACG,IAAI,CAAC,WAAW,EAAET,OAAU,CAACP,uBAAuB,EAAEY,KAAK,CAACN,QAAQ,CAAC,CAAC;;AAE7E;IACA,IAAIM,KAAK,CAACK,KAAK,EAAE;MACf,MAAMC,cAAc,GAAGR,SAAS,CAC7BI,SAAS,CAAC,6BAA6B,CAAC,CACxCL,IAAI,CAACA,IAAI,CAAC,CACVM,IAAI,CAAC,QAAQ,CAAC,CACdC,IAAI,CAAC,2BAA2B,EAAE,EAAE,CAAC;AAExCE,MAAAA,cAAc,CACXF,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,CACZA,IAAI,CAAC,MAAM,EAAE,MAAM,CAAC,CACpBA,IAAI,CAAC,QAAQ,EAAE,MAAM,CAAC,CACtBA,IAAI,CAAC,cAAc,EAAE,GAAG,CAAC,CACzBA,IAAI,CAAC,WAAW,EAAET,OAAU,CAACP,uBAAuB,EAAEY,KAAK,CAACN,QAAQ,CAAC,CAAC;AAC3E,IAAA;AACF,EAAA,CAAC,CAAC;AACN;;;;"}