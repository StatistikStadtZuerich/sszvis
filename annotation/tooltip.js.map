{"version":3,"file":"tooltip.js","sources":["../../src/annotation/tooltip.js"],"sourcesContent":["/**\n * Tooltip annotation\n *\n * Use this component to add a tooltip to the document. The tooltip component should be\n * called on a selection of [data-tooltip-anchor], which contain the information necessary to\n * position the tooltip and provide it with data. The tooltip's visibility should be toggled\n * using the .visible property, passing a predicate function. Tooltips will be displayed\n * when .visible returns true.\n *\n * @module sszvis/annotation/tooltip\n *\n * @property {seletion} renderInto      Provide a selection container into which to render the tooltip.\n *                                      Unlike most other components, the tooltip isn't rendered directly into the selection\n *                                      on which it is called. Instead, it's rendered into whichever selection is\n *                                      passed to the renderInto option\n * @property {function} visible         Provide a predicate function which accepts a datum and determines whether the associated\n *                                      tooltip should be visible. (default: false)\n * @property {function} header          A function accepting a datum. The result becomes the header of the tooltip.\n *                                      This function can return:\n *                                      - a plain string\n *                                      - an HTML string to be used as innerHTML\n * @property {function} body            A function accepting a datum. The result becomes the body of the tooltip.\n *                                      This function can return:\n *                                      - a plain string\n *                                      - an HTML string to be used as innerHTML\n *                                      - an array of arrays, which produces a tabular layout where each\n *                                      sub-array is one row in the table.\n * @property {function} orientation     A string or function returning a string which determines the orientation. This determines\n *                                      which direction the tooltip sits relative to its point.\n *                                      Possible values are: \"bottom\" (points down), \"top\" (points upward), \"left\" (points left), and \"right\" (points right).\n *                                      Default is \"bottom\".\n * @property {number} dx                A number for the x-offset of the tooltip\n * @property {number} dy                A number for the y-offset of the tooltip\n * @property {function} opacity         A function or number which determines the opacity of the tooltip. Default is 1.\n *\n * @return {sszvis.component}\n *\n */\n\nimport { select } from \"d3\";\nimport { component } from \"../d3-component.js\";\nimport * as fn from \"../fn.js\";\n\n/* Configuration\n----------------------------------------------- */\nconst SMALL_CORNER_RADIUS = 3;\nconst LARGE_CORNER_RADIUS = 4;\nconst TIP_SIZE = 6;\nconst BLUR_PADDING = 5;\n\n/* Exported module\n----------------------------------------------- */\nexport default function () {\n  const renderer = tooltipRenderer();\n\n  return component()\n    .delegate(\"header\", renderer)\n    .delegate(\"body\", renderer)\n    .delegate(\"orientation\", renderer)\n    .delegate(\"dx\", renderer)\n    .delegate(\"dy\", renderer)\n    .delegate(\"opacity\", renderer)\n    .prop(\"renderInto\")\n    .prop(\"visible\", fn.functor)\n    .visible(false)\n    .renderSelection((selection) => {\n      const props = selection.props();\n      const intoBCR = props.renderInto.node().getBoundingClientRect();\n\n      const tooltipData = [];\n      selection.each(function (d) {\n        if (props.visible(d)) {\n          const thisBCR = this.getBoundingClientRect();\n          const pos = [thisBCR.left - intoBCR.left, thisBCR.top - intoBCR.top];\n          tooltipData.push({\n            datum: d,\n            x: pos[0],\n            y: pos[1],\n          });\n        }\n      });\n\n      props.renderInto.datum(tooltipData).call(renderer);\n    });\n}\n\n/**\n * Tooltip renderer\n * @private\n */\nconst tooltipRenderer = function () {\n  return component()\n    .prop(\"header\")\n    .prop(\"body\")\n    .prop(\"orientation\", fn.functor)\n    .orientation(\"bottom\")\n    .prop(\"dx\", fn.functor)\n    .dx(1)\n    .prop(\"dy\", fn.functor)\n    .dy(1)\n    .prop(\"opacity\", fn.functor)\n    .opacity(1)\n    .renderSelection((selection) => {\n      const tooltipData = selection.datum();\n      const props = selection.props();\n\n      const isDef = fn.defined;\n      const isSmall =\n        (isDef(props.header) && !isDef(props.body)) || (!isDef(props.header) && isDef(props.body));\n\n      // Select tooltip elements\n\n      const tooltip = selection.selectAll(\".sszvis-tooltip\").data(tooltipData).join(\"div\");\n\n      tooltip\n        .style(\"pointer-events\", \"none\")\n        .style(\"opacity\", props.opacity)\n        .style(\"padding-top\", (d) => (props.orientation(d) === \"top\" ? TIP_SIZE + \"px\" : null))\n        .style(\"padding-right\", (d) => (props.orientation(d) === \"right\" ? TIP_SIZE + \"px\" : null))\n        .style(\"padding-bottom\", (d) =>\n          props.orientation(d) === \"bottom\" ? TIP_SIZE + \"px\" : null\n        )\n        .style(\"padding-left\", (d) => (props.orientation(d) === \"left\" ? TIP_SIZE + \"px\" : null))\n        .classed(\"sszvis-tooltip\", true);\n\n      // Enter: tooltip background\n\n      const enterBackground = tooltip\n        .selectAll(\".sszvis-tooltip__background\")\n        .data([0])\n        .join(\"svg\")\n        .attr(\"class\", \"sszvis-tooltip__background\")\n        .attr(\"height\", 0)\n        .attr(\"width\", 0);\n\n      const enterBackgroundPath = enterBackground.selectAll(\"path\").data([0]).join(\"path\");\n\n      if (supportsSVGFilters()) {\n        const filter = enterBackground\n          .selectAll(\"filter\")\n          .data([0])\n          .join(\"filter\")\n          .attr(\"id\", \"sszvisTooltipShadowFilter\")\n          .attr(\"height\", \"150%\");\n\n        filter\n          .selectAll(\"feGaussianBlur\")\n          .data([0])\n          .join(\"feGaussianBlur\")\n          .attr(\"in\", \"SourceAlpha\")\n          .attr(\"stdDeviation\", 2);\n\n        filter\n          .selectAll(\"feComponentTransfer\")\n          .data([0])\n          .join(\"feComponentTransfer\")\n          .selectAll(\"feFuncA\")\n          .data([0])\n          .join(\"feFuncA\")\n          .attr(\"type\", \"linear\")\n          .attr(\"slope\", 0.2);\n\n        const merge = filter.selectAll(\"feMerge\").data([0]).join(\"feMerge\");\n        merge.selectAll(\"feMergeNode\").data([0]).join(\"feMergeNode\"); // Contains the blurred image\n        merge\n          .selectAll(\"feMergeNode\")\n          .data([0])\n          .join(\"feMergeNode\") // Contains the element that the filter is applied to\n          .attr(\"in\", \"SourceGraphic\");\n\n        enterBackgroundPath.attr(\"filter\", \"url(#sszvisTooltipShadowFilter)\");\n      } else {\n        enterBackground.classed(\"sszvis-tooltip__background--fallback\", true);\n      }\n\n      // Enter: tooltip content\n\n      const enterContent = tooltip\n        .selectAll(\".sszvis-tooltip__content\")\n        .data([0])\n        .join(\"div\")\n        .classed(\"sszvis-tooltip__content\", true);\n\n      enterContent\n        .selectAll(\".sszvis-tooltip__header\")\n        .data([0])\n        .join(\"div\")\n        .classed(\"sszvis-tooltip__header\", true);\n\n      enterContent\n        .selectAll(\".sszvis-tooltip__body\")\n        .data([0])\n        .join(\"div\")\n        .classed(\"sszvis-tooltip__body\", true);\n\n      // Update: content\n\n      tooltip\n        .select(\".sszvis-tooltip__header\")\n        .datum(fn.prop(\"datum\"))\n        .html(props.header || fn.functor(\"\"));\n\n      tooltip\n        .select(\".sszvis-tooltip__body\")\n        .datum(fn.prop(\"datum\"))\n        .html((d) => {\n          const body = props.body ? fn.functor(props.body)(d) : \"\";\n          return Array.isArray(body) ? formatTable(body) : body;\n        });\n\n      selection\n        .selectAll(\".sszvis-tooltip\")\n        .classed(\"sszvis-tooltip--small\", isSmall)\n        .each(function (d) {\n          const tip = select(this);\n          // only using dimensions.width and dimensions.height here. Not affected by scroll position\n          const dimensions = tip.node().getBoundingClientRect();\n          const orientation = Reflect.apply(props.orientation, this, arguments);\n\n          // Position tooltip element\n\n          switch (orientation) {\n            case \"top\": {\n              tip\n                .style(\"left\", d.x - dimensions.width / 2 + \"px\")\n                .style(\"top\", d.y + props.dy(d) + \"px\");\n              break;\n            }\n            case \"bottom\": {\n              tip\n                .style(\"left\", d.x - dimensions.width / 2 + \"px\")\n                .style(\"top\", d.y - props.dy(d) - dimensions.height + \"px\");\n              break;\n            }\n            case \"left\": {\n              tip\n                .style(\"left\", d.x + props.dx(d) + \"px\")\n                .style(\"top\", d.y - dimensions.height / 2 + \"px\");\n              break;\n            }\n            case \"right\": {\n              tip\n                .style(\"left\", d.x - props.dx(d) - dimensions.width + \"px\")\n                .style(\"top\", d.y - dimensions.height / 2 + \"px\");\n              break;\n            }\n          }\n\n          // Position background element\n\n          const bgHeight = dimensions.height + 2 * BLUR_PADDING;\n          const bgWidth = dimensions.width + 2 * BLUR_PADDING;\n          tip\n            .select(\".sszvis-tooltip__background\")\n            .attr(\"height\", bgHeight)\n            .attr(\"width\", bgWidth)\n            .style(\"left\", -BLUR_PADDING + \"px\")\n            .style(\"top\", -BLUR_PADDING + \"px\")\n            .select(\"path\")\n            .attr(\n              \"d\",\n              tooltipBackgroundGenerator(\n                [BLUR_PADDING, BLUR_PADDING],\n                [bgWidth - BLUR_PADDING, bgHeight - BLUR_PADDING],\n                orientation,\n                isSmall ? SMALL_CORNER_RADIUS : LARGE_CORNER_RADIUS\n              )\n            );\n        });\n    });\n};\n\n/**\n * formatTable\n */\nfunction formatTable(rows) {\n  const tableBody = rows\n    .map((row) => \"<tr>\" + row.map((cell) => \"<td>\" + cell + \"</td>\").join(\"\") + \"</tr>\")\n    .join(\"\");\n  return '<table class=\"sszvis-tooltip__body__table\">' + tableBody + \"</table>\";\n}\n\nfunction x(d) {\n  return d[0];\n}\nfunction y(d) {\n  return d[1];\n}\nfunction side(cx, cy, x0, y0, x1, y1, showTip) {\n  const mx = x0 + (x1 - x0) / 2;\n  const my = y0 + (y1 - y0) / 2;\n\n  const corner = [\"Q\", cx, cy, x0, y0];\n\n  let tip = [];\n  if (showTip && y0 === y1) {\n    tip =\n      x0 < x1\n        ? // Top\n          [\"L\", mx - TIP_SIZE, my, \"L\", mx, my - TIP_SIZE, \"L\", mx + TIP_SIZE, my]\n        : // Bottom\n          [\"L\", mx + TIP_SIZE, my, \"L\", mx, my + TIP_SIZE, \"L\", mx - TIP_SIZE, my];\n  } else if (showTip && x0 === x1) {\n    tip =\n      y0 < y1\n        ? // Right\n          [\"L\", mx, my - TIP_SIZE, \"L\", mx + TIP_SIZE, my, \"L\", mx, my + TIP_SIZE]\n        : // Left\n          [\"L\", mx, my + TIP_SIZE, \"L\", mx - TIP_SIZE, my, \"L\", mx, my - TIP_SIZE];\n  }\n\n  const end = [\"L\", x1, y1];\n\n  return [...corner, ...tip, ...end];\n}\n\n/**\n * Tooltip background generator\n *\n * Generates a path description with a tip on the specified side.\n *\n *           top\n *         ________\n *   left |        | right\n *        |___  ___|\n *            \\/\n *          bottom\n *\n * @param  {Vector} a           Top-left corner of the tooltip rectangle (x, y)\n * @param  {Vector} b           Bottom-right corner of the tooltip rectangle (x, y)\n * @param  {String} orientation The tip will point in this direction (top, right, bottom, left)\n *\n * @return {Path}               SVG path description\n */\nfunction tooltipBackgroundGenerator(a, b, orientation, radius) {\n  switch (orientation) {\n    case \"top\": {\n      a[1] = a[1] + TIP_SIZE;\n      break;\n    }\n    case \"bottom\": {\n      b[1] = b[1] - TIP_SIZE;\n      break;\n    }\n    case \"left\": {\n      a[0] = a[0] + TIP_SIZE;\n      break;\n    }\n    case \"right\": {\n      b[0] = b[0] - TIP_SIZE;\n      break;\n    }\n  }\n\n  return [\n    // Start\n    [\"M\", x(a), y(a) + radius],\n    // Top side\n    side(x(a), y(a), x(a) + radius, y(a), x(b) - radius, y(a), orientation === \"top\"),\n    // Right side\n    side(x(b), y(a), x(b), y(a) + radius, x(b), y(b) - radius, orientation === \"right\"),\n    // Bottom side\n    side(x(b), y(b), x(b) - radius, y(b), x(a) + radius, y(b), orientation === \"bottom\"),\n    // Left side\n    side(x(a), y(b), x(a), y(b) - radius, x(a), y(a) + radius, orientation === \"left\"),\n  ]\n    .map((d) => d.join(\" \"))\n    .join(\" \");\n}\n\n/**\n * Detect whether the current browser supports SVG filters\n */\nfunction supportsSVGFilters() {\n  return (\n    window[\"SVGFEColorMatrixElement\"] !== undefined &&\n    SVGFEColorMatrixElement.SVG_FECOLORMATRIX_TYPE_SATURATE == 2\n  );\n}\n"],"names":["SMALL_CORNER_RADIUS","LARGE_CORNER_RADIUS","TIP_SIZE","BLUR_PADDING","renderer","tooltipRenderer","component","delegate","prop","fn","visible","renderSelection","selection","props","intoBCR","renderInto","node","getBoundingClientRect","tooltipData","each","d","thisBCR","pos","left","top","push","datum","x","y","call","orientation","dx","dy","opacity","isDef","isSmall","header","body","tooltip","selectAll","data","join","style","classed","enterBackground","attr","enterBackgroundPath","supportsSVGFilters","filter","merge","enterContent","select","html","Array","isArray","formatTable","tip","dimensions","Reflect","apply","arguments","width","height","bgHeight","bgWidth","tooltipBackgroundGenerator","rows","tableBody","map","row","cell","side","cx","cy","x0","y0","x1","y1","showTip","mx","my","corner","end","a","b","radius","window","undefined","SVGFEColorMatrixElement","SVG_FECOLORMATRIX_TYPE_SATURATE"],"mappings":"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"}