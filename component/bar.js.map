{"version":3,"file":"bar.js","sources":["../../src/component/bar.js"],"sourcesContent":["/**\n * Bar component\n *\n * The bar component is a general-purpose component used to render rectangles, including\n * bars for horizontal and vertical standard and stacked bar charts, bars in the population\n * pyramids, and the boxes of the heat table.\n *\n * The input data should be an array of data values, where each data value contains the information\n * necessary to render a single rectangle. The x-position, y-position, width, and height of each rectangle\n * are then extracted from the data objects using accessor functions.\n *\n * In addition, the user can specify fill and stroke accessor functions. When called, these functions\n * are given each rectangle's data object, and should return a valid fill or stroke color to be applied\n * to the rectangle.\n *\n * The x, y, width, height, fill, and stroke properties may also be specified as constants.\n *\n * @module sszvis/component/bar\n *\n * @property {number, function} x             the x-value of the rectangles. Becomes a functor.\n * @property {number, function} y             the y-value of the rectangles. Becomes a functor.\n * @property {number, function} width         the width-value of the rectangles. Becomes a functor.\n * @property {number, function} height        the height-value of the rectangles. Becomes a functor.\n * @property {string, function} fill          the fill-value of the rectangles. Becomes a functor.\n * @property {string, function} stroke        the stroke-value of the rectangles. Becomes a functor.\n * @property {boolean} centerTooltip          Whether or not to center the tooltip anchor within the bar.\n *                                            The default tooltip anchor position is at the top of the bar,\n *                                            centered in the width dimension. When this property is true,\n *                                            the tooltip anchor will also be centered in the height dimension.\n * @property {Array<Number>} tooltipAnchor    Where, relative to the box formed by the bar, to position the tooltip\n *                                            anchor. This property is overriden if centerTooltip is true. The\n *                                            value should be a two-element array, [x, y], where x is the position (in 0 - 1)\n *                                            of the tooltip in the width dimension, and y is the position (also range 0 - 1)\n *                                            in the height dimension. For example, the upper left corner would be [0, 0],\n *                                            the center of the bar would be [0.5, 0.5], the middle of the right side\n *                                            would be [1, 0.5], and the lower right corner [1, 1]. Used by, for example,\n *                                            the pyramid chart.\n * @property {boolean} transition             Whether or not to transition the visual values of the bar component, when they\n *                                            are changed.\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\nimport tooltipAnchor from \"../annotation/tooltipAnchor.js\";\nimport { component } from \"../d3-component.js\";\nimport * as fn from \"../fn.js\";\nimport { defaultTransition } from \"../transition.js\";\n\n// replaces NaN values with 0\nfunction handleMissingVal(v) {\n  return isNaN(v) ? 0 : v;\n}\n\nexport default function () {\n  return component()\n    .prop(\"x\", fn.functor)\n    .prop(\"y\", fn.functor)\n    .prop(\"width\", fn.functor)\n    .prop(\"height\", fn.functor)\n    .prop(\"fill\", fn.functor)\n    .prop(\"stroke\", fn.functor)\n    .prop(\"centerTooltip\")\n    .prop(\"tooltipAnchor\")\n    .prop(\"transition\")\n    .transition(true)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const xAcc = fn.compose(handleMissingVal, props.x);\n      const yAcc = fn.compose(handleMissingVal, props.y);\n      const wAcc = fn.compose(handleMissingVal, props.width);\n      const hAcc = fn.compose(handleMissingVal, props.height);\n\n      const bars = selection\n        .selectAll(\".sszvis-bar\")\n        .data(data)\n        .join(\"rect\")\n        .classed(\"sszvis-bar\", true)\n        .attr(\"x\", xAcc)\n        .attr(\"y\", yAcc)\n        .attr(\"width\", wAcc)\n        .attr(\"height\", hAcc)\n        .attr(\"fill\", props.fill)\n        .attr(\"stroke\", props.stroke);\n\n      if (props.transition) {\n        bars.transition(defaultTransition());\n      }\n\n      bars.attr(\"x\", xAcc).attr(\"y\", yAcc).attr(\"width\", wAcc).attr(\"height\", hAcc);\n\n      // Tooltip anchors\n      let tooltipPosition;\n      if (props.centerTooltip) {\n        tooltipPosition = (d) => [xAcc(d) + wAcc(d) / 2, yAcc(d) + hAcc(d) / 2];\n      } else if (props.tooltipAnchor) {\n        const uv = props.tooltipAnchor.map(Number.parseFloat);\n        tooltipPosition = (d) => [xAcc(d) + uv[0] * wAcc(d), yAcc(d) + uv[1] * hAcc(d)];\n      } else {\n        tooltipPosition = (d) => [xAcc(d) + wAcc(d) / 2, yAcc(d)];\n      }\n\n      const ta = tooltipAnchor().position(tooltipPosition);\n\n      selection.call(ta);\n    });\n}\n"],"names":["handleMissingVal","v","isNaN","component","prop","fn","transition","render","data","selection","select","props","xAcc","x","yAcc","y","wAcc","width","hAcc","height","bars","selectAll","join","classed","attr","fill","stroke","defaultTransition","tooltipPosition","centerTooltip","d","tooltipAnchor","uv","map","Number","parseFloat","ta","position","call"],"mappings":"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"}