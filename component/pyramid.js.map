{"version":3,"file":"pyramid.js","sources":["../../src/component/pyramid.js"],"sourcesContent":["/**\n * Pyramid component\n *\n * The pyramid component is primarily used to show a distribution of age groups\n * in a population (population pyramid). The chart is mirrored vertically,\n * meaning that it has a horizontal axis that extends in a positive and negative\n * direction having the same domain.\n *\n * This chart's horizontal point of origin is at it's spine, i.e. the center of\n * the chart.\n *\n * @module sszvis/component/pyramid\n *\n * @requires sszvis.component.bar\n *\n * @property {number, d3.scale} [barFill]          The color of a bar\n * @property {number, d3.scale} barHeight          The height of a bar\n * @property {number, d3.scale} barWidth           The width of a bar\n * @property {number, d3.scale} barPosition        The vertical position of a bar\n * @property {Array<number, number>} tooltipAnchor The anchor position for the tooltips. Uses sszvis.component.bar.tooltipAnchor\n *                                                 under the hood to optionally reposition the tooltip anchors in the pyramid chart.\n *                                                 Default value is [0.5, 0.5], which centers tooltips on the bars\n * @property {function}         leftAccessor       Data for the left side\n * @property {function}         rightAccessor      Data for the right side\n * @property {function}         [leftRefAccessor]  Reference data for the left side\n * @property {function}         [rightRefAccessor] Reference data for the right side\n *\n * @return {sszvis.component}\n */\n\nimport { select, line as d3Line } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { defaultTransition } from \"../transition.js\";\nimport bar from \"./bar.js\";\nimport { component } from \"../d3-component.js\";\n\n/* Constants\n----------------------------------------------- */\nconst SPINE_PADDING = 0.5;\n\n/* Module\n----------------------------------------------- */\nexport default function () {\n  return component()\n    .prop(\"barHeight\", fn.functor)\n    .prop(\"barWidth\", fn.functor)\n    .prop(\"barPosition\", fn.functor)\n    .prop(\"barFill\", fn.functor)\n    .barFill(\"#000\")\n    .prop(\"tooltipAnchor\")\n    .tooltipAnchor([0.5, 0.5])\n    .prop(\"leftAccessor\")\n    .prop(\"rightAccessor\")\n    .prop(\"leftRefAccessor\")\n    .prop(\"rightRefAccessor\")\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      // Components\n\n      const leftBar = bar()\n        .x((d) => -SPINE_PADDING - props.barWidth(d))\n        .y(props.barPosition)\n        .height(props.barHeight)\n        .width(props.barWidth)\n        .fill(props.barFill)\n        .tooltipAnchor(props.tooltipAnchor);\n\n      const rightBar = bar()\n        .x(SPINE_PADDING)\n        .y(props.barPosition)\n        .height(props.barHeight)\n        .width(props.barWidth)\n        .fill(props.barFill)\n        .tooltipAnchor(props.tooltipAnchor);\n\n      const leftLine = lineComponent()\n        .barPosition(props.barPosition)\n        .barWidth(props.barWidth)\n        .mirror(true);\n\n      const rightLine = lineComponent().barPosition(props.barPosition).barWidth(props.barWidth);\n\n      // Rendering\n\n      selection.selectGroup(\"left\").datum(props.leftAccessor(data)).call(leftBar);\n\n      selection.selectGroup(\"right\").datum(props.rightAccessor(data)).call(rightBar);\n\n      selection\n        .selectGroup(\"leftReference\")\n        .datum(props.leftRefAccessor ? [props.leftRefAccessor(data)] : [])\n        .call(leftLine);\n\n      selection\n        .selectGroup(\"rightReference\")\n        .datum(props.rightRefAccessor ? [props.rightRefAccessor(data)] : [])\n        .call(rightLine);\n    });\n}\n\nfunction lineComponent() {\n  return component()\n    .prop(\"barPosition\")\n    .prop(\"barWidth\")\n    .prop(\"mirror\")\n    .mirror(false)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const lineGen = d3Line().x(props.barWidth).y(props.barPosition);\n\n      const line = selection\n        .selectAll(\".sszvis-pyramid__referenceline\")\n        .data(data)\n        .join(\"path\")\n        .attr(\"class\", \"sszvis-pyramid__referenceline\");\n\n      line\n        .attr(\"transform\", props.mirror ? \"scale(-1, 1)\" : \"\")\n        .transition(defaultTransition())\n        .attr(\"d\", lineGen);\n    });\n}\n"],"names":["SPINE_PADDING","component","prop","fn","barFill","tooltipAnchor","render","data","selection","select","props","leftBar","bar","x","d","barWidth","y","barPosition","height","barHeight","width","fill","rightBar","leftLine","lineComponent","mirror","rightLine","selectGroup","datum","leftAccessor","call","rightAccessor","leftRefAccessor","rightRefAccessor","lineGen","d3Line","line","selectAll","join","attr","transition","defaultTransition"],"mappings":"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"}