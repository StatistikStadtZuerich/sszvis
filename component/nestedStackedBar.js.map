{"version":3,"file":"nestedStackedBar.js","sources":["../../src/component/nestedStackedBar.js"],"sourcesContent":["/**\n * Nested Stacked Bars Vertical component\n *\n * This component renders a nested stacked bar chart with vertical orientation.\n * It uses the same abstract intermediate representation for the stack, but is rendered\n * using vertical dimensions. Note that using this component will add the properties 'y0'\n * and 'y' to any passed-in data objects, as part of computing the stack intermediate representation.\n * Existing properties with these names will be overwritten.\n *\n * @module sszvis/component/nestedStackedBarsVertical\n *\n * @property {function} offset              Specifies an offset function for positioning the nested groups.\n * @property {function} xScale              Specifies an x-scale for the stack layout. This scale is used to position\n *                                          the elements of each stack, both the left offset value and the width of each stack segment.\n * @property {function} yScale              A y-scale. After the stack is computed, the y-scale is used to position each stack.\n * @property {function} fill                Specify a fill value for the rectangles (default black).\n * @property {function} tooltip             Specify a tooltip function for the rectangles.\n * @property {function} xAcc                Specifies an x-accessor for the stack layout. The result of this function\n *                                          is used to compute the horizontal extent of each element in the stack.\n *                                          The return value must be a number.\n * @property {function} xLabel              Specifies a label for the x-axis.\n * @property {string} slant                 Specifies the slant of the x-axis labels.\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\nimport { axisX } from \"../axis.js\";\nimport { component } from \"../d3-component.js\";\nimport * as fn from \"../fn.js\";\nimport translateString from \"../svgUtils/translateString.js\";\nimport { stackedBarVertical } from \"./stackedBar.js\";\n\nexport const nestedStackedBarsVertical = () =>\n  component()\n    .prop(\"offset\", fn.functor)\n    .prop(\"xScale\", fn.functor)\n    .prop(\"yScale\", fn.functor)\n    .prop(\"fill\", fn.functor)\n    .prop(\"tooltip\", fn.functor)\n    .prop(\"xAcc\", fn.functor)\n    .prop(\"xLabel\", fn.functor)\n    .prop(\"xLabel\", fn.functor)\n    .prop(\"slant\")\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const { offset, xScale, yScale, fill, tooltip, xAcc, xLabel } = props;\n\n      const xAxis = axisX\n        .ordinal()\n        .scale(xScale)\n        .ticks(1)\n        .tickSize(0)\n        .orient(\"bottom\")\n        .slant(props.slant)\n        .title(xLabel);\n\n      const group = selection.selectAll(\"[data-nested-stacked-bars]\").data(data);\n\n      const nestedGroups = group\n        .join(\"g\")\n        .attr(\"data-nested-stacked-bars\", (d) => xAcc(d[0][0].data));\n\n      nestedGroups.attr(\"transform\", (d) => `translate(${offset(d)} 0)`);\n\n      nestedGroups\n        .selectGroup(\"nested-x-axis\")\n        .attr(\"transform\", translateString(0, yScale(0)))\n        .call(xAxis);\n\n      const stackedBars = stackedBarVertical()\n        .xScale(xScale)\n        .width(xScale.bandwidth())\n        .yScale(yScale)\n        .fill(fill);\n\n      const bars = nestedGroups.selectGroup(\"barchart\").call(stackedBars);\n\n      bars.selectAll(\"[data-tooltip-anchor]\").call(tooltip);\n    });\n"],"names":["nestedStackedBarsVertical","component","prop","fn","render","data","selection","select","props","offset","xScale","yScale","fill","tooltip","xAcc","xLabel","xAxis","axisX","ordinal","scale","ticks","tickSize","orient","slant","title","group","selectAll","nestedGroups","join","attr","d","concat","selectGroup","translateString","call","stackedBars","stackedBarVertical","width","bandwidth","bars"],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;MASaA,yBAAyB,GAAGA,MACvCC,SAAS,EAAE,CACRC,IAAI,CAAC,QAAQ,EAAEC,OAAU,CAAC,CAC1BD,IAAI,CAAC,QAAQ,EAAEC,OAAU,CAAC,CAC1BD,IAAI,CAAC,QAAQ,EAAEC,OAAU,CAAC,CAC1BD,IAAI,CAAC,MAAM,EAAEC,OAAU,CAAC,CACxBD,IAAI,CAAC,SAAS,EAAEC,OAAU,CAAC,CAC3BD,IAAI,CAAC,MAAM,EAAEC,OAAU,CAAC,CACxBD,IAAI,CAAC,QAAQ,EAAEC,OAAU,CAAC,CAC1BD,IAAI,CAAC,QAAQ,EAAEC,OAAU,CAAC,CAC1BD,IAAI,CAAC,OAAO,CAAC,CACbE,MAAM,CAAC,UAAUC,IAAI,EAAE;AACtB,EAAA,MAAMC,SAAS,GAAGC,MAAM,CAAC,IAAI,CAAC;AAC9B,EAAA,MAAMC,KAAK,GAAGF,SAAS,CAACE,KAAK,EAAE;EAE/B,MAAM;IAAEC,MAAM;IAAEC,MAAM;IAAEC,MAAM;IAAEC,IAAI;IAAEC,OAAO;IAAEC,IAAI;AAAEC,IAAAA;AAAO,GAAC,GAAGP,KAAK;AAErE,EAAA,MAAMQ,KAAK,GAAGC,KAAK,CAChBC,OAAO,EAAE,CACTC,KAAK,CAACT,MAAM,CAAC,CACbU,KAAK,CAAC,CAAC,CAAC,CACRC,QAAQ,CAAC,CAAC,CAAC,CACXC,MAAM,CAAC,QAAQ,CAAC,CAChBC,KAAK,CAACf,KAAK,CAACe,KAAK,CAAC,CAClBC,KAAK,CAACT,MAAM,CAAC;AAEhB,EAAA,MAAMU,KAAK,GAAGnB,SAAS,CAACoB,SAAS,CAAC,4BAA4B,CAAC,CAACrB,IAAI,CAACA,IAAI,CAAC;EAE1E,MAAMsB,YAAY,GAAGF,KAAK,CACvBG,IAAI,CAAC,GAAG,CAAC,CACTC,IAAI,CAAC,0BAA0B,EAAGC,CAAC,IAAKhB,IAAI,CAACgB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAACzB,IAAI,CAAC,CAAC;AAE9DsB,EAAAA,YAAY,CAACE,IAAI,CAAC,WAAW,EAAGC,CAAC,IAAA,YAAA,CAAAC,MAAA,CAAkBtB,MAAM,CAACqB,CAAC,CAAC,QAAK,CAAC;EAElEH,YAAY,CACTK,WAAW,CAAC,eAAe,CAAC,CAC5BH,IAAI,CAAC,WAAW,EAAEI,eAAe,CAAC,CAAC,EAAEtB,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAChDuB,IAAI,CAAClB,KAAK,CAAC;AAEd,EAAA,MAAMmB,WAAW,GAAGC,kBAAkB,EAAE,CACrC1B,MAAM,CAACA,MAAM,CAAC,CACd2B,KAAK,CAAC3B,MAAM,CAAC4B,SAAS,EAAE,CAAC,CACzB3B,MAAM,CAACA,MAAM,CAAC,CACdC,IAAI,CAACA,IAAI,CAAC;AAEb,EAAA,MAAM2B,IAAI,GAAGZ,YAAY,CAACK,WAAW,CAAC,UAAU,CAAC,CAACE,IAAI,CAACC,WAAW,CAAC;EAEnEI,IAAI,CAACb,SAAS,CAAC,uBAAuB,CAAC,CAACQ,IAAI,CAACrB,OAAO,CAAC;AACvD,CAAC;;;;"}