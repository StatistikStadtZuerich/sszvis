{"version":3,"file":"sszvis.min.js","sources":["../src/d3-selectdiv.js","../src/d3-selectgroup.js","../src/fn.ts","../src/svgUtils/ensureDefsElement.js","../src/color.js","../src/patterns.js","../src/d3-component.js","../src/svgUtils/crisp.js","../src/svgUtils/translateString.js","../src/annotation/tooltipAnchor.js","../src/annotation/rangeFlag.js","../src/locale.ts","../src/format.ts","../src/annotation/tooltip.js","../src/transition.js","../node_modules/immer/dist/immer.mjs","../src/fallback.js","../node_modules/nano-throttle/index.js","../src/viewport/resize.js","../src/app.js","../src/breakpoint.js","../src/aspectRatio.js","../src/logger.js","../src/scale.js","../src/svgUtils/textWrap.js","../src/axis.js","../src/behavior/move.js","../src/behavior/util.js","../src/behavior/voronoi.js","../src/measure.js","../src/bounds.js","../src/cascade.js","../src/component/bar.js","../src/component/pyramid.js","../src/component/stackedBar.js","../src/component/stackedPyramid.js","../src/component/sunburst.js","../src/control/slider.js","../src/legend/ordinalColorScale.js","../src/layout/colorLegendLayout.js","../src/layout/sankey.js","../src/layout/sunburst.js","../src/map/mapUtils.js","../src/map/renderer/bubble.js","../src/map/renderer/base.js","../src/map/renderer/highlight.js","../src/map/renderer/mesh.js","../src/map/renderer/patternedlakeoverlay.js","../src/parse.js","../src/svgUtils/modularText.js","../src/annotation/circle.js","../src/annotation/confidenceArea.js","../src/annotation/line.js","../src/annotation/rangeRuler.js","../src/annotation/rectangle.js","../src/annotation/ruler.js","../src/control/buttonGroup.js","../src/maps/choropleth.js","../src/createHtmlLayer.js","../src/createSvgLayer.js","../src/layout/heatTableDimensions.js","../src/layout/horizontalBarChartDimensions.js","../src/layout/verticalBarChartDimensions.js","../src/component/dot.js","../src/annotation/fitTooltip.js","../src/component/groupedBars.js","../src/control/handleRuler.js","../src/layout/populationPyramidLayout.js","../src/layout/smallMultiples.js","../src/layout/stackedAreaMultiplesLayout.js","../src/legend/binnedColorScale.js","../src/legend/linearColorScale.js","../src/legend/radius.js","../src/component/line.js","../src/loadError.js","../src/map/renderer/geojson.js","../src/map/renderer/image.js","../src/map/renderer/raster.js","../src/component/nestedStackedBar.js","../src/behavior/panning.js","../src/component/pie.js","../src/responsiveProps.js","../src/component/sankey.js","../src/control/select.js","../src/component/stackedArea.js","../src/component/stackedAreaMultiples.js"],"sourcesContent":["import { selection } from \"d3\";\n/**\n * d3.selection plugin to simplify creating idempotent divs that are not\n * recreated when rendered again.\n *\n * @see https://github.com/mbostock/d3/wiki/Selections\n *\n * @param {String} key - the name of the group\n * @return {d3.selection}\n */\nselection.prototype.selectDiv = function (key) {\n  return this.selectAll('[data-d3-selectdiv=\"' + key + '\"]')\n    .data((d) => [d])\n    .join(\"div\")\n    .attr(\"data-d3-selectdiv\", key)\n    .style(\"position\", \"absolute\");\n};\n","import { selection } from \"d3\";\n\n/**\n * d3.selection plugin to simplify creating idempotent groups that are not\n * recreated when rendered again.\n *\n * @see https://github.com/mbostock/d3/wiki/Selections\n *\n * @param  {String} key The name of the group\n * @return {d3.selection}\n */\nselection.prototype.selectGroup = function (key) {\n  return this.selectAll('[data-d3-selectgroup=\"' + key + '\"]')\n    .data((d) => [d])\n    .join(\"g\")\n    .attr(\"data-d3-selectgroup\", key);\n};\n",null,"/**\n * Ensure Defs Element\n *\n * This method ensures that the provided selection contains a 'defs' object,\n * and furthermore, that the defs object contains an instance of the provided\n * element type, with the provided ID.\n *\n * @module sszvis/svgUtils/ensureDefsElement\n *\n * @param {d3.selection} selection\n * @param {string}       type       Element to create\n * @param {string}       elementId  The ID to assign to the created element\n */\n\nexport default function (selection, type, elementId) {\n  return ensureDefsSelection(selection)\n    .selectAll(type + \"#\" + elementId)\n    .data([0])\n    .join(type)\n    .attr(\"id\", elementId);\n}\n\n/* Helper functions\n----------------------------------------------- */\n\n/**\n * This method ensures that the provided selection contains a 'defs' object,\n * which is required for rendering patterns. SVG elements rendered into a defs\n * container will not be displayed, but can be referenced by ID in the fill property\n * of other, visible, elements.\n */\nfunction ensureDefsSelection(selection) {\n  return selection.selectAll(\"defs\").data([0]).join(\"defs\");\n}\n","/**\n * Color scales\n *\n * Three kinds of color scales are provided: qualitative, sequential, and\n * diverging. All color scales can be reversed, qualitative color scales\n * can also be brightened or darkened.\n *\n * @module sszvis/color\n *\n *\n * Qualitative color scales\n *\n * @function qual12    The full range of categorical colors\n * @function qual6     Subset of saturated categorical colors\n * @function qual6a    Subset of blue-green categorical colors\n * @function qual6b    Subset of yellow-red categorical colors\n * @method   darken    Instance method to darken all colors. @returns new scale\n * @method   brighten  Instance method to brighten all colors. @returns new scale\n * @method   reverse   Instance method to reverse the color order. @returns new scale\n *\n *\n * Sequential color scales\n *\n * @function seqBlu    Linear color scale from bright to dark blue\n * @function seqRed    Linear color scale from bright to dark red\n * @function seqGrn    Linear color scale from bright to dark green\n * @function seqBrn    Linear color scale from bright to dark brown\n * @method   reverse   Instance method to reverse the color order. @returns new scale\n *\n *\n * Diverging color scales\n *\n * @function divVal    Diverging and valued color scale from red to blue\n * @function divNtr    Diverging and neutral color scale from brown to green\n * @function divValGry constiation of the valued scale with a grey midpoint\n * @function divNtrGry constiation of the neutral scale with a grey midpoint\n * @method   reverse   Instance method to reverse the color order. @returns new scale\n *\n * Grey color scales\n * @function gry       1-color scale for shaded values\n * @function lightGry  1-color scale for shaded backgrounds\n */\n\nimport { scaleOrdinal, scaleLinear, hsl, rgb, lab, mean, quantile } from \"d3\";\n\n/* Constants\n----------------------------------------------- */\nconst LIGHTNESS_STEP = 1;\n\n/* Scales\n----------------------------------------------- */\nfunction qualColorScale(colors) {\n  return function () {\n    const scale = scaleOrdinal().range(colors.map(convertLab)).unknown(convertLab(colors[0]));\n    return decorateOrdinalScale(scale);\n  };\n}\n\nconst darkBlue = \"#3431DE\";\nconst mediumBlue = \"#0A8DF6\";\nconst lightBlue = \"#23C3F1\";\n\nconst darkRed = \"#7B4FB7\";\nconst mediumRed = \"#DB247D\";\nconst lightRed = \"#FB737E\";\n\nconst darkGreen = \"#007C78\";\nconst mediumGreen = \"#1D942E\";\nconst lightGreen = \"#99C32E\";\n\nconst darkBrown = \"#9A5B01\";\nconst mediumBrown = \"#FF720C\";\nconst lightBrown = \"#FBB900\";\n\nexport const scaleQual12 = qualColorScale([\n  darkBlue,\n  mediumBlue,\n  lightBlue,\n  darkRed,\n  mediumRed,\n  lightRed,\n  darkGreen,\n  mediumGreen,\n  lightGreen,\n  darkBrown,\n  mediumBrown,\n  lightBrown,\n]);\n\nexport const scaleQual6 = qualColorScale([\n  darkBlue,\n  mediumRed,\n  mediumGreen,\n  lightBrown,\n  lightBlue,\n  mediumBrown,\n]);\n\nexport const scaleQual6a = qualColorScale([\n  darkBlue,\n  mediumBlue,\n  lightBlue,\n  darkRed,\n  mediumRed,\n  lightRed,\n]);\n\nexport const scaleQual6b = qualColorScale([\n  darkGreen,\n  mediumGreen,\n  lightGreen,\n  darkBrown,\n  mediumBrown,\n  lightBrown,\n]);\n\nconst female = \"#349894\";\nconst male = \"#FFD736\";\nconst misc = \"#986AD5\";\n\nexport const scaleGender3 = () =>\n  qualColorScale([female, male, misc])().domain([\"Frauen\", \"Männer\", \"Divers\"]);\n\nconst swissFemale = \"#00615D\";\nconst foreignFemale = \"#349894\";\nconst swissMale = \"#DA9C00\";\nconst foreignMale = \"#FFD736\";\nconst swissMisc = \"#5E359A\";\nconst foreignMisc = \"#986AD5\";\n\nexport const scaleGender6Origin = () =>\n  qualColorScale([\n    swissFemale,\n    foreignFemale,\n    swissMale,\n    foreignMale,\n    swissMisc,\n    foreignMisc,\n  ])().domain([\n    \"Schweizerinnen\",\n    \"Ausländerinnen\",\n    \"Schweizer\",\n    \"Ausländer\",\n    \"Divers Schweiz\",\n    \"Divers Ausland\",\n  ]);\n\nconst femaleFemale = \"#349894\";\nconst maleMale = \"#FFD736\";\nconst femaleMale = \"#3431DE\";\nconst femaleUnknown = \"#B8B8B8\";\nconst maleUnknown = \"#D6D6D6\";\n\nexport const scaleGender5Wedding = () =>\n  qualColorScale([femaleFemale, maleMale, femaleMale, femaleUnknown, maleUnknown])().domain([\n    \"Frau / Frau\",\n    \"Mann / Mann\",\n    \"Frau / Mann\",\n    \"Frau / Unbekannt\",\n    \"Mann / Unbekannt\",\n  ]);\n\nfunction seqColorScale(colors) {\n  return function () {\n    const scale = scaleLinear().range(colors.map(convertLab));\n    return decorateLinearScale(scale);\n  };\n}\n\nexport const scaleSeqBlu = seqColorScale([\"#CADEFF\", \"#5B6EFF\", \"#211A8A\"]);\nexport const scaleSeqRed = seqColorScale([\"#FED2EE\", \"#ED408D\", \"#7D0044\"]);\nexport const scaleSeqGrn = seqColorScale([\"#CFEED8\", \"#34B446\", \"#0C4B1F\"]);\nexport const scaleSeqBrn = seqColorScale([\"#FCDDBB\", \"#EA5D00\", \"#611F00\"]);\n\nfunction divColorScale(colors) {\n  return function () {\n    const scale = scaleLinear().range(colors.map(convertLab));\n    return decorateDivScale(scale);\n  };\n}\n\nexport const scaleDivVal = divColorScale([\n  \"#611F00\",\n  \"#A13200\",\n  \"#EA5D00\",\n  \"#FF9A54\",\n  \"#FCDDBB\",\n  \"#CADEFF\",\n  \"#89AFFF\",\n  \"#5B6EFF\",\n  \"#3431DE\",\n  \"#211A8A\",\n]);\nexport const scaleDivValGry = divColorScale([\n  \"#782600\",\n  \"#CC4309\",\n  \"#FF720C\",\n  \"#FFBC88\",\n  \"#E4E0DF\",\n  \"#AECBFF\",\n  \"#6B8EFF\",\n  \"#3B51FF\",\n  \"#2F2ABB\",\n]);\nexport const scaleDivNtr = divColorScale([\n  \"#7D0044\",\n  \"#C4006A\",\n  \"#ED408D\",\n  \"#FF83B9\",\n  \"#FED2EE\",\n  \"#CFEED8\",\n  \"#81C789\",\n  \"#34B446\",\n  \"#1A7F2D\",\n  \"#0C4B1F\",\n]);\nexport const scaleDivNtrGry = divColorScale([\n  \"#A30059\",\n  \"#DB247D\",\n  \"#FF579E\",\n  \"#FFA8D0\",\n  \"#E4E0DF\",\n  \"#A8DBB1\",\n  \"#55BC5D\",\n  \"#1D942E\",\n  \"#10652A\",\n]);\n\nfunction greyColorScale(colors) {\n  return function () {\n    const scale = scaleOrdinal().range(colors.map(convertLab));\n    return decorateLinearScale(scale);\n  };\n}\n\nexport const scaleLightGry = greyColorScale([\"#FAFAFA\"]);\nexport const scalePaleGry = greyColorScale([\"#EAEAEA\"]);\nexport const scaleGry = greyColorScale([\"#D6D6D6\"]);\nexport const scaleDimGry = greyColorScale([\"#B8B8B8\"]);\nexport const scaleMedGry = greyColorScale([\"#7C7C7C\"]);\nexport const scaleDeepGry = greyColorScale([\"#545454\"]);\n\nexport const slightlyDarker = function (c) {\n  return hsl(c).darker(0.4);\n};\n\nexport const muchDarker = function (c) {\n  return hsl(c).darker(0.7);\n};\n\nexport const withAlpha = function (c, a) {\n  const rgbColor = rgb(c);\n  return \"rgba(\" + rgbColor.r + \",\" + rgbColor.g + \",\" + rgbColor.b + \",\" + a + \")\";\n};\n\n/* Scale extensions\n----------------------------------------------- */\nfunction decorateOrdinalScale(scale) {\n  scale.darker = function () {\n    return decorateOrdinalScale(\n      scale.copy().range(scale.range().map((d) => d.brighter(LIGHTNESS_STEP)))\n    );\n  };\n  scale.brighter = function () {\n    return decorateOrdinalScale(\n      scale.copy().range(scale.range().map((d) => d.darker(LIGHTNESS_STEP)))\n    );\n  };\n  scale.reverse = function () {\n    return decorateOrdinalScale(scale.copy().range(scale.range().reverse()));\n  };\n  return scale;\n}\n\nfunction decorateDivScale(scale) {\n  scale = interpolatedDivergentColorScale(scale);\n  scale.reverse = function () {\n    return decorateLinearScale(scale.copy().range(scale.range().reverse()));\n  };\n  return scale;\n}\n\nfunction interpolatedDivergentColorScale(scale) {\n  const nativeDomain = scale.domain;\n  if (!scale.range()) return scale;\n  const length = scale.range().length;\n  scale.domain = function (dom) {\n    if (!dom) return nativeDomain.call(this);\n    const xDomain = [];\n    for (let i = 0; i < length; i++) {\n      xDomain.push(quantile(dom, i / (length - 1)));\n    }\n    return nativeDomain.call(this, xDomain);\n  };\n  return scale;\n}\n\nfunction decorateLinearScale(scale) {\n  scale = interpolatedColorScale(scale);\n  scale.reverse = function () {\n    return decorateLinearScale(scale.copy().range(scale.range().reverse()));\n  };\n  return scale;\n}\n\nfunction interpolatedColorScale(scale) {\n  const nativeDomain = scale.domain;\n  scale.domain = function (dom) {\n    if (arguments.length === 1) {\n      const threeDomain = [dom[0], mean(dom), dom[1]];\n      return nativeDomain.call(this, threeDomain);\n    } else {\n      return Reflect.apply(nativeDomain, this, arguments);\n    }\n  };\n  return scale;\n}\n\n/* Helper functions\n----------------------------------------------- */\nfunction convertLab(d) {\n  return lab(d);\n}\n","/**\n * Patterns module\n *\n * @module sszvis/patterns\n *\n * This module contains svg patterns and pattern helper functions which are used\n * to render important textures for constious other components.\n *\n * @method  heatTableMissingValuePattern    The pattern for the missing values in the heat table\n * @method  mapMissingValuePattern          The pattern for the map areas which are missing values. Used by map.js internally\n * @method  mapLakePattern                  The pattern for Lake Zurich in the map component. Used by map.js internally\n * @method  mapLakeFadeGradient             The pattern which provides a gradient, used by the alpha fade pattern,\n *                                          in the Lake Zurich shape. Used by map.js internally\n * @method  mapLakeGradientMask             The pattern which provides a gradient alpha fade for the Lake Zurich shape.\n *                                           It uses the fadeGradient pattern to create an alpha gradient mask. Used by map.js internally\n * @method  dataAreaPattern                 The pattern for the data area texture.\n *\n */\n\nimport { scaleLightGry } from \"./color.js\";\n\nexport const heatTableMissingValuePattern = function (selection) {\n  const rectFill = scaleLightGry(),\n    crossStroke = \"#A4A4A4\",\n    crossStrokeWidth = 0.035,\n    cross1 = 0.35,\n    cross2 = 0.65;\n\n  selection\n    .attr(\"patternUnits\", \"objectBoundingBox\")\n    .attr(\"patternContentUnits\", \"objectBoundingBox\")\n    .attr(\"x\", 0)\n    .attr(\"y\", 0)\n    .attr(\"width\", 1)\n    .attr(\"height\", 1);\n\n  selection\n    .append(\"rect\")\n    .attr(\"x\", 0)\n    .attr(\"y\", 0)\n    .attr(\"width\", 1)\n    .attr(\"height\", 1)\n    .attr(\"fill\", rectFill);\n\n  selection\n    .append(\"line\")\n    .attr(\"x1\", cross1)\n    .attr(\"y1\", cross1)\n    .attr(\"x2\", cross2)\n    .attr(\"y2\", cross2)\n    .attr(\"stroke-width\", crossStrokeWidth)\n    .attr(\"stroke\", crossStroke);\n\n  selection\n    .append(\"line\")\n    .attr(\"x1\", cross2)\n    .attr(\"y1\", cross1)\n    .attr(\"x2\", cross1)\n    .attr(\"y2\", cross2)\n    .attr(\"stroke-width\", crossStrokeWidth)\n    .attr(\"stroke\", crossStroke);\n};\n\nexport const mapMissingValuePattern = function (selection) {\n  const pWidth = 14,\n    pHeight = 14,\n    fillColor = \"#FAFAFA\",\n    lineStroke = \"#CCCCCC\";\n\n  selection\n    .attr(\"patternUnits\", \"userSpaceOnUse\")\n    .attr(\"patternContentUnits\", \"userSpaceOnUse\")\n    .attr(\"x\", 0)\n    .attr(\"y\", 0)\n    .attr(\"width\", pWidth)\n    .attr(\"height\", pHeight);\n\n  selection\n    .append(\"rect\")\n    .attr(\"x\", 0)\n    .attr(\"y\", 0)\n    .attr(\"width\", pWidth)\n    .attr(\"height\", pHeight)\n    .attr(\"fill\", fillColor);\n\n  selection\n    .append(\"line\")\n    .attr(\"x1\", 1)\n    .attr(\"y1\", 10)\n    .attr(\"x2\", 5)\n    .attr(\"y2\", 14)\n    .attr(\"stroke\", lineStroke);\n\n  selection\n    .append(\"line\")\n    .attr(\"x1\", 5)\n    .attr(\"y1\", 10)\n    .attr(\"x2\", 1)\n    .attr(\"y2\", 14)\n    .attr(\"stroke\", lineStroke);\n\n  selection\n    .append(\"line\")\n    .attr(\"x1\", 8)\n    .attr(\"y1\", 3)\n    .attr(\"x2\", 12)\n    .attr(\"y2\", 7)\n    .attr(\"stroke\", lineStroke);\n\n  selection\n    .append(\"line\")\n    .attr(\"x1\", 12)\n    .attr(\"y1\", 3)\n    .attr(\"x2\", 8)\n    .attr(\"y2\", 7)\n    .attr(\"stroke\", lineStroke);\n};\n\nexport const mapLakePattern = function (selection) {\n  const pWidth = 6;\n  const pHeight = 6;\n  const offset = 0.5;\n\n  selection\n    .attr(\"patternUnits\", \"userSpaceOnUse\")\n    .attr(\"patternContentUnits\", \"userSpaceOnUse\")\n    .attr(\"x\", 0)\n    .attr(\"y\", 0)\n    .attr(\"width\", pWidth)\n    .attr(\"height\", pHeight);\n\n  selection\n    .append(\"rect\")\n    .attr(\"x\", 0)\n    .attr(\"y\", 0)\n    .attr(\"width\", pWidth)\n    .attr(\"height\", pHeight)\n    .attr(\"fill\", \"#fff\");\n\n  selection\n    .append(\"line\")\n    .attr(\"x1\", 0)\n    .attr(\"y1\", pHeight * offset)\n    .attr(\"x2\", pWidth * offset)\n    .attr(\"y2\", 0)\n    .attr(\"stroke\", \"#ddd\")\n    .attr(\"stroke-linecap\", \"square\");\n\n  selection\n    .append(\"line\")\n    .attr(\"x1\", pWidth * offset)\n    .attr(\"y1\", pHeight)\n    .attr(\"x2\", pWidth)\n    .attr(\"y2\", pHeight * offset)\n    .attr(\"stroke\", \"#ddd\")\n    .attr(\"stroke-linecap\", \"square\");\n};\n\nexport const mapLakeFadeGradient = function (selection) {\n  selection\n    .attr(\"x1\", 0)\n    .attr(\"y1\", 0)\n    .attr(\"x2\", 0.55)\n    .attr(\"y2\", 1)\n    .attr(\"id\", \"lake-fade-gradient\");\n\n  selection.append(\"stop\").attr(\"offset\", 0.74).attr(\"stop-color\", \"white\").attr(\"stop-opacity\", 1);\n\n  selection.append(\"stop\").attr(\"offset\", 0.97).attr(\"stop-color\", \"white\").attr(\"stop-opacity\", 0);\n};\n\nexport const mapLakeGradientMask = function (selection) {\n  selection.attr(\"maskContentUnits\", \"objectBoundingBox\");\n\n  selection\n    .append(\"rect\")\n    .attr(\"fill\", \"url(#lake-fade-gradient)\")\n    .attr(\"width\", 1)\n    .attr(\"height\", 1);\n};\n\nexport const dataAreaPattern = function (selection) {\n  const pWidth = 6;\n  const pHeight = 6;\n  const offset = 0.5;\n\n  selection\n    .attr(\"patternUnits\", \"userSpaceOnUse\")\n    .attr(\"patternContentUnits\", \"userSpaceOnUse\")\n    .attr(\"x\", 0)\n    .attr(\"y\", 0)\n    .attr(\"width\", pWidth)\n    .attr(\"height\", pHeight);\n\n  selection\n    .append(\"line\")\n    .attr(\"x1\", 0)\n    .attr(\"y1\", pHeight * offset)\n    .attr(\"x2\", pWidth * offset)\n    .attr(\"y2\", 0)\n    .attr(\"stroke\", \"#e6e6e6\")\n    .attr(\"stroke-width\", 1.1);\n\n  selection\n    .append(\"line\")\n    .attr(\"x1\", pWidth * offset)\n    .attr(\"y1\", pHeight)\n    .attr(\"x2\", pWidth)\n    .attr(\"y2\", pHeight * offset)\n    .attr(\"stroke\", \"#e6e6e6\")\n    .attr(\"stroke-width\", 1.1);\n};\n","import { selection as d3Selection } from \"d3\";\n\n/**\n * d3 plugin to simplify creating reusable charts. Implements\n * the reusable chart interface and can thus be used interchangeably\n * with any other reusable charts.\n *\n * @example\n * var myAxis = sszvis.component()\n *   .prop('ticks').ticks(10)\n *   .render(function(data, i, j) {\n *     var selection = select(this);\n *     var props = selection.props();\n *     var axis = d3.svg.axis().ticks(props.ticks);\n *     selection\n *       .append('g')\n *       .call(axis);\n *   })\n * console.log(myAxis.ticks()); //=> 10\n * select('svg').call(myAxis.ticks(3));\n *\n * @see http://bost.ocks.org/mike/chart/\n *\n * @property {function} prop Define a property accessor\n * @property {function} render The chart's body\n *\n * @return {sszvis.component} A d3 reusable chart\n */\nexport function component() {\n  const props = {};\n  let selectionRenderer = null;\n  let renderer = identity;\n\n  /**\n   * Constructor\n   *\n   * @param  {d3.selection} selection Passed in by d3\n   */\n  function sszvisComponent(selection) {\n    if (selectionRenderer) {\n      selection.props = function () {\n        return clone(props);\n      };\n      selectionRenderer.apply(selection, slice(arguments));\n    }\n    selection.each(function () {\n      this.__props__ = clone(props);\n      renderer.apply(this, slice(arguments));\n    });\n  }\n\n  /**\n   * Define a property accessor with an optional setter\n   *\n   * @param  {String} prop The property's name\n   * @param  {Function} [setter] The setter's context will be bound to the\n   *         sszvis.component. Sets the returned value to the given property\n   * @return {sszvis.component}\n   */\n  sszvisComponent.prop = function (prop, setter) {\n    setter || (setter = identity);\n    sszvisComponent[prop] = accessor(props, prop, setter.bind(sszvisComponent)).bind(\n      sszvisComponent\n    );\n    return sszvisComponent;\n  };\n\n  /**\n   * Delegate a properties' accessors to a delegate object\n   *\n   * @param  {String} prop     The property's name\n   * @param  {Object} delegate The target having getter and setter methods for prop\n   * @return {sszvis.component}\n   */\n  sszvisComponent.delegate = function (prop, delegate) {\n    sszvisComponent[prop] = function () {\n      const result = delegate[prop].apply(delegate, slice(arguments));\n      return arguments.length === 0 ? result : sszvisComponent;\n    };\n    return sszvisComponent;\n  };\n\n  /**\n   * Creates a render context for the given component's parent selection.\n   * Use this, when you need full control over the rendering of the component\n   * and you need access to the full selection instead of just the selection\n   * of one datum.\n   *\n   * @param  {Function} callback\n   * @return {[sszvis.component]}\n   */\n  sszvisComponent.renderSelection = function (callback) {\n    selectionRenderer = callback;\n    return sszvisComponent;\n  };\n\n  /**\n   * Creates a render context for the given component. Implements the\n   * d3.selection.each interface.\n   *\n   * @see https://github.com/mbostock/d3/wiki/Selections#each\n   *\n   * @param  {Function} callback\n   * @return {sszvis.component}\n   */\n  sszvisComponent.render = function (callback) {\n    renderer = callback;\n    return sszvisComponent;\n  };\n\n  return sszvisComponent;\n}\n\n/**\n * d3.selection plugin to get the properties of a sszvis.component.\n * Works similarly to d3.selection.data, but for properties.\n *\n * @see https://github.com/mbostock/d3/wiki/Selections\n *\n * @return {Object} An object of properties for the given component\n */\nd3Selection.prototype.props = function () {\n  // It would be possible to make this work exactly like\n  // d3.selection.data(), but it would need some test cases,\n  // so we currently simplify to the most common use-case:\n  // getting props.\n  if (arguments.length > 0) throw new Error(\"selection.props() does not accept any arguments\");\n  if (this.size() != 1) throw new Error(\"only one group is supported\");\n  if (this._groups[0].length != 1) throw new Error(\"only one node is supported\");\n\n  const group = this._groups[0];\n  const node = group[0];\n  return node.__props__ || {};\n};\n\n/**\n * Creates an accessor function that either gets or sets a value, depending\n * on whether or not it is called with arguments.\n *\n * @param  {Object} props The props to get from or set to\n * @param  {String} attr The property to be accessed\n * @param  {Function} [setter] Transforms the data on set\n * @return {Function} The accessor function\n */\nfunction accessor(props, prop, setter) {\n  setter || (setter = identity);\n  return function () {\n    if (arguments.length === 0) return props[prop];\n\n    props[prop] = setter.apply(null, slice(arguments));\n    return this;\n  };\n}\n\nfunction identity(d) {\n  return d;\n}\n\nfunction slice(array) {\n  return Array.prototype.slice.call(array);\n}\n\nfunction clone(obj) {\n  const copy = {};\n  for (const attr in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, attr)) copy[attr] = obj[attr];\n  }\n  return copy;\n}\n","/**\n * Crisp\n *\n * Utilities to render SVG elements crisply by placing them precisely on the\n * pixel grid. Rectangles should be placed on round pixels, lines and circles\n * on half-pixels.\n *\n * Example of rectangle placement (four • create one pixel)\n * •    •----•----•    •\n *      |         |\n * •    •----•----•    •\n *\n * Example of line placement (four • create one pixel)\n * •    •    •    •    •\n *    ---------------\n * •    •    •    •    •\n *\n * @module sszvis/svgUtils/crisp\n */\n\nimport * as fn from \"../fn.js\";\n\n/**\n * crisp.halfPixel\n *\n * To ensure SVG elements are rendered crisply and without anti-aliasing\n * artefacts, they must be placed on a half-pixel grid.\n *\n * @param  {number} pos A pixel position\n * @return {number}     A pixel position snapped to the pixel grid\n */\nexport const halfPixel = function (pos) {\n  return Math.floor(pos) + 0.5;\n};\n\n/**\n * crisp.roundTransformString\n *\n * Takes an SVG transform string 'translate(12.3,4.56789) rotate(3.5)' and\n * rounds all translate coordinates to integers: 'translate(12,5) rotate(3.5)'.\n *\n * A valid translate instruction has the form 'translate(<x> [<y>])' where\n * x and y can be separated by a space or comma. We normalize this to use\n * spaces because that's what Internet Explorer uses.\n *\n * @param  {string} transformStr A valid SVG transform string\n * @return {string}              An SVG transform string with rounded values\n */\nexport const roundTransformString = function (transformStr) {\n  const roundNumber = fn.compose(Math.floor, Number);\n  return transformStr.replace(/(translate\\()\\s*([\\d ,.]+)\\s*(\\))/i, (_, left, vecStr, right) => {\n    const roundVec = vecStr\n      .replace(\",\", \" \")\n      .replace(/\\s+/, \" \")\n      .split(\" \")\n      .map(roundNumber)\n      .join(\",\");\n    return left + roundVec + right;\n  });\n};\n\n/**\n * crisp.transformTranslateSubpixelShift\n *\n * This helper function takes a transform string and returns a vector that\n * tells us how much to shift an element in order to place it on a half-pixel\n * grid.\n *\n * @param  {string} transformStr A valid SVG transform string\n * @return {vecor}               Two-element array ([dx, dy])\n */\nexport const transformTranslateSubpixelShift = function (transformStr) {\n  const roundNumber = fn.compose(Math.floor, Number);\n  const m = transformStr.match(/(translate\\()\\s*([\\d ,.-]+)\\s*(\\))/i);\n  const vec = m[2].replace(\",\", \" \").replace(/\\s+/, \" \").split(\" \").map(Number);\n\n  if (vec.length === 1) vec.push([0]);\n\n  const vecRound = vec.map(roundNumber);\n  return [vec[0] - vecRound[0], vec[1] - vecRound[1]];\n};\n","/**\n * translateString\n *\n * Pass an x and a y component, and this returns a translate string, which can be set as the 'transform' property of\n * an svg element.\n *\n * @module sszvis/svgUtils/translateString\n *\n * @param  {number} x     The x-component of the transform\n * @param  {number} y     The y-component of the transform\n * @return {string}       The translate string\n */\n\nexport default function (x, y) {\n  return \"translate(\" + x + \",\" + y + \")\";\n}\n","/**\n * Tooltip anchor annotation\n *\n * Tooltip anchors are invisible SVG <rect>s that each component needs to\n * provide. Because they are real elements we can know their exact position\n * on the page without any calculations and even if the parent element has\n * been transformed. These elements need to be <rect>s because some browsers\n * don't calculate positon information for the better suited <g> elements.\n *\n * Tooltips can be bound to by selecting for the tooltip data attribute.\n *\n * @module sszvis/annotation/tooltipAnchor\n *\n * @example\n * var tooltip = sszvis.tooltip();\n * bars.selectAll('[data-tooltip-anchor]').call(tooltip);\n *\n * Tooltips use HTML5 data attributes to clarify their intent, which is not\n * to style an element but to provide an anchor that can be selected using\n * Javascript.\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Using_data_attributes\n * @see https://developer.mozilla.org/en-US/docs/Web/CSS/Attribute_selectors\n *\n * To add a tooltip anchor to an element, create a new tooltip anchor function\n * and call it on a selection. This is usually the same selection that you have\n * added the visible elements of your chart to, e.g. the selection that you\n * render bar <rect>s into.\n *\n * @example\n * var tooltipAnchor = sszvis.tooltipAnchor()\n *   .position(function(d) {\n *     return [xScale(d), yScale(d)];\n *   });\n * selection.call(tooltipAnchor);\n *\n * @property {function} position A vector of the tooltip's [x, y] coordinates\n * @property {boolean}  debug    Renders a visible tooltip anchor when true\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport translateString from \"../svgUtils/translateString.js\";\nimport { component } from \"../d3-component.js\";\n\n/* Helper functions\n  ----------------------------------------------- */\nfunction vectorToTranslateString(vec) {\n  return translateString.apply(null, vec);\n}\n\nexport default function () {\n  return component()\n    .prop(\"position\")\n    .position(fn.functor([0, 0]))\n    .prop(\"debug\")\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const anchor = selection\n        .selectAll(\"[data-tooltip-anchor]\")\n        .data(data)\n        .join(\"rect\")\n        .attr(\"height\", 1)\n        .attr(\"width\", 1)\n        .attr(\"fill\", \"none\")\n        .attr(\"stroke\", \"none\")\n        .attr(\"visibility\", \"none\")\n        .attr(\"data-tooltip-anchor\", \"\");\n\n      // Update\n\n      anchor.attr(\"transform\", fn.compose(vectorToTranslateString, props.position));\n\n      // Visible anchor if debug is true\n      if (props.debug) {\n        const referencePoint = selection\n          .selectAll(\"[data-tooltip-anchor-debug]\")\n          .data(data)\n          .join(\"circle\")\n          .attr(\"data-tooltip-anchor-debug\", \"\");\n\n        referencePoint\n          .attr(\"r\", 2)\n          .attr(\"fill\", \"#fff\")\n          .attr(\"stroke\", \"#f00\")\n          .attr(\"stroke-width\", 1.5)\n          .attr(\"transform\", fn.compose(vectorToTranslateString, props.position));\n      }\n    });\n}\n","/**\n * Range Flag annotation\n *\n * The range flag component creates a pair of small white circles which fit well with the range ruler.\n * However, this is a separate component for implementation reasons, because the data for the range flag\n * should usually be only one value, distinct from the range ruler which expects multiple values. The range\n * flag also creates a tooltip anchor between the two dots, to which you can attach a tooltip. See the\n * interactive stacked area chart examples for a use of the range flag.\n *\n * @module sszvis/annotation/rangeFlag\n *\n * @property {number functor} x           A value for the x-value of the range flag\n * @property {number functor} y0          A value for the y-value of the lower range flag dot\n * @property {number functor} y1          A value for the y-value of the upper range flag dot\n *\n * @returns {sszvis.component}\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { halfPixel } from \"../svgUtils/crisp.js\";\nimport tooltipAnchor from \"../annotation/tooltipAnchor.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"x\", fn.functor)\n    .prop(\"y0\", fn.functor)\n    .prop(\"y1\", fn.functor)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const crispX = fn.compose(halfPixel, props.x);\n      const crispY0 = fn.compose(halfPixel, props.y0);\n      const crispY1 = fn.compose(halfPixel, props.y1);\n\n      selection\n        .selectAll(\".sszvis-rangeFlag__mark.bottom\")\n        .data(data)\n        .call(makeFlagDot(\"bottom\", crispX, crispY0));\n\n      selection\n        .selectAll(\".sszvis-rangeFlag__mark.top\")\n        .data(data)\n        .call(makeFlagDot(\"top\", crispX, crispY1));\n\n      const ta = tooltipAnchor().position((d) => [\n        crispX(d),\n        halfPixel((props.y0(d) + props.y1(d)) / 2),\n      ]);\n\n      selection.call(ta);\n    });\n}\n\nfunction makeFlagDot(classed, cx, cy) {\n  return function (dot) {\n    dot\n      .join(\"circle\")\n      .classed(\"sszvis-rangeFlag__mark\", true)\n      .classed(classed, true)\n      .attr(\"r\", 3.5)\n      .attr(\"cx\", cx)\n      .attr(\"cy\", cy);\n  };\n}\n",null,null,"/**\n * Tooltip annotation\n *\n * Use this component to add a tooltip to the document. The tooltip component should be\n * called on a selection of [data-tooltip-anchor], which contain the information necessary to\n * position the tooltip and provide it with data. The tooltip's visibility should be toggled\n * using the .visible property, passing a predicate function. Tooltips will be displayed\n * when .visible returns true.\n *\n * @module sszvis/annotation/tooltip\n *\n * @property {seletion} renderInto      Provide a selection container into which to render the tooltip.\n *                                      Unlike most other components, the tooltip isn't rendered directly into the selection\n *                                      on which it is called. Instead, it's rendered into whichever selection is\n *                                      passed to the renderInto option\n * @property {function} visible         Provide a predicate function which accepts a datum and determines whether the associated\n *                                      tooltip should be visible. (default: false)\n * @property {function} header          A function accepting a datum. The result becomes the header of the tooltip.\n *                                      This function can return:\n *                                      - a plain string\n *                                      - an HTML string to be used as innerHTML\n * @property {function} body            A function accepting a datum. The result becomes the body of the tooltip.\n *                                      This function can return:\n *                                      - a plain string\n *                                      - an HTML string to be used as innerHTML\n *                                      - an array of arrays, which produces a tabular layout where each\n *                                      sub-array is one row in the table.\n * @property {function} orientation     A string or function returning a string which determines the orientation. This determines\n *                                      which direction the tooltip sits relative to its point.\n *                                      Possible values are: \"bottom\" (points down), \"top\" (points upward), \"left\" (points left), and \"right\" (points right).\n *                                      Default is \"bottom\".\n * @property {number} dx                A number for the x-offset of the tooltip\n * @property {number} dy                A number for the y-offset of the tooltip\n * @property {function} opacity         A function or number which determines the opacity of the tooltip. Default is 1.\n *\n * @return {sszvis.component}\n *\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { component } from \"../d3-component.js\";\n\n/* Configuration\n----------------------------------------------- */\nconst SMALL_CORNER_RADIUS = 3;\nconst LARGE_CORNER_RADIUS = 4;\nconst TIP_SIZE = 6;\nconst BLUR_PADDING = 5;\n\n/* Exported module\n----------------------------------------------- */\nexport default function () {\n  const renderer = tooltipRenderer();\n\n  return component()\n    .delegate(\"header\", renderer)\n    .delegate(\"body\", renderer)\n    .delegate(\"orientation\", renderer)\n    .delegate(\"dx\", renderer)\n    .delegate(\"dy\", renderer)\n    .delegate(\"opacity\", renderer)\n    .prop(\"renderInto\")\n    .prop(\"visible\", fn.functor)\n    .visible(false)\n    .renderSelection((selection) => {\n      const props = selection.props();\n      const intoBCR = props.renderInto.node().getBoundingClientRect();\n\n      const tooltipData = [];\n      selection.each(function (d) {\n        if (props.visible(d)) {\n          const thisBCR = this.getBoundingClientRect();\n          const pos = [thisBCR.left - intoBCR.left, thisBCR.top - intoBCR.top];\n          tooltipData.push({\n            datum: d,\n            x: pos[0],\n            y: pos[1],\n          });\n        }\n      });\n\n      props.renderInto.datum(tooltipData).call(renderer);\n    });\n}\n\n/**\n * Tooltip renderer\n * @private\n */\nconst tooltipRenderer = function () {\n  return component()\n    .prop(\"header\")\n    .prop(\"body\")\n    .prop(\"orientation\", fn.functor)\n    .orientation(\"bottom\")\n    .prop(\"dx\", fn.functor)\n    .dx(1)\n    .prop(\"dy\", fn.functor)\n    .dy(1)\n    .prop(\"opacity\", fn.functor)\n    .opacity(1)\n    .renderSelection((selection) => {\n      const tooltipData = selection.datum();\n      const props = selection.props();\n\n      const isDef = fn.defined;\n      const isSmall =\n        (isDef(props.header) && !isDef(props.body)) || (!isDef(props.header) && isDef(props.body));\n\n      // Select tooltip elements\n\n      const tooltip = selection.selectAll(\".sszvis-tooltip\").data(tooltipData).join(\"div\");\n\n      tooltip\n        .style(\"pointer-events\", \"none\")\n        .style(\"opacity\", props.opacity)\n        .style(\"padding-top\", (d) => (props.orientation(d) === \"top\" ? TIP_SIZE + \"px\" : null))\n        .style(\"padding-right\", (d) => (props.orientation(d) === \"right\" ? TIP_SIZE + \"px\" : null))\n        .style(\"padding-bottom\", (d) =>\n          props.orientation(d) === \"bottom\" ? TIP_SIZE + \"px\" : null\n        )\n        .style(\"padding-left\", (d) => (props.orientation(d) === \"left\" ? TIP_SIZE + \"px\" : null))\n        .classed(\"sszvis-tooltip\", true);\n\n      // Enter: tooltip background\n\n      const enterBackground = tooltip\n        .selectAll(\".sszvis-tooltip__background\")\n        .data([0])\n        .join(\"svg\")\n        .attr(\"class\", \"sszvis-tooltip__background\")\n        .attr(\"height\", 0)\n        .attr(\"width\", 0);\n\n      const enterBackgroundPath = enterBackground.selectAll(\"path\").data([0]).join(\"path\");\n\n      if (supportsSVGFilters()) {\n        const filter = enterBackground\n          .selectAll(\"filter\")\n          .data([0])\n          .join(\"filter\")\n          .attr(\"id\", \"sszvisTooltipShadowFilter\")\n          .attr(\"height\", \"150%\");\n\n        filter\n          .selectAll(\"feGaussianBlur\")\n          .data([0])\n          .join(\"feGaussianBlur\")\n          .attr(\"in\", \"SourceAlpha\")\n          .attr(\"stdDeviation\", 2);\n\n        filter\n          .selectAll(\"feComponentTransfer\")\n          .data([0])\n          .join(\"feComponentTransfer\")\n          .selectAll(\"feFuncA\")\n          .data([0])\n          .join(\"feFuncA\")\n          .attr(\"type\", \"linear\")\n          .attr(\"slope\", 0.2);\n\n        const merge = filter.selectAll(\"feMerge\").data([0]).join(\"feMerge\");\n        merge.selectAll(\"feMergeNode\").data([0]).join(\"feMergeNode\"); // Contains the blurred image\n        merge\n          .selectAll(\"feMergeNode\")\n          .data([0])\n          .join(\"feMergeNode\") // Contains the element that the filter is applied to\n          .attr(\"in\", \"SourceGraphic\");\n\n        enterBackgroundPath.attr(\"filter\", \"url(#sszvisTooltipShadowFilter)\");\n      } else {\n        enterBackground.classed(\"sszvis-tooltip__background--fallback\", true);\n      }\n\n      // Enter: tooltip content\n\n      const enterContent = tooltip\n        .selectAll(\".sszvis-tooltip__content\")\n        .data([0])\n        .join(\"div\")\n        .classed(\"sszvis-tooltip__content\", true);\n\n      enterContent\n        .selectAll(\".sszvis-tooltip__header\")\n        .data([0])\n        .join(\"div\")\n        .classed(\"sszvis-tooltip__header\", true);\n\n      enterContent\n        .selectAll(\".sszvis-tooltip__body\")\n        .data([0])\n        .join(\"div\")\n        .classed(\"sszvis-tooltip__body\", true);\n\n      // Update: content\n\n      tooltip\n        .select(\".sszvis-tooltip__header\")\n        .datum(fn.prop(\"datum\"))\n        .html(props.header || fn.functor(\"\"));\n\n      tooltip\n        .select(\".sszvis-tooltip__body\")\n        .datum(fn.prop(\"datum\"))\n        .html((d) => {\n          const body = props.body ? fn.functor(props.body)(d) : \"\";\n          return Array.isArray(body) ? formatTable(body) : body;\n        });\n\n      selection\n        .selectAll(\".sszvis-tooltip\")\n        .classed(\"sszvis-tooltip--small\", isSmall)\n        .each(function (d) {\n          const tip = select(this);\n          // only using dimensions.width and dimensions.height here. Not affected by scroll position\n          const dimensions = tip.node().getBoundingClientRect();\n          const orientation = Reflect.apply(props.orientation, this, arguments);\n\n          // Position tooltip element\n\n          switch (orientation) {\n            case \"top\": {\n              tip\n                .style(\"left\", d.x - dimensions.width / 2 + \"px\")\n                .style(\"top\", d.y + props.dy(d) + \"px\");\n              break;\n            }\n            case \"bottom\": {\n              tip\n                .style(\"left\", d.x - dimensions.width / 2 + \"px\")\n                .style(\"top\", d.y - props.dy(d) - dimensions.height + \"px\");\n              break;\n            }\n            case \"left\": {\n              tip\n                .style(\"left\", d.x + props.dx(d) + \"px\")\n                .style(\"top\", d.y - dimensions.height / 2 + \"px\");\n              break;\n            }\n            case \"right\": {\n              tip\n                .style(\"left\", d.x - props.dx(d) - dimensions.width + \"px\")\n                .style(\"top\", d.y - dimensions.height / 2 + \"px\");\n              break;\n            }\n          }\n\n          // Position background element\n\n          const bgHeight = dimensions.height + 2 * BLUR_PADDING;\n          const bgWidth = dimensions.width + 2 * BLUR_PADDING;\n          tip\n            .select(\".sszvis-tooltip__background\")\n            .attr(\"height\", bgHeight)\n            .attr(\"width\", bgWidth)\n            .style(\"left\", -BLUR_PADDING + \"px\")\n            .style(\"top\", -BLUR_PADDING + \"px\")\n            .select(\"path\")\n            .attr(\n              \"d\",\n              tooltipBackgroundGenerator(\n                [BLUR_PADDING, BLUR_PADDING],\n                [bgWidth - BLUR_PADDING, bgHeight - BLUR_PADDING],\n                orientation,\n                isSmall ? SMALL_CORNER_RADIUS : LARGE_CORNER_RADIUS\n              )\n            );\n        });\n    });\n};\n\n/**\n * formatTable\n */\nfunction formatTable(rows) {\n  const tableBody = rows\n    .map((row) => \"<tr>\" + row.map((cell) => \"<td>\" + cell + \"</td>\").join(\"\") + \"</tr>\")\n    .join(\"\");\n  return '<table class=\"sszvis-tooltip__body__table\">' + tableBody + \"</table>\";\n}\n\nfunction x(d) {\n  return d[0];\n}\nfunction y(d) {\n  return d[1];\n}\nfunction side(cx, cy, x0, y0, x1, y1, showTip) {\n  const mx = x0 + (x1 - x0) / 2;\n  const my = y0 + (y1 - y0) / 2;\n\n  const corner = [\"Q\", cx, cy, x0, y0];\n\n  let tip = [];\n  if (showTip && y0 === y1) {\n    tip =\n      x0 < x1\n        ? // Top\n          [\"L\", mx - TIP_SIZE, my, \"L\", mx, my - TIP_SIZE, \"L\", mx + TIP_SIZE, my]\n        : // Bottom\n          [\"L\", mx + TIP_SIZE, my, \"L\", mx, my + TIP_SIZE, \"L\", mx - TIP_SIZE, my];\n  } else if (showTip && x0 === x1) {\n    tip =\n      y0 < y1\n        ? // Right\n          [\"L\", mx, my - TIP_SIZE, \"L\", mx + TIP_SIZE, my, \"L\", mx, my + TIP_SIZE]\n        : // Left\n          [\"L\", mx, my + TIP_SIZE, \"L\", mx - TIP_SIZE, my, \"L\", mx, my - TIP_SIZE];\n  }\n\n  const end = [\"L\", x1, y1];\n\n  return [...corner, ...tip, ...end];\n}\n\n/**\n * Tooltip background generator\n *\n * Generates a path description with a tip on the specified side.\n *\n *           top\n *         ________\n *   left |        | right\n *        |___  ___|\n *            \\/\n *          bottom\n *\n * @param  {Vector} a           Top-left corner of the tooltip rectangle (x, y)\n * @param  {Vector} b           Bottom-right corner of the tooltip rectangle (x, y)\n * @param  {String} orientation The tip will point in this direction (top, right, bottom, left)\n *\n * @return {Path}               SVG path description\n */\nfunction tooltipBackgroundGenerator(a, b, orientation, radius) {\n  switch (orientation) {\n    case \"top\": {\n      a[1] = a[1] + TIP_SIZE;\n      break;\n    }\n    case \"bottom\": {\n      b[1] = b[1] - TIP_SIZE;\n      break;\n    }\n    case \"left\": {\n      a[0] = a[0] + TIP_SIZE;\n      break;\n    }\n    case \"right\": {\n      b[0] = b[0] - TIP_SIZE;\n      break;\n    }\n  }\n\n  return [\n    // Start\n    [\"M\", x(a), y(a) + radius],\n    // Top side\n    side(x(a), y(a), x(a) + radius, y(a), x(b) - radius, y(a), orientation === \"top\"),\n    // Right side\n    side(x(b), y(a), x(b), y(a) + radius, x(b), y(b) - radius, orientation === \"right\"),\n    // Bottom side\n    side(x(b), y(b), x(b) - radius, y(b), x(a) + radius, y(b), orientation === \"bottom\"),\n    // Left side\n    side(x(a), y(b), x(a), y(b) - radius, x(a), y(a) + radius, orientation === \"left\"),\n  ]\n    .map((d) => d.join(\" \"))\n    .join(\" \");\n}\n\n/**\n * Detect whether the current browser supports SVG filters\n */\nfunction supportsSVGFilters() {\n  return (\n    window[\"SVGFEColorMatrixElement\"] !== undefined &&\n    SVGFEColorMatrixElement.SVG_FECOLORMATRIX_TYPE_SATURATE == 2\n  );\n}\n","/**\n * Default transition attributes for sszvis\n *\n * @module sszvis/transition\n *\n * Generally speaking, this module is used internally by components which transition the state of the update selection.\n * The module sszvis.transition encapsulates the basic transition attributes used in the app. It is invoked by doing\n * d3.selection().transition().call(sszvis.transition), which applies the transition attributes to the passed transition.\n * transition.fastTransition provides an alternate transition duration for certain situations where the standard duration is\n * too slow.\n */\n\nimport { transition as d3Transition, easePolyOut } from \"d3\";\n\nconst defaultEase = easePolyOut;\n\nexport const defaultTransition = function () {\n  return d3Transition().ease(defaultEase).duration(300);\n};\n\nexport const fastTransition = function () {\n  return d3Transition().ease(defaultEase).duration(50);\n};\n\nexport const slowTransition = function () {\n  return d3Transition().ease(defaultEase).duration(500);\n};\n","// src/utils/env.ts\nvar NOTHING = Symbol.for(\"immer-nothing\");\nvar DRAFTABLE = Symbol.for(\"immer-draftable\");\nvar DRAFT_STATE = Symbol.for(\"immer-state\");\n\n// src/utils/errors.ts\nvar errors = process.env.NODE_ENV !== \"production\" ? [\n  // All error codes, starting by 0:\n  function(plugin) {\n    return `The plugin for '${plugin}' has not been loaded into Immer. To enable the plugin, import and call \\`enable${plugin}()\\` when initializing your application.`;\n  },\n  function(thing) {\n    return `produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${thing}'`;\n  },\n  \"This object has been frozen and should not be mutated\",\n  function(data) {\n    return \"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? \" + data;\n  },\n  \"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.\",\n  \"Immer forbids circular references\",\n  \"The first or second argument to `produce` must be a function\",\n  \"The third argument to `produce` must be a function or undefined\",\n  \"First argument to `createDraft` must be a plain object, an array, or an immerable object\",\n  \"First argument to `finishDraft` must be a draft returned by `createDraft`\",\n  function(thing) {\n    return `'current' expects a draft, got: ${thing}`;\n  },\n  \"Object.defineProperty() cannot be used on an Immer draft\",\n  \"Object.setPrototypeOf() cannot be used on an Immer draft\",\n  \"Immer only supports deleting array indices\",\n  \"Immer only supports setting array indices and the 'length' property\",\n  function(thing) {\n    return `'original' expects a draft, got: ${thing}`;\n  }\n  // Note: if more errors are added, the errorOffset in Patches.ts should be increased\n  // See Patches.ts for additional errors\n] : [];\nfunction die(error, ...args) {\n  if (process.env.NODE_ENV !== \"production\") {\n    const e = errors[error];\n    const msg = typeof e === \"function\" ? e.apply(null, args) : e;\n    throw new Error(`[Immer] ${msg}`);\n  }\n  throw new Error(\n    `[Immer] minified error nr: ${error}. Full error at: https://bit.ly/3cXEKWf`\n  );\n}\n\n// src/utils/common.ts\nvar getPrototypeOf = Object.getPrototypeOf;\nfunction isDraft(value) {\n  return !!value && !!value[DRAFT_STATE];\n}\nfunction isDraftable(value) {\n  if (!value)\n    return false;\n  return isPlainObject(value) || Array.isArray(value) || !!value[DRAFTABLE] || !!value.constructor?.[DRAFTABLE] || isMap(value) || isSet(value);\n}\nvar objectCtorString = Object.prototype.constructor.toString();\nfunction isPlainObject(value) {\n  if (!value || typeof value !== \"object\")\n    return false;\n  const proto = getPrototypeOf(value);\n  if (proto === null) {\n    return true;\n  }\n  const Ctor = Object.hasOwnProperty.call(proto, \"constructor\") && proto.constructor;\n  if (Ctor === Object)\n    return true;\n  return typeof Ctor == \"function\" && Function.toString.call(Ctor) === objectCtorString;\n}\nfunction original(value) {\n  if (!isDraft(value))\n    die(15, value);\n  return value[DRAFT_STATE].base_;\n}\nfunction each(obj, iter) {\n  if (getArchtype(obj) === 0 /* Object */) {\n    Reflect.ownKeys(obj).forEach((key) => {\n      iter(key, obj[key], obj);\n    });\n  } else {\n    obj.forEach((entry, index) => iter(index, entry, obj));\n  }\n}\nfunction getArchtype(thing) {\n  const state = thing[DRAFT_STATE];\n  return state ? state.type_ : Array.isArray(thing) ? 1 /* Array */ : isMap(thing) ? 2 /* Map */ : isSet(thing) ? 3 /* Set */ : 0 /* Object */;\n}\nfunction has(thing, prop) {\n  return getArchtype(thing) === 2 /* Map */ ? thing.has(prop) : Object.prototype.hasOwnProperty.call(thing, prop);\n}\nfunction get(thing, prop) {\n  return getArchtype(thing) === 2 /* Map */ ? thing.get(prop) : thing[prop];\n}\nfunction set(thing, propOrOldValue, value) {\n  const t = getArchtype(thing);\n  if (t === 2 /* Map */)\n    thing.set(propOrOldValue, value);\n  else if (t === 3 /* Set */) {\n    thing.add(value);\n  } else\n    thing[propOrOldValue] = value;\n}\nfunction is(x, y) {\n  if (x === y) {\n    return x !== 0 || 1 / x === 1 / y;\n  } else {\n    return x !== x && y !== y;\n  }\n}\nfunction isMap(target) {\n  return target instanceof Map;\n}\nfunction isSet(target) {\n  return target instanceof Set;\n}\nfunction latest(state) {\n  return state.copy_ || state.base_;\n}\nfunction shallowCopy(base, strict) {\n  if (isMap(base)) {\n    return new Map(base);\n  }\n  if (isSet(base)) {\n    return new Set(base);\n  }\n  if (Array.isArray(base))\n    return Array.prototype.slice.call(base);\n  const isPlain = isPlainObject(base);\n  if (strict === true || strict === \"class_only\" && !isPlain) {\n    const descriptors = Object.getOwnPropertyDescriptors(base);\n    delete descriptors[DRAFT_STATE];\n    let keys = Reflect.ownKeys(descriptors);\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i];\n      const desc = descriptors[key];\n      if (desc.writable === false) {\n        desc.writable = true;\n        desc.configurable = true;\n      }\n      if (desc.get || desc.set)\n        descriptors[key] = {\n          configurable: true,\n          writable: true,\n          // could live with !!desc.set as well here...\n          enumerable: desc.enumerable,\n          value: base[key]\n        };\n    }\n    return Object.create(getPrototypeOf(base), descriptors);\n  } else {\n    const proto = getPrototypeOf(base);\n    if (proto !== null && isPlain) {\n      return { ...base };\n    }\n    const obj = Object.create(proto);\n    return Object.assign(obj, base);\n  }\n}\nfunction freeze(obj, deep = false) {\n  if (isFrozen(obj) || isDraft(obj) || !isDraftable(obj))\n    return obj;\n  if (getArchtype(obj) > 1) {\n    Object.defineProperties(obj, {\n      set: { value: dontMutateFrozenCollections },\n      add: { value: dontMutateFrozenCollections },\n      clear: { value: dontMutateFrozenCollections },\n      delete: { value: dontMutateFrozenCollections }\n    });\n  }\n  Object.freeze(obj);\n  if (deep)\n    Object.values(obj).forEach((value) => freeze(value, true));\n  return obj;\n}\nfunction dontMutateFrozenCollections() {\n  die(2);\n}\nfunction isFrozen(obj) {\n  return Object.isFrozen(obj);\n}\n\n// src/utils/plugins.ts\nvar plugins = {};\nfunction getPlugin(pluginKey) {\n  const plugin = plugins[pluginKey];\n  if (!plugin) {\n    die(0, pluginKey);\n  }\n  return plugin;\n}\nfunction loadPlugin(pluginKey, implementation) {\n  if (!plugins[pluginKey])\n    plugins[pluginKey] = implementation;\n}\n\n// src/core/scope.ts\nvar currentScope;\nfunction getCurrentScope() {\n  return currentScope;\n}\nfunction createScope(parent_, immer_) {\n  return {\n    drafts_: [],\n    parent_,\n    immer_,\n    // Whenever the modified draft contains a draft from another scope, we\n    // need to prevent auto-freezing so the unowned draft can be finalized.\n    canAutoFreeze_: true,\n    unfinalizedDrafts_: 0\n  };\n}\nfunction usePatchesInScope(scope, patchListener) {\n  if (patchListener) {\n    getPlugin(\"Patches\");\n    scope.patches_ = [];\n    scope.inversePatches_ = [];\n    scope.patchListener_ = patchListener;\n  }\n}\nfunction revokeScope(scope) {\n  leaveScope(scope);\n  scope.drafts_.forEach(revokeDraft);\n  scope.drafts_ = null;\n}\nfunction leaveScope(scope) {\n  if (scope === currentScope) {\n    currentScope = scope.parent_;\n  }\n}\nfunction enterScope(immer2) {\n  return currentScope = createScope(currentScope, immer2);\n}\nfunction revokeDraft(draft) {\n  const state = draft[DRAFT_STATE];\n  if (state.type_ === 0 /* Object */ || state.type_ === 1 /* Array */)\n    state.revoke_();\n  else\n    state.revoked_ = true;\n}\n\n// src/core/finalize.ts\nfunction processResult(result, scope) {\n  scope.unfinalizedDrafts_ = scope.drafts_.length;\n  const baseDraft = scope.drafts_[0];\n  const isReplaced = result !== void 0 && result !== baseDraft;\n  if (isReplaced) {\n    if (baseDraft[DRAFT_STATE].modified_) {\n      revokeScope(scope);\n      die(4);\n    }\n    if (isDraftable(result)) {\n      result = finalize(scope, result);\n      if (!scope.parent_)\n        maybeFreeze(scope, result);\n    }\n    if (scope.patches_) {\n      getPlugin(\"Patches\").generateReplacementPatches_(\n        baseDraft[DRAFT_STATE].base_,\n        result,\n        scope.patches_,\n        scope.inversePatches_\n      );\n    }\n  } else {\n    result = finalize(scope, baseDraft, []);\n  }\n  revokeScope(scope);\n  if (scope.patches_) {\n    scope.patchListener_(scope.patches_, scope.inversePatches_);\n  }\n  return result !== NOTHING ? result : void 0;\n}\nfunction finalize(rootScope, value, path) {\n  if (isFrozen(value))\n    return value;\n  const state = value[DRAFT_STATE];\n  if (!state) {\n    each(\n      value,\n      (key, childValue) => finalizeProperty(rootScope, state, value, key, childValue, path)\n    );\n    return value;\n  }\n  if (state.scope_ !== rootScope)\n    return value;\n  if (!state.modified_) {\n    maybeFreeze(rootScope, state.base_, true);\n    return state.base_;\n  }\n  if (!state.finalized_) {\n    state.finalized_ = true;\n    state.scope_.unfinalizedDrafts_--;\n    const result = state.copy_;\n    let resultEach = result;\n    let isSet2 = false;\n    if (state.type_ === 3 /* Set */) {\n      resultEach = new Set(result);\n      result.clear();\n      isSet2 = true;\n    }\n    each(\n      resultEach,\n      (key, childValue) => finalizeProperty(rootScope, state, result, key, childValue, path, isSet2)\n    );\n    maybeFreeze(rootScope, result, false);\n    if (path && rootScope.patches_) {\n      getPlugin(\"Patches\").generatePatches_(\n        state,\n        path,\n        rootScope.patches_,\n        rootScope.inversePatches_\n      );\n    }\n  }\n  return state.copy_;\n}\nfunction finalizeProperty(rootScope, parentState, targetObject, prop, childValue, rootPath, targetIsSet) {\n  if (process.env.NODE_ENV !== \"production\" && childValue === targetObject)\n    die(5);\n  if (isDraft(childValue)) {\n    const path = rootPath && parentState && parentState.type_ !== 3 /* Set */ && // Set objects are atomic since they have no keys.\n    !has(parentState.assigned_, prop) ? rootPath.concat(prop) : void 0;\n    const res = finalize(rootScope, childValue, path);\n    set(targetObject, prop, res);\n    if (isDraft(res)) {\n      rootScope.canAutoFreeze_ = false;\n    } else\n      return;\n  } else if (targetIsSet) {\n    targetObject.add(childValue);\n  }\n  if (isDraftable(childValue) && !isFrozen(childValue)) {\n    if (!rootScope.immer_.autoFreeze_ && rootScope.unfinalizedDrafts_ < 1) {\n      return;\n    }\n    finalize(rootScope, childValue);\n    if ((!parentState || !parentState.scope_.parent_) && typeof prop !== \"symbol\" && (isMap(targetObject) ? targetObject.has(prop) : Object.prototype.propertyIsEnumerable.call(targetObject, prop)))\n      maybeFreeze(rootScope, childValue);\n  }\n}\nfunction maybeFreeze(scope, value, deep = false) {\n  if (!scope.parent_ && scope.immer_.autoFreeze_ && scope.canAutoFreeze_) {\n    freeze(value, deep);\n  }\n}\n\n// src/core/proxy.ts\nfunction createProxyProxy(base, parent) {\n  const isArray = Array.isArray(base);\n  const state = {\n    type_: isArray ? 1 /* Array */ : 0 /* Object */,\n    // Track which produce call this is associated with.\n    scope_: parent ? parent.scope_ : getCurrentScope(),\n    // True for both shallow and deep changes.\n    modified_: false,\n    // Used during finalization.\n    finalized_: false,\n    // Track which properties have been assigned (true) or deleted (false).\n    assigned_: {},\n    // The parent draft state.\n    parent_: parent,\n    // The base state.\n    base_: base,\n    // The base proxy.\n    draft_: null,\n    // set below\n    // The base copy with any updated values.\n    copy_: null,\n    // Called by the `produce` function.\n    revoke_: null,\n    isManual_: false\n  };\n  let target = state;\n  let traps = objectTraps;\n  if (isArray) {\n    target = [state];\n    traps = arrayTraps;\n  }\n  const { revoke, proxy } = Proxy.revocable(target, traps);\n  state.draft_ = proxy;\n  state.revoke_ = revoke;\n  return proxy;\n}\nvar objectTraps = {\n  get(state, prop) {\n    if (prop === DRAFT_STATE)\n      return state;\n    const source = latest(state);\n    if (!has(source, prop)) {\n      return readPropFromProto(state, source, prop);\n    }\n    const value = source[prop];\n    if (state.finalized_ || !isDraftable(value)) {\n      return value;\n    }\n    if (value === peek(state.base_, prop)) {\n      prepareCopy(state);\n      return state.copy_[prop] = createProxy(value, state);\n    }\n    return value;\n  },\n  has(state, prop) {\n    return prop in latest(state);\n  },\n  ownKeys(state) {\n    return Reflect.ownKeys(latest(state));\n  },\n  set(state, prop, value) {\n    const desc = getDescriptorFromProto(latest(state), prop);\n    if (desc?.set) {\n      desc.set.call(state.draft_, value);\n      return true;\n    }\n    if (!state.modified_) {\n      const current2 = peek(latest(state), prop);\n      const currentState = current2?.[DRAFT_STATE];\n      if (currentState && currentState.base_ === value) {\n        state.copy_[prop] = value;\n        state.assigned_[prop] = false;\n        return true;\n      }\n      if (is(value, current2) && (value !== void 0 || has(state.base_, prop)))\n        return true;\n      prepareCopy(state);\n      markChanged(state);\n    }\n    if (state.copy_[prop] === value && // special case: handle new props with value 'undefined'\n    (value !== void 0 || prop in state.copy_) || // special case: NaN\n    Number.isNaN(value) && Number.isNaN(state.copy_[prop]))\n      return true;\n    state.copy_[prop] = value;\n    state.assigned_[prop] = true;\n    return true;\n  },\n  deleteProperty(state, prop) {\n    if (peek(state.base_, prop) !== void 0 || prop in state.base_) {\n      state.assigned_[prop] = false;\n      prepareCopy(state);\n      markChanged(state);\n    } else {\n      delete state.assigned_[prop];\n    }\n    if (state.copy_) {\n      delete state.copy_[prop];\n    }\n    return true;\n  },\n  // Note: We never coerce `desc.value` into an Immer draft, because we can't make\n  // the same guarantee in ES5 mode.\n  getOwnPropertyDescriptor(state, prop) {\n    const owner = latest(state);\n    const desc = Reflect.getOwnPropertyDescriptor(owner, prop);\n    if (!desc)\n      return desc;\n    return {\n      writable: true,\n      configurable: state.type_ !== 1 /* Array */ || prop !== \"length\",\n      enumerable: desc.enumerable,\n      value: owner[prop]\n    };\n  },\n  defineProperty() {\n    die(11);\n  },\n  getPrototypeOf(state) {\n    return getPrototypeOf(state.base_);\n  },\n  setPrototypeOf() {\n    die(12);\n  }\n};\nvar arrayTraps = {};\neach(objectTraps, (key, fn) => {\n  arrayTraps[key] = function() {\n    arguments[0] = arguments[0][0];\n    return fn.apply(this, arguments);\n  };\n});\narrayTraps.deleteProperty = function(state, prop) {\n  if (process.env.NODE_ENV !== \"production\" && isNaN(parseInt(prop)))\n    die(13);\n  return arrayTraps.set.call(this, state, prop, void 0);\n};\narrayTraps.set = function(state, prop, value) {\n  if (process.env.NODE_ENV !== \"production\" && prop !== \"length\" && isNaN(parseInt(prop)))\n    die(14);\n  return objectTraps.set.call(this, state[0], prop, value, state[0]);\n};\nfunction peek(draft, prop) {\n  const state = draft[DRAFT_STATE];\n  const source = state ? latest(state) : draft;\n  return source[prop];\n}\nfunction readPropFromProto(state, source, prop) {\n  const desc = getDescriptorFromProto(source, prop);\n  return desc ? `value` in desc ? desc.value : (\n    // This is a very special case, if the prop is a getter defined by the\n    // prototype, we should invoke it with the draft as context!\n    desc.get?.call(state.draft_)\n  ) : void 0;\n}\nfunction getDescriptorFromProto(source, prop) {\n  if (!(prop in source))\n    return void 0;\n  let proto = getPrototypeOf(source);\n  while (proto) {\n    const desc = Object.getOwnPropertyDescriptor(proto, prop);\n    if (desc)\n      return desc;\n    proto = getPrototypeOf(proto);\n  }\n  return void 0;\n}\nfunction markChanged(state) {\n  if (!state.modified_) {\n    state.modified_ = true;\n    if (state.parent_) {\n      markChanged(state.parent_);\n    }\n  }\n}\nfunction prepareCopy(state) {\n  if (!state.copy_) {\n    state.copy_ = shallowCopy(\n      state.base_,\n      state.scope_.immer_.useStrictShallowCopy_\n    );\n  }\n}\n\n// src/core/immerClass.ts\nvar Immer2 = class {\n  constructor(config) {\n    this.autoFreeze_ = true;\n    this.useStrictShallowCopy_ = false;\n    /**\n     * The `produce` function takes a value and a \"recipe function\" (whose\n     * return value often depends on the base state). The recipe function is\n     * free to mutate its first argument however it wants. All mutations are\n     * only ever applied to a __copy__ of the base state.\n     *\n     * Pass only a function to create a \"curried producer\" which relieves you\n     * from passing the recipe function every time.\n     *\n     * Only plain objects and arrays are made mutable. All other objects are\n     * considered uncopyable.\n     *\n     * Note: This function is __bound__ to its `Immer` instance.\n     *\n     * @param {any} base - the initial state\n     * @param {Function} recipe - function that receives a proxy of the base state as first argument and which can be freely modified\n     * @param {Function} patchListener - optional function that will be called with all the patches produced here\n     * @returns {any} a new state, or the initial state if nothing was modified\n     */\n    this.produce = (base, recipe, patchListener) => {\n      if (typeof base === \"function\" && typeof recipe !== \"function\") {\n        const defaultBase = recipe;\n        recipe = base;\n        const self = this;\n        return function curriedProduce(base2 = defaultBase, ...args) {\n          return self.produce(base2, (draft) => recipe.call(this, draft, ...args));\n        };\n      }\n      if (typeof recipe !== \"function\")\n        die(6);\n      if (patchListener !== void 0 && typeof patchListener !== \"function\")\n        die(7);\n      let result;\n      if (isDraftable(base)) {\n        const scope = enterScope(this);\n        const proxy = createProxy(base, void 0);\n        let hasError = true;\n        try {\n          result = recipe(proxy);\n          hasError = false;\n        } finally {\n          if (hasError)\n            revokeScope(scope);\n          else\n            leaveScope(scope);\n        }\n        usePatchesInScope(scope, patchListener);\n        return processResult(result, scope);\n      } else if (!base || typeof base !== \"object\") {\n        result = recipe(base);\n        if (result === void 0)\n          result = base;\n        if (result === NOTHING)\n          result = void 0;\n        if (this.autoFreeze_)\n          freeze(result, true);\n        if (patchListener) {\n          const p = [];\n          const ip = [];\n          getPlugin(\"Patches\").generateReplacementPatches_(base, result, p, ip);\n          patchListener(p, ip);\n        }\n        return result;\n      } else\n        die(1, base);\n    };\n    this.produceWithPatches = (base, recipe) => {\n      if (typeof base === \"function\") {\n        return (state, ...args) => this.produceWithPatches(state, (draft) => base(draft, ...args));\n      }\n      let patches, inversePatches;\n      const result = this.produce(base, recipe, (p, ip) => {\n        patches = p;\n        inversePatches = ip;\n      });\n      return [result, patches, inversePatches];\n    };\n    if (typeof config?.autoFreeze === \"boolean\")\n      this.setAutoFreeze(config.autoFreeze);\n    if (typeof config?.useStrictShallowCopy === \"boolean\")\n      this.setUseStrictShallowCopy(config.useStrictShallowCopy);\n  }\n  createDraft(base) {\n    if (!isDraftable(base))\n      die(8);\n    if (isDraft(base))\n      base = current(base);\n    const scope = enterScope(this);\n    const proxy = createProxy(base, void 0);\n    proxy[DRAFT_STATE].isManual_ = true;\n    leaveScope(scope);\n    return proxy;\n  }\n  finishDraft(draft, patchListener) {\n    const state = draft && draft[DRAFT_STATE];\n    if (!state || !state.isManual_)\n      die(9);\n    const { scope_: scope } = state;\n    usePatchesInScope(scope, patchListener);\n    return processResult(void 0, scope);\n  }\n  /**\n   * Pass true to automatically freeze all copies created by Immer.\n   *\n   * By default, auto-freezing is enabled.\n   */\n  setAutoFreeze(value) {\n    this.autoFreeze_ = value;\n  }\n  /**\n   * Pass true to enable strict shallow copy.\n   *\n   * By default, immer does not copy the object descriptors such as getter, setter and non-enumrable properties.\n   */\n  setUseStrictShallowCopy(value) {\n    this.useStrictShallowCopy_ = value;\n  }\n  applyPatches(base, patches) {\n    let i;\n    for (i = patches.length - 1; i >= 0; i--) {\n      const patch = patches[i];\n      if (patch.path.length === 0 && patch.op === \"replace\") {\n        base = patch.value;\n        break;\n      }\n    }\n    if (i > -1) {\n      patches = patches.slice(i + 1);\n    }\n    const applyPatchesImpl = getPlugin(\"Patches\").applyPatches_;\n    if (isDraft(base)) {\n      return applyPatchesImpl(base, patches);\n    }\n    return this.produce(\n      base,\n      (draft) => applyPatchesImpl(draft, patches)\n    );\n  }\n};\nfunction createProxy(value, parent) {\n  const draft = isMap(value) ? getPlugin(\"MapSet\").proxyMap_(value, parent) : isSet(value) ? getPlugin(\"MapSet\").proxySet_(value, parent) : createProxyProxy(value, parent);\n  const scope = parent ? parent.scope_ : getCurrentScope();\n  scope.drafts_.push(draft);\n  return draft;\n}\n\n// src/core/current.ts\nfunction current(value) {\n  if (!isDraft(value))\n    die(10, value);\n  return currentImpl(value);\n}\nfunction currentImpl(value) {\n  if (!isDraftable(value) || isFrozen(value))\n    return value;\n  const state = value[DRAFT_STATE];\n  let copy;\n  if (state) {\n    if (!state.modified_)\n      return state.base_;\n    state.finalized_ = true;\n    copy = shallowCopy(value, state.scope_.immer_.useStrictShallowCopy_);\n  } else {\n    copy = shallowCopy(value, true);\n  }\n  each(copy, (key, childValue) => {\n    set(copy, key, currentImpl(childValue));\n  });\n  if (state) {\n    state.finalized_ = false;\n  }\n  return copy;\n}\n\n// src/plugins/patches.ts\nfunction enablePatches() {\n  const errorOffset = 16;\n  if (process.env.NODE_ENV !== \"production\") {\n    errors.push(\n      'Sets cannot have \"replace\" patches.',\n      function(op) {\n        return \"Unsupported patch operation: \" + op;\n      },\n      function(path) {\n        return \"Cannot apply patch, path doesn't resolve: \" + path;\n      },\n      \"Patching reserved attributes like __proto__, prototype and constructor is not allowed\"\n    );\n  }\n  const REPLACE = \"replace\";\n  const ADD = \"add\";\n  const REMOVE = \"remove\";\n  function generatePatches_(state, basePath, patches, inversePatches) {\n    switch (state.type_) {\n      case 0 /* Object */:\n      case 2 /* Map */:\n        return generatePatchesFromAssigned(\n          state,\n          basePath,\n          patches,\n          inversePatches\n        );\n      case 1 /* Array */:\n        return generateArrayPatches(state, basePath, patches, inversePatches);\n      case 3 /* Set */:\n        return generateSetPatches(\n          state,\n          basePath,\n          patches,\n          inversePatches\n        );\n    }\n  }\n  function generateArrayPatches(state, basePath, patches, inversePatches) {\n    let { base_, assigned_ } = state;\n    let copy_ = state.copy_;\n    if (copy_.length < base_.length) {\n      ;\n      [base_, copy_] = [copy_, base_];\n      [patches, inversePatches] = [inversePatches, patches];\n    }\n    for (let i = 0; i < base_.length; i++) {\n      if (assigned_[i] && copy_[i] !== base_[i]) {\n        const path = basePath.concat([i]);\n        patches.push({\n          op: REPLACE,\n          path,\n          // Need to maybe clone it, as it can in fact be the original value\n          // due to the base/copy inversion at the start of this function\n          value: clonePatchValueIfNeeded(copy_[i])\n        });\n        inversePatches.push({\n          op: REPLACE,\n          path,\n          value: clonePatchValueIfNeeded(base_[i])\n        });\n      }\n    }\n    for (let i = base_.length; i < copy_.length; i++) {\n      const path = basePath.concat([i]);\n      patches.push({\n        op: ADD,\n        path,\n        // Need to maybe clone it, as it can in fact be the original value\n        // due to the base/copy inversion at the start of this function\n        value: clonePatchValueIfNeeded(copy_[i])\n      });\n    }\n    for (let i = copy_.length - 1; base_.length <= i; --i) {\n      const path = basePath.concat([i]);\n      inversePatches.push({\n        op: REMOVE,\n        path\n      });\n    }\n  }\n  function generatePatchesFromAssigned(state, basePath, patches, inversePatches) {\n    const { base_, copy_ } = state;\n    each(state.assigned_, (key, assignedValue) => {\n      const origValue = get(base_, key);\n      const value = get(copy_, key);\n      const op = !assignedValue ? REMOVE : has(base_, key) ? REPLACE : ADD;\n      if (origValue === value && op === REPLACE)\n        return;\n      const path = basePath.concat(key);\n      patches.push(op === REMOVE ? { op, path } : { op, path, value });\n      inversePatches.push(\n        op === ADD ? { op: REMOVE, path } : op === REMOVE ? { op: ADD, path, value: clonePatchValueIfNeeded(origValue) } : { op: REPLACE, path, value: clonePatchValueIfNeeded(origValue) }\n      );\n    });\n  }\n  function generateSetPatches(state, basePath, patches, inversePatches) {\n    let { base_, copy_ } = state;\n    let i = 0;\n    base_.forEach((value) => {\n      if (!copy_.has(value)) {\n        const path = basePath.concat([i]);\n        patches.push({\n          op: REMOVE,\n          path,\n          value\n        });\n        inversePatches.unshift({\n          op: ADD,\n          path,\n          value\n        });\n      }\n      i++;\n    });\n    i = 0;\n    copy_.forEach((value) => {\n      if (!base_.has(value)) {\n        const path = basePath.concat([i]);\n        patches.push({\n          op: ADD,\n          path,\n          value\n        });\n        inversePatches.unshift({\n          op: REMOVE,\n          path,\n          value\n        });\n      }\n      i++;\n    });\n  }\n  function generateReplacementPatches_(baseValue, replacement, patches, inversePatches) {\n    patches.push({\n      op: REPLACE,\n      path: [],\n      value: replacement === NOTHING ? void 0 : replacement\n    });\n    inversePatches.push({\n      op: REPLACE,\n      path: [],\n      value: baseValue\n    });\n  }\n  function applyPatches_(draft, patches) {\n    patches.forEach((patch) => {\n      const { path, op } = patch;\n      let base = draft;\n      for (let i = 0; i < path.length - 1; i++) {\n        const parentType = getArchtype(base);\n        let p = path[i];\n        if (typeof p !== \"string\" && typeof p !== \"number\") {\n          p = \"\" + p;\n        }\n        if ((parentType === 0 /* Object */ || parentType === 1 /* Array */) && (p === \"__proto__\" || p === \"constructor\"))\n          die(errorOffset + 3);\n        if (typeof base === \"function\" && p === \"prototype\")\n          die(errorOffset + 3);\n        base = get(base, p);\n        if (typeof base !== \"object\")\n          die(errorOffset + 2, path.join(\"/\"));\n      }\n      const type = getArchtype(base);\n      const value = deepClonePatchValue(patch.value);\n      const key = path[path.length - 1];\n      switch (op) {\n        case REPLACE:\n          switch (type) {\n            case 2 /* Map */:\n              return base.set(key, value);\n            case 3 /* Set */:\n              die(errorOffset);\n            default:\n              return base[key] = value;\n          }\n        case ADD:\n          switch (type) {\n            case 1 /* Array */:\n              return key === \"-\" ? base.push(value) : base.splice(key, 0, value);\n            case 2 /* Map */:\n              return base.set(key, value);\n            case 3 /* Set */:\n              return base.add(value);\n            default:\n              return base[key] = value;\n          }\n        case REMOVE:\n          switch (type) {\n            case 1 /* Array */:\n              return base.splice(key, 1);\n            case 2 /* Map */:\n              return base.delete(key);\n            case 3 /* Set */:\n              return base.delete(patch.value);\n            default:\n              return delete base[key];\n          }\n        default:\n          die(errorOffset + 1, op);\n      }\n    });\n    return draft;\n  }\n  function deepClonePatchValue(obj) {\n    if (!isDraftable(obj))\n      return obj;\n    if (Array.isArray(obj))\n      return obj.map(deepClonePatchValue);\n    if (isMap(obj))\n      return new Map(\n        Array.from(obj.entries()).map(([k, v]) => [k, deepClonePatchValue(v)])\n      );\n    if (isSet(obj))\n      return new Set(Array.from(obj).map(deepClonePatchValue));\n    const cloned = Object.create(getPrototypeOf(obj));\n    for (const key in obj)\n      cloned[key] = deepClonePatchValue(obj[key]);\n    if (has(obj, DRAFTABLE))\n      cloned[DRAFTABLE] = obj[DRAFTABLE];\n    return cloned;\n  }\n  function clonePatchValueIfNeeded(obj) {\n    if (isDraft(obj)) {\n      return deepClonePatchValue(obj);\n    } else\n      return obj;\n  }\n  loadPlugin(\"Patches\", {\n    applyPatches_,\n    generatePatches_,\n    generateReplacementPatches_\n  });\n}\n\n// src/plugins/mapset.ts\nfunction enableMapSet() {\n  class DraftMap extends Map {\n    constructor(target, parent) {\n      super();\n      this[DRAFT_STATE] = {\n        type_: 2 /* Map */,\n        parent_: parent,\n        scope_: parent ? parent.scope_ : getCurrentScope(),\n        modified_: false,\n        finalized_: false,\n        copy_: void 0,\n        assigned_: void 0,\n        base_: target,\n        draft_: this,\n        isManual_: false,\n        revoked_: false\n      };\n    }\n    get size() {\n      return latest(this[DRAFT_STATE]).size;\n    }\n    has(key) {\n      return latest(this[DRAFT_STATE]).has(key);\n    }\n    set(key, value) {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      if (!latest(state).has(key) || latest(state).get(key) !== value) {\n        prepareMapCopy(state);\n        markChanged(state);\n        state.assigned_.set(key, true);\n        state.copy_.set(key, value);\n        state.assigned_.set(key, true);\n      }\n      return this;\n    }\n    delete(key) {\n      if (!this.has(key)) {\n        return false;\n      }\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      prepareMapCopy(state);\n      markChanged(state);\n      if (state.base_.has(key)) {\n        state.assigned_.set(key, false);\n      } else {\n        state.assigned_.delete(key);\n      }\n      state.copy_.delete(key);\n      return true;\n    }\n    clear() {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      if (latest(state).size) {\n        prepareMapCopy(state);\n        markChanged(state);\n        state.assigned_ = /* @__PURE__ */ new Map();\n        each(state.base_, (key) => {\n          state.assigned_.set(key, false);\n        });\n        state.copy_.clear();\n      }\n    }\n    forEach(cb, thisArg) {\n      const state = this[DRAFT_STATE];\n      latest(state).forEach((_value, key, _map) => {\n        cb.call(thisArg, this.get(key), key, this);\n      });\n    }\n    get(key) {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      const value = latest(state).get(key);\n      if (state.finalized_ || !isDraftable(value)) {\n        return value;\n      }\n      if (value !== state.base_.get(key)) {\n        return value;\n      }\n      const draft = createProxy(value, state);\n      prepareMapCopy(state);\n      state.copy_.set(key, draft);\n      return draft;\n    }\n    keys() {\n      return latest(this[DRAFT_STATE]).keys();\n    }\n    values() {\n      const iterator = this.keys();\n      return {\n        [Symbol.iterator]: () => this.values(),\n        next: () => {\n          const r = iterator.next();\n          if (r.done)\n            return r;\n          const value = this.get(r.value);\n          return {\n            done: false,\n            value\n          };\n        }\n      };\n    }\n    entries() {\n      const iterator = this.keys();\n      return {\n        [Symbol.iterator]: () => this.entries(),\n        next: () => {\n          const r = iterator.next();\n          if (r.done)\n            return r;\n          const value = this.get(r.value);\n          return {\n            done: false,\n            value: [r.value, value]\n          };\n        }\n      };\n    }\n    [(DRAFT_STATE, Symbol.iterator)]() {\n      return this.entries();\n    }\n  }\n  function proxyMap_(target, parent) {\n    return new DraftMap(target, parent);\n  }\n  function prepareMapCopy(state) {\n    if (!state.copy_) {\n      state.assigned_ = /* @__PURE__ */ new Map();\n      state.copy_ = new Map(state.base_);\n    }\n  }\n  class DraftSet extends Set {\n    constructor(target, parent) {\n      super();\n      this[DRAFT_STATE] = {\n        type_: 3 /* Set */,\n        parent_: parent,\n        scope_: parent ? parent.scope_ : getCurrentScope(),\n        modified_: false,\n        finalized_: false,\n        copy_: void 0,\n        base_: target,\n        draft_: this,\n        drafts_: /* @__PURE__ */ new Map(),\n        revoked_: false,\n        isManual_: false\n      };\n    }\n    get size() {\n      return latest(this[DRAFT_STATE]).size;\n    }\n    has(value) {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      if (!state.copy_) {\n        return state.base_.has(value);\n      }\n      if (state.copy_.has(value))\n        return true;\n      if (state.drafts_.has(value) && state.copy_.has(state.drafts_.get(value)))\n        return true;\n      return false;\n    }\n    add(value) {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      if (!this.has(value)) {\n        prepareSetCopy(state);\n        markChanged(state);\n        state.copy_.add(value);\n      }\n      return this;\n    }\n    delete(value) {\n      if (!this.has(value)) {\n        return false;\n      }\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      prepareSetCopy(state);\n      markChanged(state);\n      return state.copy_.delete(value) || (state.drafts_.has(value) ? state.copy_.delete(state.drafts_.get(value)) : (\n        /* istanbul ignore next */\n        false\n      ));\n    }\n    clear() {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      if (latest(state).size) {\n        prepareSetCopy(state);\n        markChanged(state);\n        state.copy_.clear();\n      }\n    }\n    values() {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      prepareSetCopy(state);\n      return state.copy_.values();\n    }\n    entries() {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      prepareSetCopy(state);\n      return state.copy_.entries();\n    }\n    keys() {\n      return this.values();\n    }\n    [(DRAFT_STATE, Symbol.iterator)]() {\n      return this.values();\n    }\n    forEach(cb, thisArg) {\n      const iterator = this.values();\n      let result = iterator.next();\n      while (!result.done) {\n        cb.call(thisArg, result.value, result.value, this);\n        result = iterator.next();\n      }\n    }\n  }\n  function proxySet_(target, parent) {\n    return new DraftSet(target, parent);\n  }\n  function prepareSetCopy(state) {\n    if (!state.copy_) {\n      state.copy_ = /* @__PURE__ */ new Set();\n      state.base_.forEach((value) => {\n        if (isDraftable(value)) {\n          const draft = createProxy(value, state);\n          state.drafts_.set(value, draft);\n          state.copy_.add(draft);\n        } else {\n          state.copy_.add(value);\n        }\n      });\n    }\n  }\n  function assertUnrevoked(state) {\n    if (state.revoked_)\n      die(3, JSON.stringify(latest(state)));\n  }\n  loadPlugin(\"MapSet\", { proxyMap_, proxySet_ });\n}\n\n// src/immer.ts\nvar immer = new Immer2();\nvar produce = immer.produce;\nvar produceWithPatches = /* @__PURE__ */ immer.produceWithPatches.bind(\n  immer\n);\nvar setAutoFreeze = /* @__PURE__ */ immer.setAutoFreeze.bind(immer);\nvar setUseStrictShallowCopy = /* @__PURE__ */ immer.setUseStrictShallowCopy.bind(\n  immer\n);\nvar applyPatches = /* @__PURE__ */ immer.applyPatches.bind(immer);\nvar createDraft = /* @__PURE__ */ immer.createDraft.bind(immer);\nvar finishDraft = /* @__PURE__ */ immer.finishDraft.bind(immer);\nfunction castDraft(value) {\n  return value;\n}\nfunction castImmutable(value) {\n  return value;\n}\nexport {\n  Immer2 as Immer,\n  applyPatches,\n  castDraft,\n  castImmutable,\n  createDraft,\n  current,\n  enableMapSet,\n  enablePatches,\n  finishDraft,\n  freeze,\n  DRAFTABLE as immerable,\n  isDraft,\n  isDraftable,\n  NOTHING as nothing,\n  original,\n  produce,\n  produceWithPatches,\n  setAutoFreeze,\n  setUseStrictShallowCopy\n};\n//# sourceMappingURL=immer.mjs.map","/**\n * Fallback handling\n *\n * Defaults to rendering a fallback image with standard chart proportions.\n *\n * @example\n * if (sszvis.fallback.unsupported()) {\n *   sszvis.fallback.render('#sszvis-chart', {src: '../fallback.png', height: 300});\n *   return;\n * }\n *\n * @module sszvis/fallback\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"./fn.js\";\n\nexport const fallbackUnsupported = function () {\n  const supportsSVG =\n    !!document.createElementNS &&\n    !!document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\").createSVGRect;\n  return !supportsSVG;\n};\n\nexport const fallbackCanvasUnsupported = function () {\n  const supportsCanvas = !!document.createElement(\"canvas\").getContext;\n  return !supportsCanvas;\n};\n\nexport const fallbackRender = function (selector, options) {\n  options || (options = {});\n  options.src || (options.src = \"fallback.png\");\n  const selection = fn.isSelection(selector) ? selector : select(selector);\n  selection.append(\"img\").attr(\"class\", \"sszvis-fallback-image\").attr(\"src\", options.src);\n};\n","module.exports = function (callback, ms, trailing) {\n  var t = 0, call;\n  arguments.length < 3 && (trailing = true);\n  return function () {\n    var args = arguments;\n    var self = this;\n    call = function () {\n      callback.apply(self, args);\n      t = new Date().getTime() + ms;\n      call = null;\n      trailing && setTimeout(function () {\n        call && call();\n      }, ms);\n    };\n    if (new Date().getTime() > t) call();\n  }\n};\n","/**\n * Viewport Resize watcher\n *\n * The resize watcher in the sszvis.viewport module can be used for alerting user code to\n * changes in the browser window size. This includes window resizing on desktop computers\n * and browsers, but also orientation changes on mobile browsers. Functions which listen\n * to the 'resize' event of the sszvis.viewport module will be fired on window resize.\n * You can add a resize listener to your application very easily:\n *\n * sszvis.viewport.on('resize', listenerFunction);\n *\n * The listener function will be called once per resize event, but at a slight delay. This is because,\n * while a user is resizing their browser window, many resize events can fire very quickly. This component\n * automatically throttles the rate at which the listener function is called, since you probably don't need\n * to respond to every single resize event. This throttling provides for a smoother user experience as they\n * resize the browser, and increases performance across the board. The listener function will always be\n * called after one or more window resize events, it just won't be called as often as the window fires the\n * events.\n *\n * @module sszvis/viewport\n *\n * @function {string, function} on      the .on() function is used to listen to the resize event itself.\n *                                      There is only one event supported by this component at the moment, so\n *                                      the first argument to .on must be 'resize' for it to have any effect.\n *                                      Although this is somewhat redundant, it is done to keep this component's\n *                                      API clear and in line with other components.\n *\n * @return {Object}\n */\n\nimport { select } from \"d3\";\nimport throttle from \"nano-throttle\";\n\n// This rather strange set of functions is designed to support the API:\n// sszvis.viewport.on('resize', callback);\n// While still enabling the user to register multiple callbacks for the 'resize'\n// event. Multiple callbacks are a feature which simply returning a d3.dispatch('resize')\n// object would not allow.\nconst callbacks = {\n  resize: [],\n};\n\nif (globalThis.window !== undefined) {\n  select(globalThis).on(\n    \"resize\",\n    throttle(() => {\n      trigger(\"resize\");\n    }, 500)\n  );\n}\n\nconst on = function (name, cb) {\n  if (!callbacks[name]) {\n    callbacks[name] = [];\n  }\n  callbacks[name] = [...callbacks[name].filter((fn) => fn !== cb), cb];\n  return this;\n};\n\nconst off = function (name, cb) {\n  if (!callbacks[name]) {\n    return this;\n  }\n  callbacks[name] = callbacks[name].filter((fn) => fn !== cb);\n  return this;\n};\n\nconst trigger = function (name) {\n  const evtArgs = Array.prototype.slice.call(arguments, 1);\n  if (callbacks[name]) {\n    for (const fn of callbacks[name]) {\n      fn.apply(null, evtArgs);\n    }\n  }\n  return this;\n};\n\nexport const viewport = { on, off, trigger };\n","import { createDraft, finishDraft, setAutoFreeze } from \"immer\";\nimport { fallbackRender } from \"./fallback\";\nimport { viewport } from \"./viewport/resize\";\n\n// d3 mutates state in many places, which is why we have to turn this off.\nsetAutoFreeze(false);\n\n/**\n * Application loop\n *\n * Creates a stateful app that can be interacted with through actions. By providing\n * a structured approach, this allows us to optimize the render loop and clarifies\n * the relationship between state and actions.\n *\n * Within an app, state can only be modified through actions. During the render phase,\n * state is immutable and an error will be thrown if it is modified accidentally.\n *\n * Conceptually, an app works like this:\n *\n *     init\n *       ⇣\n *     state ⭢ render\n *      ⮤ action ⮠\n *\n * The basis of an app are the following three types:\n *\n * Dispatch can be used to schedule an action after rendering has been completed. In the\n * render function, dispatch is not directly accessible; instead, an actions object is\n * provided to dispatch actions by calling them as functions.\n * @typedef {(action: string, p?: Props) => void} Dispatch\n *\n * An effect can be returned from an action to schedule further actions using dispatch.\n * @typedef {(d: Dispatch, p?: Props) => void} Effect\n *\n * An action receives an Immer.js Draft that can be mutated within the action. If further\n * actions should be called after this one, an action can return an Effect.\n * @typedef {(s: Draft, p?: Props) => Effect | void} Action\n * @see {@link https://immerjs.github.io/immer/docs/produce/}\n *\n * The app can be configured with the following props:\n *\n * @prop {Object} props\n * @prop {(s: Draft) => Promise<Effect | void>} props.init - Asynchronously create\n * the initial state and optionally schedule an action\n * @prop {(s: State, as: Record<keyof props.actions, (p?: Props) => void>)} props.render - Update\n * the DOM from the state and optionally dispatch actions\n * @prop {Record<string, Action>} [props.actions] - Functions to transition the\n * application state\n * @prop {{element: string, src: string}} [props.fallback] - Render a fallback image\n *\n * @module sszvis/app\n */\nexport const app = ({ init, render, actions = {}, fallback }) => {\n  let doing;\n  let state;\n\n  invariant(isFunction(init), 'An \"init\" function returning a Promise must be provided.');\n  invariant(isFunction(render), 'A \"render\" function must be provided.');\n\n  const actionDispatchers = Object.keys(actions).reduce((acc, key) => {\n    acc[key] = (...args) => {\n      dispatch(key, args);\n    };\n    return acc;\n  }, {});\n\n  function scheduleUpdate(effect) {\n    if (!doing) {\n      doing = true;\n      requestAnimationFrame(() => {\n        render(state, actionDispatchers);\n        doing = false;\n      });\n    }\n    if (isFunction(effect)) effect(dispatch);\n  }\n\n  function dispatch(action, props) {\n    invariant(actions[action] != null, `Action \"${action}\" is not defined, add it to \"actions\".`);\n    const draft = createDraft(state);\n    const effect = actions[action](draft, ...props);\n    state = finishDraft(draft);\n    scheduleUpdate(effect);\n  }\n\n  const initialState = createDraft({});\n  init(initialState)\n    .then((effect) => {\n      state = finishDraft(initialState);\n      scheduleUpdate(effect);\n      viewport.on(\"resize\", scheduleUpdate);\n    })\n    .catch((error) => {\n      invariant(false, error);\n      fallback && fallbackRender(fallback.element, { src: fallback.src });\n    });\n};\n\n// -----------------------------------------------------------------------------\n// Helper functions\n\nfunction invariant(condition, message) {\n  if (!condition) {\n    throw new Error(`[sszvis.app] ${message}`);\n  }\n}\n\nfunction isFunction(x) {\n  return typeof x === \"function\";\n}\n","/**\n * Responsive design breakpoints for sszvis\n *\n * @module sszvis/breakpoint\n *\n * Provides breakpoint-related functions, including those which build special\n * breakpoint objects that can be used to test against screen measurements to see\n * if the breakpoint matches, and this module also includes the default breakpoint\n * sizes for SSZVIS. The breakpoints are inclusive upper limits, i.e. when testing a\n * breakpoint against a given set of measurements, if the breakpoint value is greater than\n * or equal to all measurements, the breakpoint will match. In code where the user should\n * supply breakpoints, the user is responsible for specifying the testing order of the breakpoints\n * provided. The breakpoints are then tested in order, and the first one which matches the measurements\n * is chosen. The user should, where possible, specify breakpoints in increasing order of size.\n * Since there are multiple dimensions on which 'size' can be defined, we do not specify our own\n * algorithm for sorting user-defined breakpoints. We rely on the judgment of the user to do that.\n *\n * @property {Function} createSpec\n * @property {Function} defaultSpec\n * @property {Function} findByName\n * @property {Function} find\n * @property {Function} match\n * @property {Function} test\n *\n * @property {Function} palm Breakpoint for plam-sized devices (phones)\n * @property {Function} lap  Breakpoint for lap-sized devices (tablets, small notebooks)\n *\n * @type Measurement {\n *   width: number,\n *   screenHeight: number\n * }\n *\n * @type Breakpoint {\n *   name: string,\n *   measurement: Measurement\n * }\n */\n\nimport * as fn from \"./fn.js\";\n\n/**\n * breakpoint.find\n *\n * Returns the first matching breakpoint for a given measurement\n *\n * @param {Array<Breakpoint>} breakpoints A breakpoint spec\n * @param {Measurement} partialMeasurement A partial measurement to match to the spec\n * @returns {Breakpoint}\n */\nexport function breakpointFind(breakpoints, partialMeasurement) {\n  const measurement = parseMeasurement(partialMeasurement);\n  return fn.find((bp) => breakpointTest(bp, measurement), breakpoints);\n}\n\n/**\n * breakpoint.findByName\n *\n * Returns the breakpoint with the given name. If there is no such breakpoint,\n * undefined is returned\n *\n * @param {Array<Breakpoint>} breakpoints A breakpoint spec\n * @param {string} name A breakpoint name\n * @returns {Breakpoint?} If no breakpoint matches, undefined is returned. If a\n *          breakpoint for the given name exists, that breakpoint is returned\n */\nexport function breakpointFindByName(breakpoints, name) {\n  const eqName = function (bp) {\n    return bp.name === name;\n  };\n  return fn.find(eqName, breakpoints);\n}\n\n/**\n * breakpoint.test\n *\n * Returns true if the given measurement fits within the breakpoint.\n *\n * @param {Breakpoint} breakpoint A single breakpoint\n * @param {Measurement} partialMeasurement A partial measurement to match to the breakpoint\n * @returns {boolean}\n */\nexport function breakpointTest(breakpoint, partialMeasurement) {\n  const bpm = breakpoint.measurement;\n  const measurement = parseMeasurement(partialMeasurement);\n  return measurement.width <= bpm.width && measurement.screenHeight <= bpm.screenHeight;\n}\n\n/**\n * breakpoint.match\n *\n * Returns an array of breakpoints the given measurement fits into. Use this in situations\n * where you need to match a sparse list of breakpoints.\n *\n * @param {Array<Breakpoint>} breakpoints A breakpoint spec\n * @param {Measurement} partialMeasurement A partial measurement to match to the spec\n * @returns {Array<Breakpoint>}\n */\nexport function breakpointMatch(breakpoints, partialMeasurement) {\n  const measurement = parseMeasurement(partialMeasurement);\n  return breakpoints.filter((bp) => breakpointTest(bp, measurement));\n}\n\n/**\n * breakpoint.createSpec\n *\n * Parses an array of partial breakpoints into a valid breakpoint spec.\n *\n * @param {Array<{name: string, width?: number, screenHeight?: number}>} spec An array\n *        of breakpoint definitions. All breakpoints are parsed into a full representation,\n *        so it's possible to only provide partial breakpoint definitions.\n * @returns {Array<Breakpoint>}\n */\nexport function breakpointCreateSpec(spec) {\n  return [...spec.map(parseBreakpoint), parseBreakpoint({ name: \"_\" })];\n}\n\n/**\n * breakpoint.defaultSpec\n *\n * @returns {Array<{name: string, width: number, screenHeight: number}>} The SSZVIS\n *          default breakpoint spec.\n */\nexport const breakpointDefaultSpec = (function () {\n  const DEFAULT_SPEC = breakpointCreateSpec([\n    { name: \"palm\", width: 540 },\n    { name: \"lap\", width: 749 },\n  ]);\n  return function () {\n    return DEFAULT_SPEC;\n  };\n})();\n\n// Default tests\nexport const breakpointPalm = makeTest(\"palm\");\nexport const breakpointLap = makeTest(\"lap\");\n\n// Helpers\n\n/**\n * Measurement\n *\n * A measurement is defined as an object with width and screenHeight props.\n * It is used throughout the breakpoint calculations.\n *\n * For parsing, a partial measurement can be supplied. If a property is\n * not defined, it is initialized to Infinity, which matches all breakpoints.\n *\n * @example\n *   const Measurement = {\n *     width: number,\n *     screenHeight: number\n *   }\n *\n * @param {{width?: number, screenHeight?: number}} partialMeasurement\n * @returns Measurement\n */\nfunction parseMeasurement(partialMeasurement) {\n  const widthOrInf = fn.propOr(\"width\", Infinity);\n  const screenHeightOrInf = fn.propOr(\"screenHeight\", Infinity);\n  return {\n    width: widthOrInf(partialMeasurement),\n    screenHeight: screenHeightOrInf(partialMeasurement),\n  };\n}\n\n/**\n * Breakpoint\n *\n * A breakpoint is defined as an object with name and measurement props.\n * It is used throughout the breakpoint calculations.\n *\n * For parsing, a partial breakpoint can be supplied where measurements\n * can be directly supplied on the top object.\n *\n * @example\n *   const PartialBreakpoint = {\n *     name: string,\n *     width?: number,\n *     screenHeight?: number\n *   }\n *\n *   const Breakpoint = {\n *     name: string,\n *     measurement: Measurement\n *   }\n *\n * @param {{name: string, width?: number, screenHeight?: number, measurement?: Measurement}} bp\n * @returns Breakpoint\n */\nfunction parseBreakpoint(bp) {\n  const measurement = fn.defined(bp.measurement)\n    ? parseMeasurement(bp.measurement)\n    : parseMeasurement({ width: bp.width, screenHeight: bp.screenHeight });\n  return {\n    name: bp.name,\n    measurement,\n  };\n}\n\n/**\n * Create a partially applied test function\n */\nfunction makeTest(name) {\n  return function (measurement) {\n    return breakpointTest(breakpointFindByName(breakpointDefaultSpec(), name), measurement);\n  };\n}\n","/**\n * Functions related to aspect ratio calculations. An \"auto\" function is\n * provided and should be used in most cases to find the recommended\n * aspect ratio.\n *\n * @module sszvis/aspectRatio\n */\n\nimport { breakpointFind, breakpointDefaultSpec } from \"./breakpoint.js\";\n\n/**\n * aspectRatio\n *\n * The base module is a function which creates an aspect ratio function.\n * You provide a width and a height of the aspect ratio, and the\n * returned function accepts any width, returning the corresponding\n * height for the aspect ratio you configured.\n *\n * @param {Number} x  The number of parts on the horizontal axis (dividend)\n * @param {Number} y  The number of parts on the vertical axis (divisor)\n * @return {Function} The aspect ratio function. Takes a width as an argument\n *                    and returns the corresponding height based on the\n *                    aspect ratio defined by x:y.\n */\nexport function aspectRatio(x, y) {\n  const ar = x / y;\n  return function (width) {\n    return width / ar;\n  };\n}\n\n/**\n * aspectRatio4to3\n *\n * Recommended breakpoints:\n *   - palm\n *\n * @param {Number} width\n * @returns {Number} height\n */\nexport const aspectRatio4to3 = aspectRatio(4, 3);\n\n/**\n * aspectRatio16to10\n *\n * Recommended breakpoints:\n *   - lap\n *\n * @param {Number} width\n * @returns {Number} height\n */\nexport const aspectRatio16to10 = aspectRatio(16, 10);\n\n/**\n * aspectRatio12to5\n *\n * Recommended breakpoints:\n *   - desk\n *\n * @param {Number} width\n * @returns {Number} height\n */\nconst AR12TO5_MAX_HEIGHT = 500;\nexport const aspectRatio12to5 = function (width) {\n  return Math.min(aspectRatio(12, 5)(width), AR12TO5_MAX_HEIGHT);\n};\naspectRatio12to5.MAX_HEIGHT = AR12TO5_MAX_HEIGHT;\n\n/**\n * aspectRatioSquare\n *\n * This aspect ratio constrains the returned height to a maximum of 420px.\n * It is recommended to center charts within this aspect ratio.\n *\n * Exposes the MAX_HEIGHT used as a property on the function.\n *\n * Recommended breakpoints:\n *   - palm\n *   - lap\n *   - desk\n *\n * @param {Number} width\n * @returns {Number} height\n */\nconst SQUARE_MAX_HEIGHT = 420;\nexport const aspectRatioSquare = function (width) {\n  return Math.min(aspectRatio(1, 1)(width), SQUARE_MAX_HEIGHT);\n};\naspectRatioSquare.MAX_HEIGHT = SQUARE_MAX_HEIGHT;\n\n/**\n * aspectRatioPortrait\n *\n * This aspect ratio constrains the returned height to a maximum of 600px.\n * It is recommended to center charts within this aspect ratio.\n *\n * Exposes the MAX_HEIGHT used as a property on the function.\n *\n * Recommended breakpoints:\n *   - palm\n *   - lap\n *   - desk\n *\n * @param {Number} width\n * @returns {Number} height\n */\nconst PORTRAIT_MAX_HEIGHT = 600;\nexport const aspectRatioPortrait = function (width) {\n  return Math.min(aspectRatio(4, 5)(width), PORTRAIT_MAX_HEIGHT);\n};\naspectRatioPortrait.MAX_HEIGHT = PORTRAIT_MAX_HEIGHT;\n\n/**\n * aspectRatioAuto\n *\n * Provides a set of default aspect ratios for different widths. If you provide a set\n * of measurements for a container and the window itself, it will provide the default\n * value of the height for that container. Note that the aspect ratio chosen may\n * depend on the container width itself. This is because of default breakpoints.\n *\n * @param  {Measurement} measurement The measurements object for the container for which you\n *                                   want a height value. Should have at least the properties:\n *                                     - `width`: container's width\n *                                     - `screenHeight`: the height of the window at the current time.\n *\n * @return {Number} The height which corresponds to the default aspect ratio for these measurements\n */\nconst defaultAspectRatios = {\n  palm: aspectRatio4to3, // palm-sized devices\n  lap: aspectRatio16to10, // lap-sized devices\n  _: aspectRatio12to5, // all other cases, including desk\n};\n\nexport const aspectRatioAuto = function (measurement) {\n  const bp = breakpointFind(breakpointDefaultSpec(), measurement);\n  const ar = defaultAspectRatios[bp.name];\n  return ar(measurement.width);\n};\n","/**\n *\n * @module sszvis/logger\n *\n * A component for logging development messages and errors\n *\n * This is a custom logger which accomplishes two goals: 1) to clearly identify log messages\n * coming from sszvis, and 2) to smooth out cross-browser inconsistencies in the implementation\n * of various console functions.\n *\n * All log messages should be visible in the developer tools Javascript console for your web browser\n * of choice. For more information on how to access browser developer tools, see the browser documentation.\n *\n * The logger provides three log levels. All logging functions can accept any number of arguments of\n * any type.\n *\n * Examples:\n *\n * Logging general information:\n *\n * sszvis.logger.log('Circle coordinates: ', circle.cx, circle.cy, circle.r);\n *\n * Logging a warning:\n *\n * sszvis.logger.warn('Configuration options are incompatible: ', props.config1(), props.config2());\n *\n * Logging an error:\n *\n * sszvis.logger.error('Component X requires the \"abc\" property');\n *\n * @method {any...} log        The basic log level, used for informational purposes\n * @method {any...} warn       Logs a warning, which identifies a potential, but not critical problem\n *                             or informs the user about certain implementation issues which may or\n *                             may not require user attention.\n * @method {any...} error      Logs an error. This should be used when something has gone wrong in the\n *                             implementation, or when the API is used in an unsupported manner. An\n *                             error logged in this way is different from an uncaught exception, in that\n *                             it does not force an unexpected termination of code execution. Instead,\n *                             when errors are logged, it is because of a known, and noticed issue, and\n *                             the error message should provide some information towards resolving the\n *                             problem, usually by changing the use of the library. The implementation\n *                             will handle the situation gracefully, and not cause an unexpected termination\n *                             of execution.\n */\n\nexport const log = logger(\"log\");\nexport const warn = logger(\"warn\");\nexport const error = logger(\"error\");\n\n/* Helper functions\n----------------------------------------------- */\nfunction logger(type) {\n  return function () {\n    if (console && console[type]) {\n      for (const msg of slice(arguments)) {\n        console[type](msg);\n      }\n    }\n  };\n}\n\nfunction slice(array) {\n  return Array.prototype.slice.call(array);\n}\n","/**\n * Scale utilities\n *\n * @module sszvis/scale\n */\n\n/**\n * Scale range\n *\n * Used to determine the extent of a scale's range. Mimics a function found in d3 source code.\n *\n * @param  {array} scale    The scale to be measured\n * @return {array}          The extent of the scale's range. Useful for determining how far\n *                          a scale stretches in its output dimension.\n */\nexport const range = function (scale) {\n  // borrowed from d3 source - svg.axis\n  return scale.rangeExtent ? scale.rangeExtent() : extent(scale.range());\n};\n\n/**\n * Helper function\n * Extent\n *\n * Used to determine the extent of an array. Mimics a function found in d3 source code.\n *\n * @param  {array} domain     an array, sorted in either ascending or descending order\n * @return {array}            the extent of the array, with the smaller term first.\n */\nfunction extent(domain) {\n  // borrowed from d3 source - svg.axis\n  const start = domain[0],\n    stop = domain[domain.length - 1];\n  return start < stop ? [start, stop] : [stop, start];\n}\n","/**\n * Text wrap\n *\n * Function allowing to 'wrap' the text from an SVG <text> element with <tspan>.\n *\n * @module sszvis/svgUtils/textWrap\n *\n * Based on https://github.com/mbostock/d3/issues/1642\n * @example svg.append(\"g\")\n *      .attr(\"class\", \"x axis\")\n *      .attr(\"transform\", \"translate(0,\" + height + \")\")\n *      .call(xAxis)\n *      .selectAll(\".tick text\")\n *          .call(d3TextWrap, x.rangeBand());\n *\n * @param text d3 selection for one or more <text> object\n * @param width number - global width in which the text will be word-wrapped.\n * @param paddingRightLeft integer - Padding right and left between the wrapped text and the 'invisible bax' of 'width' width\n * @param paddingTopBottom integer - Padding top and bottom between the wrapped text and the 'invisible bax' of 'width' width\n * @returns Array[number] - Number of lines created by the function, stored in a Array in case multiple <text> element are passed to the function\n */\n\nimport { select } from \"d3\";\n\nexport default function (selection, width, paddingRightLeft, paddingTopBottom) {\n  paddingRightLeft = paddingRightLeft || 5; //Default padding (5px)\n  paddingTopBottom = (paddingTopBottom || 5) - 2; //Default padding (5px), remove 2 pixels because of the borders\n  const maxWidth = width; //I store the tooltip max width\n  width = width - paddingRightLeft * 2; //Take the padding into account\n\n  const arrLineCreatedCount = [];\n  selection.each(function () {\n    const text = select(this);\n    const words = text\n      .text()\n      .split(/[\\t\\n\\v\\f\\r ]+/)\n      .reverse(); //Don't cut non-breaking space (\\xA0), as well as the Unicode characters \\u00A0 \\u2028 \\u2029)\n    let word;\n    let line = [];\n    let lineNumber = 0;\n    const lineHeight = 1.1; //Em\n    let x;\n    let y = text.attr(\"y\");\n    let dy = Number.parseFloat(text.attr(\"dy\"));\n    let createdLineCount = 1; //Total line created count\n    const textAlign = text.style(\"text-anchor\") || \"start\"; //'start' by default (start, middle, end, inherit)\n\n    //Clean the data in case <text> does not define those values\n    if (isNaN(dy)) dy = 0; //Default padding (0em) : the 'dy' attribute on the first <tspan> _must_ be identical to the 'dy' specified on the <text> element, or start at '0em' if undefined\n\n    //Offset the text position based on the text-anchor\n    const wrapTickLabels = select(text.node().parentNode).classed(\"tick\"); //Don't wrap the 'normal untranslated' <text> element and the translated <g class='tick'><text></text></g> elements the same way..\n    if (wrapTickLabels) {\n      switch (textAlign) {\n        case \"start\": {\n          x = -width / 2;\n          break;\n        }\n        case \"middle\": {\n          x = 0;\n          break;\n        }\n        case \"end\": {\n          x = width / 2;\n          break;\n        }\n        default:\n      }\n    } else {\n      //untranslated <text> elements\n      switch (textAlign) {\n        case \"start\": {\n          x = paddingRightLeft;\n          break;\n        }\n        case \"middle\": {\n          x = maxWidth / 2;\n          break;\n        }\n        case \"end\": {\n          x = maxWidth - paddingRightLeft;\n          break;\n        }\n        default:\n      }\n    }\n    y = +(null === y ? paddingTopBottom : y);\n\n    let tspan = text\n      .text(null)\n      .append(\"tspan\")\n      .attr(\"x\", x)\n      .attr(\"y\", y)\n      .attr(\"dy\", dy + \"em\");\n\n    while (words.length > 0) {\n      word = words.pop();\n      line.push(word);\n      tspan.text(line.join(\" \"));\n      if (tspan.node().getComputedTextLength() > width && line.length > 1) {\n        line.pop();\n        tspan.text(line.join(\" \"));\n        line = [word];\n        tspan = text\n          .append(\"tspan\")\n          .attr(\"x\", x)\n          .attr(\"y\", y)\n          .attr(\"dy\", ++lineNumber * lineHeight + dy + \"em\")\n          .text(word);\n        ++createdLineCount;\n      }\n    }\n\n    arrLineCreatedCount.push(createdLineCount); //Store the line count in the array\n  });\n  return arrLineCreatedCount;\n}\n","/**\n * Axis component\n *\n * This component is an extension of d3.axis and provides the same interface\n * with some custom additions. It provides good defaults for sszvis charts\n * and helps with some commonly used functionality.\n *\n * @module sszvis/axis\n *\n * The following properties are directly delegated to the d3.axis component.\n * They are documented in the d3 documentation.\n * @see https://github.com/mbostock/d3/wiki/SVG-Axes\n *\n * @property {function} scale         Delegates to d3.axis\n * @property {function} orient        Delegates to d3.axis\n * @property {function} ticks         Delegates to d3.axis\n * @property {function} tickValues    Delegates to d3.axis\n * @property {function} tickSize      Delegates to d3.axis\n * @property {function} innerTickSize Delegates to d3.axis\n * @property {function} outerTickSize Delegates to d3.axis\n * @property {function} tickPadding   Delegates to d3.axis\n * @property {function} tickFormat    Delegates to d3.axis\n *\n * The following properties are custom additions.\n *\n * @property {boolean} alignOuterLabels                 Whether or not to align the outer labels to the axis extent so that they do not fall outside the axis space.\n * @property {boolean} contour                          Specify a 'contour' background for the axis labels.\n * @property {number} hideBorderTickThreshold           Specifies the pixel distance threshold for the visible tick correction. Ticks which are closer than\n *                                                      this threshold to the end of the axis (i.e. a tick which is 1 or two pixels from the end) will be\n *                                                      hidden from view. This prevents the display of a tick very close to the ending line.\n * @property {number} hideLabelThreshold                By default, labels are hidden when they are closer than LABEL_PROXIMITY_THRESHOLD to a highlighted label.\n *                                                      If this value is set to 0 or lower, labels won't be hidden, even if they overlap with the highlighted label.\n * @property {function} highlightTick                   Specifies a predicate function to use to determine whether axis ticks should be highlighted.\n *                                                      Any tick value which returns true for this predicate function will be treated specially as a highlighted tick.\n *                                                      Note that this function does NOT have any effect over which ticks are actually included on the axis. To create special\n *                                                      custom ticks, use tickValues.\n * @property {boolean} showZeroY                        Whether the axis should display a label for at y=0.\n * @property {string} slant                             Specify a label slant for the tick labels. Can be \"vertical\" - labels are displayed vertically - or\n *                                                      \"diagonal\" - labels are displayed at a 45 degree angle to the axis.\n *                                                      Use \"horizontal\" to reset to a horizontal slant.\n * @property {number} textWrap                          Specify a width at which to wrap the axis label text.\n * @property {number, function} tickLength              specify a number or a function which returns a number for setting the tick length.\n * @property {string} title                             Specify a string to use as the title of this chart. Default title position depends on the chart orientation\n * @property {string} titleAnchor                       specify the title text-anchor. Values are 'start', 'middle', and 'end'. Corresponds to the 'text-anchor' svg styling attribute\n *                                                      the default depends on the axis orient property\n * @property {boolean} titleCenter                      whether or not to center the axis title along the axis. If true, this sets the title anchor point\n *                                                      as the midpoint between axis extremes. Should usually be used with titleAnchor('middle') to ensure exact title centering. (default: false)\n * @property {number} dxTitle                           specify an amount by which to offset the title towards the left. This offsets away from the default position. (default: 0)\n * @property {number} dyTitle                           specify an amount by which to offset the title towards the top. This offsets away from the default position. (default: 0)\n * @property {boolean} titleVertical                    whether or not to rotate the title 90 degrees so that it appears vertical, reading from bottom to top. (default: false)\n * @property {boolean} vertical                         whether the axis is a vertical axis. When true, this property changes certain display properties of the axis according to the style guide.\n *\n * @return {sszvis.component}\n */\n\nimport { axisBottom, axisLeft, axisRight, axisTop, select, extent } from \"d3\";\nimport { component } from \"./d3-component.js\";\nimport * as fn from \"./fn.js\";\nimport { formatAxisTimeFormat, formatNumber, formatText } from \"./format.js\";\nimport * as logger from \"./logger.js\";\nimport { range } from \"./scale.js\";\nimport { halfPixel, transformTranslateSubpixelShift } from \"./svgUtils/crisp.js\";\nimport textWrap from \"./svgUtils/textWrap.js\";\nimport translateString from \"./svgUtils/translateString.js\";\n\nconst TICK_PROXIMITY_THRESHOLD = 8;\nconst TICK_END_THRESHOLD = 12;\nconst LABEL_PROXIMITY_THRESHOLD = 10;\n\nconst axis = function () {\n  // const axisDelegate = d3.axisBottom();\n  // axisDelegate.orient = function() { return 'bottom'; };\n\n  // axisComponent.__delegate__ = axisDelegate;\n\n  return (\n    component()\n      .prop(\"scale\")\n      .prop(\"orient\")\n      .prop(\"ticks\")\n      .prop(\"tickValues\")\n      .prop(\"tickSize\")\n      .prop(\"tickSizeInner\")\n      .prop(\"tickSizeOuter\")\n      .prop(\"tickPadding\")\n      .prop(\"tickFormat\")\n\n      .prop(\"_scale\")\n\n      .prop(\"orient\")\n      .orient(\"bottom\")\n      .prop(\"alignOuterLabels\")\n      .alignOuterLabels(false)\n      .prop(\"contour\")\n      .prop(\"hideBorderTickThreshold\")\n      .hideBorderTickThreshold(TICK_PROXIMITY_THRESHOLD)\n      .prop(\"hideLabelThreshold\")\n      .hideLabelThreshold(LABEL_PROXIMITY_THRESHOLD)\n      .prop(\"highlightTick\", fn.functor)\n      .prop(\"showZeroY\")\n      .showZeroY(false)\n      .prop(\"slant\")\n      .prop(\"textWrap\")\n      .prop(\"tickLength\")\n      .prop(\"title\")\n      .prop(\"titleAnchor\") // start, end, or middle\n      .prop(\"titleCenter\") // a boolean value - whether to center the title\n      .prop(\"dxTitle\") // a numeric value for the left offset of the title\n      .prop(\"dyTitle\") // a numeric value for the top offset of the title\n      .prop(\"titleVertical\")\n      .prop(\"vertical\")\n      .vertical(false)\n      //this property is typically used for the x-axis, but not for the y axis\n      //it creates a gap between chart and x-axis by offsetting the the chart by a number of pixels\n      .prop(\"yOffset\")\n      .yOffset(0)\n      .render(function () {\n        const selection = select(this);\n        const props = selection.props();\n\n        const isBottom = !props.vertical && props.orient === \"bottom\";\n\n        const axisDelegate = (function () {\n          switch (props.orient) {\n            case \"bottom\": {\n              return axisBottom();\n            }\n            case \"top\": {\n              return axisTop();\n            }\n            case \"left\": {\n              return axisLeft();\n            }\n            case \"right\": {\n              return axisRight();\n            }\n          }\n        })();\n\n        for (const prop of [\n          \"scale\",\n          \"ticks\",\n          \"tickValues\",\n          \"tickSizeInner\",\n          \"tickSizeOuter\",\n          \"tickPadding\",\n          \"tickFormat\",\n          \"tickSize\",\n        ]) {\n          if (props[prop] !== undefined) {\n            if (axisDelegate[prop] === undefined) {\n              throw new Error('axis: \"' + prop + '\" not available');\n            }\n            axisDelegate[prop](props[prop]);\n          }\n        }\n\n        if (props._scale) {\n          axisDelegate.scale(props._scale);\n        }\n\n        const group = selection\n          .selectGroup(\"sszvis-axis\")\n          .classed(\"sszvis-axis\", true)\n          .classed(\"sszvis-axis--top\", !props.vertical && props.orient === \"top\")\n          .classed(\"sszvis-axis--bottom\", isBottom)\n          .classed(\"sszvis-axis--vertical\", props.vertical)\n          .attr(\"transform\", translateString(0, props.yOffset))\n          .call(axisDelegate);\n\n        group.attr(\"fill\", null).attr(\"font-size\", null).attr(\"font-family\", null);\n        // .attr(\"text-anchor\", null);\n\n        const axisScale = axisDelegate.scale();\n\n        // Create selections here which will be used later for many custom configurations\n        // Note: Inconstiant: This is only valid so long as new .tick groups or tick label texts\n        // are not being added after these selections are constructed. If that changes, these\n        // selections need to be re-constructed.\n        const tickGroups = group.selectAll(\"g.tick\");\n        const tickTexts = tickGroups.selectAll(\"text\");\n\n        // To prevent anti-aliasing on elements that need to be rendered crisply\n        // we need to position them on a half-pixel grid: 0.5, 1.5, 2.5, etc.\n        // We can't translate the whole .tick group, however, because this\n        // leads to weird type rendering artefacts in some browsers. That's\n        // why we reach into the group and translate lines onto the half-pixel\n        // grid by taking the translation of the group into account.\n        tickGroups.each(function () {\n          const subpixelShift = transformTranslateSubpixelShift(this.getAttribute(\"transform\"));\n          const dx = halfPixel(0) - subpixelShift[0];\n          const dy = halfPixel(isBottom ? 2 : 0) + subpixelShift[1];\n          select(this).select(\"line\").attr(\"transform\", translateString(dx, dy));\n        });\n\n        tickTexts.each(function () {\n          if (props.orient === \"top\" || props.orient === \"bottom\") {\n            select(this).attr(\"dx\", \"-0.5\");\n          }\n          if (props.orient === \"left\" || props.orient === \"right\") {\n            select(this).attr(\"y\", \"-0.5\");\n          }\n        });\n\n        // Place axis line on a half-pixel grid to prevent anti-aliasing\n        group.selectAll(\"path.domain\");\n        // .attr('transform', translateString(halfPixel(0), halfPixel(0)));\n\n        // hide ticks which are too close to one endpoint\n        const rangeExtent = range(axisScale);\n        tickGroups.selectAll(\"line\").each(function (d) {\n          const pos = axisScale(d),\n            d3this = select(this);\n          d3this.classed(\n            \"hidden\",\n            !d3this.classed(\"sszvis-axis__longtick\") &&\n              (absDistance(pos, rangeExtent[0]) < props.hideBorderTickThreshold ||\n                absDistance(pos, rangeExtent[1]) < props.hideBorderTickThreshold)\n          );\n        });\n\n        if (fn.defined(props.tickLength)) {\n          const domainExtent = extent(axisScale.domain());\n          const ticks = tickGroups.filter(\n            (d) => !fn.stringEqual(d, domainExtent[0]) && !fn.stringEqual(d, domainExtent[1])\n          );\n          const orientation = props.orient;\n\n          let longLinePadding = 2;\n          if (orientation === \"left\" || orientation === \"right\") {\n            ticks.selectAll(\"text\").each(function () {\n              longLinePadding = Math.max(this.getBoundingClientRect().width, longLinePadding);\n            });\n            longLinePadding += 2; // a lil' extra on the end\n          }\n\n          const lines = ticks\n            .selectAll(\"line.sszvis-axis__longtick\")\n            .data([0])\n            .join(\"line\")\n            .classed(\"sszvis-axis__longtick\", true);\n\n          if (props.tickLength > longLinePadding) {\n            switch (orientation) {\n              case \"top\": {\n                lines.attr(\"y1\", longLinePadding).attr(\"y2\", props.tickLength);\n\n                break;\n              }\n              case \"bottom\": {\n                lines.attr(\"y1\", -longLinePadding).attr(\"y2\", -props.tickLength);\n\n                break;\n              }\n              case \"left\": {\n                lines.attr(\"x1\", -longLinePadding).attr(\"x2\", -props.tickLength);\n\n                break;\n              }\n              case \"right\": {\n                lines.attr(\"x1\", longLinePadding).attr(\"x2\", props.tickLength);\n\n                break;\n              }\n              // No default\n            }\n          } else {\n            lines.remove();\n          }\n        }\n\n        if (props.alignOuterLabels) {\n          const alignmentBounds = range(axisScale);\n          const min = alignmentBounds[0];\n          const max = alignmentBounds[1];\n\n          tickTexts.style(\"text-anchor\", (d) => {\n            const value = axisScale(d);\n            if (absDistance(value, min) < TICK_END_THRESHOLD) {\n              return \"start\";\n            } else if (absDistance(value, max) < TICK_END_THRESHOLD) {\n              return \"end\";\n            }\n            return \"middle\";\n          });\n        }\n\n        if (fn.defined(props.textWrap)) {\n          tickTexts.call(textWrap, props.textWrap);\n        }\n\n        if (props.slant) {\n          tickTexts.call(slantLabel[props.orient][props.slant]);\n        }\n\n        // Highlight axis labels that return true for props.highlightTick.\n        if (props.highlightTick) {\n          const activeBounds = [];\n          const passiveBounds = [];\n\n          tickTexts.classed(\"hidden\", false).classed(\"active\", props.highlightTick);\n\n          // Hide axis labels that overlap with highlighted labels unless\n          // the labels are slanted (in which case the bounding boxes overlap)\n          if (props.hideLabelThreshold > 0 && !props.slant) {\n            tickTexts.each(function (d) {\n              // although getBoundingClientRect returns coordinates relative to the window, not the document,\n              // this should still work, since all tick bounds are affected equally by scroll position changes.\n              const bcr = this.getBoundingClientRect();\n              const b = {\n                node: this,\n                bounds: {\n                  top: bcr.top,\n                  right: bcr.right,\n                  bottom: bcr.bottom,\n                  left: bcr.left,\n                },\n              };\n              if (props.highlightTick(d)) {\n                b.bounds.left -= props.hideLabelThreshold;\n                b.bounds.right += props.hideLabelThreshold;\n                activeBounds.push(b);\n              } else {\n                passiveBounds.push(b);\n              }\n            });\n\n            for (const active of activeBounds) {\n              for (const passive of passiveBounds) {\n                select(passive.node).classed(\n                  \"hidden\",\n                  boundsOverlap(passive.bounds, active.bounds)\n                );\n              }\n            }\n          }\n        }\n\n        if (props.title) {\n          const title = group\n            .selectAll(\".sszvis-axis__title\")\n            .data([props.title])\n            .join(\"text\")\n            .classed(\"sszvis-axis__title\", true);\n\n          title\n            .text((d) => d)\n            .attr(\"transform\", () => {\n              const orient = props.orient,\n                axisScaleExtent = range(axisScale);\n\n              const titleProps = props.titleCenter\n                ? {\n                    left:\n                      orient === \"left\" || orient === \"right\"\n                        ? 0\n                        : orient === \"top\" || orient === \"bottom\"\n                          ? (axisScaleExtent[0] + axisScaleExtent[1]) / 2\n                          : 0,\n                    top:\n                      orient === \"left\" || orient === \"right\"\n                        ? (axisScaleExtent[0] + axisScaleExtent[1]) / 2\n                        : orient === \"top\"\n                          ? 0\n                          : orient === \"bottom\"\n                            ? 32\n                            : 0,\n                  }\n                : {\n                    left:\n                      orient === \"left\" || orient === \"right\" || orient === \"top\"\n                        ? 0\n                        : orient === \"bottom\"\n                          ? axisScaleExtent[1]\n                          : 0,\n                    top:\n                      orient === \"left\" || orient === \"right\" || orient === \"top\"\n                        ? 0\n                        : orient === \"bottom\"\n                          ? 32\n                          : 0,\n                  };\n\n              titleProps.vertical = !!props.titleVertical;\n              titleProps.left += props.dxTitle || 0;\n              titleProps.top += props.dyTitle || 0;\n              return (\n                \"translate(\" +\n                titleProps.left +\n                \", \" +\n                titleProps.top +\n                \") rotate(\" +\n                (titleProps.vertical ? \"-90\" : \"0\") +\n                \")\"\n              );\n            })\n            .style(\"text-anchor\", () => {\n              const orient = props.orient;\n              if (props.titleAnchor === undefined) {\n                switch (orient) {\n                  case \"left\": {\n                    return \"end\";\n                  }\n                  case \"right\": {\n                    return \"start\";\n                  }\n                  case \"top\":\n                  case \"bottom\": {\n                    return \"end\";\n                  }\n                  // No default\n                }\n              } else {\n                return props.titleAnchor;\n              }\n            });\n        }\n\n        /**\n         * Add a background to axis labels to make them more readable on\n         * colored backgrounds\n         */\n        if (props.contour && props.slant) {\n          logger.warn(\"Can't apply contour to slanted labels\");\n        } else if (props.contour) {\n          tickGroups.each(function () {\n            const g = select(this);\n            const textNode = g.select(\"text\").node();\n            let textContour = g.select(\".sszvis-axis__label-contour\");\n            if (textContour.empty()) {\n              textContour = select(textNode.cloneNode()).classed(\n                \"sszvis-axis__label-contour\",\n                true\n              );\n              this.insertBefore(textContour.node(), textNode);\n            }\n            textContour.text(textNode.textContent);\n          });\n        }\n      })\n  );\n};\n\nconst setOrdinalTicks = function (count) {\n  // in this function, the 'this' context should be an sszvis.axis\n  const domain = this.scale().domain(),\n    values = [],\n    step = Math.round(domain.length / count);\n\n  // include the first value\n  if (domain[0] !== undefined) values.push(domain[0]);\n  for (let i = step, l = domain.length; i < l - 1; i += step) {\n    if (domain[i] !== undefined) values.push(domain[i]);\n  }\n  // include the last value\n  if (domain[domain.length - 1] !== \"undefined\") values.push(domain[domain.length - 1]);\n\n  this.tickValues(values);\n\n  return count;\n};\n\nexport const axisX = function () {\n  return axis()\n    .yOffset(2) //gap between chart and x-axis\n    .ticks(3)\n    .tickSizeInner(4)\n    .tickSizeOuter(6.5)\n    .tickPadding(6)\n    .tickFormat(fn.arity(1, formatNumber));\n};\n\naxisX.time = function () {\n  return axisX().tickFormat(formatAxisTimeFormat).alignOuterLabels(true);\n};\n\naxisX.ordinal = function () {\n  return (\n    axisX()\n      // extend this class a little with a custom implementation of 'ticks'\n      // that allows you to set a custom number of ticks,\n      // including the first and last value in the ordinal scale\n      .prop(\"ticks\", setOrdinalTicks)\n      .tickFormat(formatText)\n  );\n};\n\n// need to be a little tricky to get the built-in d3.axis to display as if the underlying scale is discontinuous\naxisX.pyramid = function () {\n  return axisX()\n    .ticks(10)\n    .prop(\"scale\", function (s) {\n      const extended = s.copy(),\n        extendedDomain = extended.domain(),\n        extendedRange = extended.range();\n\n      extended\n        // the domain is mirrored - ±domain[1]\n        .domain([-extendedDomain[1], extendedDomain[1]])\n        // the range is mirrored – ±range[1]\n        .range([extendedRange[0] - extendedRange[1], extendedRange[0] + extendedRange[1]]);\n\n      this._scale(extended);\n      return extended;\n    })\n    .tickFormat((v) =>\n      // this tick format means that the axis appears to be divergent around 0\n      // when in fact it is -domain[1] -> +domain[1]\n      formatNumber(Math.abs(v))\n    );\n};\n\nexport const axisY = function () {\n  const newAxis = axis()\n    .ticks(6)\n    .tickSize(0, 0)\n    .tickPadding(0)\n    .tickFormat((d) => (0 === d && !newAxis.showZeroY() ? null : formatNumber(d)))\n    .vertical(true);\n  return newAxis;\n};\n\naxisY.time = function () {\n  return axisY().tickFormat(formatAxisTimeFormat);\n};\n\naxisY.ordinal = function () {\n  return (\n    axisY()\n      // add custom 'ticks' function\n      .prop(\"ticks\", setOrdinalTicks)\n      .tickFormat(formatText)\n  );\n};\n\n/* Helper functions\n----------------------------------------------- */\n\nfunction absDistance(a, b) {\n  return Math.abs(a - b);\n}\n\nfunction boundsOverlap(boundsA, boundsB) {\n  return !(\n    boundsB.left > boundsA.right ||\n    boundsB.right < boundsA.left ||\n    boundsB.top > boundsA.bottom ||\n    boundsB.bottom < boundsA.top\n  );\n}\n\nconst slantLabel = {\n  top: {\n    horizontal(selection) {\n      selection\n        .style(\"text-anchor\", \"middle\")\n        .attr(\"dx\", \"-0.5\")\n        .attr(\"dy\", \"0.71em\")\n        .attr(\"transform\", null);\n    },\n    vertical(selection) {\n      selection\n        .style(\"text-anchor\", \"start\")\n        .attr(\"dx\", \"0em\")\n        .attr(\"dy\", \"0.35em\") // vertically-center\n        .attr(\"transform\", \"rotate(-90)\");\n    },\n    diagonal(selection) {\n      selection\n        .style(\"text-anchor\", \"start\")\n        .attr(\"dx\", \"0.1em\")\n        .attr(\"dy\", \"0.1em\")\n        .attr(\"transform\", \"translate(-0.5) rotate(-45)\");\n    },\n  },\n  bottom: {\n    horizontal(selection) {\n      selection\n        .style(\"text-anchor\", \"middle\")\n        .attr(\"dx\", \"-0.5\")\n        .attr(\"dy\", \"0.71em\")\n        .attr(\"transform\", null);\n    },\n    vertical(selection) {\n      selection\n        .style(\"text-anchor\", \"end\")\n        .attr(\"dx\", \"-1em\")\n        .attr(\"dy\", \"-0.75em\")\n        .attr(\"transform\", \"rotate(-90)\");\n    },\n    diagonal(selection) {\n      selection\n        .style(\"text-anchor\", \"end\")\n        .attr(\"dx\", \"-0.8em\")\n        .attr(\"dy\", \"0em\")\n        .attr(\"transform\", \"rotate(-45)\");\n    },\n  },\n};\n","/**\n * Move behavior\n *\n * The move behavior is used to add a mouseover and touchmove-based interface to a chart.\n *\n * Like other behavior components, this behavior adds an invisible layer over the chart,\n * which the users interact with using touch or mouse actions. The behavior component then interprets\n * these interactions, and calls the relevant event handler callback functions. These callback functions are\n * passed values which represent data-space information about the nature of the interaction.\n * That last sentence was intentionally vague, because different behaviors operate in slightly different ways.\n *\n * The move behavior requires scales to be passed to it as configuration, and when a user interacts with the behavior layer,\n * it inverts the pixel location of the interaction using these scales and passes the resulting data-space values to the callback\n * functions. This component extends a d3.dispatch instance.\n *\n * @module sszvis/behavior/move\n *\n * @property {boolean} debug                      Whether or not to render the component in debug mode, which reveals its position in the chart.\n * @property {function} xScale                    The x-scale for the component. The extent of this scale, plus component padding, is the width of the\n *                                                component's active area.\n * @property {function} yScale                    The y-scale for the component. The extent of this scale, plus component padding, is the height of the\n *                                                component's active area.\n * @property {boolean} draggable                  Whether or not this component is draggable. This changes certain display properties of the component.\n * @property {object} padding                     An object which specifies padding, in addition to the scale values, for the component. Defaults are all 0.\n *                                                The options are { top, right, bottom, left }\n * @property {boolean|function} cancelScrolling   A predicate function, or a constant boolean, that determines whether the browser's default scrolling\n *                                                behavior in response to a touch event should be canceled. In area charts and line charts, for example,\n *                                                you generally don't want to cancel scrolling, as this creates a scroll trap. However, in bar charts\n *                                                which use this behavior, you want to pass a predicate function here which will determine whether the touch\n *                                                event falls within the \"profile\" of the bar chart, and should therefore cancel scrolling and trigger an event.\n * @property {boolean} fireOnPanOnly              In response to touch events, whether to fire events only while \"panning\", that is only while performing\n *                                                a touch move where the default scrolling behavior is canceled, and not otherwise. In area and line charts, this\n *                                                should be false, since you want to fire events all the time, even while scrolling. In bar charts, we want to\n *                                                limit the firing of events (and therefore, the showing of tooltips) to only cases where the touch event has its\n *                                                default scrolling prevented, and the user is therefore \"panning\" across bars. So this should be true for bar charts.\n * @property {string and function} on             The .on() method of this component should specify an event name and an event handler function.\n *                                                Possible event names are:\n *                                                'start' - when the move action starts - mouseover or touchstart\n *                                                'move' - called when a 'moving' action happens - mouseover on the element\n *                                                'drag' - called when a 'dragging' action happens - mouseover with the mouse click down, or touchmove\n *                                                'end' - called when the event ends - mouseout or touchend\n *                                                Event handler functions, excepting end, are passed an x-value and a y-value, which are the data values,\n *                                                computed by inverting the provided xScale and yScale, which correspond to the screen pixel location of the event.\n *\n * @return {sszvis.component}\n */\n\nimport { select, pointer, dispatch, ascending } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { range } from \"../scale.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  const event = dispatch(\"start\", \"move\", \"drag\", \"end\");\n\n  const moveComponent = component()\n    .prop(\"debug\")\n    .prop(\"xScale\")\n    .prop(\"yScale\")\n    .prop(\"draggable\")\n    .prop(\"cancelScrolling\", fn.functor)\n    .cancelScrolling(false)\n    .prop(\"fireOnPanOnly\", fn.functor)\n    .fireOnPanOnly(false)\n    .prop(\"padding\", (p) => {\n      const defaults = { top: 0, left: 0, bottom: 0, right: 0 };\n      for (const prop in p) {\n        defaults[prop] = p[prop];\n      }\n      return defaults;\n    })\n    .padding({})\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      const xExtent = range(props.xScale).sort(ascending);\n      const yExtent = range(props.yScale).sort(ascending);\n\n      xExtent[0] -= props.padding.left;\n      xExtent[1] += props.padding.right;\n      yExtent[0] -= props.padding.top;\n      yExtent[1] += props.padding.bottom;\n\n      const layer = selection\n        .selectAll(\"[data-sszvis-behavior-move]\")\n        .data([0])\n        .join(\"rect\")\n        .attr(\"data-sszvis-behavior-move\", \"\")\n        .attr(\"class\", \"sszvis-interactive\");\n\n      if (props.draggable) {\n        layer.classed(\"sszvis-interactive--draggable\", true);\n      }\n\n      layer\n        .attr(\"x\", xExtent[0])\n        .attr(\"y\", yExtent[0])\n        .attr(\"width\", xExtent[1] - xExtent[0])\n        .attr(\"height\", yExtent[1] - yExtent[0])\n        .attr(\"fill\", \"transparent\")\n        .on(\"mouseover\", function () {\n          event.apply(\"start\", this, arguments);\n        })\n        .on(\"mousedown\", function (e) {\n          const target = this;\n          const doc = select(document);\n          const win = select(globalThis);\n\n          const startDragging = function () {\n            target.__dragging__ = true;\n          };\n\n          const stopDragging = function () {\n            target.__dragging__ = false;\n            win.on(\"mousemove.sszvis-behavior-move\", null);\n            doc.on(\"mouseout.sszvis-behavior-move\", null);\n            event.apply(\"end\", this, arguments);\n          };\n\n          win.on(\"mouseup.sszvis-behavior-move\", stopDragging);\n          doc.on(\"mouseout.sszvis-behavior-move\", () => {\n            const from = e.relatedTarget || e.toElement;\n            if (!from || from.nodeName === \"HTML\") {\n              stopDragging();\n            }\n          });\n\n          startDragging();\n        })\n        .on(\"mousemove\", function (e) {\n          const target = this;\n          const xy = pointer(e);\n          const x = scaleInvert(props.xScale, xy[0]);\n          const y = scaleInvert(props.yScale, xy[1]);\n\n          if (target.__dragging__) {\n            event.apply(\"drag\", this, [e, x, y]);\n          } else {\n            event.apply(\"move\", this, [e, x, y]);\n          }\n        })\n        .on(\"mouseout\", function (e) {\n          event.apply(\"end\", this, [e]);\n        })\n        .on(\"touchstart\", function (e) {\n          const xy = fn.first(pointer(e));\n          const x = scaleInvert(props.xScale, xy[0]);\n          const y = scaleInvert(props.yScale, xy[1]);\n\n          const cancelScrolling = props.cancelScrolling(x, y);\n\n          if (cancelScrolling) {\n            e.preventDefault();\n          }\n\n          // if fireOnPanOnly => cancelScrolling must be true\n          // if !fireOnPanOnly => always fire events\n          // This is in place because this behavior needs to only fire\n          // events on a successful \"pan\" action in the bar charts, i.e.\n          // only when scrolling is prevented, but then it also needs to fire\n          // events all the time in the line and area charts, i.e. allow\n          // scrolling to continue as normal but also fire events.\n          // To configure the chart for use in the bar charts, you need\n          // to configure a cancelScrolling function for determining when to\n          // cancel scrolling, i.e. what constitutes a \"pan\" event, and also\n          // pass fireOnPanOnly = true, which flips this switch and relies on\n          // cancelScrolling to determine whether to fire the events.\n          if (!props.fireOnPanOnly() || cancelScrolling) {\n            event.apply(\"start\", this, [e, x, y]);\n            event.apply(\"drag\", this, [e, x, y]);\n            event.apply(\"move\", this, [e, x, y]);\n\n            const pan = function () {\n              const panXY = fn.first(pointer(e));\n              const panX = scaleInvert(props.xScale, panXY[0]);\n              const panY = scaleInvert(props.yScale, panXY[1]);\n\n              const panCancelScrolling = props.cancelScrolling(panX, panY);\n\n              if (panCancelScrolling) {\n                e.preventDefault();\n              }\n\n              // See comment above about the same if condition.\n              if (!props.fireOnPanOnly() || panCancelScrolling) {\n                event.apply(\"drag\", this, [e, panX, panY]);\n                event.apply(\"move\", this, [e, panX, panY]);\n              } else {\n                event.apply(\"end\", this, [e]);\n              }\n            };\n\n            const end = function () {\n              event.apply(\"end\", this, [e]);\n              select(this).on(\"touchmove\", null).on(\"touchend\", null);\n            };\n\n            select(this).on(\"touchmove\", pan).on(\"touchend\", end);\n          }\n        });\n\n      if (props.debug) {\n        layer.attr(\"fill\", \"rgba(255,0,0,0.2)\");\n      }\n    });\n\n  moveComponent.on = function () {\n    const value = event.on.apply(event, arguments);\n    return value === event ? moveComponent : value;\n  };\n\n  return moveComponent;\n}\n\nfunction scaleInvert(scale, px) {\n  const scaleType = scale.invert ? \"Linear\" : scale.paddingInner ? \"Band\" : \"Point\";\n  switch (scaleType) {\n    case \"Linear\": {\n      return scale.invert(px);\n    }\n    case \"Band\": {\n      return invertBandScale(scale, px);\n    }\n    case \"Point\": {\n      return invertPointScale(scale, px);\n    }\n    default: {\n      throw new Error(\"Unknown scale type, could not invert\");\n    }\n  }\n}\n\nfunction invertBandScale(scale, px) {\n  const step = scale.step();\n  const paddingOuter = scale.paddingOuter() * step;\n  const paddingInner = scale.paddingInner() * step;\n  const bandWidth = scale.bandwidth();\n  const scaleRange = scale.range();\n  const domain = scale.domain();\n\n  if (domain.length === 1) {\n    if (scaleRange[0] <= px && scaleRange[1] >= px) {\n      return domain[0];\n    }\n    return null;\n  }\n\n  const ranges = domain.map((d, i) => {\n    if (i === 0) {\n      return [scaleRange[0], scaleRange[0] + paddingOuter + bandWidth + paddingInner / 2];\n    } else if (i === domain.length - 1) {\n      return [scaleRange[1] - (paddingOuter + bandWidth + paddingInner / 2), scaleRange[1]];\n    } else {\n      return [\n        scaleRange[0] + paddingOuter + i * step - paddingInner / 2,\n        scaleRange[0] + paddingOuter + (i + 1) * step - paddingInner / 2,\n      ];\n    }\n  });\n  for (let i = 0, l = ranges.length; i < l; i++) {\n    if (ranges[i][0] < px && px <= ranges[i][1]) {\n      return domain[i];\n    }\n  }\n  return null;\n}\n\nfunction invertPointScale(scale, px) {\n  const step = scale.step();\n  const paddingOuter = scale.padding() * step;\n  const scaleRange = scale.range();\n  const domain = scale.domain();\n\n  if (domain.length === 1) {\n    if (scaleRange[0] <= px && scaleRange[1] >= px) {\n      return domain[0];\n    }\n    return null;\n  }\n\n  const ranges = domain.map((d, i) => {\n    if (i === 0) {\n      return [scaleRange[0], scaleRange[0] + paddingOuter + step / 2];\n    } else if (i === domain.length - 1) {\n      return [scaleRange[1] - (paddingOuter + step / 2), scaleRange[1]];\n    } else {\n      return [\n        scaleRange[0] + paddingOuter + i * step - step / 2,\n        scaleRange[0] + paddingOuter + i * step + step / 2,\n      ];\n    }\n  });\n  for (let i = 0, l = ranges.length; i < l; i++) {\n    if (ranges[i][0] < px && px <= ranges[i][1]) {\n      return domain[i];\n    }\n  }\n  return null;\n}\n","/**\n * Behavior utilities\n *\n * These utilities are intended for internal usage by the sszvis.behavior components.\n * They aren't intended for use in example code, but should be in a separate module\n * because they are accessed by several different behavior components.\n *\n * @function {Event} elementFromEvent             Accepts an event, and returns the element, if any,\n *                                                which is in the document under that event. Uses\n *                                                document.elementFromPoint to determine the element.\n *                                                If there is no such element, or the event is invalid,\n *                                                this function will return null.\n * @function {Element} datumFromPannableElement   Accepts an element, determines if it's \"pannable\",\n *                                                and returns the datum, if any, attached to this element.\n *                                                This is determined by the presence of the data-sszvis-behavior-pannable\n *                                                attribute on the element. Behaviors which use \"panning\" behavior\n *                                                will attach this attribute to the elements they target.\n *                                                Elements which have panning behaviors attached to them\n *                                                will get this attribute assigned to them. If the element doesn't\n *                                                have this attriute, or doesn't have a datum assigned, this funciton\n *                                                returns null.\n * @function {Event} datumFromPanEvent            A combination of elementFromEvent and datumFromPannableElement, which\n *                                                accepts an event and returns the datum attached to the element under\n *                                                that event, if such an element and such a datum exists.\n * @function {Number, Object, Function, Number} testBarThreshold        This function is a convenience function for encapsulating\n *                                                                      the test which should be performed on a touch interaction,\n *                                                                      to see whether the touch falls within the \"profile\" of a bar\n *                                                                      chart. If so, that is, if the test passes, then scrolling should\n *                                                                      be prevented on the bar charts, and a tooltip should be shown.\n *                                                                      This is the behavior known as \"panning\" over the surface of the chart,\n *                                                                      while on a mobile device. The function returns true if the touch is\n *                                                                      considered to be within the \"profile\" of the bar chart, and false otherwise.\n *                                                                      The function takes four arguments:\n *                                                                        cursorValue - This the value, specified in the same units as the original\n *                                                                                      data, at the touch event's position. This value is\n *                                                                                      automatically calculated by the 'move' behavior,\n *                                                                                      by inverting the scale used for the bar charts' extent.\n *                                                                        datum -       This is the data value at the touch event's position,\n *                                                                                      against which you are comparing the profile. Since data\n *                                                                                      values all live in user-land, you should retrieve this\n *                                                                                      datum yourself. Usually this can be done by using the\n *                                                                                      inverted value from the other axis of the bar chart,\n *                                                                                      and searching the data for the datum which matches that\n *                                                                                      value. However, note that the datum argument can be\n *                                                                                      undefined, in which case the touch is considered invalid and\n *                                                                                      the test will return false.\n *                                                                        accessor -    This is an accessor function for retrieving a numeric value\n *                                                                                      from the datum. This function should be used to retrieve out\n *                                                                                      of the datum the value against which cursorValue is compared.\n *                                                                        threshold -   A small threshold, specified in datum units, i.e. in the units\n *                                                                                      of the domain (NOT the range) of the scale function. When a bar\n *                                                                                      value is very small, or 0, or NaN, it would be impossible to have\n *                                                                                      a touch which is over the \"profile\" of this bar. So in those cases,\n *                                                                                      we consider the touch to be within the profile if it and the data\n *                                                                                      value are under this threshold. This number should be some small\n *                                                                                      number in the data's domain, and will be compared against both\n *                                                                                      cursorValue and the value accessed from the datum.\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../fn.js\";\n\nexport const elementFromEvent = function (evt) {\n  if (!fn.isNull(evt) && fn.defined(evt)) {\n    return document.elementFromPoint(evt.clientX, evt.clientY);\n  }\n  return null;\n};\n\nexport const datumFromPannableElement = function (element) {\n  if (!fn.isNull(element)) {\n    const selection = select(element);\n    if (!fn.isNull(selection.attr(\"data-sszvis-behavior-pannable\"))) {\n      const datum = selection.datum();\n      if (fn.defined(datum)) {\n        return datum;\n      }\n    }\n  }\n  return null;\n};\n\nexport const datumFromPanEvent = function (evt) {\n  return datumFromPannableElement(elementFromEvent(evt));\n};\n\nexport const testBarThreshold = function (cursorValue, datum, accessor, threshold) {\n  if (!fn.defined(datum)) {\n    return false;\n  }\n  const dataValue = accessor(datum);\n  // For bars that are very small, or have a NaN value, then\n  // when the touch is close enough to the 0-axis, we prevent scrolling\n  // and show the tooltip. The proximity which the touch must have to the 0-axis\n  // is determined by threshold, which must be a value in the axis' domain (NOT range).\n  return (\n    (cursorValue < threshold && isNaN(dataValue)) ||\n    (cursorValue < threshold && dataValue < threshold) ||\n    cursorValue < dataValue\n  );\n};\n","/**\n * Voronoi behavior\n *\n * The voronoi behavior adds an invisible layer of voronoi cells to a chart. The voronoi cells are calculated\n * based on the positions of the data objects which should be bound to the interaction layer before this behavior\n * is called on it. Each voronoi cell is associated with one data object, and this data object is passed to the event\n * callback functions.\n *\n * Like other behavior components, this behavior adds an invisible layer over the chart,\n * which the users interact with using touch or mouse actions. The behavior component then interprets\n * these interactions, and calls the relevant event handler callback functions. These callback functions are\n * passed values which represent data-space information about the nature of the interaction.\n * That last sentence was intentionally vague, because different behaviors operate in slightly different ways.\n *\n * The voronoi behavior expects to find an array of data already bound to the interaction layer. Each datum should\n * represent a point, and these points are used as the focal points of the construction of voronoi cells. These data\n * are also associated with the voronoi cells, so that when a user interacts with them, the datum and its index within the\n * bound data are passed to the callback functions. This component extends a d3.dispatch instance.\n *\n * The event handler functions are only called when the event happens within a certain distance\n * (see MAX_INTERACTION_RADIUS_SQUARED in this file) from the voronoi area's center.\n *\n * @module sszvis/behavior/voronoi\n *\n * @property {function} x                         Specify an accessor function for the x-position of the voronoi point\n * @property {function} y                         Specify an accessor function for the y-position of the voronoi point\n * @property {array[array, array]} bounds         Specify the bounds of the voronoi area. This is essential to the construction of voronoi cells\n *                                                using the d3.vornoi geom object. The bounds should determine the chart area over which you would like\n *                                                voronoi cells to be active. Note that if not specified, the voronoi cells will be very large.\n * @property {boolean} debug                      Whether the component is in debug mode. Being in debug mode renders the voroni cells obviously\n * @property {string and function} on             The .on() method should specify an event name and an event handler function.\n *                                                Possible event names are:\n *                                                'over' - when the user interacts with a voronoi area, either with a mouseover or touchstart\n *                                                'out' - when the user ceases to interact with a voronoi area, either with a mouseout or touchend\n *                                                All event handler functions are passed the datum which is the center of the voronoi area.\n *                                                Note: previously, event handlers were also passed the index of the datum within the dataset.\n *                                                However, this is no longer the case, due to the difficulty of inferring that information when hit\n *                                                testing a touch interaction on arbitrary rendered elements in the scene. In addition, the 'out' event\n *                                                used to be passed the datum itself, but this is no longer the case, also having to do with the impossibility\n *                                                of guaranteeing that there is a datum at the position of a touch, while \"panning\".\n *\n */\n\nimport { select, dispatch, Delaunay } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport * as logger from \"../logger.js\";\nimport { elementFromEvent, datumFromPannableElement } from \"./util.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  const event = dispatch(\"over\", \"out\");\n\n  const voronoiComponent = component()\n    .prop(\"x\")\n    .prop(\"y\")\n    .prop(\"bounds\")\n    .prop(\"debug\")\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      if (!props.bounds) {\n        logger.error(\"behavior.voronoi - requires bounds\");\n        return false;\n      }\n      const delaunay = Delaunay.from(\n        data,\n        (d) => props.x(d),\n        (d) => props.y(d)\n      );\n      const voronoi = delaunay.voronoi(props.bounds);\n\n      const polys = selection\n        .selectAll(\"[data-sszvis-behavior-voronoi]\")\n        .data(voronoi.cellPolygons())\n        .join(\"path\")\n        .attr(\"data-sszvis-behavior-voronoi\", \"\")\n        .attr(\"data-sszvis-behavior-pannable\", \"\")\n        .attr(\"class\", \"sszvis-interactive\");\n\n      polys\n        .attr(\"d\", (d) => \"M\" + d.join(\"L\") + \"Z\")\n        .attr(\"fill\", \"transparent\")\n        .on(\"mouseover\", function (e) {\n          const cbox = this.parentNode.getBoundingClientRect();\n          const datumIdx = delaunay.find(e.clientX - cbox.left, e.clientY - cbox.top);\n          if (\n            eventNearPoint(e, [\n              cbox.left + props.x(data[datumIdx]),\n              cbox.top + props.y(data[datumIdx]),\n            ])\n          ) {\n            event.apply(\"over\", this, [e, data[datumIdx]]);\n          }\n        })\n        .on(\"mousemove\", function (e) {\n          const cbox = this.parentNode.getBoundingClientRect();\n          const datumIdx = delaunay.find(e.clientX - cbox.left, e.clientY - cbox.top);\n          if (\n            eventNearPoint(e, [\n              cbox.left + props.x(data[datumIdx]),\n              cbox.top + props.y(data[datumIdx]),\n            ])\n          ) {\n            event.apply(\"over\", this, [e, data[datumIdx]]);\n          } else {\n            event.apply(\"out\", this, [e]);\n          }\n        })\n        .on(\"mouseout\", function (e) {\n          event.apply(\"out\", this, [e]);\n        })\n        .on(\"touchstart\", function (e) {\n          const cbox = this.parentNode.getBoundingClientRect();\n          const datumIdx = delaunay.find(e.clientX - cbox.left, e.clientY - cbox.top);\n\n          if (\n            eventNearPoint(fn.firstTouch(e), [\n              cbox.left + props.x(data[datumIdx]),\n              cbox.top + props.y(data[datumIdx]),\n            ])\n          ) {\n            e.preventDefault();\n            event.apply(\"over\", this, [e, data[datumIdx]]);\n\n            // Attach these handlers only if the initial touch is within the max distance from the voronoi center\n            // This prevents the situation where a touch is outside that distance, and causes scrolling, but then the\n            // user moves their finger over the center of the voronoi area, and it fires an event anyway. Generally,\n            // when users are performing touches that cause scrolling, we want to avoid firing the events.\n            const pan = function () {\n              const touchEvent = fn.firstTouch(e);\n              const element = elementFromEvent(touchEvent);\n              const panDatum = datumFromPannableElement(element);\n              if (panDatum === null) {\n                event.apply(\"out\", this, [e]);\n              } else {\n                const panCbox = element.parentNode.getBoundingClientRect();\n                if (\n                  eventNearPoint(touchEvent, [\n                    panCbox.left + props.x(panDatum.data),\n                    panCbox.top + props.y(panDatum.data),\n                  ])\n                ) {\n                  // This event won't be cancelable if you start touching outside the hit area of a voronoi center,\n                  // then start scrolling, then move your finger over the hit area of a voronoi center. The browser\n                  // says you are \"still scrolling\" and won't let you cancel the event. It will issue a warning, which\n                  // we want to avoid.\n                  if (e.cancelable) {\n                    e.preventDefault();\n                  }\n                  event.apply(\"over\", this, [e, panDatum.data]);\n                } else {\n                  event.apply(\"out\", this, [e]);\n                }\n              }\n            };\n\n            const end = function () {\n              event.apply(\"out\", this, [e]);\n              select(this).on(\"touchmove\", null).on(\"touchend\", null);\n            };\n\n            select(this).on(\"touchmove\", pan).on(\"touchend\", end);\n          }\n        });\n\n      if (props.debug) {\n        polys.attr(\"stroke\", \"#f00\");\n      }\n    });\n\n  voronoiComponent.on = function () {\n    const value = event.on.apply(event, arguments);\n    return value === event ? voronoiComponent : value;\n  };\n\n  return voronoiComponent;\n}\n\n// Perform distance calculations in units squared to avoid a costly Math.sqrt\nconst MAX_INTERACTION_RADIUS_SQUARED = Math.pow(15, 2);\n\nfunction eventNearPoint(event, point) {\n  const dx = event.clientX - point[0];\n  const dy = event.clientY - point[1];\n  return dx * dx + dy * dy < MAX_INTERACTION_RADIUS_SQUARED;\n}\n","/**\n * A collection of utilities to measure elements\n *\n * @module sszvis/measure\n */\nimport { select } from \"d3\";\nimport { isSelection, isString } from \"./fn\";\n\n/**\n * measureDimensions\n *\n * Calculates the width of the first DOM element defined by a CSS selector string,\n * a DOM element reference, or a d3 selection. If the DOM element can't be\n * measured `undefined` is returned for the width. Returns also measurements of\n * the screen, which are used by some responsive components.\n *\n * @param  {string|DOMElement|d3.selection} el The element to measure\n *\n * @return {Object} The measurement of the width of the element, plus dimensions of the screen\n *                  The returned object contains:\n *                      width: {number|undefined} The width of the element\n *                      screenWidth: {number} The innerWidth of the screen\n *                      screenHeight: {number} The innerHeight of the screen\n */\nexport const measureDimensions = function (arg) {\n  let node;\n  if (isString(arg)) {\n    node = select(arg).node();\n  } else if (isSelection(arg)) {\n    node = arg.node();\n  } else {\n    node = arg;\n  }\n  return {\n    width: node ? node.getBoundingClientRect().width : undefined,\n    screenWidth: window.innerWidth,\n    screenHeight: window.innerHeight,\n  };\n};\n\n/**\n * measureText\n *\n * Calculates the width of a string given a font size and a font face. It might\n * be more convenient to use a preset based on this function that has the font\n * size and family already set.\n *\n * @param {number} fontSize The font size in pixels\n * @param {string} fontFace The font face (\"Arial\", \"Helvetica\", etc.)\n * @param {string} text The text to measure\n * @returns {number} The width of the text\n *\n * @example\n * const helloWidth = sszvis.measureText(14, \"Arial, sans-serif\")(\"Hello!\")\n **/\nexport const measureText = (function () {\n  const canvas = document.createElement(\"canvas\");\n  const context = canvas.getContext(\"2d\");\n  const cache = {};\n\n  return function (fontSize, fontFace, text) {\n    const key = [fontSize, fontFace, text].join(\"-\");\n    context.font = fontSize + \"px \" + fontFace;\n    return cache[key] || (cache[key] = context.measureText(text).width);\n  };\n})();\n\n/**\n * measureAxisLabel\n *\n * A preset to measure the widths of axis labels.\n *\n * @param {string} text The text to measure\n * @returns {number} The width of the text\n *\n * @example\n * const labelWidth = sszvis.measureAxisLabel(\"Hello!\")\n */\nexport const measureAxisLabel = function (text) {\n  return measureText(10, \"Arial, sans-serif\", text);\n};\n\n/**\n * measureLegendLabel\n *\n * A preset to measure the widths of legend labels.\n *\n * @param {string} text The text to measure\n * @returns {number} The width of the text\n *\n * @example\n * const labelWidth = sszvis.measureLegendLabel(\"Hello!\")\n */\nexport const measureLegendLabel = function (text) {\n  return measureText(12, \"Arial, sans-serif\", text);\n};\n","/**\n * Bounds\n *\n * Creates a bounds object to help with the construction of d3 charts\n * that follow the d3 margin convention. The result of this function\n * is consumed by sszvis.createSvgLayer and sszvis.createHtmlLayer.\n *\n * @module sszvis/bounds\n *\n * @see http://bl.ocks.org/mbostock/3019563\n *\n * @property {number} DEFAULT_WIDTH The default width used across all charts\n * @property {number} RATIO The default side length ratio\n *\n * @param {Object} bounds Specifies the bounds of a chart area. Valid properties are:\n *   @property {number} bounds.width The total width of the chart (default: DEFAULT_WIDTH)\n *   @property {number} bounds.height The total height of the chart (default: height / RATIO)\n *   @property {number} bounds.top Top padding (default: 0)\n *   @property {number} bounds.left Left padding (default: 1)\n *   @property {number} bounds.bottom Bottom padding (default: 0)\n *   @property {number} bounds.right Right padding (default: 1)\n * @param {string|d3.selection} [selection] A CSS selector or d3 selection that will be measured to\n *                                          automatically calculate the bounds width and height using\n *                                          the SSZVIS responsive aspect ratio calculation. Custom\n *                                          width and height settings have priority over these auto-\n *                                          matic calculations, so if they are defined, this argument\n *                                          has no effect.\n *                                          This argument is optional to maintain backwards compatibility.\n *\n * @return {Object}              The returned object will preserve the properties width and height, or give them default values\n *                               if unspecified. It will also contain 'innerWidth', which is the width minus left and right padding,\n *                               and 'innerHeight', which is the height minus top and bottom padding. And it includes a 'padding' sub-object,\n *                               which contains calculated or default values for top, bottom, left, and right padding.\n *                               Lastly, the object includes 'screenWidth' and 'screenHeight', which are occasionally used by responsive components.\n */\n\nimport { select } from \"d3\";\nimport { aspectRatioAuto } from \"./aspectRatio.js\";\nimport * as fn from \"./fn.js\";\nimport { measureDimensions } from \"./measure.js\";\n\nconst DEFAULT_WIDTH = 516;\n\nexport function bounds(arg1 /* bounds or selection */, arg2 /* [selection] */) {\n  let _bounds = null,\n    selection = null;\n  if (arguments.length === 0) {\n    _bounds = {};\n  } else if (arguments.length === 1) {\n    if (fn.isObject(arg1)) {\n      _bounds = arg1;\n    } else if (fn.isSelection(arg1)) {\n      _bounds = {};\n      selection = arg1;\n    } else {\n      _bounds = {};\n      selection = select(arg1);\n    }\n  } else {\n    _bounds = arg1;\n    selection = fn.isSelection(arg2) ? arg2 : select(arg2);\n  }\n\n  // All padding sides have default values\n  const padding = {\n    top: either(_bounds.top, 0),\n    right: either(_bounds.right, 1),\n    bottom: either(_bounds.bottom, 0),\n    left: either(_bounds.left, 1),\n  };\n\n  // Width is calculated as: _bounds.width (if provided) -> selection.getBoundingClientRect().width (if provided) -> DEFAULT_WIDTH\n  const dimensions = fn.defined(selection)\n    ? measureDimensions(selection)\n    : { width: DEFAULT_WIDTH };\n\n  const width = either(_bounds.width, dimensions.width);\n  const innerHeight = aspectRatioAuto(dimensions);\n  const height = either(_bounds.height, innerHeight + padding.top + padding.bottom);\n\n  return {\n    innerHeight: height - padding.top - padding.bottom,\n    innerWidth: width - padding.left - padding.right,\n    padding,\n    height,\n    width,\n    screenWidth: dimensions.screenWidth,\n    screenHeight: dimensions.screenHeight,\n  };\n}\n\nexport { DEFAULT_WIDTH };\n\n// This is the default aspect ratio. It is defined as: width / innerHeight\n// See the Offerte document for SSZVIS 1.3, and here: https://basecamp.com/1762663/projects/10790469/todos/212434984\n// To calculate the default innerHeight, do width / ASPECT_RATIO\n// @deprecated Since the responsive revisions, the default aspect ratio has changed,\n//             so that it is now responsive to the container width.\n//             This property is preserved for compatibility reasons.\nexport const RATIO = 16 / 9;\n\n/* Helper functions\n----------------------------------------------- */\nfunction either(val, fallback) {\n  return val === undefined ? fallback : val;\n}\n","/**\n * Cascade module\n *\n * @module sszvis/cascade\n *\n * sszvis.cascade is a module that can be useful for creating nested data structures.\n * It can be used in similar ways to d3.nest, but should not be conflated with d3.nest,\n * since it provides different behavior.\n *\n * The cascade class is not a data structure. Rather, it is used to create a data structue\n * generator. An instance of the cascade class should be configured to specify the desired\n * characteristics of the resulting data structure, and then applied to a flat array of\n * objects in order to generate the data structure.\n *\n * Fundamental to the cascade class is the concept of \"groupBy\", which is an operation that\n * transforms a flat array of data into a nested data structure. It does this by\n * passing each value in the flat array through an accessor function, and \"groping\" those\n * elements based on the return value of that function. Every element in the resulting groups\n * will have produced the same value when passed into the accessor function.\n *\n * For example, if a flat data set contains a number of elements, and some have a value \"city = Zurich\",\n * while others have a value \"city = Basel\", performing a groupBy operation on this data set\n * and passing a predicate function which returns the value of the \"city\" property of these objects\n * will form the objects into groups where all objects in one group have \"city = Zurich\", and all objects\n * in the other group have \"city = Basel\".\n *\n * The Cascade module abstracts the concept of \"groupBy\" on multiple levels, and provides the option\n * to arrange the resultant groups in different ways.\n *\n * There are two options for the form of the resulting groups. (This is where sszvis.cascade\n * diverges in behavior from d3.nest, which offers two options, but they must be the same through\n * the entire data structure):\n *\n * In one version, the groups are formed into a plain Javascript object with key -> value pairs. The keys are\n * the set of results from the grouping function. (In our example, the keys would be \"Zurich\" and \"Basel\")\n * In this implementation, the values are each arrays of elements which share the value of the key function.\n * However, these objects may be nested arbitrarily deep. If multiple layers of objects are specified, then the\n * values will themselves be objects with key -> value pairs, and so on. The final layer of objects will have\n * arrays for values, where each element in the arrays is a data object which shares values for all of the specified\n * key properties with the other objects in its array.\n *\n * Alternatively, the input array of objects can be grouped into an array of groups, where the groups\n * contain data values which all share the same value for a certain key property. These, too, can be nested.\n * The sub-groups may be formed as arrays, where each element in the next level is grouped\n * according to the same principle, but with a different key function. Alternatively, the groups may be\n * objects, grouped according to the principle described in the first version. It is up to the user of the\n * class to specify the extent and nature of this nesting. If an array of groups is the last level of the cascade,\n * its values will be arrays of data values.\n *\n * At the base of the cascade, regardless of the types of the levels, will be arrays of data objects. These arrays\n * can also be thought of as containing the leaves of the tree structure.\n *\n * Instances of this class are configured using three methods: \"objectBy\", \"arrayBy\", and \"sort\". They are used by\n * calling the \"apply\" method, passing a flat array of data objects. The first three methods return the instance\n * to enable method chaining, while \"apply\" returns the nested data structure.\n *\n * @method objectBy         Takes as argument a predicate function which is called on each element in an input array. The\n *                          return values of this function are used to create an object with key -> value pairs, where the keys\n *                          are the results of the calls to the predicate function and the values are a further layer of the cascade.\n * @method arrayBy          Takes as argument a predicate function which is called on each element in an input array. The\n *                          return values of this function are used to create an array, where each element of the array\n *                          is a further layer of the cascade. arrayBy also takes an optional second parameter, which specifys\n *                          a sorting function. If provided, groups in the resulting array will be sorted by passing the key values\n *                          of the groups through the sorting function. For example, if an alphabetical sort function is passed\n *                          as the second parameter to an arrayBy call in the example above, the resulting array will be sorted\n *                          such that the first group is the one with \"city = Basel\" and the second group is the one with \"city = Zurich\".\n *                          The sort function should take the usual form of a function passed to Array.prototype.sort().\n * @method sort             This method specifies a sort function for the very last layer of the cascade, which is always arrays of data objects.\n *                          the sort function passed to this method should accept data objects as values.\n *\n * @returns                 An instance of sszvis.cascade\n */\n\nfunction groupBy(data, keyFunc) {\n  const group = {};\n  let key;\n  for (let i = 0, l = data.length, value; i < l; ++i) {\n    value = data[i];\n    key = keyFunc(value);\n    if (group[key]) {\n      group[key].push(value);\n    } else {\n      group[key] = [value];\n    }\n  }\n  return group;\n}\n\nfunction groupEach(data, func) {\n  for (const prop in data) {\n    func(data[prop], prop);\n  }\n}\n\nfunction arrEach(arr, func) {\n  for (let i = 0, l = arr.length; i < l; ++i) {\n    func(arr[i], i);\n  }\n}\n\nexport function cascade() {\n  const _cascade = {},\n    keys = [],\n    sorts = [];\n  let valuesSort;\n\n  function make(data, depth) {\n    if (depth >= keys.length) {\n      if (valuesSort) data.sort(valuesSort);\n      return data;\n    }\n\n    const sorter = sorts[depth];\n    const key = keys[depth++];\n    const grouped = groupBy(data, key.func);\n\n    if (key.type === \"obj\") {\n      const obj = {};\n      groupEach(grouped, (value, k) => {\n        obj[k] = make(value, depth);\n      });\n      return obj;\n    } else if (key.type === \"arr\") {\n      const arr = [];\n      if (sorter) {\n        const groupKeys = Object.keys(grouped).sort(sorter);\n        arrEach(groupKeys, (k) => {\n          arr.push(make(grouped[k], depth));\n        });\n      } else {\n        groupEach(grouped, (value) => {\n          arr.push(make(value, depth));\n        });\n      }\n      return arr;\n    }\n  }\n\n  _cascade.apply = function (data) {\n    return make(data, 0);\n  };\n\n  _cascade.objectBy = function (d) {\n    keys.push({\n      type: \"obj\",\n      func: d,\n    });\n    return _cascade;\n  };\n\n  _cascade.arrayBy = function (d, sorter) {\n    keys.push({\n      type: \"arr\",\n      func: d,\n    });\n    if (sorter) sorts[keys.length - 1] = sorter;\n    return _cascade;\n  };\n\n  _cascade.sort = function (d) {\n    valuesSort = d;\n    return _cascade;\n  };\n\n  return _cascade;\n}\n","/**\n * Bar component\n *\n * The bar component is a general-purpose component used to render rectangles, including\n * bars for horizontal and vertical standard and stacked bar charts, bars in the population\n * pyramids, and the boxes of the heat table.\n *\n * The input data should be an array of data values, where each data value contains the information\n * necessary to render a single rectangle. The x-position, y-position, width, and height of each rectangle\n * are then extracted from the data objects using accessor functions.\n *\n * In addition, the user can specify fill and stroke accessor functions. When called, these functions\n * are given each rectangle's data object, and should return a valid fill or stroke color to be applied\n * to the rectangle.\n *\n * The x, y, width, height, fill, and stroke properties may also be specified as constants.\n *\n * @module sszvis/component/bar\n *\n * @property {number, function} x             the x-value of the rectangles. Becomes a functor.\n * @property {number, function} y             the y-value of the rectangles. Becomes a functor.\n * @property {number, function} width         the width-value of the rectangles. Becomes a functor.\n * @property {number, function} height        the height-value of the rectangles. Becomes a functor.\n * @property {string, function} fill          the fill-value of the rectangles. Becomes a functor.\n * @property {string, function} stroke        the stroke-value of the rectangles. Becomes a functor.\n * @property {boolean} centerTooltip          Whether or not to center the tooltip anchor within the bar.\n *                                            The default tooltip anchor position is at the top of the bar,\n *                                            centered in the width dimension. When this property is true,\n *                                            the tooltip anchor will also be centered in the height dimension.\n * @property {Array<Number>} tooltipAnchor    Where, relative to the box formed by the bar, to position the tooltip\n *                                            anchor. This property is overriden if centerTooltip is true. The\n *                                            value should be a two-element array, [x, y], where x is the position (in 0 - 1)\n *                                            of the tooltip in the width dimension, and y is the position (also range 0 - 1)\n *                                            in the height dimension. For example, the upper left corner would be [0, 0],\n *                                            the center of the bar would be [0.5, 0.5], the middle of the right side\n *                                            would be [1, 0.5], and the lower right corner [1, 1]. Used by, for example,\n *                                            the pyramid chart.\n * @property {boolean} transition             Whether or not to transition the visual values of the bar component, when they\n *                                            are changed.\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { defaultTransition } from \"../transition.js\";\nimport tooltipAnchor from \"../annotation/tooltipAnchor.js\";\nimport { component } from \"../d3-component.js\";\n\n// replaces NaN values with 0\nfunction handleMissingVal(v) {\n  return isNaN(v) ? 0 : v;\n}\n\nexport default function () {\n  return component()\n    .prop(\"x\", fn.functor)\n    .prop(\"y\", fn.functor)\n    .prop(\"width\", fn.functor)\n    .prop(\"height\", fn.functor)\n    .prop(\"fill\", fn.functor)\n    .prop(\"stroke\", fn.functor)\n    .prop(\"centerTooltip\")\n    .prop(\"tooltipAnchor\")\n    .prop(\"transition\")\n    .transition(true)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const xAcc = fn.compose(handleMissingVal, props.x);\n      const yAcc = fn.compose(handleMissingVal, props.y);\n      const wAcc = fn.compose(handleMissingVal, props.width);\n      const hAcc = fn.compose(handleMissingVal, props.height);\n\n      const bars = selection\n        .selectAll(\".sszvis-bar\")\n        .data(data)\n        .join(\"rect\")\n        .classed(\"sszvis-bar\", true)\n        .attr(\"x\", xAcc)\n        .attr(\"y\", yAcc)\n        .attr(\"width\", wAcc)\n        .attr(\"height\", hAcc)\n        .attr(\"fill\", props.fill)\n        .attr(\"stroke\", props.stroke);\n\n      if (props.transition) {\n        bars.transition(defaultTransition());\n      }\n\n      bars.attr(\"x\", xAcc).attr(\"y\", yAcc).attr(\"width\", wAcc).attr(\"height\", hAcc);\n\n      // Tooltip anchors\n      let tooltipPosition;\n      if (props.centerTooltip) {\n        tooltipPosition = function (d) {\n          return [xAcc(d) + wAcc(d) / 2, yAcc(d) + hAcc(d) / 2];\n        };\n      } else if (props.tooltipAnchor) {\n        const uv = props.tooltipAnchor.map(Number.parseFloat);\n        tooltipPosition = function (d) {\n          return [xAcc(d) + uv[0] * wAcc(d), yAcc(d) + uv[1] * hAcc(d)];\n        };\n      } else {\n        tooltipPosition = function (d) {\n          return [xAcc(d) + wAcc(d) / 2, yAcc(d)];\n        };\n      }\n\n      const ta = tooltipAnchor().position(tooltipPosition);\n\n      selection.call(ta);\n    });\n}\n","/**\n * Pyramid component\n *\n * The pyramid component is primarily used to show a distribution of age groups\n * in a population (population pyramid). The chart is mirrored vertically,\n * meaning that it has a horizontal axis that extends in a positive and negative\n * direction having the same domain.\n *\n * This chart's horizontal point of origin is at it's spine, i.e. the center of\n * the chart.\n *\n * @module sszvis/component/pyramid\n *\n * @requires sszvis.component.bar\n *\n * @property {number, d3.scale} [barFill]          The color of a bar\n * @property {number, d3.scale} barHeight          The height of a bar\n * @property {number, d3.scale} barWidth           The width of a bar\n * @property {number, d3.scale} barPosition        The vertical position of a bar\n * @property {Array<number, number>} tooltipAnchor The anchor position for the tooltips. Uses sszvis.component.bar.tooltipAnchor\n *                                                 under the hood to optionally reposition the tooltip anchors in the pyramid chart.\n *                                                 Default value is [0.5, 0.5], which centers tooltips on the bars\n * @property {function}         leftAccessor       Data for the left side\n * @property {function}         rightAccessor      Data for the right side\n * @property {function}         [leftRefAccessor]  Reference data for the left side\n * @property {function}         [rightRefAccessor] Reference data for the right side\n *\n * @return {sszvis.component}\n */\n\nimport { select, line as d3Line } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { defaultTransition } from \"../transition.js\";\nimport bar from \"./bar.js\";\nimport { component } from \"../d3-component.js\";\n\n/* Constants\n----------------------------------------------- */\nconst SPINE_PADDING = 0.5;\n\n/* Module\n----------------------------------------------- */\nexport default function () {\n  return component()\n    .prop(\"barHeight\", fn.functor)\n    .prop(\"barWidth\", fn.functor)\n    .prop(\"barPosition\", fn.functor)\n    .prop(\"barFill\", fn.functor)\n    .barFill(\"#000\")\n    .prop(\"tooltipAnchor\")\n    .tooltipAnchor([0.5, 0.5])\n    .prop(\"leftAccessor\")\n    .prop(\"rightAccessor\")\n    .prop(\"leftRefAccessor\")\n    .prop(\"rightRefAccessor\")\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      // Components\n\n      const leftBar = bar()\n        .x((d) => -SPINE_PADDING - props.barWidth(d))\n        .y(props.barPosition)\n        .height(props.barHeight)\n        .width(props.barWidth)\n        .fill(props.barFill)\n        .tooltipAnchor(props.tooltipAnchor);\n\n      const rightBar = bar()\n        .x(SPINE_PADDING)\n        .y(props.barPosition)\n        .height(props.barHeight)\n        .width(props.barWidth)\n        .fill(props.barFill)\n        .tooltipAnchor(props.tooltipAnchor);\n\n      const leftLine = lineComponent()\n        .barPosition(props.barPosition)\n        .barWidth(props.barWidth)\n        .mirror(true);\n\n      const rightLine = lineComponent().barPosition(props.barPosition).barWidth(props.barWidth);\n\n      // Rendering\n\n      selection.selectGroup(\"left\").datum(props.leftAccessor(data)).call(leftBar);\n\n      selection.selectGroup(\"right\").datum(props.rightAccessor(data)).call(rightBar);\n\n      selection\n        .selectGroup(\"leftReference\")\n        .datum(props.leftRefAccessor ? [props.leftRefAccessor(data)] : [])\n        .call(leftLine);\n\n      selection\n        .selectGroup(\"rightReference\")\n        .datum(props.rightRefAccessor ? [props.rightRefAccessor(data)] : [])\n        .call(rightLine);\n    });\n}\n\nfunction lineComponent() {\n  return component()\n    .prop(\"barPosition\")\n    .prop(\"barWidth\")\n    .prop(\"mirror\")\n    .mirror(false)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const lineGen = d3Line().x(props.barWidth).y(props.barPosition);\n\n      const line = selection\n        .selectAll(\".sszvis-pyramid__referenceline\")\n        .data(data)\n        .join(\"path\")\n        .attr(\"class\", \"sszvis-pyramid__referenceline\");\n\n      line\n        .attr(\"transform\", props.mirror ? \"scale(-1, 1)\" : \"\")\n        .transition(defaultTransition())\n        .attr(\"d\", lineGen);\n    });\n}\n","/**\n * Stacked Bar component\n *\n * This component includes both the vertical and horizontal stacked bar chart components.\n * Both are constiations on the same concept, and they both use the same abstract intermediate\n * representation for the stack, but are rendered using different dimensions. Note that using\n * this component will add the properties 'y0' and 'y' to any passed-in data objects, as part of\n * computing the stack intermediate representation. Existing properties with these names will be\n * overwritten.\n *\n * @module sszvis/component/stackedBar/horizontal\n * @module sszvis/component/stackedBar/vertical\n *\n * @property {function} xAccessor           Specifies an x-accessor for the stack layout. The result of this function\n *                                          is used to compute the horizontal extent of each element in the stack.\n *                                          The return value must be a number.\n * @property {function} xScale              Specifies an x-scale for the stack layout. This scale is used to position\n *                                          the elements of each stack, both the left offset value and the width of each stack segment.\n * @property {number, function} width       Specifies a width for the bars in the stack layout. This value is not used in the\n *                                          horizontal orientation. (xScale is used instead).\n * @property {function} yAccessor           The y-accessor. The return values of this function are used to group elements together as stacks.\n * @property {function} yScale              A y-scale. After the stack is computed, the y-scale is used to position each stack.\n * @property {number, function} height      Specify the height of each rectangle. This value determines the height of each element in the stacks.\n * @property {string, function} fill        Specify a fill value for the rectangles (default black).\n * @property {string, function} stroke      Specify a stroke value for the stack rectangles (default none).\n * @property {string} orientation           Specifies the orientation (\"vertical\" or \"horizontal\") of the stacked bar chart.\n *                                          Used internally to configure the verticalBar and the horizontalBar. Should probably never be changed.\n *\n * @return {sszvis.component}\n */\n\nimport { select, stack as d3Stack, stackOrderNone, stackOrderReverse, max } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { cascade } from \"../cascade.js\";\nimport bar from \"./bar.js\";\nimport { component } from \"../d3-component.js\";\n\nconst stackAcc = fn.prop(\"stack\");\n\n// Accessors for the first and second element of a tuple (2-element array).\nconst fst = fn.prop(\"0\");\nconst snd = fn.prop(\"1\");\n\nfunction stackedBarData(order) {\n  return function (_stackAcc, seriesAcc, valueAcc) {\n    return function (data) {\n      const rows = cascade().arrayBy(_stackAcc).objectBy(seriesAcc).apply(data);\n\n      // Collect all keys ()\n      const keys = rows.reduce((a, row) => fn.set([...a, ...Object.keys(row)]), []);\n\n      const stacks = d3Stack()\n        .keys(keys)\n        .value((x, key) => valueAcc(x[key][0]))\n        .order(order)(rows);\n\n      // Simplify the 'data' property.\n      for (const stack of stacks) {\n        for (const d of stack) {\n          d.series = stack.key;\n          d.data = d.data[stack.key][0];\n          d.stack = _stackAcc(d.data);\n        }\n      }\n\n      stacks.keys = keys;\n\n      stacks.maxValue = max(stacks, (stack) => max(stack, (d) => d[1]));\n\n      return stacks;\n    };\n  };\n}\n\nexport const stackedBarHorizontalData = stackedBarData(stackOrderNone);\nexport const stackedBarVerticalData = stackedBarData(stackOrderReverse);\n\nfunction stackedBar(config) {\n  return component()\n    .prop(\"xScale\", fn.functor)\n    .prop(\"width\", fn.functor)\n    .prop(\"yScale\", fn.functor)\n    .prop(\"height\", fn.functor)\n    .prop(\"fill\")\n    .prop(\"stroke\")\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const barGen = bar()\n        .x(config.x(props))\n        .y(config.y(props))\n        .width(config.width(props))\n        .height(config.height(props))\n        .fill(props.fill)\n        .stroke(props.stroke || \"#FFFFFF\");\n\n      const groups = selection\n        .selectAll(\".sszvis-stack\")\n        .data(data)\n        .join(\"g\")\n        .classed(\"sszvis-stack\", true);\n\n      groups.call(barGen);\n    });\n}\n\nconst horizontalStackedBarConfig = {\n  x(props) {\n    return fn.compose(props.xScale, fst);\n  },\n  y(props) {\n    return fn.compose(props.yScale, stackAcc);\n  },\n  width(props) {\n    return function (d) {\n      return props.xScale(d[1]) - props.xScale(d[0]);\n    };\n  },\n  height(props) {\n    return props.height;\n  },\n};\nexport const stackedBarHorizontal = function () {\n  return stackedBar(horizontalStackedBarConfig);\n};\n\nconst verticalStackedBarConfig = {\n  x(props) {\n    return fn.compose(props.xScale, stackAcc);\n  },\n  y(props) {\n    return fn.compose(props.yScale, snd);\n  },\n  width(props) {\n    return props.width;\n  },\n  height(props) {\n    return function (d) {\n      return props.yScale(d[0]) - props.yScale(d[1]);\n    };\n  },\n};\nexport const stackedBarVertical = function () {\n  return stackedBar(verticalStackedBarConfig);\n};\n","/**\n * Stacked Pyramid component\n *\n * The pyramid component is primarily used to show a distribution of age groups\n * in a population (population pyramid). The chart is mirrored vertically,\n * meaning that it has a horizontal axis that extends in a positive and negative\n * direction having the same domain.\n *\n * This chart's horizontal point of origin is at it's spine, i.e. the center of\n * the chart.\n *\n * @module sszvis/component/stackedPyramid\n *\n * @requires sszvis.component.bar\n *\n * @property {number, d3.scale} [barFill]          The color of a bar\n * @property {number, d3.scale} barHeight          The height of a bar\n * @property {number, d3.scale} barWidth           The width of a bar\n * @property {number, d3.scale} barPosition        The vertical position of a bar\n * @property {Array<number, number>} tooltipAnchor The anchor position for the tooltips. Uses sszvis.component.bar.tooltipAnchor\n *                                                 under the hood to optionally reposition the tooltip anchors in the pyramid chart.\n *                                                 Default value is [0.5, 0.5], which centers tooltips on the bars\n * @property {function}         leftAccessor       Data for the left side\n * @property {function}         rightAccessor      Data for the right side\n * @property {function}         [leftRefAccessor]  Reference data for the left side\n * @property {function}         [rightRefAccessor] Reference data for the right side\n *\n * @return {sszvis.component}\n */\n\nimport { select, stack as d3Stack, line as d3Line, max } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { cascade } from \"../cascade.js\";\nimport { defaultTransition } from \"../transition.js\";\nimport bar from \"./bar.js\";\nimport { component } from \"../d3-component.js\";\n\n/* Constants\n----------------------------------------------- */\nconst SPINE_PADDING = 0.5;\n\nconst dataAcc = fn.prop(\"data\");\nconst rowAcc = fn.prop(\"row\");\n\n/**\n * This function prepares the data for the stackedPyramid component\n *\n * The input data is expected to have at least four columns:\n *\n *  - side: determines on which side (left/right) the value goes. MUST have cardinality of two!\n *  - row: determines on which row (vertical position) the value goes.\n *  - series: determines in which series (for the stack) the value is.\n *  - value: the numerical value.\n *\n * The combination of each distinct (side,row,series) triplet MUST appear only once\n * in the data. This function makes no effort to normalize the data if that's not the case.\n */\nexport function stackedPyramidData(sideAcc, _rowAcc, seriesAcc, valueAcc) {\n  return function (data) {\n    const sides = cascade()\n      .arrayBy(sideAcc)\n      .arrayBy(_rowAcc)\n      .objectBy(seriesAcc)\n      .apply(data)\n      .map((rows) => {\n        const keys = Object.keys(rows[0]);\n        const side = sideAcc(rows[0][keys[0]][0]);\n\n        const stacks = d3Stack()\n          .keys(keys)\n          .value((x, key) => valueAcc(x[key][0]))(rows);\n\n        for (const [i, stack] of stacks.entries()) {\n          for (const [row, d] of stack.entries()) {\n            d.data = d.data[keys[i]][0];\n            d.series = keys[i];\n            d.side = side;\n            d.row = row;\n            d.value = valueAcc(d.data);\n          }\n        }\n\n        return stacks;\n      });\n\n    // Compute the max value, for convenience. This value is needed to construct\n    // the horizontal scale.\n    sides.maxValue = max(sides, (side) => max(side, (rows) => max(rows, (row) => row[1])));\n\n    return sides;\n  };\n}\n\n/* Module\n----------------------------------------------- */\nexport function stackedPyramid() {\n  return component()\n    .prop(\"barHeight\", fn.functor)\n    .prop(\"barWidth\", fn.functor)\n    .prop(\"barPosition\", fn.functor)\n    .prop(\"barFill\", fn.functor)\n    .barFill(\"#000\")\n    .prop(\"tooltipAnchor\")\n    .tooltipAnchor([0.5, 0.5])\n    .prop(\"leftAccessor\")\n    .prop(\"rightAccessor\")\n    .prop(\"leftRefAccessor\")\n    .prop(\"rightRefAccessor\")\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      // Components\n\n      const leftBar = bar()\n        .x((d) => -SPINE_PADDING - props.barWidth(d[1]))\n        .y(fn.compose(props.barPosition, rowAcc))\n        .height(props.barHeight)\n        .width((d) => props.barWidth(d[1]) - props.barWidth(d[0]))\n        .fill(fn.compose(props.barFill, dataAcc))\n        .tooltipAnchor(props.tooltipAnchor);\n\n      const rightBar = bar()\n        .x((d) => SPINE_PADDING + props.barWidth(d[0]))\n        .y(fn.compose(props.barPosition, rowAcc))\n        .height(props.barHeight)\n        .width((d) => props.barWidth(d[1]) - props.barWidth(d[0]))\n        .fill(fn.compose(props.barFill, dataAcc))\n        .tooltipAnchor(props.tooltipAnchor);\n\n      const leftStack = stackComponent().stackElement(leftBar);\n\n      const rightStack = stackComponent().stackElement(rightBar);\n\n      const leftLine = lineComponent()\n        .barPosition(props.barPosition)\n        .barWidth(props.barWidth)\n        .mirror(true);\n\n      const rightLine = lineComponent().barPosition(props.barPosition).barWidth(props.barWidth);\n\n      // Rendering\n\n      selection.selectGroup(\"leftStack\").datum(props.leftAccessor(data)).call(leftStack);\n\n      selection.selectGroup(\"rightStack\").datum(props.rightAccessor(data)).call(rightStack);\n\n      selection\n        .selectGroup(\"leftReference\")\n        .datum(props.leftRefAccessor ? [props.leftRefAccessor(data)] : [])\n        .call(leftLine);\n\n      selection\n        .selectGroup(\"rightReference\")\n        .datum(props.rightRefAccessor ? [props.rightRefAccessor(data)] : [])\n        .call(rightLine);\n    });\n}\n\nfunction stackComponent() {\n  return component()\n    .prop(\"stackElement\")\n    .renderSelection((selection) => {\n      const datum = selection.datum();\n      const props = selection.props();\n\n      const stack = selection\n        .selectAll(\"[data-sszvis-stack]\")\n        .data(datum)\n        .join(\"g\")\n        .attr(\"data-sszvis-stack\", \"\");\n\n      stack.each(function (d) {\n        select(this).datum(d).call(props.stackElement);\n      });\n    });\n}\n\nfunction lineComponent() {\n  return component()\n    .prop(\"barPosition\")\n    .prop(\"barWidth\")\n    .prop(\"mirror\")\n    .mirror(false)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const lineGen = d3Line().x(props.barWidth).y(props.barPosition);\n\n      const line = selection\n        .selectAll(\".sszvis-path\")\n        .data(data)\n        .join(\"path\")\n        .attr(\"class\", \"sszvis-path\")\n        .attr(\"fill\", \"none\")\n        .attr(\"stroke\", \"#aaa\")\n        .attr(\"stroke-width\", 2)\n        .attr(\"stroke-dasharray\", \"3 3\");\n\n      line\n        .attr(\"transform\", props.mirror ? \"scale(-1, 1)\" : \"\")\n        .transition(defaultTransition())\n        .attr(\"d\", lineGen);\n    });\n}\n","/**\n * Sunburst component\n *\n * This component renders a sunburst diagram, which is kind of like a layered pie chart. There is an\n * inner ring of values, which are total values for some large category. Each of these categories can\n * be broken down into smaller categories, which are shown in another layer around the inner ring. If these\n * categories can in turn be broken down into smaller ones, you can add yet another layer. The result\n * is a hierarchical display with the level of aggregation getting finer and finer as you get further\n * from the center of the chart.\n *\n * This component uses the data structure returned by the sszvis.layout.sunbust.prepareData function, and\n * can be configured using the sszvis.layout.sunburst.computeLayout function. Under the hood, the prepareData\n * function uses d3's nest data transformer (d3.nest) to construct a nested data structure from the input\n * array, and d3's partition layout (d3.layout.partition), and the resulting data structure will be\n * familiar to those familiar with the partition layout.\n *\n * @property {Function} angleScale              Scale function for the angle of the segments of the sunburst chart. If using the\n *                                              sszvis.layout.sunburst.prepareData function, the domain will be [0, 1]. The range\n *                                              should usually be [0, 2 * PI]. That domain and range are used as default for this property.\n * @property {Function} radiusScale             Scale function for the radius of segments. Can be configured using values returned from\n *                                              sszvis.layout.sunburst.computeLayout. See the examples for how the scale setup works.\n * @property {Number} centerRadius              The radius of the center of the chart. Can be configured with sszvis.layout.sunburst.computeLayout.\n * @property {Function} fill                    Function that returns the fill color for the segments in the center of the chart. Note that this will only be\n *                                              called on the centermost segments. The segments which are subcategories of these center segments\n *                                              will have their fill determined recursively, by lightening the color of its parent segment.\n * @property {Color, Function} stroke           The stroke color of the segments. Defaults to white.\n *\n * @return {sszvis.component}\n */\n\nimport { select, scaleLinear, hsl, arc, interpolate } from \"d3\";\n\nimport * as logger from \"../logger.js\";\nimport { defaultTransition } from \"../transition.js\";\nimport tooltipAnchor from \"../annotation/tooltipAnchor.js\";\nimport { component } from \"../d3-component.js\";\n\nconst TWO_PI = 2 * Math.PI;\n\nexport default function () {\n  return component()\n    .prop(\"angleScale\")\n    .angleScale(scaleLinear().range([0, 2 * Math.PI]))\n    .prop(\"radiusScale\")\n    .prop(\"centerRadius\")\n    .prop(\"fill\")\n    .prop(\"stroke\")\n    .stroke(\"white\")\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      // Accepts a sunburst node and returns a d3.hsl color for that node (sometimes operates recursively)\n      function getColorRecursive(node) {\n        // Center node (if the data were prepared using sszvis.layout.sunburst.prepareData)\n        if (node.data.isSunburstRoot) {\n          return \"transparent\";\n        } else if (!node.parent) {\n          // Accounts for incorrectly formatted data which hasn't gone through sszvis.layout.sunburst.prepareData\n          logger.warn(\n            \"Data passed to sszvis.component.sunburst does not have the expected tree structure. You should prepare it using sszvis.format.sunburst.prepareData\"\n          );\n          return hsl(props.fill(node.data.key));\n        } else if (node.parent.data.isSunburstRoot) {\n          // Use the color scale\n          return hsl(props.fill(node.data.key));\n        } else {\n          // Recurse up the tree and adjust the lightness value\n          const pColor = getColorRecursive(node.parent);\n          pColor.l *= 1.15;\n          return pColor;\n        }\n      }\n\n      const startAngle = function (d) {\n        return Math.max(0, Math.min(TWO_PI, props.angleScale(d.x0)));\n      };\n      const endAngle = function (d) {\n        return Math.max(0, Math.min(TWO_PI, props.angleScale(d.x1)));\n      };\n      const innerRadius = function (d) {\n        return props.centerRadius + Math.max(0, props.radiusScale(d.y0));\n      };\n      const outerRadius = function (d) {\n        return props.centerRadius + Math.max(0, props.radiusScale(d.y1));\n      };\n\n      const arcGen = arc()\n        .startAngle(startAngle)\n        .endAngle(endAngle)\n        .innerRadius(innerRadius)\n        .outerRadius(outerRadius);\n\n      for (const d of data) {\n        // _x and _dx are the destination values for the transition.\n        // We set these to the computed x and dx.\n        d._x0 = d.x0;\n        d._x1 = d.x1;\n      }\n\n      const arcs = selection\n        .selectAll(\".sszvis-sunburst-arc\")\n        .each((d, i) => {\n          if (data[i]) {\n            // x and dx are the current/transitioning values\n            // We set these here, in case any datums already exist which have values set\n            data[i].x0 = d.x0;\n            data[i].x1 = d.x1;\n            // The transition tweens from x and dx to _x and _dx\n          }\n        })\n        .data(data)\n        .join(\"path\")\n        .attr(\"class\", \"sszvis-sunburst-arc\");\n\n      arcs.attr(\"stroke\", props.stroke).attr(\"fill\", getColorRecursive);\n\n      arcs.transition(defaultTransition()).attrTween(\"d\", (d) => {\n        const x0Interp = interpolate(d.x0, d._x0);\n        const x1Interp = interpolate(d.x1, d._x1);\n        return function (t) {\n          d.x0 = x0Interp(t);\n          d.x1 = x1Interp(t);\n          return arcGen(d);\n        };\n      });\n\n      // Add tooltip anchors\n      const arcTooltipAnchor = tooltipAnchor().position((d) => {\n        const startA = startAngle(d);\n        const endA = endAngle(d);\n        const a = startA + Math.abs(endA - startA) / 2 - Math.PI / 2;\n        const r = (innerRadius(d) + outerRadius(d)) / 2;\n        return [Math.cos(a) * r, Math.sin(a) * r];\n      });\n\n      selection.call(arcTooltipAnchor);\n    });\n}\n","/**\n * Slider control\n *\n * Control for use in filtering. Works very much like an interactive axis.\n * A d3 scale is its primary configuration, and it has a labeled handle which can be used to\n * select values on that scale. Ticks created using an sszvis.axis show the user where\n * data values lie.\n *\n * @module  sszvis/control/slider\n *\n * @property {function} scale                 A scale function which this slider represents. The values in the scale's domain\n *                                            are used as the possible values of the slider.\n * @property {array} minorTicks               An array of ticks which become minor (smaller and unlabeled) ticks on the slider's axis\n * @property {array} majorTicks               An array of ticks which become major (larger and labeled) ticks on the slider's axis\n * @property {function} tickLabels            A function to use to format the major tick labels.\n * @property {string} slant                             Specify a label slant for the tick labels. Can be \"vertical\" - labels are displayed vertically - or\n *                                                      \"diagonal\" - labels are displayed at a 45 degree angle to the axis.\n *                                                      Use \"horizontal\" to reset to a horizontal slant.\n * @property {any} value                      The current value of the slider. Should be set whenever slider interaction causes the state to change.\n * @property {string, function} label         A string or function for the handle label. The datum associated with it is the current slider value.\n * @property {function} onchange              A callback function called whenever user interaction attempts to change the slider value.\n *                                            Note that this component will not change its own state. The callback function must affect some state change\n *                                            in order for this component's display to be updated.\n *\n * @returns {sszvis.component}\n */\n\nimport { select, scaleLinear } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { halfPixel } from \"../svgUtils/crisp.js\";\nimport translateString from \"../svgUtils/translateString.js\";\nimport { range } from \"../scale.js\";\nimport move from \"../behavior/move.js\";\nimport { axisX } from \"../axis.js\";\nimport { component } from \"../d3-component.js\";\n\nfunction contains(x, a) {\n  return a.includes(x);\n}\n\nexport default function () {\n  return component()\n    .prop(\"scale\")\n    .prop(\"value\")\n    .prop(\"onchange\")\n    .prop(\"minorTicks\")\n    .minorTicks([])\n    .prop(\"majorTicks\")\n    .majorTicks([])\n    .prop(\"tickLabels\", fn.functor)\n    .prop(\"slant\")\n    .tickLabels(fn.identity)\n    .prop(\"label\", fn.functor)\n    .label(fn.identity)\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      const axisOffset = 28; // vertical offset for the axis\n      const majorTickSize = 12;\n      const backgroundOffset = halfPixel(18); // vertical offset for the middle of the background\n      const handleWidth = 10; // the width of the handle\n      const handleHeight = 23; // the height of the handle\n      const bgWidth = 6; // the width of the background\n      const lineEndOffset = bgWidth / 2; // the amount by which to offset the ends of the background line\n      const handleSideOffset = handleWidth / 2 + 0.5; // the amount by which to offset the position of the handle\n\n      const scaleDomain = props.scale.domain();\n      const scaleRange = range(props.scale);\n      const alteredScale = props.scale\n        .copy()\n        .range([scaleRange[0] + handleSideOffset, scaleRange[1] - handleSideOffset]);\n\n      // the mostly unchanging bits\n      const bg = selection\n        .selectAll(\"g.sszvis-control-slider__backgroundgroup\")\n        .data([1])\n        .join(\"g\")\n        .classed(\"sszvis-control-slider__backgroundgroup\", true);\n\n      // create the axis\n      const axis = axisX()\n        .scale(alteredScale)\n        .orient(\"bottom\")\n        .slant(props.slant)\n        .hideBorderTickThreshold(0)\n        .tickSize(majorTickSize)\n        .tickPadding(6)\n        .tickValues(fn.set([...props.majorTicks, ...props.minorTicks]))\n        .tickFormat((d) => (contains(d, props.majorTicks) ? props.tickLabels(d) : \"\"));\n\n      const axisSelection = bg\n        .selectAll(\"g.sszvis-axisGroup\")\n        .data([1])\n        .join(\"g\")\n        .classed(\"sszvis-axisGroup sszvis-axis sszvis-axis--bottom sszvis-axis--slider\", true);\n\n      axisSelection.attr(\"transform\", translateString(0, axisOffset)).call(axis);\n\n      // adjust visual aspects of the axis to fit the design\n      axisSelection\n        .selectAll(\".tick line\")\n        .filter((d) => !contains(d, props.majorTicks))\n        .attr(\"y2\", 4);\n\n      const majorAxisText = axisSelection\n        .selectAll(\".tick text\")\n        .filter((d) => contains(d, props.majorTicks));\n\n      if (!props.slant || props.slant === \"horizontal\") {\n        const numTicks = majorAxisText.size();\n        majorAxisText.style(\"text-anchor\", (d, i) =>\n          i === 0 ? \"start\" : i === numTicks - 1 ? \"end\" : \"middle\"\n        );\n      }\n\n      if (props.slant === \"vertical\") {\n        majorAxisText.attr(\"dx\", \"-1.8em\");\n        majorAxisText.attr(\"dy\", \"-1.5em\");\n      }\n\n      if (props.slant === \"diagonal\") {\n        majorAxisText.attr(\"dx\", \"-1.6em\");\n        majorAxisText.attr(\"dy\", \"0.2em\");\n      }\n\n      // create the slider background\n      const backgroundSelection = bg\n        .selectAll(\"g.sszvis-slider__background\")\n        .data([1])\n        .join(\"g\")\n        .classed(\"sszvis-slider__background\", true)\n        .attr(\"transform\", translateString(0, backgroundOffset));\n\n      backgroundSelection\n        .selectAll(\".sszvis-slider__background__bg1\")\n        .data([1])\n        .join(\"line\")\n        .classed(\"sszvis-slider__background__bg1\", true)\n        .style(\"stroke-width\", bgWidth)\n        .style(\"stroke\", \"#888\")\n        .style(\"stroke-linecap\", \"round\")\n        .attr(\"x1\", Math.ceil(scaleRange[0] + lineEndOffset))\n        .attr(\"x2\", Math.floor(scaleRange[1] - lineEndOffset));\n\n      backgroundSelection\n        .selectAll(\".sszvis-slider__background__bg2\")\n        .data([1])\n        .join(\"line\")\n        .classed(\"sszvis-slider__background__bg2\", true)\n        .style(\"stroke-width\", bgWidth - 1)\n        .style(\"stroke\", \"#fff\")\n        .style(\"stroke-linecap\", \"round\")\n        .attr(\"x1\", Math.ceil(scaleRange[0] + lineEndOffset))\n        .attr(\"x2\", Math.floor(scaleRange[1] - lineEndOffset));\n\n      backgroundSelection\n        .selectAll(\".sszvis-slider__backgroundshadow\")\n        .data([props.value])\n        .join(\"line\")\n        .attr(\"class\", \"sszvis-slider__backgroundshadow\")\n        .attr(\"stroke-width\", bgWidth - 1)\n        .style(\"stroke\", \"#E0E0E0\")\n        .style(\"stroke-linecap\", \"round\")\n        .attr(\"x1\", Math.ceil(scaleRange[0] + lineEndOffset))\n        .attr(\"x2\", fn.compose(Math.floor, alteredScale));\n\n      // draw the handle and the label\n      const handle = selection\n        .selectAll(\"g.sszvis-control-slider__handle\")\n        .data([props.value])\n        .join(\"g\")\n        .classed(\"sszvis-control-slider__handle\", true)\n        .attr(\"transform\", (d) => translateString(halfPixel(alteredScale(d)), 0.5));\n\n      handle.append(\"text\").classed(\"sszvis-control-slider--label\", true);\n\n      handle\n        .selectAll(\".sszvis-control-slider--label\")\n        .data((d) => [d])\n        .text(props.label)\n        .style(\"text-anchor\", (d) =>\n          fn.stringEqual(d, scaleDomain[0])\n            ? \"start\"\n            : fn.stringEqual(d, scaleDomain[1])\n              ? \"end\"\n              : \"middle\"\n        )\n        .attr(\"dx\", (d) =>\n          fn.stringEqual(d, scaleDomain[0])\n            ? -(handleWidth / 2)\n            : fn.stringEqual(d, scaleDomain[1])\n              ? handleWidth / 2\n              : 0\n        );\n\n      handle\n        .selectAll(\".sszvis-control-slider__handlebox\")\n        .data([1])\n        .join(\"rect\")\n        .classed(\"sszvis-control-slider__handlebox\", true)\n        .attr(\"x\", -(handleWidth / 2))\n        .attr(\"y\", backgroundOffset - handleHeight / 2)\n        .attr(\"width\", handleWidth)\n        .attr(\"height\", handleHeight)\n        .attr(\"rx\", 2)\n        .attr(\"ry\", 2);\n\n      const handleLineDimension = handleHeight / 2 - 4; // the amount by which to offset the small handle line within the handle\n\n      handle\n        .selectAll(\".sszvis-control-slider__handleline\")\n        .data([1])\n        .join(\"line\")\n        .classed(\"sszvis-control-slider__handleline\", true)\n        .attr(\"y1\", backgroundOffset - handleLineDimension)\n        .attr(\"y2\", backgroundOffset + handleLineDimension);\n\n      const sliderInteraction = move()\n        .xScale(props.scale)\n        // range goes from the text top (text is 11px tall) to the bottom of the axis\n        .yScale(scaleLinear().range([-11, axisOffset + majorTickSize]))\n        .draggable(true)\n        .on(\"drag\", props.onchange);\n\n      selection\n        .selectGroup(\"sliderInteraction\")\n        .classed(\"sszvis-control-slider--interactionLayer\", true)\n        .attr(\"transform\", translateString(0, 4))\n        .call(sliderInteraction);\n    });\n}\n","/**\n * Ordinal Color Scale Legend\n *\n * This component is used for creating a legend for a categorical color scale.\n *\n * @module sszvis/legend/ordinalColorScale\n *\n * @property {d3.scaleOrdinal()} scale         An ordinal scale which will be transformed into the legend.\n * @property {Number} rowHeight                 The height of the rows of the legend.\n * @property {Number} columnWidth               The width of the columns of the legend.\n * @property {Number} rows                      The target number of rows for the legend.\n * @property {Number} columns                    The target number of columns for the legend.\n * @property {String} orientation               The orientation (layout order) of the legend. should be either \"horizontal\" or \"vertical\". No default.\n * @property {Boolean} reverse                  Whether to reverse the order that categories appear in the legend. Default false\n * @property {Boolean} rightAlign               Whether to right-align the legend. Default false.\n * @property {Boolean} horizontalFloat          A true value changes the legend layout to the horizontal float version. Default false.\n * @property {Number} floatPadding              The amount of padding between elements in the horizontal float layout. Default 10px\n * @property {Number} floatWidth                The maximum width of the horizontal float layout. Default 600px\n *\n * The color legend works by iterating over the domain of the provided scale, and generating a legend entry for each\n * element in the domain. The entry consists of a label giving the category, and a circle colored with the category's\n * corresponding color. When props.rightAlign is false (the default), the circle comes before the name. When rightAlign\n * is true, the circle comes afterwards. The layout of these labels is governed by the other parameters.\n *\n * Default Layout:\n *\n * Because the labels are svg elements positioned with translate (and do not use the html box model layout algorithm),\n * rowHeight is necessary to provide the vertical height of each row. Generally speaking, 20px is fine for the default text size.\n * In the default layout, labels are organized into rows and columns in a gridded fashion. columnWidth is the total width of\n * any resulting columns. Note that if there is only one column, columnWidth is irrelevant.\n *\n * There are two orientation options for the row/column layout. The 'horizontal' orientation lays out elements from the input\n * domain into rows, creating new rows as necessary. For example, with three columns, the first three elements will form\n * the top row, then the next three in the second row, and so on. With 'vertical' orientation, labels are stacked into a column,\n * and new columns are added as necessary to hold all of the elements. Therefore, in the 'horizontal' orientation, the number of columns\n * is key, as this determines when a row ends and a new row begins. In the 'vertical' layout, the number of rows determines when to start\n * a new column.\n *\n * For the input set { A, B, C, D, E, F, G }\n *\n * Horizontal Orientation (3 columns):\n *\n *      A    B    C\n *      D    E    F\n *      G\n *\n * Horizontal Orientation (2 columns):\n *\n *     A    B\n *     C    D\n *     E    F\n *     G\n *\n * Vertical Orientation (3 rows):\n *\n *      A    D    G\n *      B    E\n *      C    F\n *\n * Vertical Orientation (2 rows):\n *\n *      A    C    E    G\n *      B    D    F\n *\n * If reverse is true, items from the input domain will be added to the layout in reversed order.\n *\n * For example, Horizontal Orientation (4 columns, reverse = true):\n *\n *    G    F    E    D\n *    C    B    A\n *\n * Horizontal Float Layout:\n *\n * If horizontalFloat is true, a different layout entirely is used, which relies on the width of each element\n * to compute the position of the next one. This layout always proceeds left-to-right first, then top-to-bottom\n * if the floatWidth would be exceeded by a new element. Between each element is an amount of padding configurable\n * using the floatPadding property.\n *\n * For the input set { foo, bar, qux, fooBar, baz, fooBarBaz, fooBaz, barFoo }\n *\n * Horizontal Float Layout (within a floatWidth identified by vertical pipes,\n * with 4 spaces of floatPadding).\n *\n * |foo    bar    qux|\n * |fooBar    baz    |      <--- not enough space for fooBarBaz\n * |fooBarBaz        |      <--- not enough space for padding + fooBaz\n * |fooBaz    barFoo |\n */\n\nimport { select } from \"d3\";\nimport { component } from \"../d3-component.js\";\nimport { halfPixel } from \"../svgUtils/crisp.js\";\nimport translateString from \"../svgUtils/translateString.js\";\n\nexport const DEFAULT_LEGEND_COLOR_ORDINAL_ROW_HEIGHT = 21;\n\nexport function legendColorOrdinal() {\n  return component()\n    .prop(\"scale\")\n    .prop(\"rowHeight\")\n    .rowHeight(DEFAULT_LEGEND_COLOR_ORDINAL_ROW_HEIGHT)\n    .prop(\"columnWidth\")\n    .columnWidth(200)\n    .prop(\"rows\")\n    .rows(3)\n    .prop(\"columns\")\n    .columns(3)\n    .prop(\"verticallyCentered\")\n    .verticallyCentered(false)\n    .prop(\"orientation\")\n    .prop(\"reverse\")\n    .reverse(false)\n    .prop(\"rightAlign\")\n    .rightAlign(false)\n    .prop(\"horizontalFloat\")\n    .horizontalFloat(false)\n    .prop(\"floatPadding\")\n    .floatPadding(20)\n    .prop(\"floatWidth\")\n    .floatWidth(600)\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      let domain = props.scale.domain();\n\n      if (props.reverse) {\n        domain = [...domain].reverse();\n      }\n\n      let rows, cols;\n      if (props.orientation === \"horizontal\") {\n        cols = Math.ceil(props.columns);\n        rows = Math.ceil(domain.length / cols);\n      } else if (props.orientation === \"vertical\") {\n        rows = Math.ceil(props.rows);\n        cols = Math.ceil(domain.length / rows);\n      }\n\n      const groups = selection\n        .selectAll(\".sszvis-legend--entry\")\n        .data(domain)\n        .join(\"g\")\n        .classed(\"sszvis-legend--entry\", true);\n\n      groups\n        .selectAll(\".sszvis-legend__mark\")\n        .data((d) => [d])\n        .join(\"circle\")\n        .classed(\"sszvis-legend__mark\", true)\n        .attr(\"cx\", props.rightAlign ? -6 : 6)\n        .attr(\"cy\", halfPixel(props.rowHeight / 2))\n        .attr(\"r\", 5)\n        .attr(\"fill\", (d) => props.scale(d))\n        .attr(\"stroke\", (d) => props.scale(d))\n        .attr(\"stroke-width\", 1);\n\n      groups\n        .selectAll(\".sszvis-legend__label\")\n        .data((d) => [d])\n        .join(\"text\")\n        .classed(\"sszvis-legend__label\", true)\n        .text((d) => d)\n        .attr(\"dy\", \"0.35em\") // vertically-center\n        .style(\"text-anchor\", () => (props.rightAlign ? \"end\" : \"start\"))\n        .attr(\"transform\", () => {\n          const x = props.rightAlign ? -18 : 18;\n          const y = halfPixel(props.rowHeight / 2);\n          return translateString(x, y);\n        });\n\n      let verticalOffset = \"\";\n      if (props.verticallyCentered) {\n        verticalOffset = \"translate(0,\" + String(-((domain.length * props.rowHeight) / 2)) + \") \";\n      }\n\n      if (props.horizontalFloat) {\n        let rowPosition = 0,\n          horizontalPosition = 0;\n        groups.attr(\"transform\", function () {\n          // not affected by scroll position\n          const width = this.getBoundingClientRect().width;\n          if (horizontalPosition + width > props.floatWidth) {\n            rowPosition += props.rowHeight;\n            horizontalPosition = 0;\n          }\n          const translate = translateString(horizontalPosition, rowPosition);\n          horizontalPosition += width + props.floatPadding;\n          return verticalOffset + translate;\n        });\n      } else {\n        groups.attr(\"transform\", (d, i) => {\n          if (props.orientation === \"horizontal\") {\n            return (\n              verticalOffset +\n              \"translate(\" +\n              (i % cols) * props.columnWidth +\n              \",\" +\n              Math.floor(i / cols) * props.rowHeight +\n              \")\"\n            );\n          } else if (props.orientation === \"vertical\") {\n            return (\n              verticalOffset +\n              \"translate(\" +\n              Math.floor(i / rows) * props.columnWidth +\n              \",\" +\n              (i % rows) * props.rowHeight +\n              \")\"\n            );\n          }\n        });\n      }\n    });\n}\n","import { max, sum } from \"d3\";\nimport { scaleQual12, scaleQual6 } from \"../color\";\nimport {\n  DEFAULT_LEGEND_COLOR_ORDINAL_ROW_HEIGHT,\n  legendColorOrdinal,\n} from \"../legend/ordinalColorScale\";\nimport { measureAxisLabel, measureDimensions, measureLegendLabel } from \"../measure\";\n\nconst DEFAULT_COLUMN_COUNT = 2;\nconst LABEL_PADDING = 40;\n\n/**\n * colorLegendLayout\n *\n * Generate a color scale and a legend for the given labels. Compute how much\n * padding labels plus legend needs for use with `sszvis.bounds()`\n */\nexport function colorLegendLayout(\n  { legendLabels, axisLabels = [], slant = \"horizontal\" },\n  container\n) {\n  const containerWidth = measureDimensions(container).width;\n  const layout = colorLegendDimensions(legendLabels, containerWidth);\n  const scale =\n    legendLabels.length > 6\n      ? scaleQual12().domain(legendLabels)\n      : scaleQual6().domain(legendLabels);\n\n  const legend = legendColorOrdinal()\n    .scale(scale)\n    .horizontalFloat(layout.horizontalFloat)\n    .rows(layout.rows)\n    .columnWidth(layout.columnWidth)\n    .orientation(layout.orientation);\n\n  const axisLabelPadding = axisLabelHeight(slant, axisLabels);\n  const legendPadding = layout.rows * DEFAULT_LEGEND_COLOR_ORDINAL_ROW_HEIGHT;\n\n  return {\n    axisLabelPadding,\n    legendPadding,\n    bottomPadding: axisLabelPadding + legendPadding,\n    legendWidth: layout.legendWidth,\n    legend,\n    scale,\n  };\n}\n\n/**\n * colorLegendDimensions\n *\n * Compute all the dimensions necessary to generate an ordinal color legend.\n */\nexport function colorLegendDimensions(labels, containerWidth) {\n  const labelCount = labels.length;\n  const maxLabelWidth = max(labels, labelWidth);\n  const totalLabelsWidth = sum(labels, labelWidth);\n\n  // Use a single column for four or fewer items\n  const columns =\n    labelCount <= 4 ? 1 : numCols(containerWidth, maxLabelWidth, DEFAULT_COLUMN_COUNT);\n\n  // Use a horizontal layout if all labels fit on one line\n  const isHorizontal = columns === 1 && totalLabelsWidth <= containerWidth;\n\n  return {\n    columns,\n    rows: isHorizontal ? 1 : Math.ceil(labelCount / columns),\n    columnWidth: columns === 1 ? null : maxLabelWidth,\n    legendWidth: columns * maxLabelWidth,\n    horizontalFloat: isHorizontal,\n    orientation: isHorizontal ? null : \"vertical\",\n  };\n}\n\n// -----------------------------------------------------------------------------\n// Helpers\n\nfunction axisLabelHeight(slant, labels) {\n  switch (slant) {\n    case \"vertical\": {\n      return 40 + max(labels, measureAxisLabel);\n    }\n    case \"diagonal\": {\n      return 40 + Math.sqrt(2 * Math.pow(max(labels, measureAxisLabel) / 2, 2));\n    }\n    default: {\n      return 60;\n    }\n  }\n}\n\nfunction labelWidth(label) {\n  return measureLegendLabel(label) + LABEL_PADDING;\n}\n\nfunction numCols(totalWidth, columnWidth, num) {\n  if (num <= 1) return 1;\n  return columnWidth <= totalWidth / num ? num : numCols(totalWidth, columnWidth, num - 1);\n}\n","/**\n * @module sszvis/layout/sankey\n *\n * A module of helper functions for computing the data structure\n * and layout required by the sankey component.\n */\n\nimport { ascending, descending, sum, min, max } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport * as logger from \"../logger.js\";\n\nconst newLinkId = (function () {\n  let id = 0;\n  return function () {\n    return ++id;\n  };\n})();\n\n/**\n * sszvis.layout.sankey.prepareData\n *\n * Returns a data preparation component for the sankey data.\n *\n * Throughout the code, the rectangles representing entities are referred to as 'nodes', while\n * the chords connection them which represent flows among those entities are referred to as 'links'.\n *\n * @property {Array} apply                    Applies the preparation to a dataset of links. Expects a list of links, where the (unique) id\n *                                            of the source node can be accessed with the source function, and the (unique) id of the target\n *                                            can be accessed with the target function. Note that no source can have the same id as a target and\n *                                            vice versa. The nodes are defined implicitly by the fact that they have a link going to them or\n *                                            from them.\n * @property {Function} source                An accessor function for getting the source of a link\n * @property {Function} target                An accessor function for getting the target of a link\n * @property {Function} value                 An accessor function for getting the value of a link. Must be a number. The total value of a node\n *                                            is the greater of the sum of the values of its sourced links and its targeting links.\n * @property {} descendingSort                Toggles the use of a descending value sort for the nodes\n * @property {} ascendingSort                 Toggles the use of an ascending value sort for the nodes\n * @property {Array(Array)} idLists           An array of arrays of id values. For each array of ids, the sankey diagram will create a column\n *                                            of nodes. Each node should have links going to it or coming from it. All ids should be unique.\n *\n * @return {Function}                         The data preparation function. Can be called directly, or applied using the '.apply' function.\n *         When called, returns an object with data to be used in constructing the chart.\n *               @property {Array} nodes             An array of node data. Each one will become a rectangle in the sankey\n *               @property {Array} links             An array of link data. Each one will become a path in the sankey\n *               @property {Array} columnTotals      An array of column totals. Needed by the computeLayout function (and internally by the sankey component)\n *               @property {Array} columnLengths     An array of column lengths (number of nodes). Needed by the computeLayout function.\n */\nexport const prepareData = function () {\n  let mGetSource = fn.identity;\n  let mGetTarget = fn.identity;\n  let mGetValue = fn.identity;\n  let mColumnIds = [];\n\n  // Helper functions\n  const valueAcc = fn.prop(\"value\");\n  const byAscendingValue = function (a, b) {\n    return ascending(valueAcc(a), valueAcc(b));\n  };\n  const byDescendingValue = function (a, b) {\n    return descending(valueAcc(a), valueAcc(b));\n  };\n\n  let valueSortFunc = byDescendingValue;\n\n  const main = function (inputData) {\n    const columnIndex = mColumnIds.reduce((index, columnIdsList, colIndex) => {\n      for (const id of columnIdsList) {\n        if (index.has(id)) {\n          logger.warn(\n            \"Duplicate column member id passed to sszvis.layout.sankey.prepareData.column:\",\n            id,\n            \"The existing value will be overwritten\"\n          );\n        }\n\n        const item = {\n          id,\n          columnIndex: colIndex, // This is the index of the column containing this node\n          nodeIndex: 0, // This will be overwritten at a later stage with the index of this node within its column\n          value: 0,\n          valueOffset: 0,\n          linksFrom: [],\n          linksTo: [],\n        };\n\n        index.set(id, item);\n      }\n\n      return index;\n    }, new Map());\n\n    const listOfLinks = inputData.map((datum) => {\n      const srcId = mGetSource(datum);\n      const tgtId = mGetTarget(datum);\n      const value = +mGetValue(datum) || 0; // Cast this to number\n\n      const srcNode = columnIndex.get(srcId);\n      const tgtNode = columnIndex.get(tgtId);\n\n      if (!srcNode) {\n        logger.warn(\"Found invalid source column id:\", srcId);\n        return null;\n      }\n\n      if (!tgtNode) {\n        logger.warn(\"Found invalid target column id:\", tgtId);\n        return null;\n      }\n\n      const item = {\n        id: newLinkId(),\n        value,\n        src: srcNode,\n        srcOffset: 0,\n        tgt: tgtNode,\n        tgtOffset: 0,\n      };\n\n      srcNode.linksFrom.push(item);\n      tgtNode.linksTo.push(item);\n\n      return item;\n    });\n\n    // Extract the column nodes from the index\n    const listOfNodes = [...columnIndex.values()];\n\n    // Calculate an array of total values for each column\n    const columnTotals = listOfNodes.reduce(\n      (totals, node) => {\n        const fromTotal = sum(node.linksFrom, valueAcc);\n        const toTotal = sum(node.linksTo, valueAcc);\n\n        // For correct visual display, the node's value is the max of the from and to links\n        node.value = Math.max(0, fromTotal, toTotal);\n\n        totals[node.columnIndex] += node.value;\n\n        return totals;\n      },\n      fn.filledArray(mColumnIds.length, 0)\n    );\n\n    // An array with the number of nodes in each column\n    const columnLengths = mColumnIds.map((colIds) => colIds.length);\n\n    // Sort the column nodes\n    // (note, this sorts all nodes for all columns in the same array)\n    listOfNodes.sort(valueSortFunc);\n\n    // Sort the links in descending order of value. This means smaller links will render\n    // on top of larger links.\n    // (note, this sorts all links for all columns in the same array)\n    listOfLinks.sort(byDescendingValue);\n\n    // Assign the valueOffset and nodeIndex properties\n    // Here, columnData[0] is an array adding up value totals\n    // and columnData[1] is an array adding up the number of nodes in each column\n    // Both are used to assign cumulative properties to the nodes of each column\n    listOfNodes.reduce(\n      (columnData, node) => {\n        // Assigns valueOffset and nodeIndex\n        node.valueOffset = columnData[0][node.columnIndex];\n        node.nodeIndex = columnData[1][node.columnIndex];\n\n        columnData[0][node.columnIndex] += node.value;\n        columnData[1][node.columnIndex] += 1;\n\n        return columnData;\n      },\n      [fn.filledArray(mColumnIds.length, 0), fn.filledArray(mColumnIds.length, 0)]\n    );\n\n    // Once the order of nodes is calculated, we need to sort the links going into the\n    // nodes and the links coming out of the nodes according to the ordering of the nodes\n    // they come from or go to. This creates a visually appealing layout which minimizes\n    // the number of link crossings\n    for (const node of listOfNodes) {\n      node.linksFrom.sort((linkA, linkB) => linkA.tgt.nodeIndex - linkB.tgt.nodeIndex);\n\n      node.linksTo.sort((linkA, linkB) => linkA.src.nodeIndex - linkB.src.nodeIndex);\n\n      // Stack the links vertically within the node according to their order\n      node.linksFrom.reduce((sumValue, link) => {\n        link.srcOffset = sumValue;\n        return sumValue + valueAcc(link);\n      }, 0);\n\n      node.linksTo.reduce((sumValue, link) => {\n        link.tgtOffset = sumValue;\n        return sumValue + valueAcc(link);\n      }, 0);\n    }\n\n    return {\n      nodes: listOfNodes,\n      links: listOfLinks,\n      columnTotals,\n      columnLengths,\n    };\n  };\n\n  main.apply = function (data) {\n    return main(data);\n  };\n\n  main.source = function (func) {\n    mGetSource = func;\n    return main;\n  };\n\n  main.target = function (func) {\n    mGetTarget = func;\n    return main;\n  };\n\n  main.value = function (func) {\n    mGetValue = func;\n    return main;\n  };\n\n  main.descendingSort = function () {\n    valueSortFunc = byDescendingValue;\n    return main;\n  };\n\n  main.ascendingSort = function () {\n    valueSortFunc = byAscendingValue;\n    return main;\n  };\n\n  main.idLists = function (idLists) {\n    mColumnIds = idLists;\n    return main;\n  };\n\n  return main;\n};\n\n/**\n * sszvis.layout.sankey.computeLayout\n *\n * Automatically computes visual display properties needed by the sankey component,\n * including padding between each node, paddings for the tops of columns to vertically center\n * them, the domain and range of values in the nodes (used for scaling the node rectangles),\n * the node thickness, and the domain and range of the column positioning scale.\n *\n * @param  {Array} columnLengths      An array of lengths (number of nodes) of each column in the diagram.\n *                                    Used to compute optimal padding between nodes. Provided by the layout.sankey.prepareData function\n * @param  {Array} columnTotals       An array of column totals (total of all values of all ndoes). Provided by the\n * @param  {Number} columnHeight      The vertical height available for the columns. The tallest column will be this height. (Usually bounds.innerHeight)\n * @param  {Number} columnWidth       The width of all columns. The sankey chart will be this width. (Usually bounds.innerWidth)\n * @return {Object}                   An object of configuration parameters to be passed to the sankey component\n *         @property {Number} nodePadding         The amount of padding to add between nodes. pass to component.sankey.nodePadding\n *         @property {Array} columnPaddings       An array of padding values for each column. Index into this with the columnIndex and return to component.sankey.columnPadding\n *         @property {Array} valueDomain          The domain for the node size scale. Use to configure a linear scale for component.sankey.sizeScale\n *         @property {Array} valueRange           The range for the node size scale. Use to configure a linear scale for component.sankey.sizeScale\n *         @property {Number} nodeThickness       The thickness of nodes. Pass to component.sankey.nodeThickness\n *         @property {Array} columnDomain         The domain for the coumn position scale. use to configure a linear scale for component.sankey.columnPosition\n *         @property {Array} columnRange          The range for the coumn position scale. use to configure a linear scale for component.sankey.columnPosition\n */\nexport const computeLayout = function (columnLengths, columnTotals, columnHeight, columnWidth) {\n  // Calculate appropriate scale and padding values (in pixels)\n  const padSpaceRatio = 0.15;\n  const padMin = 12;\n  const padMax = 50;\n  const minDisplayPixels = 1; // Minimum number of pixels used for display area\n\n  // Compute the padding value (in pixels) for each column, then take the minimum value\n  const computedPixPadding = min(\n    columnLengths.map((colLength) => {\n      // Any given column's padding is := (1 / 4 of total extent) / (number of padding spaces)\n      const colPadding = (columnHeight * padSpaceRatio) / (colLength - 1);\n      // Limit by minimum and maximum pixel padding values\n      return Math.max(padMin, Math.min(padMax, colPadding));\n    })\n  );\n\n  // Given the computed padding value, compute each column's resulting \"pixels per unit\"\n  // This is the number of remaining pixels available to display the column's total units,\n  // after padding pixels have been subtracted. Then take the minimum value of that.\n  const pixPerUnit = min(\n    columnLengths.map((colLength, colIndex) => {\n      // The non-padding pixels must have at least minDisplayPixels\n      const nonPaddingPixels = Math.max(\n        minDisplayPixels,\n        columnHeight - (colLength - 1) * computedPixPadding\n      );\n      return nonPaddingPixels / columnTotals[colIndex];\n    })\n  );\n\n  // The padding between bars, in bar value units\n  const valuePadding = computedPixPadding / pixPerUnit;\n  // The padding between bars, in pixels\n  const nodePadding = computedPixPadding;\n\n  // The maximum total value of any column\n  const maxTotal = max(columnTotals);\n\n  // Compute y-padding required to vertically center each column (in pixels)\n  const paddedHeights = columnLengths.map(\n    (colLength, colIndex) => columnTotals[colIndex] * pixPerUnit + (colLength - 1) * nodePadding\n  );\n  const maxPaddedHeight = max(paddedHeights);\n  const columnPaddings = columnLengths.map(\n    (colLength, colIndex) => (maxPaddedHeight - paddedHeights[colIndex]) / 2\n  );\n\n  // The domain of the size scale\n  const valueDomain = [0, maxTotal];\n  // The range of the size scale\n  const valueRange = [0, maxTotal * pixPerUnit];\n\n  // Calculate column (or row, as the case may be) positioning values\n  const nodeThickness = 20;\n  const numColumns = columnLengths.length;\n  const columnXMultiplier = (columnWidth - nodeThickness) / (numColumns - 1);\n  const columnDomain = [0, 1];\n  const columnRange = [0, columnXMultiplier];\n\n  return {\n    valuePadding,\n    nodePadding,\n    columnPaddings,\n    valueDomain,\n    valueRange,\n    nodeThickness,\n    columnDomain,\n    columnRange,\n  };\n};\n","/**\n * @module sszvis/layout/sunburst\n *\n * Helper functions for transforming your data to match the format required by the sunburst chart.\n */\n\nimport { hierarchy, partition, min, max, rollup } from \"d3\";\n\nimport * as fn from \"../fn.js\";\n\nfunction unwrapNested(roll) {\n  return Array.from(roll, ([key, values]) => ({\n    key,\n    values: values.size > 0 ? unwrapNested(values) : undefined,\n    value: values.size > 0 ? undefined : values,\n  }));\n}\n\nlet sortFn = function () {\n  return 0;\n};\n\n/**\n * sszvis.layout.sunburst.prepareData\n *\n * Creates a data preparation layout, with an API that works similarly to d3's configurable layouts.\n *\n * @property {Array} calculate      Accepts an array of data, and applies this layout to that data. Returns the formatted dataset,\n *                                  ready to be used as data for the sunburst component.\n * @property {Function} layer       Accepts a function, which should be a key function, used to create a layer for the data.\n *                                  The key function is applied to each datum, and the return value groups that datum within a\n *                                  layer of the sunburst chart. The exact behavior depends on the order in which layers are specified.\n *                                  The first specified layer will be the innermost one of the sunburst, with subsequent layers adding\n *                                  around the sunburst. Data are grouped according to the first layer, then the second layer, then the third, etc.\n *                                  This uses d3.nest under the hood, and applys the key function as a d3.nest().key, so it works like that.\n * @property {Function} value       The function which retrieves the value of each datum. This is required in order to calculate the size of\n *                                  the ring segment for each datum.\n * @property {Function} sort        Provide a sorting function for sibling nodes of the sunburst. The d3.partition layout probably uses a\n *                                  javascript object internally for some bookkeeping. At the moment, not all browsers handle key ordering in\n *                                  objects similarly. This sorting function is used to sort the output values of the d3.partition layout, according\n *                                  to user wishes. It receives two node values (which are created by d3), which should have at least a \"key\" property\n *                                  (corresponding to the layer key), and a \"value\" property (corresponding to the value amount of the slice).\n *                                  Otherwise, it behaves like a normal javascript array sorting function. The default value attempts to preserve the\n *                                  existing sort order of the data.\n *\n * @return {Function}               The layout function. Can be called directly or you can use '.calculate(dataset)'.\n */\nexport const prepareData = function () {\n  const layers = [];\n  let valueAcc = fn.identity;\n  // Sibling nodes of the partition layout are sorted according to this sort function.\n  // The default value for this component tries to preserve the order of the input data.\n  // However, input data order preservation is not guaranteed, because of an implementation\n  // detail of d3.partition, probably having to do with the way that each browser can\n  // implement its own key ordering for javascript objects.\n\n  function main(data) {\n    const nested = unwrapNested(rollup(data, fn.first, ...layers));\n\n    const root = hierarchy({ isSunburstRoot: true, values: nested }, fn.prop(\"values\"))\n      .sort(sortFn)\n      .sum((x) => (x.value ? valueAcc(x.value) : 0));\n\n    partition()(root);\n\n    function flatten(node) {\n      return Array.prototype.concat.apply([node], (node.children || []).map(flatten));\n    }\n\n    // Remove the root element from the data (but it still exists in memory so long as the data is alive)\n    return flatten(root).filter((d) => !d.data.isSunburstRoot);\n  }\n\n  main.calculate = function (data) {\n    return main(data);\n  };\n\n  main.layer = function (keyFunc) {\n    layers.push(keyFunc);\n    return main;\n  };\n\n  main.value = function (accfn) {\n    valueAcc = accfn;\n    return main;\n  };\n\n  main.sort = function (sortFunc) {\n    sortFn = sortFunc;\n    return main;\n  };\n\n  return main;\n};\n\nexport const MAX_SUNBURST_RING_WIDTH = 60;\nconst MAX_RW = MAX_SUNBURST_RING_WIDTH;\n\nexport const MIN_SUNBURST_RING_WIDTH = 10;\nconst MIN_RW = MIN_SUNBURST_RING_WIDTH;\n\n/**\n * sszvis.layout.sunburst.computeLayout\n *\n * Computes layout parameters for good visual display of the sunburst chart.\n *\n * @param  {Number} numLayers          The number of layers in the sunburst chart.\n * @param  {Number} chartWidth         The total width available for displaying the sunburst chart.\n * @return {Object}                    Some parameters for the sunburst chart:\n *       @property {Number} centerRadius      The central radius of the chart (used by the sunburst component)\n *       @property {Number} numLayers         The number of layers in the chart (used by the sunburst component)\n *       @property {Number} ringWidth         The width of a single ring in the chart (used by the sunburst component)\n */\nexport const computeLayout = function (numLayers, chartWidth) {\n  // Diameter of the center circle is one-third the width\n  const halfWidth = chartWidth / 2;\n  const centerRadius = halfWidth / 3;\n  const ringWidth = Math.max(MIN_RW, Math.min(MAX_RW, (halfWidth - centerRadius) / numLayers));\n\n  return {\n    centerRadius,\n    numLayers,\n    ringWidth,\n  };\n};\n\n/**\n * sszvis.layout.sunburst.getRadiusExtent\n * @param  {Array} formattedData      An array of data to inspect for the extent of the radius scale\n *\n * @return {Array}                    The minimum and maximum radius values (in d3's partition layout's terms). Use this as\n *                                    The domain of the radius scale you use to configure the sunburst chart. This is a convenience\n *                                    function which abstracts away the way d3 stores positions within the partition layout used\n *                                    by the sunburst chart.\n */\nexport const getRadiusExtent = function (formattedData) {\n  return [min(formattedData, (d) => d.y0), max(formattedData, (d) => d.y1)];\n};\n","/*\n * A collection of utilities used by the map modules\n *\n * @module sszvis/map/utils\n */\n\nimport { geoMercator, geoPath, geoCentroid } from \"d3\";\nimport { memoize } from \"../fn.js\";\n\nexport const STADT_KREISE_KEY = \"zurichStadtKreise\";\nexport const STATISTISCHE_QUARTIERE_KEY = \"zurichStatistischeQuartiere\";\nexport const STATISTISCHE_ZONEN_KEY = \"zurichStatistischeZonen\";\nexport const WAHL_KREISE_KEY = \"zurichWahlKreise\";\nexport const AGGLOMERATION_2012_KEY = \"zurichAgglomeration2012\";\nexport const SWITZERLAND_KEY = \"switzerland\";\n\n/**\n * swissMapProjection\n *\n * A function for creating d3 projection functions, customized for the dimensions of the map you need.\n * Because this projection generator involves calculating the boundary of the features that will be\n * projected, the result of these calculations is cached internally. Hence the featureBoundsCacheKey.\n * You don't need to worry about this - mostly it's the map module components which use this function.\n *\n * @param  {Number} width                           The width of the projection destination space.\n * @param  {Number} height                          The height of the projection destination space.\n * @param  {Object} featureCollection               The feature collection that will be projected by the returned function. Needed to calculated a good size.\n * @param  {String} featureBoundsCacheKey           Used internally, this is a key for the cache for the expensive part of this computation.\n * @return {Function}                               The projection function.\n */\nexport const swissMapProjection = memoize(\n  (width, height, featureCollection) => geoMercator().fitSize([width, height], featureCollection),\n  // Memoize resolver\n  (width, height, _, featureBoundsCacheKey) =>\n    \"\" + width + \",\" + height + \",\" + featureBoundsCacheKey\n);\n\n/**\n * This is a special d3.geoPath generator function tailored for rendering maps of\n * Switzerland. The values are chosen specifically to optimize path generation for\n * Swiss map regions and is not necessarily optimal for displaying other areas of the globe.\n *\n * @param  {number} width                     The width of the available map space\n * @param  {number} height                    The height of the available map space\n * @param  {GeoJson} featureCollection        The collection of features to be displayed in the map space\n * @param  {string} [featureBoundsCacheKey]   A string key to use to cache the result of the bounds calculation, which is expensive.\n *                                            This key should be the same every time the same featureCollection object\n *                                            is passed to this function. If the featureCollection is different, use a different\n *                                            cache key. If provided, this can enable large performance improvements in map rendering.\n * @return {d3.geoPath}                       A path generator function. This function takes a geojson datum as argument\n *                                            and returns an svg path string which represents that geojson, projected using\n *                                            a map projection optimal for Swiss areas.\n */\nexport const swissMapPath = function (width, height, featureCollection, featureBoundsCacheKey) {\n  return geoPath().projection(\n    swissMapProjection(width, height, featureCollection, featureBoundsCacheKey)\n  );\n};\n\n/**\n * Use this function to calcualate the length in pixels of a distance in meters across the surface of the earth\n * The earth's radius is not constant, so this function uses an approximation for calculating the degree angle of\n * a distance in meters.\n *\n * @param {function} projection     You need to provide a projection function for calculating pixel values from decimal degree\n *                                  coordinates. This function should accept values as [lon, lat] array pairs (like d3's projection functions).\n * @param {array} centerPoint       You need to provide a center point. This point is used as the center of a hypothetical square\n *                                  with side lengths equal to the meter distance to be measured. The center point is required\n *                                  because the pixel size of a given degree distance will be different if that square is located\n *                                  at the equator or at one of the poles. This value should be specified as a [lon, lat] array pair.\n * @param {number} meterDistance    The distance (in meters) for which you want the pixel value\n */\nexport const pixelsFromGeoDistance = function (projection, centerPoint, meterDistance) {\n  // This radius (in meters) is halfway between the radius of the earth at the equator (6378200m) and that at its poles (6356750m).\n  // I figure it's an appropriate approximation for Switzerland, which is at roughly 45deg latitude.\n  const APPROX_EARTH_RADIUS = 6_367_475;\n  const APPROX_EARTH_CIRCUMFERENCE = Math.PI * 2 * APPROX_EARTH_RADIUS;\n  // Compute the size of the angle made by the meter distance\n  const degrees = (meterDistance / APPROX_EARTH_CIRCUMFERENCE) * 360;\n  // Construct a square, centered at centerPoint, with sides that span that number of degrees\n  const halfDegrees = degrees / 2;\n  const bounds = [\n    [centerPoint[0] - halfDegrees, centerPoint[1] - halfDegrees],\n    [centerPoint[0] + halfDegrees, centerPoint[1] + halfDegrees],\n  ];\n\n  // Project those bounds to pixel coordinates using the provided map projection\n  const projBounds = bounds.map(projection);\n  // Depending on the rotation of the map, the sides of the box are not always positive quantities\n  // For example, on a north-is-up map, the pixel y-scale is inverted, so higher latitude degree\n  // values are lower pixel y-values. On a south-is-up map, the opposite is true.\n  const projXDist = Math.abs(projBounds[1][0] - projBounds[0][0]);\n  const projYDist = Math.abs(projBounds[1][1] - projBounds[0][1]);\n  return (projXDist + projYDist) / 2;\n};\n\nexport const GEO_KEY_DEFAULT = \"geoId\";\n\n/**\n * prepareMergedData\n *\n * Merges a dataset with a geojson object by matching elements in the dataset to elements in the geojson.\n * it expects a keyname to be given, which is the key in each data object which has the id of the geojson\n * element to which that data object should be matched. Expects an array of data objects, and a geojson object\n * which has a features array. Each feature is mapped to one data object.\n *\n * @param  {Array} dataset           The array of input data to match\n * @param  {Object} geoJson          The geojson object. This function will attempt to match each geojson feature to a data object\n * @param  {String} keyName          The name of the property on each data object which will be matched with each geojson id.\n * @return {Array}                   An array of objects (one for each element of the geojson's features). Each should have a\n *                                   geoJson property which is the feature, and a datum property which is the matched datum.\n */\nexport const prepareMergedGeoData = function (dataset, geoJson, keyName) {\n  keyName || (keyName = GEO_KEY_DEFAULT);\n\n  // group the input data by map entity id\n  const groupedInputData = Array.isArray(dataset)\n    ? dataset.reduce((m, v) => {\n        m[v[keyName]] = v;\n        return m;\n      }, {})\n    : {};\n\n  // merge the map features and the input data into new objects that include both\n  return geoJson.features.map((feature) => ({\n    geoJson: feature,\n    datum: groupedInputData[feature.id],\n  }));\n};\n\n/**\n * getGeoJsonCenter\n *\n * Gets the geographic centroid of a geojson feature object. Caches the result of the calculation\n * on the object as an optimization (note that this is a coordinate position and is independent\n * of the map projection). If the geoJson object's properties contain a 'center' property, that\n * is expected to be a string of the form \"longitude,latitude\" which will be parsed into a [lon, lat]\n * pair expected by d3's projection functions. These strings can be added to the properties array\n * using the topojson command line tool's -e option (see the Makefile rule for the zurich statistical\n * quarters map for an example of this use).\n *\n * @param  {Object} geoJson                 The geoJson object for which you want the center.\n * @return {Array[float, float]}            The geographical coordinates (in the form [lon, lat]) of the centroid\n *                                          (or user-specified center) of the object.\n */\nexport const getGeoJsonCenter = function (geoJson) {\n  if (!geoJson.properties.cachedCenter) {\n    const setCenter = geoJson.properties.center;\n    geoJson.properties.cachedCenter = setCenter\n      ? setCenter.split(\",\").map(Number.parseFloat)\n      : geoCentroid(geoJson);\n  }\n\n  return geoJson.properties.cachedCenter;\n};\n\n/**\n * widthAdaptiveMapPathStroke\n *\n * A little \"magic\" function for automatically calculating map stroke sizes based on\n * the width of the container they're in. Used for responsive designs.\n *\n * @param  {number} width    The width of the container holding the map.\n * @return {number}          The stroke width that the map elements should have.\n */\nexport const widthAdaptiveMapPathStroke = function (width) {\n  return Math.min(Math.max(0.8, width / 400), 1.1);\n};\n","/**\n * @module sszvis/map/anchoredCircles\n *\n * Creates circles which are anchored to the positions of map elements. Used in the \"bubble chart\".\n * You will usually want to pass this component, configured, as the .anchoredShape property of a base\n * map component.\n *\n * @property {Object} mergedData                    Used internally by the base map component which renders this. Is a merged dataset used to render the shapes\n * @property {Function} mapPath                     Used internally by the base map component which renders this. Is a path generation function which provides projections.\n * @property {Number, Function} radius              The radius of the circles. Can be a function which accepts a datum and returns a radius value.\n * @property {Color, Function} fill                 The fill color of the circles. Can be a function\n * @property {Color, Function} strokeColor          The stroke color of the circles. Can be a function\n * @property {Boolean} transition                   Whether or not to transition the sizes of the circles when data changes. Default true\n *\n * @return {sszvis.component}\n */\n\nimport { select, dispatch } from \"d3\";\n\nimport * as fn from \"../../fn.js\";\nimport { defaultTransition } from \"../../transition.js\";\nimport { getGeoJsonCenter } from \"../mapUtils.js\";\nimport translateString from \"../../svgUtils/translateString.js\";\nimport { component } from \"../../d3-component.js\";\n\nconst datumAcc = fn.prop(\"datum\");\n\nexport default function () {\n  const event = dispatch(\"over\", \"out\", \"click\");\n\n  const anchoredCirclesComponent = component()\n    .prop(\"mergedData\")\n    .prop(\"mapPath\")\n    .prop(\"radius\", fn.functor)\n    .prop(\"fill\", fn.functor)\n    .prop(\"strokeColor\", fn.functor)\n    .strokeColor(\"#ffffff\")\n    .prop(\"strokeWidth\", fn.functor)\n    .strokeWidth(1)\n    .prop(\"transition\")\n    .transition(true)\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      const radiusAcc = fn.compose(props.radius, datumAcc);\n\n      const anchoredCircles = selection\n        .selectGroup(\"anchoredCircles\")\n        .selectAll(\".sszvis-anchored-circle\")\n        .data(props.mergedData, (d) => d.geoJson.id)\n        .join(\"circle\")\n        .attr(\"class\", \"sszvis-anchored-circle sszvis-anchored-circle--entering\")\n        .attr(\"r\", radiusAcc)\n        .on(\"mouseover\", function (d) {\n          event.call(\"over\", this, d.datum);\n        })\n        .on(\"mouseout\", function (d) {\n          event.call(\"out\", this, d.datum);\n        })\n        .on(\"click\", function (d) {\n          event.call(\"click\", this, d.datum);\n        })\n        .attr(\"transform\", (d) => {\n          const position = props.mapPath.projection()(getGeoJsonCenter(d.geoJson));\n          return translateString(position[0], position[1]);\n        })\n        .style(\"fill\", (d) => props.fill(d.datum))\n        .style(\"stroke\", (d) => props.strokeColor(d.datum))\n        .style(\"stroke-width\", (d) => props.strokeWidth(d.datum))\n        .sort((a, b) => props.radius(b.datum) - props.radius(a.datum));\n\n      // Remove the --entering modifier from the updating circles\n      anchoredCircles.classed(\"sszvis-anchored-circle--entering\", false);\n\n      if (props.transition) {\n        const t = defaultTransition();\n        anchoredCircles.exit().transition(t).attr(\"r\", 0).remove();\n\n        anchoredCircles.transition(t).attr(\"r\", radiusAcc);\n      } else {\n        anchoredCircles.exit().remove();\n        anchoredCircles.attr(\"r\", radiusAcc);\n      }\n    });\n\n  anchoredCirclesComponent.on = function () {\n    const value = event.on.apply(event, arguments);\n    return value === event ? anchoredCirclesComponent : value;\n  };\n\n  return anchoredCirclesComponent;\n}\n","/**\n * base renderer component\n *\n * @module sszvis/map/renderer/base\n *\n * A component used internally for rendering the base layer of maps.\n * These map entities have a color fill, which is possibly a pattern that represents\n * missing values. They are also event targets. If your map has nothing else, it should have a\n * base layer.\n *\n * @property {GeoJson} geoJson                        The GeoJson object to be rendered by this map layer.\n * @property {d3.geo.path} mapPath                    A path-generator function used to create the path data string of the provided GeoJson.\n * @property {Object} mergedData                      This should be an array of merged data objects. Each object should have a datum property (the datum for\n *                                                    the map entity) and a geoJson property (the geoJson shape for the map entity). This component renders the\n *                                                    geoJson data and uses the datum to get properties of the shape, like fill color and tooltip data.\n * @property {Boolean, Function} defined              A predicate function used to determine whether a datum has a defined value.\n *                                                    Map entities with data values that fail this predicate test will display the missing value texture.\n * @property {String, Function} fill                  A string or function for the fill of the map entities\n * @property {Boolean} transitionColor                Whether or not to transition the fill color of the map entities. (default: true)\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../../fn.js\";\nimport ensureDefsElement from \"../../svgUtils/ensureDefsElement.js\";\nimport { mapMissingValuePattern } from \"../../patterns.js\";\nimport { slowTransition } from \"../../transition.js\";\nimport tooltipAnchor from \"../../annotation/tooltipAnchor.js\";\nimport { getGeoJsonCenter } from \"../mapUtils.js\";\nimport { component } from \"../../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"mergedData\")\n    .prop(\"geoJson\")\n    .prop(\"mapPath\")\n    .prop(\"defined\", fn.functor)\n    .defined(true) // a predicate function to determine whether a datum has a defined value\n    .prop(\"fill\", fn.functor)\n    .fill(() => \"black\") // a function for the entity fill color. default is black\n    .prop(\"transitionColor\")\n    .transitionColor(true)\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      // render the missing value pattern\n      ensureDefsElement(selection, \"pattern\", \"missing-pattern\").call(mapMissingValuePattern);\n\n      // map fill function - returns the missing value pattern if the datum doesn't exist or fails the props.defined test\n      function getMapFill(d) {\n        return props.defined(d.datum) ? props.fill(d.datum) : \"url(#missing-pattern)\";\n      }\n\n      const mapAreas = selection\n        .selectAll(\".sszvis-map__area\")\n        .data(props.mergedData)\n        .join(\"path\")\n        .classed(\"sszvis-map__area\", true)\n        .classed(\"sszvis-map__area--entering\", true)\n        .attr(\"data-event-target\", \"\")\n        .attr(\"fill\", getMapFill)\n        .classed(\"sszvis-map__area--entering\", false);\n\n      selection.selectAll(\".sszvis-map__area--undefined\").attr(\"fill\", getMapFill);\n\n      // change the fill if necessary\n      mapAreas\n        .classed(\n          \"sszvis-map__area--undefined\",\n          (d) => !fn.defined(d.datum) || !props.defined(d.datum)\n        )\n        .attr(\"d\", (d) => props.mapPath(d.geoJson));\n\n      if (props.transitionColor) {\n        mapAreas.transition().call(slowTransition).attr(\"fill\", getMapFill);\n      } else {\n        mapAreas.attr(\"fill\", getMapFill);\n      }\n\n      // the tooltip anchor generator\n      const ta = tooltipAnchor().position((d) =>\n        props.mapPath.projection()(getGeoJsonCenter(d.geoJson))\n      );\n\n      const tooltipGroup = selection.selectGroup(\"tooltipAnchors\").datum(props.mergedData);\n\n      // attach tooltip anchors\n      tooltipGroup.call(ta);\n    });\n}\n","/**\n * highlight renderer component\n *\n * @module sszvis/map/renderer/highlight\n *\n * A component used internally for rendering the highlight layer of maps.\n * The highlight layer accepts an array of data values to highlight, and renders\n * The map entities associated with those data values using a special stroke.\n *\n * @property {GeoJson} geoJson                        The GeoJson object to be rendered by this map layer.\n * @property {d3.geo.path} mapPath                    A path-generator function used to create the path data string of the provided GeoJson.\n * @property {String} keyName                         The data object key which will return a map entity id. Default 'geoId'.\n * @property {Array} highlight                        An array of data elements to highlight. The corresponding map entities are highlighted.\n * @property {String, Function} highlightStroke       A function for the stroke of the highlighted entities\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../../fn.js\";\nimport { GEO_KEY_DEFAULT } from \"../mapUtils.js\";\nimport { component } from \"../../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"keyName\")\n    .keyName(GEO_KEY_DEFAULT) // the name of the data key that identifies which map entity it belongs to\n    .prop(\"geoJson\")\n    .prop(\"mapPath\")\n    .prop(\"highlight\")\n    .highlight([]) // an array of data values to highlight\n    .prop(\"highlightStroke\", fn.functor)\n    .highlightStroke(\"white\") // a function for highlighted entity stroke colors (default: white)\n    .prop(\"highlightStrokeWidth\", fn.functor)\n    .highlightStrokeWidth(2)\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      const highlightBorders = selection.selectAll(\".sszvis-map__highlight\");\n\n      if (props.highlight.length === 0) {\n        highlightBorders.remove();\n        return true; // no highlight, no worry\n      }\n\n      const groupedMapData = props.geoJson.features.reduce((m, feature) => {\n        m[feature.id] = feature;\n        return m;\n      }, {});\n\n      // merge the highlight data\n      const mergedHighlight = props.highlight.reduce((m, v) => {\n        if (v) {\n          m.push({\n            geoJson: groupedMapData[v[props.keyName]],\n            datum: v,\n          });\n        }\n        return m;\n      }, []);\n\n      highlightBorders\n        .data(mergedHighlight)\n        .join(\"path\")\n        .classed(\"sszvis-map__highlight\", true)\n        .attr(\"d\", (d) => props.mapPath(d.geoJson))\n        .style(\"stroke\", (d) => props.highlightStroke(d.datum))\n        .style(\"stroke-width\", (d) => props.highlightStrokeWidth(d.datum));\n    });\n}\n","/**\n * mesh renderer component\n *\n * @module sszvis/map/renderer/mesh\n *\n * A component used internally for rendering the borders of all map entities as a single mesh.\n * This component expects a GeoJson object which is a single polyline for the entire mesh of all borders.\n * All borders will therefore be rendered as one continuous object, which is faster, more memory-efficient,\n * and prevents overlapping borders from creating strange rendering effects. The downside is that the entire\n * line must have a single set of styles which all borders share. To highlight individual borders, use the highlight renderer.\n *\n * @property {GeoJson} geoJson                        The GeoJson object to be rendered by this map layer.\n * @property {d3.geo.path} mapPath                    A path-generator function used to create the path data string of the provided GeoJson.\n * @property {string, function} borderColor           The color of the border path stroke. Default is white\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\nimport { component } from \"../../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"geoJson\")\n    .prop(\"mapPath\")\n    .prop(\"borderColor\")\n    .borderColor(\"white\") // A function or string for the color of all borders. Note: all borders have the same color\n    .prop(\"strokeWidth\")\n    .strokeWidth(1.25)\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      // add the map borders. These are rendered as one single path element\n      const meshLine = selection\n        .selectAll(\".sszvis-map__border\")\n        .data([props.geoJson])\n        .join(\"path\")\n        .classed(\"sszvis-map__border\", true);\n\n      meshLine\n        .attr(\"d\", props.mapPath)\n        .style(\"stroke\", props.borderColor)\n        .style(\"stroke-width\", props.strokeWidth);\n    });\n}\n","/**\n * patternedlakeoverlay component\n *\n * @module sszvis/map/renderer/patternedlakeoverlay\n *\n * A component used internally for rendering Lake Zurich, and the borders of map entities which\n * lie above Lake Zurich.\n *\n * @property {d3.geo.path} mapPath      A path-generator function used to create the path data string of the provided GeoJson.\n * @property {GeoJson} lakeFeature      A GeoJson object which provides data for the outline shape of Lake Zurich. This shape will\n *                                      be filled with a special texture fill and masked with an alpha gradient fade.\n * @property {GeoJson} lakeBounds       A GeoJson object which provides data for the shape of map entity borders which lie over the\n *                                      lake. These borders will be drawn over the lake shape, as grey dotted lines.\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\n\nimport ensureDefsElement from \"../../svgUtils/ensureDefsElement.js\";\nimport { mapLakePattern, mapLakeFadeGradient, mapLakeGradientMask } from \"../../patterns.js\";\nimport { component } from \"../../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"mapPath\")\n    .prop(\"lakeFeature\")\n    .prop(\"lakeBounds\")\n    .prop(\"lakePathColor\")\n    .prop(\"fadeOut\")\n    .fadeOut(true)\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      // the lake texture\n      ensureDefsElement(selection, \"pattern\", \"lake-pattern\").call(mapLakePattern);\n\n      if (props.fadeOut) {\n        // the fade gradient\n        ensureDefsElement(selection, \"linearGradient\", \"lake-fade-gradient\").call(\n          mapLakeFadeGradient\n        );\n\n        // the mask, which uses the fade gradient\n        ensureDefsElement(selection, \"mask\", \"lake-fade-mask\").call(mapLakeGradientMask);\n      }\n\n      // generate the Lake Zurich path\n      const zurichSee = selection\n        .selectAll(\".sszvis-map__lakezurich\")\n        .data([props.lakeFeature])\n        .join(\"path\")\n        .classed(\"sszvis-map__lakezurich\", true)\n        .attr(\"d\", props.mapPath)\n        .attr(\"fill\", \"url(#lake-pattern)\");\n\n      if (props.fadeOut) {\n        // this mask applies the fade effect\n        zurichSee.attr(\"mask\", \"url(#lake-fade-mask)\");\n      }\n\n      // add a path for the boundaries of map entities which extend over the lake.\n      // This path is rendered as a dotted line over the lake shape\n      const lakePath = selection\n        .selectAll(\".sszvis-map__lakepath\")\n        .data([props.lakeBounds])\n        .join(\"path\")\n        .classed(\"sszvis-map__lakepath\", true)\n        .attr(\"d\", props.mapPath);\n\n      if (props.lakePathColor) {\n        lakePath.style(\"stroke\", props.lakePathColor);\n      }\n    });\n}\n","/**\n * Parsing functions\n *\n * @module sszvis/parse\n */\n\nimport { timeFormatLocale } from \"d3\";\nimport { locale } from \"./locale.js\";\n\nconst timeParse = timeFormatLocale(locale).parse;\n\n/**\n * Parse Swiss date strings\n * @param  {String} d A Swiss date string, e.g. 17.08.2014\n * @return {Date}\n */\nconst dateParser = timeParse(\"%d.%m.%Y\");\nexport const parseDate = function (d) {\n  return dateParser(d);\n};\n\n/**\n * Parse year values\n * @param  {string} d   A string which should be parsed as if it were a year, like \"2014\"\n * @return {Date}       A javascript date object for the first time in the given year\n */\nconst yearParser = timeParse(\"%Y\");\nexport const parseYear = function (d) {\n  return yearParser(d);\n};\n\n/**\n * Parse untyped input\n * @param  {String} d A value that could be a number\n * @return {Number}   If d is not a number, NaN is returned\n */\nexport const parseNumber = function (d) {\n  return d.trim() === \"\" ? Number.NaN : +d;\n};\n","/**\n * ModularText component\n *\n * Create structured text with formatting and newlines. Use either the HTML or\n * SVG variant, depending on the output you expect.\n *\n * @module sszvis/svgUtils/modularText/html\n * @module sszvis/svgUtils/modularText/svg\n *\n * @example HTML\n * var fmtHtml = sszvis.svgUtils.modularText.html()\n *   .plain('Artist:')\n *   .plain(function(d) { return d.name; })\n *   .newline()\n *   .bold(function(d) { return d.age; })\n *   .italic('years old');\n * fmtHtml({name: 'Patti', age: 67});\n * //=> \"Artist: Patti<br/><strong>67</strong> <em>years old</em>\"\n *\n * @example SVG\n * var fmtSvg = sszvis.svgUtils.modularText.svg()\n *   .bold(function(d) { return d.items; })\n *   .plain('items');\n * fmtSvg({items: 30});\n * //=> \"<tspan x=\"0\" dy=\"0\"><tspan style=\"font-weight:bold\">30</tspan> <tspan>items</tspan></tspan>\"\n *\n * @property {string, function} plain  String without formatting\n * @property {string, function} italic String with italic style\n * @property {string, function} bold   String with bold style\n * @property newline                   Insert a line break\n *\n * @return {function} Formatting function that accepts a datum\n */\n\nimport * as fn from \"../fn.js\";\n\nfunction formatHTML() {\n  const styles = {\n    plain(d) {\n      return d;\n    },\n    italic(d) {\n      return \"<em>\" + d + \"</em>\";\n    },\n    bold(d) {\n      return \"<strong>\" + d + \"</strong>\";\n    },\n  };\n\n  return function (textBody, datum) {\n    return textBody\n      .lines()\n      .map((line) => line.map((word) => styles[word.style].call(null, word.text(datum))).join(\" \"))\n      .join(\"<br/>\");\n  };\n}\n\nfunction formatSVG() {\n  const styles = {\n    plain(d) {\n      return \"<tspan>\" + d + \"</tspan>\";\n    },\n    italic(d) {\n      return '<tspan style=\"font-style:italic\">' + d + \"</tspan>\";\n    },\n    bold(d) {\n      return '<tspan style=\"font-weight:bold\">' + d + \"</tspan>\";\n    },\n  };\n\n  return function (textBody, datum) {\n    return textBody.lines().reduce((svg, line, i) => {\n      const lineSvg = line.map((word) => styles[word.style].call(null, word.text(datum))).join(\" \");\n      const dy = i === 0 ? 0 : \"1.2em\";\n      return svg + '<tspan x=\"0\" dy=\"' + dy + '\">' + lineSvg + \"</tspan>\";\n    }, \"\");\n  };\n}\n\nfunction structuredText() {\n  const lines = [[]];\n\n  return {\n    addLine() {\n      lines.push([]);\n    },\n\n    addWord(style, text) {\n      fn.last(lines).push({\n        text: fn.functor(text),\n        style,\n      });\n    },\n\n    lines() {\n      return lines;\n    },\n  };\n}\n\nfunction makeTextWithFormat(format) {\n  return function () {\n    const textBody = structuredText();\n\n    function makeText(d) {\n      return format(textBody, d);\n    }\n\n    makeText.newline = function () {\n      textBody.addLine();\n      return makeText;\n    };\n\n    for (const style of [\"bold\", \"italic\", \"plain\"]) {\n      makeText[style] = function (text) {\n        textBody.addWord(style, text);\n        return makeText;\n      };\n    }\n\n    return makeText;\n  };\n}\n\nexport const modularTextHTML = makeTextWithFormat(formatHTML());\nexport const modularTextSVG = makeTextWithFormat(formatSVG());\n","/**\n * Circle annotation\n *\n * A component for creating circular data areas. The component should be passed\n * an array of data values, each of which will be used to render a data area by\n * passing it through the accessor functions. You can specify a caption to display,\n * which can be offset from the center of the data area by specifying dx or dy properties.\n *\n * @module sszvis/annotation/circle\n *\n * @param {number, function} x        The x-position of the center of the data area.\n * @param {number, function} y        The y-position of the center of the data area.\n * @param {number, function} r        The radius of the data area.\n * @param {number, function} dx       The x-offset of the data area caption.\n * @param {number, function} dy       The y-offset of the data area caption.\n * @param {string, function} caption  The caption for the data area. Default position is the center of the circle\n *\n * @returns {sszvis.component} a circular data area component\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport ensureDefsElement from \"../svgUtils/ensureDefsElement.js\";\nimport { dataAreaPattern } from \"../patterns.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"x\", fn.functor)\n    .prop(\"y\", fn.functor)\n    .prop(\"r\", fn.functor)\n    .prop(\"dx\", fn.functor)\n    .prop(\"dy\", fn.functor)\n    .prop(\"caption\", fn.functor)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      ensureDefsElement(selection, \"pattern\", \"data-area-pattern\").call(dataAreaPattern);\n\n      const dataArea = selection\n        .selectAll(\".sszvis-dataareacircle\")\n        .data(data)\n        .join(\"circle\")\n        .classed(\"sszvis-dataareacircle\", true);\n\n      dataArea\n        .attr(\"cx\", props.x)\n        .attr(\"cy\", props.y)\n        .attr(\"r\", props.r)\n        .attr(\"fill\", \"url(#data-area-pattern)\");\n\n      if (props.caption) {\n        const dataCaptions = selection\n          .selectAll(\".sszvis-dataareacircle__caption\")\n          .data(data)\n          .join(\"text\")\n          .classed(\"sszvis-dataareacircle__caption\", true);\n\n        dataCaptions\n          .attr(\"x\", props.x)\n          .attr(\"y\", props.y)\n          .attr(\"dx\", props.dx)\n          .attr(\"dy\", props.dy)\n          .text(props.caption);\n      }\n    });\n}\n","/**\n * @function sszvis.annotationConfidenceArea\n *\n * A component for creating confidence areas. The component should be passed\n * an array of data values, each of which will be used to render a confidence area\n * by passing it through the accessor functions. You can specify the x, y0, and y1\n * properties to define the area. The component also supports stroke, strokeWidth,\n * and fill properties for styling.\n *\n * @module sszvis/annotation/confidenceArea\n *\n * @param {function} x             The x-accessor function.\n * @param {function} y0            The y0-accessor function.\n * @param {function} y1            The y1-accessor function.\n * @param {string} [stroke]        The stroke color of the area.\n * @param {number} [strokeWidth]   The stroke width of the area.\n * @param {string} [fill]          The fill color of the area.\n * @param {function} [key]         The key function for data binding.\n * @param {function} [valuesAccessor] The accessor function for the data values.\n * @param {boolean} [transition]   Whether to apply a transition to the area.\n *\n * @returns {sszvis.component} a confidence area component\n */\n\nimport { select, area as d3Area } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport ensureDefsElement from \"../svgUtils/ensureDefsElement.js\";\nimport { dataAreaPattern } from \"../patterns.js\";\nimport { defaultTransition } from \"../transition.js\";\n\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"x\")\n    .prop(\"y0\")\n    .prop(\"y1\")\n    .prop(\"stroke\")\n    .prop(\"strokeWidth\")\n    .prop(\"fill\")\n    .prop(\"key\")\n    .key((_, i) => i)\n    .prop(\"valuesAccessor\")\n    .valuesAccessor(fn.identity)\n    .prop(\"transition\")\n    .transition(true)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      ensureDefsElement(selection, \"pattern\", \"data-area-pattern\").call(dataAreaPattern);\n\n      // Layouts\n      const area = d3Area().x(props.x).y0(props.y0).y1(props.y1);\n\n      // Rendering\n\n      let path = selection\n        .selectAll(\".sszvis-area\")\n        .data(data, props.key)\n        .join(\"path\")\n        .classed(\"sszvis-area\", true)\n        .style(\"stroke\", props.stroke)\n        .attr(\"fill\", \"url(#data-area-pattern)\")\n        .order();\n\n      if (props.transition) {\n        path = path.transition().call(defaultTransition);\n      }\n\n      path\n        .attr(\"d\", fn.compose(area, props.valuesAccessor))\n        .style(\"stroke\", props.stroke)\n        .style(\"stroke-width\", props.strokeWidth)\n        .attr(\"fill\", \"url(#data-area-pattern)\");\n    });\n}\n","/**\n * Line annotation\n *\n * A component for creating reference line data areas. The component should be passed\n * an array of data values, each of which will be used to render a reference line\n * by passing it through the accessor functions. You can specify a caption to display,\n * which will be positioned by default at the midpoint of the line you specify,\n * aligned with the angle of the line. The caption can be offset from the midpoint\n * by specifying dx or dy properties.\n *\n * @module sszvis/annotation/line\n *\n * @param {any} x1             The x-value, in data units, of the first reference line point.\n * @param {any} x2             The x-value, in data units, of the second reference line point.\n * @param {any} y1             The y-value, in data units, of the first reference line point.\n * @param {any} y2             The y-value, in data units, of the second reference line point.\n * @param {function} xScale         The x-scale of the chart. Used to transform the given x- values into chart coordinates.\n * @param {function} yScale         The y-scale of the chart. Used to transform the given y- values into chart coordinates.\n * @param {number} [dx]           The x-offset of the caption\n * @param {number} [dy]           The y-offset of the caption\n * @param {string} [caption]      A reference line caption. (default position is centered at the midpoint of the line, aligned with the slope angle of the line)\n * @returns {sszvis.component} a linear data area component (reference line)\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { component } from \"../d3-component.js\";\n\n// reference line specified in the form y = mx + b\n// user supplies m and b\n// default line is y = x\n\nexport default function () {\n  return component()\n    .prop(\"x1\")\n    .prop(\"x2\")\n    .prop(\"y1\")\n    .prop(\"y2\")\n    .prop(\"xScale\")\n    .prop(\"yScale\")\n    .prop(\"dx\", fn.functor)\n    .dx(0)\n    .prop(\"dy\", fn.functor)\n    .dy(0)\n    .prop(\"caption\", fn.functor)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const x1 = props.xScale(props.x1);\n      const y1 = props.yScale(props.y1);\n      const x2 = props.xScale(props.x2);\n      const y2 = props.yScale(props.y2);\n\n      const line = selection\n        .selectAll(\".sszvis-referenceline\")\n        .data(data)\n        .join(\"line\")\n        .classed(\"sszvis-referenceline\", true);\n\n      line.attr(\"x1\", x1).attr(\"y1\", y1).attr(\"x2\", x2).attr(\"y2\", y2);\n\n      if (props.caption) {\n        const caption = selection\n          .selectAll(\".sszvis-referenceline__caption\")\n          .data([0])\n          .join(\"text\")\n          .classed(\"sszvis-referenceline__caption\", true);\n\n        caption\n          .attr(\"transform\", () => {\n            const vx = x2 - x1;\n            const vy = y2 - y1;\n            const angle = (Math.atan2(vy, vx) * 180) / Math.PI;\n            return \"translate(\" + (x1 + x2) / 2 + \",\" + (y1 + y2) / 2 + \") rotate(\" + angle + \")\";\n          })\n          .attr(\"dx\", props.dx)\n          .attr(\"dy\", props.dy)\n          .text(props.caption);\n      }\n    });\n}\n","/**\n * RangeRuler annotation\n *\n * The range ruler is similar to the handle ruler and the ruler, except for each data\n * point which it finds bound to its layer, it generates two small dots, and a label which\n * states the value of the data point. For an example, see the interactive stacked area charts.\n * Note that the interactive stacked area charts also include the rangeFlag component for highlighting\n * certain specific dots. This is a sepearate component.\n *\n * @module sszvis/annotation/rangeRuler\n *\n * @property {number functor} x            A function for the x-position of the ruler.\n * @property {number functor} y0           A function for the y-position of the lower dot. Called for each datum.\n * @property {number functor} y1           A function for the y-position of the upper dot. Called for each datum.\n * @property {number} top                  A number for the y-position of the top of the ruler\n * @property {number} bottom               A number for the y-position of the bottom of the ruler\n * @property {string functor} label        A function which generates labels for each range.\n * @property {number} total                A number to display as the total of the range ruler (at the top)\n * @property {boolean functor} flip        Determines whether the rangeRuler labels should be flipped (they default to the right side)\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { halfPixel } from \"../svgUtils/crisp.js\";\nimport { formatNumber } from \"../format.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"x\", fn.functor)\n    .prop(\"y0\", fn.functor)\n    .prop(\"y1\", fn.functor)\n    .prop(\"top\")\n    .prop(\"bottom\")\n    .prop(\"label\")\n    .prop(\"removeStroke\")\n    .label(fn.functor(\"\"))\n    .prop(\"total\")\n    .prop(\"flip\", fn.functor)\n    .flip(false)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const crispX = fn.compose(halfPixel, props.x);\n      const crispY0 = fn.compose(halfPixel, props.y0);\n      const crispY1 = fn.compose(halfPixel, props.y1);\n      const middleY = function (d) {\n        return halfPixel((props.y0(d) + props.y1(d)) / 2);\n      };\n\n      const dotRadius = 1.5;\n\n      const line = selection\n        .selectAll(\".sszvis-rangeRuler__rule\")\n        .data([0])\n        .join(\"line\")\n        .classed(\"sszvis-rangeRuler__rule\", true);\n\n      line.attr(\"x1\", crispX).attr(\"y1\", props.top).attr(\"x2\", crispX).attr(\"y2\", props.bottom);\n\n      const marks = selection\n        .selectAll(\".sszvis-rangeRuler--mark\")\n        .data(data)\n        .join(\"g\")\n        .classed(\"sszvis-rangeRuler--mark\", true);\n\n      marks.append(\"circle\").classed(\"sszvis-rangeRuler__p1\", true);\n      marks.append(\"circle\").classed(\"sszvis-rangeRuler__p2\", true);\n      marks.append(\"text\").classed(\"sszvis-rangeRuler__label-contour\", true);\n      marks.append(\"text\").classed(\"sszvis-rangeRuler__label\", true);\n\n      marks\n        .selectAll(\".sszvis-rangeRuler__p1\")\n        .data((d) => [d])\n        .attr(\"cx\", crispX)\n        .attr(\"cy\", crispY0)\n        .attr(\"r\", dotRadius);\n\n      marks\n        .selectAll(\".sszvis-rangeRuler__p2\")\n        .data((d) => [d])\n        .attr(\"cx\", crispX)\n        .attr(\"cy\", crispY1)\n        .attr(\"r\", dotRadius);\n\n      marks\n        .selectAll(\".sszvis-rangeRuler__label\")\n        .data((d) => [d])\n        .attr(\"x\", (d) => {\n          const offset = props.flip(d) ? -10 : 10;\n          return crispX(d) + offset;\n        })\n        .attr(\"y\", middleY)\n        .attr(\"dy\", \"0.35em\") // vertically-center\n        .style(\"text-anchor\", (d) => (props.flip(d) ? \"end\" : \"start\"))\n        .text(fn.compose(formatNumber, props.label));\n\n      //make the contour behind the the label update with the label\n      marks\n        .selectAll(\".sszvis-rangeRuler__label-contour\")\n        .data((d) => [d])\n        .attr(\"x\", (d) => {\n          const offset = props.flip(d) ? -10 : 10;\n          return crispX(d) + offset;\n        })\n        .attr(\"y\", middleY)\n        .attr(\"dy\", \"0.35em\") // vertically-center\n        .style(\"text-anchor\", (d) => (props.flip(d) ? \"end\" : \"start\"))\n        .text(fn.compose(formatNumber, props.label));\n\n      selection.selectAll(\"g.sszvis-rangeRuler--mark\").each(function () {\n        const g = select(this);\n        const textNode = g.select(\"text\").node();\n        let textContour = g.select(\".sszvis-rangeRuler__label-contour\");\n        if (textContour.empty()) {\n          textContour = select(textNode.cloneNode())\n            .classed(\"sszvis-rangeRuler__label-contour\", true)\n            .classed(\"sszvis-rangeRuler__label\", false);\n          this.insertBefore(textContour.node(), textNode);\n        } else {\n          textContour\n            .attr(\"x\", (d) => {\n              const offset = props.flip(d) ? -10 : 10;\n              return crispX(d) + offset;\n            })\n            .attr(\"y\", middleY)\n            .attr(\"dy\", \"0.35em\") // vertically-center\n            .style(\"text-anchor\", (d) => (props.flip(d) ? \"end\" : \"start\"));\n        }\n        textContour.text(textNode.textContent);\n      });\n\n      if (!props.removeStroke) {\n        marks.attr(\"stroke\", \"white\").attr(\"stroke-width\", 0.5).attr(\"stroke-opacity\", 0.75);\n      }\n\n      const total = selection\n        .selectAll(\".sszvis-rangeRuler__total\")\n        .data([fn.last(data)])\n        .join(\"text\")\n        .classed(\"sszvis-rangeRuler__total\", true);\n\n      total\n        .attr(\"x\", (d) => {\n          const offset = props.flip(d) ? -10 : 10;\n          return crispX(d) + offset;\n        })\n        .attr(\"y\", props.top - 10)\n        .style(\"text-anchor\", (d) => (props.flip(d) ? \"end\" : \"start\"))\n        .text(\"Total \" + formatNumber(props.total));\n\n      const totalNode = total.node();\n      let totalContour = selection.select(\".sszvis-rangeRuler__total-contour\");\n      if (totalContour.empty()) {\n        totalContour = select(totalNode.cloneNode())\n          .classed(\"sszvis-rangeRuler__total-contour\", true)\n          .classed(\"sszvis-rangeRuler__total\", false);\n        this.insertBefore(totalContour.node(), totalNode);\n      } else {\n        totalContour\n          .attr(\"x\", (d) => {\n            const offset = props.flip(d) ? -10 : 10;\n            return crispX(d) + offset;\n          })\n          .attr(\"y\", props.top - 10)\n          .style(\"text-anchor\", (d) => (props.flip(d) ? \"end\" : \"start\"));\n      }\n      totalContour.text(totalNode.textContent);\n\n      if (!props.removeStroke) {\n        total.attr(\"stroke\", \"white\").attr(\"stroke-width\", 0.5).attr(\"stroke-opacity\", 0.75);\n      }\n    });\n}\n","/**\n * Rectangle annotation\n *\n * A component for creating rectangular data areas. The component should be passed\n * an array of data values, each of which will be used to render a data area by\n * passing it through the accessor functions. You can specify a caption to display,\n * which can be offset from the center of the data area by specifying dx or dy properties.\n *\n * @module sszvis/annotation/rectangle\n *\n * @param {number, function} x        The x-position of the upper left corner of the data area.\n * @param {number, function} y        The y-position of the upper left corner of the data area.\n * @param {number, function} width    The width of the data area.\n * @param {number, function} height   The height of the data area.\n * @param {number, function} dx       The x-offset of the data area caption.\n * @param {number, function} dy       The y-offset of the data area caption.\n * @param {string, function} caption  The caption for the data area.\n *\n * @returns {sszvis.component} a rectangular data area component\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport ensureDefsElement from \"../svgUtils/ensureDefsElement.js\";\nimport { dataAreaPattern } from \"../patterns.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"x\", fn.functor)\n    .prop(\"y\", fn.functor)\n    .prop(\"width\", fn.functor)\n    .prop(\"height\", fn.functor)\n    .prop(\"dx\", fn.functor)\n    .prop(\"dy\", fn.functor)\n    .prop(\"caption\", fn.functor)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      ensureDefsElement(selection, \"pattern\", \"data-area-pattern\").call(dataAreaPattern);\n\n      const dataArea = selection\n        .selectAll(\".sszvis-dataarearectangle\")\n        .data(data)\n        .join(\"rect\")\n        .classed(\"sszvis-dataarearectangle\", true);\n\n      dataArea\n        .attr(\"x\", props.x)\n        .attr(\"y\", props.y)\n        .attr(\"width\", props.width)\n        .attr(\"height\", props.height)\n        .attr(\"fill\", \"url(#data-area-pattern)\");\n\n      if (props.caption) {\n        const dataCaptions = selection\n          .selectAll(\".sszvis-dataarearectangle__caption\")\n          .data(data)\n          .join(\"text\")\n          .classed(\"sszvis-dataarearectangle__caption\", true);\n\n        dataCaptions\n          .attr(\"x\", (d, i) => props.x(d, i) + props.width(d, i) / 2)\n          .attr(\"y\", (d, i) => props.y(d, i) + props.height(d, i) / 2)\n          .attr(\"dx\", props.dx)\n          .attr(\"dy\", props.dy)\n          .text(props.caption);\n      }\n    });\n}\n","/**\n * Ruler annotation\n *\n * The ruler component can be used to create a vertical line which highlights data at a certain\n * x-value, for instance in a line chart or area chart. The ruler expects data to be bound to\n * the layer it renders into, and it will generate a small dot for each data point it finds.\n *\n * @module sszvis/annotation/ruler\n *\n * @property {number} top                 A number which is the y-position of the top of the ruler line\n * @property {number} bottom              A number which is the y-position of the bottom of the ruler line\n * @property {function} x                 A number or function returning a number for the x-position of the ruler line.\n * @property {function} y                 A function for determining the y-position of the ruler dots. Should take a data\n *                                        value as an argument and return a y-position.\n * @property {function} label             A function for determining the labels of the ruler dots. Should take a\n *                                        data value as argument and return a label.\n * @property {string, function} color     A string or function to specify the color of the ruler dots.\n * @property {function} flip              A boolean or function which returns a boolean that specifies\n *                                        whether the labels on the ruler dots should be flipped. (they default to the right side)\n * @property {function} labelId           An id accessor function for the labels. This is used to match label data to svg elements,\n *                                        and it is used by the reduceOverlap algorithm to match calculated bounds and positions with\n *                                        labels. The default implementation uses the x and y positions of each label, but when labels\n *                                        overlap, these positions are the same (and one will be removed!). It's generally a good idea\n *                                        to provide your own function here, but you should especially use this when multiple labels\n *                                        could overlap with each other. Usually this will be some kind of category accessor function.\n * @property {boolean} reduceOverlap      Use an iterative relaxation algorithm to adjust the positions of the labels (when there is more\n *                                        than one label) so that they don't overlap. This can be computationally expensive, when there are\n *                                        many labels that need adjusting. This is turned off by default.\n *\n * @return {sszvis.component}\n */\n\nimport { select, ascending } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { halfPixel } from \"../svgUtils/crisp.js\";\nimport translateString from \"../svgUtils/translateString.js\";\nimport { component } from \"../d3-component.js\";\n\nexport const annotationRuler = () =>\n  component()\n    .prop(\"top\")\n    .prop(\"bottom\")\n    .prop(\"x\", fn.functor)\n    .prop(\"y\", fn.functor)\n    .prop(\"label\")\n    .label(fn.functor(\"\"))\n    .prop(\"color\")\n    .prop(\"flip\", fn.functor)\n    .flip(false)\n    .prop(\"labelId\", fn.functor)\n    .prop(\"reduceOverlap\")\n    .reduceOverlap(true)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const labelId =\n        props.labelId ||\n        function (d) {\n          return props.x(d) + \"_\" + props.y(d);\n        };\n\n      const ruler = selection\n        .selectAll(\".sszvis-ruler__rule\")\n        .data(data, labelId)\n        .join(\"line\")\n        .classed(\"sszvis-ruler__rule\", true);\n\n      ruler\n        .attr(\"x1\", fn.compose(halfPixel, props.x))\n        .attr(\"y1\", props.y)\n        .attr(\"x2\", fn.compose(halfPixel, props.x))\n        .attr(\"y2\", props.bottom);\n\n      const dot = selection\n        .selectAll(\".sszvis-ruler__dot\")\n        .data(data, labelId)\n        .join(\"circle\")\n        .classed(\"sszvis-ruler__dot\", true);\n\n      dot\n        .attr(\"cx\", fn.compose(halfPixel, props.x))\n        .attr(\"cy\", fn.compose(halfPixel, props.y))\n        .attr(\"r\", 3.5)\n        .attr(\"fill\", props.color);\n\n      selection\n        .selectAll(\".sszvis-ruler__label-outline\")\n        .data(data, labelId)\n        .join(\"text\")\n        .classed(\"sszvis-ruler__label-outline\", true);\n\n      const label = selection\n        .selectAll(\".sszvis-ruler__label\")\n        .data(data, labelId)\n        .join(\"text\")\n        .classed(\"sszvis-ruler__label\", true);\n\n      // Update both label and labelOutline selections\n\n      const crispX = fn.compose(halfPixel, props.x);\n      const crispY = fn.compose(halfPixel, props.y);\n\n      const textSelection = selection\n        .selectAll(\".sszvis-ruler__label, .sszvis-ruler__label-outline\")\n        .attr(\"transform\", (d) => {\n          const x = crispX(d);\n          const y = crispY(d);\n\n          const dx = props.flip(d) ? -10 : 10;\n          const dy = y < props.top ? 2 * y : y > props.bottom ? 0 : 5;\n\n          return translateString(x + dx, y + dy);\n        })\n        .style(\"text-anchor\", (d) => (props.flip(d) ? \"end\" : \"start\"))\n        .html(props.label);\n\n      if (props.reduceOverlap) {\n        const THRESHOLD = 2;\n        let ITERATIONS = 10;\n        const labelBounds = [];\n        // Optimization for the lookup later\n        const labelBoundsIndex = {};\n\n        // Reset vertical shift (set by previous renders)\n        textSelection.attr(\"y\", \"\");\n\n        // Create bounds objects\n        label.each(function (d) {\n          const bounds = this.getBoundingClientRect();\n          const item = {\n            top: bounds.top,\n            bottom: bounds.bottom,\n            dy: 0,\n          };\n          labelBounds.push(item);\n          labelBoundsIndex[labelId(d)] = item;\n        });\n\n        // Sort array in place by vertical position\n        // (only supports labels of same height)\n        labelBounds.sort((a, b) => ascending(a.top, b.top));\n\n        // Using postfix decrement means the expression evaluates to the value of the variable\n        // before the decrement takes place. In the case of 10 iterations, this means that the\n        // variable gets to 0 after the truthiness of the 10th iteration is tested, and the\n        // expression is false at the beginning of the 11th, so 10 iterations are executed.\n        // If you use prefix decrement (--ITERATIONS), the variable gets to 0 at the beginning of\n        // the 10th iteration, meaning that only 9 iterations are executed.\n        while (ITERATIONS--) {\n          // Calculate overlap and correct position\n          for (const [index, firstLabel] of labelBounds.entries()) {\n            for (const secondLabel of labelBounds.slice(index + 1)) {\n              const overlap = firstLabel.bottom - secondLabel.top;\n              if (overlap >= THRESHOLD) {\n                const offset = overlap / 2;\n                firstLabel.bottom -= offset;\n                firstLabel.top -= offset;\n                firstLabel.dy -= offset;\n                secondLabel.bottom += offset;\n                secondLabel.top += offset;\n                secondLabel.dy += offset;\n              }\n            }\n          }\n        }\n\n        // Shift vertically to remove overlap\n        textSelection.attr(\"y\", (d) => {\n          const textLabel = labelBoundsIndex[labelId(d)];\n          return textLabel.dy;\n        });\n      }\n    });\n\nexport const rulerLabelVerticalSeparate = (cAcc) => (g) => {\n  const THRESHOLD = 2;\n  const labelBounds = [];\n\n  // Reset vertical shift\n  g.selectAll(\"text\").each(function () {\n    select(this).attr(\"y\", \"\");\n  });\n\n  // Calculate bounds\n  g.selectAll(\".sszvis-ruler__label\").each(function (d) {\n    const bounds = this.getBoundingClientRect();\n    labelBounds.push({\n      category: cAcc(d),\n      top: bounds.top,\n      bottom: bounds.bottom,\n      dy: 0,\n    });\n  });\n\n  // Sort by vertical position (only supports labels of same height)\n  labelBounds.sort((a, b) => ascending(a.top, b.top));\n\n  // Calculate overlap and correct position\n  for (let i = 0; i < 10; i++) {\n    for (let j = 0; j < labelBounds.length; j++) {\n      for (let k = j + 1; k < labelBounds.length; k++) {\n        if (j === k) continue;\n        const firstLabel = labelBounds[j];\n        const secondLabel = labelBounds[k];\n        const overlap = firstLabel.bottom - secondLabel.top;\n        if (overlap >= THRESHOLD) {\n          firstLabel.bottom -= overlap / 2;\n          firstLabel.top -= overlap / 2;\n          firstLabel.dy -= overlap / 2;\n          secondLabel.bottom += overlap / 2;\n          secondLabel.top += overlap / 2;\n          secondLabel.dy += overlap / 2;\n        }\n      }\n    }\n  }\n\n  // Shift vertically to remove overlap\n  g.selectAll(\"text\").each(function (d) {\n    const label = fn.find((l) => l.category === cAcc(d), labelBounds);\n    if (label) {\n      select(this).attr(\"y\", label.dy);\n    }\n  });\n};\n","/**\n * Button Group control\n *\n * Control for switching top-level filter values. Use this control for changing between several\n * options which affect the state of the chart. This component should be rendered into an html layer.\n *\n * This control is part of the `optionSelectable` class of controls and can be used interchangeably\n * with other controls of this class (sszvis.control.select).\n *\n * @module sszvis/control/buttonGroup\n *\n * @property {array} values         an array of values which are the options available in the control. Each one will become a button\n * @property {any} current          the current value of the button group. Should be one of the options passed to .values()\n * @property {number} width         The total width of the button group. Each option will have 1/3rd of this width. (default: 300px)\n * @property {function} change      A callback/event handler function to call when the user clicks on a value.\n *                                  Note that clicking on a value does not necessarily change any state unless this callback function does something.\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"values\")\n    .prop(\"current\")\n    .prop(\"width\")\n    .width(300)\n    .prop(\"change\")\n    .change(fn.identity)\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      const buttonWidth = props.width / props.values.length;\n\n      const container = selection\n        .selectAll(\".sszvis-control-optionSelectable\")\n        .data([\"sszvis-control-buttonGroup\"], (d) => d)\n        .join(\"div\")\n        .classed(\"sszvis-control-optionSelectable\", true)\n        .classed(\"sszvis-control-buttonGroup\", true);\n\n      container.style(\"width\", props.width + \"px\");\n\n      const buttons = container\n        .selectAll(\".sszvis-control-buttonGroup__item\")\n        .data(props.values)\n        .join(\"div\")\n        .classed(\"sszvis-control-buttonGroup__item\", true);\n\n      buttons\n        .style(\"width\", buttonWidth + \"px\")\n        .classed(\"selected\", (d) => d === props.current)\n        .text((d) => d)\n        .on(\"click\", props.change);\n    });\n}\n","import { select, dispatch } from \"d3\";\nimport { component } from \"../d3-component.js\";\nimport {\n  GEO_KEY_DEFAULT,\n  mapRendererBase,\n  mapRendererHighlight,\n  mapRendererMesh,\n  mapRendererPatternedLakeOverlay,\n  prepareMergedGeoData,\n  swissMapPath,\n} from \"../map/index.js\";\n\n/**\n * zurichStadtKreise Map Component\n *\n * To use this component, pass data in the usual manner. Each data object is expected to have a value which\n * will be used to match that object with a particular map entity. The possible id values depend on the map type.\n * They are covered in more detail in the file sszvis/map/map-ids.txt. Which data key is used to fetch this value is configurable.\n * The default key which map.js expects is 'geoId', but by changing the keyName property of the map, you can pass data which\n * use any key. The map component assumes that datum[keyName] is a valid map ID which is matched with the available map entities.\n *\n * @property {Number} width                           The width of the map. Used to create the map projection function\n * @property {Number} height                          The height of the map. Used to create the map projection function\n * @property {String} keyName                         The data object key which will return a map entity id. Default 'geoId'.\n * @property {Array} highlight                        An array of data elements to highlight. The corresponding map entities are highlighted.\n * @property {String, Function} highlightStroke       A function for the stroke of the highlighted entities\n * @property {Boolean, Function} defined              A predicate function used to determine whether a datum has a defined value.\n *                                                    Map entities with data values that fail this predicate test will display the missing value texture.\n * @property {String, Function} fill                  A string or function for the fill of the map entities\n * @property {String} borderColor                     A string for the border color of the map entities\n * @property {Boolean} withLake                       Whether or not to show the textured outline of the end of lake Zurich that is within the city. Default true\n * @property {Component} anchoredShape                A shape to anchor to the base map elements of this map. For example, anchoredCircles for a bubble map.\n * @property {Boolean} transitionColor                Whether or not to transition the color of the base shapes. Default true.\n * @function on(String, function)                     This component has an event handler interface for binding events to the map entities.\n *                                                    The available events are 'over', 'out', and 'click'. These are triggered on map\n *                                                    elements when the user mouses over or taps, mouses out, or taps or clicks, respectively.\n *\n * @return {d3.component}\n */\n\nexport default function () {\n  const event = dispatch(\"over\", \"out\", \"click\");\n\n  const baseRenderer = mapRendererBase();\n  const meshRenderer = mapRendererMesh();\n  const lakeRenderer = mapRendererPatternedLakeOverlay();\n  const highlightRenderer = mapRendererHighlight();\n\n  const mapComponent = component()\n    .prop(\"width\")\n    .prop(\"height\")\n    .prop(\"keyName\")\n    .keyName(GEO_KEY_DEFAULT)\n    .prop(\"withLake\")\n    .withLake(true)\n    .prop(\"anchoredShape\")\n    .prop(\"features\")\n    .prop(\"borders\")\n    .prop(\"lakeFeatures\")\n    .prop(\"lakeBorders\")\n    .prop(\"lakeFadeOut\")\n    .lakeFadeOut(false)\n    .delegate(\"defined\", baseRenderer)\n    .delegate(\"fill\", baseRenderer)\n    .delegate(\"transitionColor\", baseRenderer)\n    .delegate(\"borderColor\", meshRenderer)\n    .delegate(\"strokeWidth\", meshRenderer)\n    .delegate(\"highlight\", highlightRenderer)\n    .delegate(\"highlightStroke\", highlightRenderer)\n    .delegate(\"highlightStrokeWidth\", highlightRenderer)\n    .delegate(\"lakePathColor\", lakeRenderer)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      // create a map path generator function\n      const mapPath = swissMapPath(\n        props.width,\n        props.height,\n        props.features,\n        \"zurichStadtfeatures\"\n      );\n\n      const mergedData = prepareMergedGeoData(data, props.features, props.keyName);\n\n      // Base shape\n      baseRenderer.geoJson(props.features).mergedData(mergedData).mapPath(mapPath);\n\n      // Border mesh\n      meshRenderer.geoJson(props.borders).mapPath(mapPath);\n\n      // Lake Zurich shape\n      lakeRenderer\n        .lakeFeature(props.lakeFeatures)\n        .lakeBounds(props.lakeBorders)\n        .mapPath(mapPath)\n        .fadeOut(props.lakeFadeOut);\n\n      // Highlight mesh\n      highlightRenderer.geoJson(props.features).keyName(props.keyName).mapPath(mapPath);\n\n      // Rendering\n\n      selection.call(baseRenderer).call(meshRenderer);\n\n      if (props.withLake) {\n        selection.call(lakeRenderer);\n      }\n\n      selection.call(highlightRenderer);\n\n      if (props.anchoredShape) {\n        props.anchoredShape.mergedData(mergedData).mapPath(mapPath);\n\n        selection.call(props.anchoredShape);\n      }\n\n      // Event Binding\n\n      selection\n        .selectAll(\"[data-event-target]\")\n        .on(\"mouseover\", function (d) {\n          event.call(\"over\", this, d.datum);\n        })\n        .on(\"mouseout\", function (d) {\n          event.call(\"out\", this, d.datum);\n        })\n        .on(\"click\", function (d) {\n          event.call(\"click\", this, d.datum);\n        });\n    });\n\n  mapComponent.on = function () {\n    const value = event.on.apply(event, arguments);\n    return value === event ? mapComponent : value;\n  };\n\n  return mapComponent;\n}\n","/**\n * Factory that returns an HTML element appended to the given target selector,\n * ensuring that it is only created once, even when run again.\n *\n * Note on the 'key' property of the optional metadata object:\n *\n * The key argument is present so that we can have multiple layers of html content in the same container.\n * For example, let's imagine you want one html div under an svg, then an svg layer, then another div over the svg.\n * The reason we need a key for these layers is that the render function in all the example code is designed to be\n * idempotent - calling it multiple times with the same arguments leaves the app in the same state. Therefore, all\n * the functions within render also need to be idempotent. A straightforward implementation of \"createHtmlLayer\" would\n * return an existing layer if present, or create one and return it if it wasn't present. This prevents createHtmlLayer\n * from making a new html element every time it's called. In turn, that means that you can call render many times and\n * always expect the same result (idempotence). But it also means that if you call it multiple times within the same\n * render function, you don't get multiple html layers. So then you can't have one under the svg and one over.\n *\n * The key argument solves this problem. It says, \"look for a div in the container which has the given key, and return\n * it if present. Otherwise, create one with that key and return it. This means that if you call createHtmlLayer\n * multiple times with the same key, only one element will be created, and you'll get it back on subsequent calls.\n * But if you call it multiple times with different keys, you'll get multiple different elements. So, when you do:\n *\n * createHtmlLayer(..., ..., { key: 'A' })\n * createSvgLayer(...)\n * createHtmlLayer(..., ..., { key: 'B' })\n *\n * Then you'll have the div-svg-div sandwich, but that sequence of function calls is still idempotent.\n * Note: createSvgLayer accepts an optional metadata object, with an optional key property, which works the same way.\n *\n * @module sszvis/createHtmlLayer\n *\n * @param {string|d3.selection} selector    CSS selector string which is used to grab the container object for the created layer\n * @param {d3.bounds} [bounds]              A bounds object which provides the dimensions and offset for the created layer\n * @param {object} metadata                 Metadata for this layer. Currently the only used option is:\n *   @property {string} key                 Used as a unique key for this layer. If you pass different values\n *                                          of key to this function, the app will create and return different layers\n *                                          for inserting HTML content. If you pass the same value (including undefined),\n *                                          you will always get back the same DOM element. For example, this is useful for\n *                                          adding an HTML layer under an SVG, and then adding one over the SVG.\n *                                          See the binned raster map for an example of using this effectively.\n *\n * @returns {d3.selection}\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"./fn.js\";\nimport { bounds as mkBounds } from \"./bounds.js\";\n\nexport function createHtmlLayer(selector, bounds, metadata) {\n  bounds || (bounds = mkBounds());\n  metadata || (metadata = {});\n\n  const key = metadata.key || \"default\";\n\n  const elementDataKey = \"data-sszvis-html-\" + key;\n\n  const root = fn.isSelection(selector) ? selector : select(selector);\n  root.classed(\"sszvis-outer-container\", true);\n\n  return root\n    .selectAll(\"[data-sszvis-html-layer][\" + elementDataKey + \"]\")\n    .data([0])\n    .join(\"div\")\n    .classed(\"sszvis-html-layer\", true)\n    .attr(\"data-sszvis-html-layer\", \"\")\n    .attr(elementDataKey, \"\")\n    .style(\"position\", \"absolute\")\n    .style(\"left\", bounds.padding.left + \"px\")\n    .style(\"top\", bounds.padding.top + \"px\");\n}\n","/**\n * Factory that returns an SVG element appended to the given target selector,\n * ensuring that it is only created once, even when run again.\n *\n * @module sszvis/createSvgLayer\n *\n * @param {string|d3.selection} selector\n * @param {d3.bounds} bounds\n * @param {object} [metadata] Metadata for this chart. Can include any number of the following:\n *   @property {string} key Used as a unique key for this layer. If you pass different values\n *                          of key to this function, the app will create and return different layers.\n *                          If you pass the same value (including undefined), you will always get back\n *                          the same DOM element. This is useful for adding multiple SVG elements.\n *                          See the binned raster map for an example of using this effectively.\n *                          Note: For more information about this argument, see the detailed explanation in\n *                          the source code for createHtmlLayer.\n *\n * @returns {d3.selection}\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"./fn.js\";\nimport { bounds as mkBounds } from \"./bounds.js\";\n\nexport function createSvgLayer(selector, bounds, metadata) {\n  bounds || (bounds = mkBounds());\n  metadata || (metadata = {});\n\n  const key = metadata.key || \"default\";\n  const elementDataKey = \"data-sszvis-svg-\" + key;\n  const title = metadata.title || \"\";\n  const description = metadata.description || \"\";\n\n  const root = fn.isSelection(selector) ? selector : select(selector);\n  const svg = root\n    .selectAll(\"svg[\" + elementDataKey + \"]\")\n    .data([0])\n    .join(\"svg\")\n    .classed(\"sszvis-svg-layer\", true)\n    .attr(elementDataKey, \"\")\n    .attr(\"role\", \"img\")\n    .attr(\"aria-label\", title + \" – \" + description)\n    .attr(\"height\", bounds.height)\n    .attr(\"width\", bounds.width);\n\n  svg.selectAll(\"title\").data([0]).join(\"title\").text(title);\n\n  svg\n    .selectAll(\"desc\")\n    .data([0])\n    .join(\"desc\")\n    .text(description)\n    .classed(\"sszvis-svg-layer\", true)\n    .attr(elementDataKey, \"\")\n    .attr(\"role\", \"img\");\n\n  return svg\n    .selectAll(\"[data-sszvis-svg-layer]\")\n    .data(() => [0])\n    .join(\"g\")\n    .attr(\"data-sszvis-svg-layer\", \"\")\n    .attr(\"transform\", \"translate(\" + bounds.padding.left + \",\" + bounds.padding.top + \")\");\n}\n","/**\n * Heat Table Dimensions\n *\n * Utility function for calculating different demensions in the heat table\n *\n * @module sszvis/layout/heatTableDimensions\n *\n * @param  {Number} spaceWidth   the total available width for the heat table within its container\n * @param  {Number} squarePadding the padding, in pixels, between squares in the heat table\n * @param  {Number} numX     The number of columns that need to fit within the heat table width\n * @param {Number} numY The number of rows in the table\n * @param {Object} [chartPadding] An object that includes padding values for the left, right, top,\n *                              and bottom padding which the heat table should have within its container.\n *                              These padding values should be enough to include any axis labels or other things\n *                              that show up around the table itself. The heat table will then fill the rest\n *                              of the available space as appropriate (up to a certain maximum size of box)\n * @return {object}         An object with dimension information about the heat table:\n *                          {\n *                              side: the length of one side of a table box\n *                              paddedSide: the length of the side plus padding\n *                              padRatio: the ratio of padding to paddedSide (used for configuring d3.scaleOrdinal.rangeBands as the second parameter)\n *                              width: the total width of all table boxes plus padding in between\n *                              height: the total height of all table boxes plus padding in between\n *                              centeredOffset: the left offset required to center the table horizontally within its container\n *                          }\n */\n\nexport default function (spaceWidth, squarePadding, numX, numY, chartPadding) {\n  chartPadding || (chartPadding = {});\n  chartPadding.top || (chartPadding.top = 0);\n  chartPadding.right || (chartPadding.right = 0);\n  chartPadding.bottom || (chartPadding.bottom = 0);\n  chartPadding.left || (chartPadding.left = 0);\n\n  // this includes the default side length for the heat table\n  const DEFAULT_SIDE = 30,\n    availableChartWidth = spaceWidth - chartPadding.left - chartPadding.right,\n    side = Math.min((availableChartWidth - squarePadding * (numX - 1)) / numX, DEFAULT_SIDE),\n    paddedSide = side + squarePadding,\n    padRatio = 1 - side / paddedSide,\n    tableWidth = numX * paddedSide - squarePadding, // subtract the squarePadding at the end\n    tableHeight = numY * paddedSide - squarePadding; // subtract the squarePadding at the end\n  return {\n    side,\n    paddedSide,\n    padRatio,\n    width: tableWidth,\n    height: tableHeight,\n    centeredOffset: Math.max((availableChartWidth - tableWidth) / 2, 0),\n  };\n}\n","/**\n * Horizontal Bar Chart Dimensions\n *\n * This function calculates dimensions for the horizontal bar chart. It encapsulates the\n * layout algorithm for sszvis horizontal bar charts. The object it returns contains several\n * properties which can be used in other functions and components for layout purposes.\n *\n * @module sszvis/layout/horizontalBarChartDimensions\n *\n * @param  {number} numBars     the number of bars in the horizontal bar chart\n * @return {object}             an object containing properties used for layout:\n *                                 {\n *                                  barHeight: the height of an individual bar\n *                                  padHeight: the height of the padding between each bar\n *                                  padRatio: the ratio of padding to barHeight + padding.\n *                                            this can be passed as the second argument to d3.scaleOrdinal().rangeBands\n *                                  outerRatio: the ratio of outer padding to barHeight + padding.\n *                                              this can be passed as the third parameter to d3.scaleOrdinal().rangeBands\n *                                  axisOffset: the amount by which to vertically offset the y-axis of the horizontal bar chart\n *                                              in order to ensure that the axis labels are visible. This can be used as the y-component\n *                                              of a call to sszvis.svgUtils.translateString.\n *                                  barGroupHeight: the combined height of all the bars and their inner padding.\n *                                  totalHeight: barGroupHeight plus the height of the outerPadding. This distance can be used\n *                                               to translate scales below the bars.\n *                                 }\n */\n\nexport default function (numBars) {\n  const DEFAULT_HEIGHT = 24, // the default bar height\n    MIN_PADDING = 20, // the minimum padding size\n    barHeight = DEFAULT_HEIGHT, // the bar height\n    numPads = numBars - 1,\n    padding = MIN_PADDING,\n    // compute other information\n    padRatio = 1 - barHeight / (barHeight + padding),\n    computedBarSpace = barHeight * numBars + padding * numPads,\n    outerRatio = 0; // no outer padding\n\n  return {\n    barHeight,\n    padHeight: padding,\n    padRatio,\n    outerRatio,\n    axisOffset: -(barHeight / 2) - 10,\n    barGroupHeight: computedBarSpace,\n    totalHeight: computedBarSpace + outerRatio * (barHeight + padding) * 2,\n  };\n}\n","/**\n * Vertical Bar Chart Dimensions\n *\n * Generates a dimension configuration object to be used for laying out the vertical bar chart.\n *\n * @module sszvis/layout/verticalBarChartDimensions\n *\n * @param  {number} width         the total width available to the horizontal bar chart. The computed chart layout is not guaranteed\n *                                to fit inside this width.\n * @param  {number} numBars       The number of bars in the bar chart.\n * @return {object}               An object containing configuration properties for use in laying out the vertical bar chart.\n *                                {\n *                                  barWidth:             the width of each bar in the bar chart\n *                                  padWidth:             the width of the padding between the bars in the bar chart\n *                                  padRatio:             the ratio between the padding and the step (barWidth + padding). This can be passed\n *                                                        as the second parameter to d3.scaleOrdinal().rangeBands().\n *                                  outerRatio:           the outer ratio between the outer padding and the step. This can be passed as the\n *                                                        third parameter to d3.scaleOrdinal().rangeBands().\n *                                  barGroupWidth:        the width of all the bars plus all the padding between the bars.\n *                                  totalWidth:           The total width of all bars, plus all inner and outer padding.\n *                                }\n */\n\nexport default function (width, numBars) {\n  const MAX_BAR_WIDTH = 48, // the maximum width of a bar\n    MIN_PADDING = 2, // the minimum padding value\n    MAX_PADDING = 100, // the maximum padding value\n    TARGET_BAR_RATIO = 0.7, // the ratio of width to width + padding used to compute the initial width and padding\n    TARGET_PADDING_RATIO = 1 - TARGET_BAR_RATIO, // the inverse of the bar ratio, this is the ratio of padding to width + padding\n    numPads = numBars - 1; // the number of padding spaces\n  // compute the target size of the padding\n  // the derivation of this equation is available upon request\n  let padding =\n    (width * TARGET_PADDING_RATIO) / (TARGET_PADDING_RATIO * numPads + TARGET_BAR_RATIO * numBars);\n  // based on the computed padding, calculate the bar width\n\n  let barWidth = (width - padding * numPads) / numBars;\n\n  // adjust for min and max bounds\n  if (barWidth > MAX_BAR_WIDTH) {\n    barWidth = MAX_BAR_WIDTH;\n    // recompute the padding value where necessary\n    padding = (width - barWidth * numBars) / numPads;\n  }\n  if (padding < MIN_PADDING) padding = MIN_PADDING;\n  if (padding > MAX_PADDING) padding = MAX_PADDING;\n\n  // compute other information\n  const padRatio = 1 - barWidth / (barWidth + padding),\n    computedBarSpace = barWidth * numBars + padding * numPads,\n    outerRatio = (width - computedBarSpace) / 2 / (barWidth + padding);\n\n  return {\n    barWidth,\n    padWidth: padding,\n    padRatio,\n    outerRatio,\n    barGroupWidth: computedBarSpace,\n    totalWidth: width,\n  };\n}\n","/**\n * Dot component\n *\n * Used to render small circles, where each circle corresponds to a data value. The dot component\n * is built on rendering svg circles, so the configuration properties are directly mapped to circle attributes.\n *\n * @module sszvis/component/dot\n *\n * @property {number, function} x               An accessor function or number for the x-position of the dots.\n * @property {number, function} y               An accessor function or number for the y-position of the dots.\n * @property {number, function} radius          An accessor function or number for the radius of the dots.\n * @property {string, function} stroke          An accessor function or string for the stroke color of the dots.\n * @property {string, function} fill            An accessor function or string for the fill color of the dots.\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { defaultTransition } from \"../transition.js\";\nimport tooltipAnchor from \"../annotation/tooltipAnchor.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"x\", fn.functor)\n    .prop(\"y\", fn.functor)\n    .prop(\"radius\")\n    .prop(\"stroke\")\n    .prop(\"fill\")\n    .prop(\"transition\")\n    .transition(true)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      let dots = selection\n        .selectAll(\".sszvis-circle\")\n        .data(data)\n        .join(\"circle\")\n        .classed(\"sszvis-circle\", true)\n        .attr(\"cx\", props.x)\n        .attr(\"cy\", props.y)\n        .attr(\"r\", props.radius)\n        .attr(\"stroke\", props.stroke)\n        .attr(\"fill\", props.fill);\n\n      if (props.transition) {\n        dots = dots.transition(defaultTransition());\n      }\n\n      dots.attr(\"cx\", props.x).attr(\"cy\", props.y).attr(\"r\", props.radius);\n\n      // Tooltip anchors\n\n      const ta = tooltipAnchor().position((d) => [props.x(d), props.y(d)]);\n\n      selection.call(ta);\n    });\n}\n","/**\n * @function sszvis.tooltipFit\n *\n * This is a useful default function for making a tooltip fit within a horizontal space.\n * You provide a default orientation for the tooltip, but also provide the bounds of the\n * space within which the tooltip should stay. When the tooltip is too close to the left\n * or right edge of the bounds, it is oriented away from the edge. Otherwise the default\n * is used.\n *\n * @param {String} defaultValue         The default value for the tooltip orientation\n * @param {Object} bounds               The bounds object within which the tooltip should stay.\n *\n * @returns {Function}                  A function for calculating the orientation of the tooltips.\n */\n\nexport default function (defaultVal, bounds) {\n  const lo = Math.min((bounds.innerWidth * 1) / 4, 100);\n  const hi = Math.max((bounds.innerWidth * 3) / 4, bounds.innerWidth - 100);\n  return function (d) {\n    const x = d.x;\n    return x > hi ? \"right\" : x < lo ? \"left\" : defaultVal;\n  };\n}\n","/**\n * Grouped Bars component\n *\n * The grouped bars component is used to create grouped vertical bar charts.\n *\n * The input to the grouped bar component should be an array of arrays, where each inner\n * array contains the bars for a single group. Each of the inner arrays becomes a group, and\n * each element in those inner arrays becomes a bar.\n *\n * In addition to the raw data, the user must provide other information necessary for calculating\n * the layout of the groups of bars, namely the number of bars in each group (this component requires that\n * all groups have the same number of bars), a scale for finding the x-offset of each group (usually an\n * instance of d3.scaleOrdinal), a width for groups, and y- and height- scales for the bars in the group.\n * Note that the number of bars in each group and the group width determines how wide each bar will be, and\n * this width is calculated internally to the groupedBars component.\n *\n * The groups are calculated and laid out entirely by the groupedBars component.\n *\n * @module sszvis/component/groupedBars\n *\n * @property {scale} groupScale         This should be a scale function for determining the correct group offset of a member of a group.\n *                                      This function is passed the group member, and should return a value for the group offset which\n *                                      is the same for all members of the group. The within-group offset (which is different for each member)\n *                                      is then added to this group offset in order to position the bars individually within the group.\n *                                      So, for instance, if the groups are based on the \"city\" property, the groupScale should return\n *                                      the same value for all data objects with \"city = Zurich\".\n * @property {number} groupSize         This property tells groupedBars how many bars to expect for each group. It is used to assist in\n *                                      calculating the within-group layout and size of the bars. This number is treated as the same for all\n *                                      groups. Groups with less members than this number will have visible gaps. (Note that having less members\n *                                      in a group is not the same as having a member with a missing value, which will be discussed later)\n * @property {number} groupWidth        The width of the groups. This value is treated as the same for all groups. The width available to the groups\n *                                      is divided up among the bars. Often, this value will be the result of calling .rangeBand() on a d3.scaleOrdinal scale.\n * @property {number} groupSpace        The percentage of space between each group. (default: 0.05). Usually the default is fine here.\n * @property {function} y               The y-position of the bars in the group. This function is given a data value and should return\n *                                      a y-value. It should be similar to other functions you have already seen for positioning bars.\n * @property {function} height          The height of the bars in the group. This function is given a data value and should return\n *                                      a height value. It should be similar to other functions you have already seen for setting the height of bars.\n * @property {string, function} fill    A functor which gives the color for each bar (often based on the bar's group). This can be a string or a function.\n * @property {string, function} stroke  The stroke color for each bar (default: none)\n * @property {function} defined         A predicate function which can be used to determine whether a bar has a defined value. (default: true).\n *                                      Any bar for which this function returns false, meaning that it has an undefined (missing) value,\n *                                      will be displayed as a faint \"x\" in the grouped bar chart. This is in order to distinguish bars with\n *                                      missing values from bars with very small values, which would display as a very thin rectangle.\n *\n * @return {sszvis.component}\n */\n\nimport { select, scaleBand, range } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport tooltipAnchor from \"../annotation/tooltipAnchor.js\";\nimport translateString from \"../svgUtils/translateString.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"groupScale\")\n    .prop(\"groupSize\")\n    .prop(\"groupWidth\")\n    .prop(\"groupSpace\")\n    .groupSpace(0.05)\n    .prop(\"y\", fn.functor)\n    .prop(\"height\")\n    .prop(\"fill\")\n    .prop(\"stroke\")\n    .prop(\"defined\", fn.functor)\n    .defined(true)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const inGroupScale = scaleBand()\n        .domain(range(props.groupSize))\n        .padding(props.groupSpace)\n        .paddingOuter(0)\n        .rangeRound([0, props.groupWidth]);\n\n      const groups = selection\n        .selectAll(\"g.sszvis-bargroup\")\n        .data(data)\n        .join(\"g\")\n        .classed(\"sszvis-bargroup\", true);\n\n      const barUnits = groups\n        .selectAll(\"g.sszvis-barunit\")\n        .data((d) => d)\n        .join(\"g\")\n        .classed(\"sszvis-barunit\", true);\n\n      barUnits.each((d, i) => {\n        // necessary for the within-group scale\n        d.__sszvisGroupedBarIndex__ = i;\n      });\n\n      const unitsWithValue = barUnits.filter(props.defined);\n\n      // clear the units before rendering\n      unitsWithValue.selectAll(\"*\").remove();\n\n      //sszsch: fix: reset previously assigned translations\n      unitsWithValue.attr(\"transform\", () => translateString(0, 0));\n\n      unitsWithValue\n        .append(\"rect\")\n        .classed(\"sszvis-bar\", true)\n        .attr(\"fill\", props.fill)\n        .attr(\n          \"x\",\n          (d) =>\n            // first term is the x-position of the group, the second term is the x-position of the bar within the group\n            props.groupScale(d) + inGroupScale(d.__sszvisGroupedBarIndex__)\n        )\n        .attr(\"y\", props.y)\n        .attr(\"width\", inGroupScale.bandwidth())\n        .attr(\"height\", props.height);\n\n      const unitsWithoutValue = barUnits.filter(fn.not(props.defined));\n\n      unitsWithoutValue.selectAll(\"*\").remove();\n\n      unitsWithoutValue.attr(\"transform\", (d, i) =>\n        translateString(\n          props.groupScale(d) +\n            inGroupScale(d.__sszvisGroupedBarIndex__) +\n            inGroupScale.bandwidth() / 2,\n          props.y(d, i)\n        )\n      );\n\n      unitsWithoutValue\n        .append(\"line\")\n        .classed(\"sszvis-bar--missing line1\", true)\n        .attr(\"x1\", -4)\n        .attr(\"y1\", -4)\n        .attr(\"x2\", 4)\n        .attr(\"y2\", 4);\n\n      unitsWithoutValue\n        .append(\"line\")\n        .classed(\"sszvis-bar--missing line2\", true)\n        .attr(\"x1\", 4)\n        .attr(\"y1\", -4)\n        .attr(\"x2\", -4)\n        .attr(\"y2\", 4);\n\n      const ta = tooltipAnchor().position((group) => {\n        let xTotal = 0;\n        let tallest = Infinity;\n        for (const [i, d] of group.entries()) {\n          xTotal +=\n            props.groupScale(d) +\n            inGroupScale(d.__sszvisGroupedBarIndex__) +\n            inGroupScale.bandwidth() / 2;\n          // smaller y is higher\n          tallest = Math.min(tallest, props.y(d, i));\n        }\n        const xAverage = xTotal / group.length;\n        return [xAverage, tallest];\n      });\n\n      selection.call(ta);\n    });\n}\n","/**\n * Ruler with a handle control\n *\n * The handle ruler component is very similar to the ruler component, except that it is rendered\n * with a 24-pixel tall handle at the top. It is moved and repositioned in the same manner as a ruler,\n * so the actual interaction with the handle is up to the developer to specify. This component also\n * creates dots for each data point it finds bound to its layer.\n *\n * @module sszvis/control/handleRuler\n *\n * @property {function} x                   A function or number which determines the x-position of the ruler\n * @property {function} y                   A function which determines the y-position of the ruler dots. Passed data values.\n * @property {number} top                   A number for the y-position of the top of the ruler.\n * @property {number} bottom                A number for the y-position of the bottom of the ruler.\n * @property {string, function} label       A string or string function for the labels of the ruler dots.\n * @property {string, function} color       A string or color for the fill color of the ruler dots.\n * @property {boolean, function} flip       A boolean or boolean function which determines whether the ruler should be flipped (they default to the right side)\n *\n * @returns {sszvis.component}\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { halfPixel } from \"../svgUtils/crisp.js\";\nimport translateString from \"../svgUtils/translateString.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"x\", fn.functor)\n    .prop(\"y\", fn.functor)\n    .prop(\"top\")\n    .prop(\"bottom\")\n    .prop(\"label\")\n    .label(fn.functor(\"\"))\n    .prop(\"color\")\n    .prop(\"flip\", fn.functor)\n    .flip(false)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      // Elements need to be placed on half-pixels in order to be rendered\n      // crisply across browsers. That's why we create this position accessor\n      // here that takes a datum as input, reads out its value (props.x) and\n      // then rounds this pixel value to half pixels (1px -> 1.5px, 1.2px -> 1.5px)\n      const crispX = fn.compose(halfPixel, props.x);\n      const crispY = fn.compose(halfPixel, props.y);\n\n      const bottom = props.bottom - 4;\n      const handleWidth = 10;\n      const handleHeight = 24;\n      const handleTop = props.top - handleHeight;\n\n      const group = selection\n        .selectAll(\".sszvis-handleRuler__group\")\n        .data([0])\n        .join(\"g\")\n        .classed(\"sszvis-handleRuler__group\", true);\n\n      group.append(\"line\").classed(\"sszvis-ruler__rule\", true);\n\n      group.append(\"rect\").classed(\"sszvis-handleRuler__handle\", true);\n\n      group.append(\"line\").classed(\"sszvis-handleRuler__handle-mark\", true);\n\n      group\n        .selectAll(\".sszvis-ruler__rule\")\n        .attr(\"x1\", crispX)\n        .attr(\"y1\", halfPixel(props.top))\n        .attr(\"x2\", crispX)\n        .attr(\"y2\", halfPixel(bottom));\n\n      group\n        .selectAll(\".sszvis-handleRuler__handle\")\n        .attr(\"x\", (d) => crispX(d) - handleWidth / 2)\n        .attr(\"y\", halfPixel(handleTop))\n        .attr(\"width\", handleWidth)\n        .attr(\"height\", handleHeight)\n        .attr(\"rx\", 2)\n        .attr(\"ry\", 2);\n\n      group\n        .selectAll(\".sszvis-handleRuler__handle-mark\")\n        .attr(\"x1\", crispX)\n        .attr(\"y1\", halfPixel(handleTop + handleHeight * 0.15))\n        .attr(\"x2\", crispX)\n        .attr(\"y2\", halfPixel(handleTop + handleHeight * 0.85));\n\n      const dots = group\n        .selectAll(\".sszvis-ruler__dot\")\n        .data(data)\n        .join(\"circle\")\n        .classed(\"sszvis-ruler__dot\", true);\n\n      dots.attr(\"cx\", crispX).attr(\"cy\", crispY).attr(\"r\", 3.5).attr(\"fill\", props.color);\n\n      selection\n        .selectAll(\".sszvis-ruler__label-outline\")\n        .data(data)\n        .join(\"text\")\n        .classed(\"sszvis-ruler__label-outline\", true);\n\n      selection\n        .selectAll(\".sszvis-ruler__label\")\n        .data(data)\n        .join(\"text\")\n        .classed(\"sszvis-ruler__label\", true);\n\n      // Update both labelOutline and labelOutline selections\n\n      selection\n        .selectAll(\".sszvis-ruler__label, .sszvis-ruler__label-outline\")\n        .attr(\"transform\", (d) => {\n          const x = fn.compose(halfPixel, props.x)(d);\n          const y = fn.compose(halfPixel, props.y)(d);\n\n          const dx = props.flip(d) ? -10 : 10;\n          const dy = y < props.top ? 2 * y : y > props.bottom ? 0 : 5;\n\n          return translateString(x + dx, y + dy);\n        })\n        .style(\"text-anchor\", (d) => (props.flip(d) ? \"end\" : \"start\"))\n        .html(props.label);\n    });\n}\n","/**\n * Population Pyramid Layout\n *\n * This function is used to compute the layout parameters for the population pyramid\n *\n * @module sszvis/layout/populationPyramidLayout\n *\n * @parameter {number} spaceWidth      The available width for the chart. This is used as a base for calculating the size of the chart\n *                                    (there's a default aspect ratio for its height), and then for calculating the rounded bar heights.\n *                                    The returned total height should be nicely proportionate to this value.\n * @parameter {number} numBars         The number of bars in the population pyramid. In other words, the number of ages or age groups in the dataset.\n *\n * @return {object}                   An object containing configuration information for the population pyramid:\n *                                    {\n *                                      barHeight: the height of one bar in the population pyramid\n *                                      padding: the height of the padding between bars in the pyramid\n *                                      totalHeight: the total height of all bars plus the padding between them. This should be the basis for the bounds calculation\n *                                      positions: an array of positions, which go from the bottom of the chart (lowest age) to the top. These positions should\n *                                      be set as the range of a d3.scaleOrdinal scale, where the domain is the list of ages or age groups that will be displayed\n *                                      in the chart. The domain ages or age groups should be sorted in ascending order, so that the positions will match up. If everything\n *                                      has gone well, the positions array's length will be numBars,\n *                                      maxBarLength: The maximum length of the bars to fit within the space while keeping a good aspect ratio.\n *                                      In situations with very wide screens, this limits the width of the entire pyramid to a reasonable size.\n *                                      chartPadding: left padding for the chart. When the maxBarLength is less than what would fill the entire width\n *                                      of the chart, this value is needed to offset the axes and legend so that they line up with the chart. Otherwise,\n *                                      the value is 0 and no padding is needed.\n *                                    }\n */\n\nimport { aspectRatioPortrait } from \"../aspectRatio.js\";\n\nexport default function (spaceWidth, numBars) {\n  const MAX_HEIGHT = 480; // Chart no taller than this\n  const MIN_BAR_HEIGHT = 2; // Bars no shorter than this\n  const defaultHeight = Math.min(aspectRatioPortrait(spaceWidth), MAX_HEIGHT);\n  const padding = 1;\n  const numPads = numBars - 1;\n  const totalPadding = padding * numPads;\n\n  let roundedBarHeight = Math.round((defaultHeight - totalPadding) / numBars);\n  roundedBarHeight = Math.max(roundedBarHeight, MIN_BAR_HEIGHT);\n\n  const totalHeight = numBars * roundedBarHeight + totalPadding;\n\n  let barPos = totalHeight - roundedBarHeight;\n  const step = roundedBarHeight + padding,\n    positions = [];\n  while (barPos >= 0) {\n    positions.push(barPos);\n    barPos -= step;\n  }\n\n  const maxBarLength = Math.min(spaceWidth / 2, (aspectRatioPortrait.MAX_HEIGHT * (4 / 5)) / 2);\n  const chartPadding = Math.max((spaceWidth - 2 * maxBarLength) / 2, 1);\n\n  return {\n    barHeight: roundedBarHeight,\n    padding,\n    totalHeight,\n    positions,\n    maxBarLength,\n    chartPadding,\n  };\n}\n","/**\n * Small Multiples layout\n *\n * Used to generate group elements which contain small multiples charts.\n *\n * This component lays out rectangular groups in a grid according to the number of rows\n * and the number of columns provided. It is possible to specify paddingX and paddingY\n * values, pixel amounts which will be left as empty space between the columns and the\n * rows, respectively.\n *\n * Data should be passed to this component in a special way: it should be an array of\n * data values, where each data value represents a single group. IMPORTANT: each data\n * value must also have a property called 'values' which represents the values corresponding\n * to that group.\n *\n * In the multiple pie charts example, an array of \"groups\" data is bound to the chart before\n * the multiples component is called. Each element in the \"groups\" data has a values property\n * which contains the data for a single pie chart.\n *\n * The multiples component creates the groups and lays them out, attaching the following new properties\n * to each group object:\n *\n * gx - the x-position of the group\n * gy - the y-position of the group\n * gw - the width of the group (without padding)\n * gh - the height of the group (without padding)\n *\n * Generally, you should not use source data objects as group objects, but should instead\n * create new objects which are used to store group information. This creates a data hierarchy\n * which matches the representation hierarchy, which is very much a d3 pattern.\n *\n * Once the groups have been created, the user must still do something with them. The pattern\n * for creating charts within each group should look something like:\n *\n * chart.selectAll('.sszvis-multiple')\n *   .each(function(d) {\n *     var groupSelection = select(this);\n *\n *     ... do something which creates a chart using groupSelection ...\n *   });\n *\n * @module sszvis/layout/smallMultiples\n *\n * @property {number} width           the total width of the collection of multiples\n * @property {number} height          the total height of the collection of multiples\n * @property {number} paddingX        x-padding to put between columns\n * @property {number} paddingY        y-padding to put between rows\n * @property {number} rows            the number of rows to generate\n * @property {number} cols            the number of columns to generate\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"width\")\n    .prop(\"height\")\n    .prop(\"paddingX\")\n    .prop(\"paddingY\")\n    .prop(\"rows\")\n    .prop(\"cols\")\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const unitWidth = (props.width - props.paddingX * (props.cols - 1)) / props.cols;\n      const unitHeight = (props.height - props.paddingY * (props.rows - 1)) / props.rows;\n\n      const horizontalCenter = unitWidth / 2;\n      const verticalCenter = unitHeight / 2;\n\n      const multiples = selection\n        .selectAll(\"g.sszvis-multiple\")\n        .data(data)\n        .join(\"g\")\n        .classed(\"sszvis-g sszvis-multiple\", true);\n\n      multiples\n        .selectAll(\"g.sszvis-multiple-chart\")\n        .data((d) => [d.values])\n        .join(\"g\")\n        .classed(\"sszvis-multiple-chart\", true);\n\n      multiples\n        .datum((d, i) => {\n          d.gx = (i % props.cols) * (unitWidth + props.paddingX);\n          d.gw = unitWidth;\n          d.cx = horizontalCenter;\n          d.gy = Math.floor(i / props.cols) * (unitHeight + props.paddingY);\n          d.gh = unitHeight;\n          d.cy = verticalCenter;\n          return d;\n        })\n        .attr(\"transform\", (d) => \"translate(\" + d.gx + \",\" + d.gy + \")\");\n    });\n}\n","/**\n * Stacked Area Multiples Layout\n *\n * This function is used to compute layout parameters for the area multiples chart.\n *\n * @module sszvis/layout/stackedAreaMultiplesLayout\n *\n * @param  {number} height      The available height of the chart\n * @param  {number} num         The number of individual stacks to display\n * @param  {number} pct         the planned-for ratio between the space allotted to each area and the amount of space + area.\n *                              This value is used to compute the baseline positions for the areas, and how much vertical space to leave\n *                              between the areas.\n *\n * @return {object}             An object containing configuration properties for use in laying out the stacked area multiples.\n *                              {\n *                                range:          This is an array of baseline positions, counting from the top of the stack downwards.\n *                                                It should be used to configure a d3.scaleOrdinal(). The values passed into the ordinal\n *                                                scale will be given a y-value which descends from the top of the stack, so that the resulting\n *                                                scale will match the organization scheme of sszvis.stackedArea. Use the ordinal scale to\n *                                                configure the sszvis.stackedAreaMultiples component.\n *                                bandHeight:     The height of each multiples band. This can be used to configure the within-area y-scale.\n *                                                This height represents the height of the y-axis of the individual area multiple.\n *                                padHeight:      This is the amount of vertical padding between each area multiple.\n *                              }\n */\n\nexport default function (height, num, pct) {\n  pct || (pct = 0.1);\n  const step = height / (num - pct),\n    bandHeight = step * (1 - pct),\n    range = [];\n  let level = bandHeight; // count from the top, and start at the bottom of the first band\n  while (level - height < 1) {\n    range.push(level);\n    level += step;\n  }\n  return {\n    range,\n    bandHeight,\n    padHeight: step * pct,\n  };\n}\n","/**\n * Binned Color Scale Legend\n *\n * Use for displaying the values of discontinuous (binned) color scale's bins\n *\n * @module sszvis/legend/binnedColorScale\n *\n * @param {function} scale              A scale to use to generate the color values\n * @param {array} displayValues         An array of values which should be displayed. Usually these should be the bin edges\n * @param {array} endpoints             The endpoints of the scale (note that these are not necessarily the first and last\n *                                      bin edges). These will become labels at either end of the legend.\n * @param {number} width                The pixel width of the legend. Default 200\n * @param {function} labelFormat        A formatter function for the labels of the displayValues.\n *\n * @return {sszvis.component}\n */\n\nimport { select, scaleLinear } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport * as logger from \"../logger.js\";\nimport { halfPixel } from \"../svgUtils/crisp.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"scale\")\n    .prop(\"displayValues\")\n    .prop(\"endpoints\")\n    .prop(\"width\")\n    .width(200)\n    .prop(\"labelFormat\")\n    .labelFormat(fn.identity)\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      if (!props.scale) return logger.error(\"legend.binnedColorScale - a scale must be specified.\");\n      if (!props.displayValues)\n        return logger.error(\"legend.binnedColorScale - display values must be specified.\");\n      if (!props.endpoints)\n        return logger.error(\"legend.binnedColorScale - endpoints must be specified\");\n\n      const segHeight = 10;\n      const circleRad = segHeight / 2;\n      const innerRange = [0, props.width - 2 * circleRad];\n\n      const barWidth = scaleLinear().domain(props.endpoints).range(innerRange);\n      let sum = 0;\n      const rectData = [];\n      let pPrev = props.endpoints[0];\n      for (const p of props.displayValues) {\n        const w = barWidth(p) - sum;\n        const offset = sum % 1;\n        rectData.push({\n          x: Math.floor(circleRad + sum),\n          w: w + offset,\n          c: props.scale(pPrev),\n          p,\n        });\n        sum += w;\n        pPrev = p;\n      }\n\n      // add the final box (last display value - > endpoint)\n      rectData.push({\n        x: Math.floor(circleRad + sum),\n        w: innerRange[1] - sum,\n        c: props.scale(pPrev),\n      });\n\n      const circles = selection\n        .selectAll(\"circle.sszvis-legend__circle\")\n        .data(props.endpoints)\n        .join(\"circle\")\n        .classed(\"sszvis-legend__circle\", true);\n\n      circles\n        .attr(\"r\", circleRad)\n        .attr(\"cy\", circleRad)\n        .attr(\"cx\", (d, i) => (i === 0 ? circleRad : props.width - circleRad))\n        .attr(\"fill\", props.scale);\n\n      const segments = selection\n        .selectAll(\"rect.sszvis-legend__crispmark\")\n        .data(rectData)\n        .join(\"rect\")\n        .classed(\"sszvis-legend__crispmark\", true);\n\n      segments\n        .attr(\"x\", (d) => d.x)\n        .attr(\"y\", 0)\n        .attr(\"width\", (d) => d.w)\n        .attr(\"height\", segHeight)\n        .attr(\"fill\", (d) => d.c);\n\n      const lineData = rectData.slice(0, -1);\n\n      const lines = selection\n        .selectAll(\"line.sszvis-legend__crispmark\")\n        .data(lineData)\n        .join(\"line\")\n        .classed(\"sszvis-legend__crispmark\", true);\n\n      lines\n        .attr(\"x1\", (d) => halfPixel(d.x + d.w))\n        .attr(\"x2\", (d) => halfPixel(d.x + d.w))\n        .attr(\"y1\", segHeight + 1)\n        .attr(\"y2\", segHeight + 6)\n        .attr(\"stroke\", \"#B8B8B8\");\n\n      const labels = selection\n        .selectAll(\".sszvis-legend__axislabel\")\n        .data(lineData)\n        .join(\"text\")\n        .classed(\"sszvis-legend__axislabel\", true);\n\n      labels\n        .style(\"text-anchor\", \"middle\")\n        .attr(\"transform\", (d) => \"translate(\" + (d.x + d.w) + \",\" + (segHeight + 20) + \")\")\n        .text((d) => props.labelFormat(d.p));\n    });\n}\n","/**\n * Linear Color Scale Legend\n *\n * Use for displaying the values of a continuous linear color scale.\n *\n * @module sszvis/legend/linearColorScale\n *\n * @property {function} scale                   The scale to use to generate the legend\n * @property {array} displayValues              A list of specific values to display. If not specified, defaults to using scale.ticks\n * @property {number} width                     The pixel width of the legend (default 200).\n * @property {number} segments                  The number of segments to aim for. Note, this is only used if displayValues isn't specified,\n *                                              and then it is passed as the argument to scale.ticks for finding the ticks. (default)\n * @property {array} labelText                  Text or a text-returning function to use as the titles for the legend endpoints. If not supplied,\n *                                              defaults to using the first and last tick values.\n * @property {function} labelFormat             An optional formatter function for the end labels. Usually should be sszvis.formatNumber.\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport * as logger from \"../logger.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"scale\")\n    .prop(\"displayValues\")\n    .displayValues([])\n    .prop(\"width\")\n    .width(200)\n    .prop(\"segments\")\n    .segments(8)\n    .prop(\"labelText\")\n    .prop(\"labelFormat\")\n    .labelFormat(fn.identity)\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      if (!props.scale) {\n        logger.error(\"legend.linearColorScale - a scale must be specified.\");\n        return false;\n      }\n\n      const domain = props.scale.domain();\n\n      let values = props.displayValues;\n      if (values.length === 0 && props.scale.ticks) {\n        values = props.scale.ticks(props.segments - 1);\n      }\n      values.push(fn.last(domain));\n\n      // Avoid division by zero\n      const segWidth = values.length > 0 ? props.width / values.length : 0;\n      const segHeight = 10;\n\n      const segments = selection\n        .selectAll(\"rect.sszvis-legend__mark\")\n        .data(values)\n        .join(\"rect\")\n        .classed(\"sszvis-legend__mark\", true);\n\n      segments\n        .attr(\"x\", (d, i) => i * segWidth - 1) // The offsets here cover up half-pixel antialiasing artifacts\n        .attr(\"y\", 0)\n        .attr(\"width\", segWidth + 1) // The offsets here cover up half-pixel antialiasing artifacts\n        .attr(\"height\", segHeight)\n        .attr(\"fill\", (d) => props.scale(d));\n\n      const startEnd = [fn.first(domain), fn.last(domain)];\n      const labelText = props.labelText || startEnd;\n\n      // rounded end caps for the segments\n      const endCaps = selection\n        .selectAll(\"circle.ssvis-legend--mark\")\n        .data(startEnd)\n        .join(\"circle\")\n        .attr(\"class\", \"ssvis-legend--mark\");\n\n      endCaps\n        .attr(\"cx\", (d, i) => i * props.width)\n        .attr(\"cy\", segHeight / 2)\n        .attr(\"r\", segHeight / 2)\n        .attr(\"fill\", (d) => props.scale(d));\n\n      const labels = selection\n        .selectAll(\".sszvis-legend__label\")\n        .data(labelText)\n        .join(\"text\")\n        .classed(\"sszvis-legend__label\", true);\n\n      const labelPadding = 16;\n\n      labels\n        .style(\"text-anchor\", (d, i) => (i === 0 ? \"end\" : \"start\"))\n        .attr(\"dy\", \"0.35em\") // vertically-center\n        .attr(\n          \"transform\",\n          (d, i) =>\n            \"translate(\" +\n            (i * props.width + (i === 0 ? -1 : 1) * labelPadding) +\n            \", \" +\n            segHeight / 2 +\n            \")\"\n        )\n        .text((d, i) => props.labelFormat(d, i));\n    });\n}\n","/**\n * Radius size legend\n *\n * Use for showing how different radius sizes correspond to data values.\n *\n * @module sszvis/legend/radius\n *\n * @property {function} scale         A scale to use to generate the radius sizes\n * @property {function} [tickFormat]  Formatter function for the labels (default identity)\n * @property {array} [tickValues]     An array of domain values to be used as radii that the legend shows\n *\n * @returns {sszvis.component}\n */\n\nimport { select, mean } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { range } from \"../scale.js\";\nimport { halfPixel } from \"../svgUtils/crisp.js\";\nimport translateString from \"../svgUtils/translateString.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"scale\")\n    .prop(\"tickFormat\")\n    .tickFormat(fn.identity)\n    .prop(\"tickValues\")\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      const domain = props.scale.domain();\n      const tickValues = props.tickValues || [\n        domain[1],\n        props.scale.invert(mean(props.scale.range())),\n        domain[0],\n      ];\n      const maxRadius = range(props.scale)[1];\n\n      const group = selection\n        .selectAll(\"g.sszvis-legend__elementgroup\")\n        .data([0])\n        .join(\"g\")\n        .attr(\"class\", \"sszvis-legend__elementgroup\");\n\n      group.attr(\"transform\", translateString(halfPixel(maxRadius), halfPixel(maxRadius)));\n\n      const circles = group\n        .selectAll(\"circle.sszvis-legend__greyline\")\n        .data(tickValues)\n        .join(\"circle\")\n        .classed(\"sszvis-legend__greyline\", true);\n\n      function getCircleCenter(d) {\n        return maxRadius - props.scale(d);\n      }\n\n      function getCircleEdge(d) {\n        return maxRadius - 2 * props.scale(d);\n      }\n\n      circles.attr(\"r\", props.scale).attr(\"stroke-width\", 1).attr(\"cy\", getCircleCenter);\n\n      const lines = group\n        .selectAll(\"line.sszvis-legend__dashedline\")\n        .data(tickValues)\n        .join(\"line\")\n        .classed(\"sszvis-legend__dashedline\", true);\n\n      lines\n        .attr(\"x1\", 0)\n        .attr(\"y1\", getCircleEdge)\n        .attr(\"x2\", maxRadius + 15)\n        .attr(\"y2\", getCircleEdge);\n\n      const labels = group\n        .selectAll(\".sszvis-legend__label\")\n        .data(tickValues)\n        .join(\"text\")\n        .attr(\"class\", \"sszvis-legend__label sszvis-legend__label--small\");\n\n      labels\n        .attr(\"dx\", maxRadius + 18)\n        .attr(\"y\", getCircleEdge)\n        .attr(\"dy\", \"0.35em\") // vertically-center\n        .text(props.tickFormat);\n    });\n}\n","/**\n * Line component\n *\n * The line component is a general-purpose component used to render lines.\n *\n * The input data should be an array of arrays, where each inner array\n * contains the data points necessary to render a line. The line is then\n * composed of x- and y- values extracted from these data objects\n * using the x and y accessor functions.\n *\n * Each data object in a line's array is passed to the x- and y- accessors, along with\n * that data object's index in the array. For more information, see the documentation for\n * d3.line.\n *\n * In addition, the user can specify stroke and strokeWidth accessor functions. Because these\n * functions apply properties to the entire line, when called, they are give the entire array of line data\n * as an argument, plus the index of that array of line data within the outer array of lines. Note that this\n * differs slightly from the usual case in that dimension-related accessor functions are given different\n * data than style-related accessor functions.\n *\n * @module sszvis/component/line\n *\n * @property {function} x                An accessor function for getting the x-value of the line\n * @property {function} y                An accessor function for getting the y-value of the line\n * @property {function} [defined]        The key function to be used for the data join\n * @property {function} [key]            The key function to be used for the data join\n * @property {function} [valuesAccessor] An accessor function for getting the data points array of the line\n * @property {string, function} [stroke] Either a string specifying the stroke color of the line or lines,\n *                                       or a function which, when passed the entire array representing the line,\n *                                       returns a value for the stroke. If left undefined, the stroke is black.\n * @property {string, function} [strokeWidth] Either a number specifying the stroke-width of the lines,\n *                                       or a function which, when passed the entire array representing the line,\n *                                       returns a value for the stroke-width. The default value is 1.\n *\n * @return {sszvis.component}\n */\n\nimport { select, line as d3Line } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { defaultTransition } from \"../transition.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"x\")\n    .prop(\"y\")\n    .prop(\"stroke\")\n    .prop(\"strokeWidth\")\n    .prop(\"defined\")\n    .prop(\"key\")\n    .key((d, i) => i)\n    .prop(\"valuesAccessor\")\n    .valuesAccessor(fn.identity)\n    .prop(\"transition\")\n    .transition(true)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      // Layouts\n\n      const line = d3Line()\n        .defined(props.defined === undefined ? fn.compose(fn.not(isNaN), props.y) : props.defined)\n        .x(props.x)\n        .y(props.y);\n\n      // Rendering\n\n      let path = selection\n        .selectAll(\".sszvis-line\")\n        .data(data, props.key)\n        .join(\"path\")\n        .classed(\"sszvis-line\", true)\n        .style(\"stroke\", props.stroke);\n\n      path.order();\n\n      if (props.transition) {\n        path = path.transition(defaultTransition());\n      }\n\n      path\n        .attr(\"d\", fn.compose(line, props.valuesAccessor))\n        .style(\"stroke\", props.stroke)\n        .style(\"stroke-width\", props.strokeWidth);\n    });\n}\n","/**\n * Handle data load errors in a standardized way\n *\n * @module sszvis/loadError\n *\n * @param  {Error} The error object\n */\n\nimport * as logger from \"./logger.js\";\n\n// var RELOAD_MSG = 'Versuchen Sie, die Webseite neu zu laden. Sollte das Problem weiterhin bestehen, nehmen Sie mit uns Kontakt auf.';\n\nexport const loadError = function (error) {\n  logger.error(error);\n\n  // Don't use alert()!\n\n  // TODO: render an inline error in the chart instead\n\n  // if (error.status === 404) {\n  //   alert('Die Daten konnten nicht geladen werden.\\n\\n' + error.responseURL + '\\n\\n' + RELOAD_MSG);\n  // } else {\n  //   alert('Ein Fehler ist aufgetreten und die Visualisierung kann nicht angezeigt werden. ' + RELOAD_MSG);\n  // }\n};\n","/**\n * geojson renderer component\n *\n * @module sszvis/map/renderer/geojson\n *\n * A component used for rendering overlays of geojson above map layers.\n * It can be used to render any arbitrary GeoJson.\n *\n * @property {string} dataKeyName           The keyname in the data which will be used to match data entities\n *                                          with geographic entities. Default 'geoId'.\n * @property {string} geoJsonKeyName        The keyname in the geoJson which will be used to match map entities\n *                                          with data entities. Default 'id'.\n * @property {GeoJson} geoJson              The GeoJson object which should be rendered. Needs to have a 'features' property.\n * @property {d3.geo.path} mapPath          A path generator for drawing the GeoJson as SVG Path elements.\n * @property {Function, Boolean} defined    A function which, when given a data value, returns whether or not data in that value is defined.\n * @property {Function, String} fill        A function that returns a string, or a string, for the fill color of the GeoJson entities. Default black.\n * @property {String} stroke                The stroke color of the entities. Can be a string or a function returning a string. Default black.\n * @property {Number} strokeWidth           The thickness of the strokes of the shapes. Can be a number or a function returning a number. Default 1.25.\n * @property {Boolean} transitionColor      Whether or not to transition the fill color of the geojson when it changes. Default true.\n *\n * @return {sszvis.component}\n */\n\nimport { select, dispatch, geoCentroid } from \"d3\";\n\nimport * as fn from \"../../fn.js\";\nimport tooltipAnchor from \"../../annotation/tooltipAnchor.js\";\nimport ensureDefsElement from \"../../svgUtils/ensureDefsElement.js\";\nimport { mapMissingValuePattern } from \"../../patterns.js\";\nimport { slowTransition } from \"../../transition.js\";\nimport { GEO_KEY_DEFAULT } from \"../mapUtils.js\";\nimport { component } from \"../../d3-component.js\";\n\nexport default function () {\n  const event = dispatch(\"over\", \"out\", \"click\");\n\n  const geojsonComponent = component()\n    .prop(\"dataKeyName\")\n    .dataKeyName(GEO_KEY_DEFAULT)\n    .prop(\"geoJsonKeyName\")\n    .geoJsonKeyName(\"id\")\n    .prop(\"geoJson\")\n    .prop(\"mapPath\")\n    .prop(\"defined\", fn.functor)\n    .defined(true)\n    .prop(\"fill\", fn.functor)\n    .fill(\"black\")\n    .prop(\"stroke\", fn.functor)\n    .stroke(\"black\")\n    .prop(\"strokeWidth\", fn.functor)\n    .strokeWidth(1.25)\n    .prop(\"transitionColor\")\n    .transitionColor(true)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      // render the missing value pattern\n      ensureDefsElement(selection, \"pattern\", \"missing-pattern\").call(mapMissingValuePattern);\n\n      // getDataKeyName will be called on data values. It should return a map entity id.\n      // getMapKeyName will be called on the 'properties' of each map feature. It should\n      // return a map entity id. Data values are matched with corresponding map features using\n      // these entity ids.\n      const getDataKeyName = fn.prop(props.dataKeyName);\n      const getMapKeyName = fn.prop(props.geoJsonKeyName);\n\n      const groupedInputData = data.reduce((m, v) => {\n        m[getDataKeyName(v)] = v;\n        return m;\n      });\n\n      const mergedData = props.geoJson.features.map((feature) => ({\n        geoJson: feature,\n        datum: groupedInputData[getMapKeyName(feature.properties)],\n      }));\n\n      function getMapFill(d) {\n        return fn.defined(d.datum) && props.defined(d.datum)\n          ? props.fill(d.datum)\n          : \"url(#missing-pattern)\";\n      }\n\n      function getMapStroke(d) {\n        return fn.defined(d.datum) && props.defined(d.datum) ? props.stroke(d.datum) : \"\";\n      }\n\n      const geoElements = selection\n        .selectAll(\".sszvis-map__geojsonelement\")\n        .data(mergedData)\n        .join(\"path\")\n        .classed(\"sszvis-map__geojsonelement\", true)\n        .attr(\"data-event-target\", \"\")\n        .attr(\"fill\", getMapFill);\n\n      selection.selectAll(\".sszvis-map__geojsonelement--undefined\").attr(\"fill\", getMapFill);\n\n      geoElements\n        .classed(\n          \"sszvis-map__geojsonelement--undefined\",\n          (d) => !fn.defined(d.datum) || !props.defined(d.datum)\n        )\n        .attr(\"d\", (d) => props.mapPath(d.geoJson));\n\n      if (props.transitionColor) {\n        geoElements.transition().call(slowTransition).attr(\"fill\", getMapFill);\n      } else {\n        geoElements.attr(\"fill\", getMapFill);\n      }\n\n      geoElements.attr(\"stroke\", getMapStroke).attr(\"stroke-width\", props.strokeWidth);\n\n      selection\n        .selectAll(\"[data-event-target]\")\n        .on(\"mouseover\", (d) => {\n          event.over(d.datum);\n        })\n        .on(\"mouseout\", (d) => {\n          event.out(d.datum);\n        })\n        .on(\"click\", (d) => {\n          event.click(d.datum);\n        });\n\n      // the tooltip anchor generator\n      const ta = tooltipAnchor().position((d) => {\n        d.geoJson.properties || (d.geoJson.properties = {});\n\n        let sphericalCentroid = d.geoJson.properties.sphericalCentroid;\n        if (!sphericalCentroid) {\n          d.geoJson.properties.sphericalCentroid = sphericalCentroid = geoCentroid(d.geoJson);\n        }\n\n        return props.mapPath.projection()(sphericalCentroid);\n      });\n\n      const tooltipGroup = selection.selectGroup(\"tooltipAnchors\").datum(mergedData);\n\n      // attach tooltip anchors\n      tooltipGroup.call(ta);\n    });\n\n  geojsonComponent.on = function () {\n    const value = event.on.apply(event, arguments);\n    return value === event ? geojsonComponent : value;\n  };\n\n  return geojsonComponent;\n}\n","/**\n * image render component\n *\n * @module  sszvis/map/renderer/image\n *\n * Used for rendering an image layer, usually as a complement to a map. This is used in examples\n * for the topographic layer. It could also be used in other contexts, but the map usage is\n * the most straightforward.\n *\n * @property {Function} projection      The map projection function used to position the image in pixels. Uses the upper left\n *                                      and lower right corners of the image as geographical place markers to align with other map layers.\n * @property {String} src               The source of the image you want to use. This should be ither a URL for an image hosted on the same\n *                                      server that hosts the page, or a base64-encoded dataURL. For example, the zurich topolayer map module.\n * @property {Array} geoBounds          This should be a 2D array containing the upper-left (north-west) and lower-right (south-east)\n *                                      coordinates of the corresponding corners of the image. The structure expected is:\n *\n *                                      [[nw-longitude, nw-latitude], [se-longitude, se-latitude]]\n *\n *                                      This is consistent with the way D3 handles similar geographic data. These coordinates are used to represent\n *                                      the edge of the image being used, and to align the image with other map layers (using the projection function).\n *                                      Note: it is possible that even with precise corner coordinates, some mismatch may still occur. This\n *                                      will happen if the image itself is generated using a different type of map projection than the one used by the\n *                                      projection function. SSZVIS uses a Mercator projection by default, but others from d3.geo can be used if desired.\n * @property {Number} opacity           The opacity of the resulting image layer. This will be applied to the entire image, and is sometimes useful when layering.\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\nimport { component } from \"../../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"projection\")\n    .prop(\"src\")\n    .prop(\"geoBounds\")\n    .prop(\"opacity\")\n    .opacity(1)\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      const image = selection\n        .selectAll(\".sszvis-map__image\")\n        .data([0]) // At the moment, 1 image per container\n        .join(\"img\")\n        .classed(\"sszvis-map__image\", true);\n\n      const topLeft = props.projection(props.geoBounds[0]);\n      const bottomRight = props.projection(props.geoBounds[1]);\n\n      image\n        .attr(\"src\", props.src)\n        .style(\"left\", Math.round(topLeft[0]) + \"px\")\n        .style(\"top\", Math.round(topLeft[1]) + \"px\")\n        .style(\"width\", Math.round(bottomRight[0] - topLeft[0]) + \"px\")\n        .style(\"height\", Math.round(bottomRight[1] - topLeft[1]) + \"px\")\n        .style(\"opacity\", props.opacity);\n    });\n}\n","/**\n * raster renderer component\n *\n * @module  sszvis/map/renderer/raster\n *\n * Used for rendering a raster layer within a map (can also be used in other contexts, but the map usage\n * is the most straightforward). Requires a width and a height for the raster layer, a function which\n * returns raster positions, and one which returns fill colors.\n *\n * @property {Boolean} debug         Whether to activate debug mode, which shows a red square over the whole\n *                                   canvas, for testing alignment with other map layers.\n * @property {Number} width          The width of the canvas\n * @property {Number} height         The height of the canvas\n * @property {Function} position     A function which takes a datum and returns a position for the corresponding\n *                                   raster square, returned as [x, y] pairs.\n * @property {Number} cellSide       The length (in pixels) of one side of each raster cell\n * @property {Function} fill         The fill function. Takes a datum and should return a fill color for the datum's pixel.\n * @property {Number} opacity        The opacity of the canvas. Defaults to 1\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../../fn.js\";\nimport { component } from \"../../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"debug\")\n    .debug(false)\n    .prop(\"width\")\n    .prop(\"height\")\n    .prop(\"position\")\n    .prop(\"cellSide\")\n    .cellSide(2)\n    .prop(\"fill\", fn.functor)\n    .prop(\"opacity\")\n    .opacity(1)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const canvas = selection\n        .selectAll(\".sszvis-map__rasterimage\")\n        .data([0])\n        .join(\"canvas\")\n        .classed(\"sszvis-map__rasterimage\", true);\n\n      canvas\n        .attr(\"width\", props.width)\n        .attr(\"height\", props.height)\n        .style(\"opacity\", props.opacity);\n\n      const ctx = canvas.node().getContext(\"2d\");\n\n      ctx.clearRect(0, 0, props.width, props.height);\n\n      if (props.debug) {\n        // Displays a rectangle that fills the canvas.\n        // Useful for checking alignment with other render layers.\n        ctx.fillStyle = \"rgba(255, 0, 0, 0.2)\";\n        ctx.fillRect(0, 0, props.width, props.height);\n      }\n\n      const halfSide = props.cellSide / 2;\n      for (const datum of data) {\n        const position = props.position(datum);\n        ctx.fillStyle = props.fill(datum);\n        ctx.fillRect(\n          position[0] - halfSide,\n          position[1] - halfSide,\n          props.cellSide,\n          props.cellSide\n        );\n      }\n    });\n}\n","/**\n * Nested Stacked Bars Vertical component\n *\n * This component renders a nested stacked bar chart with vertical orientation.\n * It uses the same abstract intermediate representation for the stack, but is rendered\n * using vertical dimensions. Note that using this component will add the properties 'y0'\n * and 'y' to any passed-in data objects, as part of computing the stack intermediate representation.\n * Existing properties with these names will be overwritten.\n *\n * @module sszvis/component/nestedStackedBarsVertical\n *\n * @property {function} offset              Specifies an offset function for positioning the nested groups.\n * @property {function} xScale              Specifies an x-scale for the stack layout. This scale is used to position\n *                                          the elements of each stack, both the left offset value and the width of each stack segment.\n * @property {function} yScale              A y-scale. After the stack is computed, the y-scale is used to position each stack.\n * @property {function} fill                Specify a fill value for the rectangles (default black).\n * @property {function} tooltip             Specify a tooltip function for the rectangles.\n * @property {function} xAcc                Specifies an x-accessor for the stack layout. The result of this function\n *                                          is used to compute the horizontal extent of each element in the stack.\n *                                          The return value must be a number.\n * @property {function} xLabel              Specifies a label for the x-axis.\n * @property {string} slant                 Specifies the slant of the x-axis labels.\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { component } from \"../d3-component.js\";\nimport { axisX } from \"../axis.js\";\nimport { stackedBarVertical } from \"./stackedBar.js\";\nimport translateString from \"../svgUtils/translateString.js\";\n\nexport const nestedStackedBarsVertical = () =>\n  component()\n    .prop(\"offset\", fn.functor)\n    .prop(\"xScale\", fn.functor)\n    .prop(\"yScale\", fn.functor)\n    .prop(\"fill\", fn.functor)\n    .prop(\"tooltip\", fn.functor)\n    .prop(\"xAcc\", fn.functor)\n    .prop(\"xLabel\", fn.functor)\n    .prop(\"xLabel\", fn.functor)\n    .prop(\"slant\")\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const { offset, xScale, yScale, fill, tooltip, xAcc, xLabel } = props;\n\n      const xAxis = axisX\n        .ordinal()\n        .scale(xScale)\n        .ticks(1)\n        .tickSize(0)\n        .orient(\"bottom\")\n        .slant(props.slant)\n        .title(xLabel);\n\n      const group = selection.selectAll(\"[data-nested-stacked-bars]\").data(data);\n\n      const nestedGroups = group\n        .join(\"g\")\n        .attr(\"data-nested-stacked-bars\", (d) => xAcc(d[0][0].data));\n\n      nestedGroups.attr(\"transform\", (d) => `translate(${offset(d)} 0)`);\n\n      nestedGroups\n        .selectGroup(\"nested-x-axis\")\n        .attr(\"transform\", translateString(0, yScale(0)))\n        .call(xAxis);\n\n      const stackedBars = stackedBarVertical()\n        .xScale(xScale)\n        .width(xScale.bandwidth())\n        .yScale(yScale)\n        .fill(fill);\n\n      const bars = nestedGroups.selectGroup(\"barchart\").call(stackedBars);\n\n      bars.selectAll(\"[data-tooltip-anchor]\").call(tooltip);\n    });\n","/**\n * Panning behavior\n *\n * This behavior is used for adding \"panning\" functionality to a set of chart elements.\n * The \"panning\" functionality refers to a combination of mouseover and touch responsiveness,\n * where on a mouse interaction an event is fired on hover, but the touch interaction is more\n * complex. The idea is to sort of imitate the way a hover interaction works, but with only a\n * finger. When a user starts a touch on an element which has this behavior enabled, the\n * default scrolling behavior of the browser will be canceled. The user can then move\n * their finger across the surface of the screen, onto other elements, and the scroll\n * will be canceled. When the finger moves onto other elements with this behavior attached,\n * the event will be fired. Meanwhile, if the user starts the interaction somewhere outside\n * an element, the scroll will happen as usual, and if they move onto an activated element,\n * no event will be fired and the scrolling will continue.\n *\n * This behavior is applied to all the children of a selection which match the elementSelector\n * property. Event listeners are attached to each of the child elements. The elementSelector\n * property is necessary to know which elements to attach to (and therefore to also avoid\n * attaching event listeners to elements which shouldn't be interaction-active).\n *\n * @module sszvis/behavior/panning\n *\n * @property {String} elementSelector    This should be a string selector that matches child\n *                                       elements of the selection on which this component\n *                                       is rendered using the .call(component) pattern. All\n *                                       child elements will have the panning event listeners\n *                                       attached to them.\n * @property {String, Function} on       The .on() method should specify an event name and a handler\n *                                       function for that event. The supported events are:\n *                                       'start' - when the interaction starts on an element.\n *                                       'pan' - when the user pans on the same element or onto another\n *                                       element (note, no 'start' event will be fired when the user\n *                                       pans with a touch from one element onto another, since this\n *                                       behavior is too difficult to test for and emulate).\n *                                       'end' - when the interaction with an element ends.\n *\n * @return {d3.component}\n */\n\nimport { select, dispatch } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { datumFromPanEvent } from \"./util.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  const event = dispatch(\"start\", \"pan\", \"end\");\n\n  const panningComponent = component()\n    .prop(\"elementSelector\")\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      const elements = selection.selectAll(props.elementSelector);\n\n      elements\n        .attr(\"data-sszvis-behavior-pannable\", \"\")\n        .classed(\"sszvis-interactive\", true)\n        .on(\"mouseenter\", function () {\n          event.apply(\"start\", this, arguments);\n        })\n        .on(\"mousemove\", function () {\n          event.apply(\"pan\", this, arguments);\n        })\n        .on(\"mouseleave\", function () {\n          event.apply(\"end\", this, arguments);\n        })\n        .on(\"touchstart\", function (e) {\n          e.preventDefault();\n          event.apply(\"start\", this, arguments);\n        })\n        .on(\"touchmove\", function (e) {\n          e.preventDefault();\n          const datum = datumFromPanEvent(fn.firstTouch(e));\n          if (datum === null) {\n            event.apply(\"end\", this, arguments);\n          } else {\n            event.apply(\"pan\", this, arguments);\n          }\n        })\n        .on(\"touchend\", function () {\n          event.apply(\"end\", this, arguments);\n        });\n    });\n\n  panningComponent.on = function () {\n    const value = event.on.apply(event, arguments);\n    return value === event ? panningComponent : value;\n  };\n\n  return panningComponent;\n}\n","/**\n * Pie component\n *\n * The pie component is used to draw pie charts. It uses the d3.arc() generator\n * to create pie wedges.\n *\n * THe input data should be an array of data values, where each data value represents one wedge in the pie.\n *\n * @module sszvis/component/pie\n *\n * @property {number} radius                  The radius of the pie chart (no default)\n * @property {string, function} fill          a fill color for wedges in the pie (default black). Ideally a function\n *                                            which takes a data value.\n * @property {string, function} stroke        the stroke color for wedges in the pie (default none)\n * @property {string, function} angle         specifys the angle of the wedges in radians. Theoretically this could be\n *                                            a constant, but that would make for a very strange pie. Ideally, this\n *                                            is a function which takes a data value and returns the angle in radians.\n *\n * @return {sszvis.component}\n */\n\nimport { select, arc, interpolate } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { defaultTransition } from \"../transition.js\";\nimport tooltipAnchor from \"../annotation/tooltipAnchor.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"radius\")\n    .prop(\"fill\")\n    .prop(\"stroke\")\n    .prop(\"angle\", fn.functor)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const stroke = props.stroke || \"#FFFFFF\";\n\n      let angle = 0;\n      for (const value of data) {\n        // In order for an angle transition to work correctly in d3, the transition must be done in data space.\n        // The computed arc path itself cannot be interpolated without error.\n        // see http://bl.ocks.org/mbostock/5100636 for a straightforward example.\n        // However, due to the structure of sszvis and the way d3 data joining works, this poses a bit of a challenge,\n        // since old and new data values could be on different objects, and they need to be merged.\n        // In the code that follows, value._a0 and value._a1 are the destination angles for the transition.\n        // value.a0 and value.a1 are the current values in the transition (either the initial value, some intermediate value, or the final angle value).\n        value._a0 = angle;\n        // These a0 and a1 values may be overwritten later if there is already data bound at this data index. (see the .each function further down).\n        if (value.a0 == undefined || isNaN(value.a0)) value.a0 = angle;\n        angle += props.angle(value);\n        value._a1 = angle;\n        // data values which don't already have angles set start out at the complete value.\n        if (value.a1 == undefined || isNaN(value.a1)) value.a1 = angle;\n      }\n\n      const arcGen = arc()\n        .innerRadius(4)\n        .outerRadius(props.radius)\n        .startAngle((d) => d.a0)\n        .endAngle((d) => d.a1);\n\n      const segments = selection\n        .selectAll(\".sszvis-path\")\n        .each((d, i) => {\n          // This matches the data values iteratively in the same way d3 will when it does the data join.\n          // This is kind of a hack, but it's the only way to get any existing angle values from the already-bound data\n          if (data[i]) {\n            data[i].a0 = d.a0;\n            data[i].a1 = d.a1;\n          }\n        })\n        .data(data)\n        .join(\"path\")\n        .classed(\"sszvis-path\", true)\n        .attr(\"transform\", \"translate(\" + props.radius + \",\" + props.radius + \")\")\n        .attr(\"fill\", props.fill)\n        .attr(\"stroke\", stroke);\n\n      segments\n        .transition(defaultTransition())\n        .attr(\"transform\", \"translate(\" + props.radius + \",\" + props.radius + \")\")\n        .attrTween(\"d\", (d) => {\n          const angle0Interp = interpolate(d.a0, d._a0);\n          const angle1Interp = interpolate(d.a1, d._a1);\n          return function (t) {\n            d.a0 = angle0Interp(t);\n            d.a1 = angle1Interp(t);\n            return arcGen(d);\n          };\n        })\n        .attr(\"fill\", props.fill)\n        .attr(\"stroke\", stroke);\n\n      const ta = tooltipAnchor().position((d) => {\n        // The correction by - Math.PI / 2 is necessary because d3 automatically (and with brief, buried documentation!)\n        // makes the same correction to svg.arc() angles :o\n        const a = d.a0 + Math.abs(d.a1 - d.a0) / 2 - Math.PI / 2;\n        const r = (props.radius * 2) / 3;\n        return [props.radius + Math.cos(a) * r, props.radius + Math.sin(a) * r];\n      });\n\n      selection.datum(data).call(ta);\n    });\n}\n","/**\n * ResponsiveProps module\n *\n * @module sszvis/responsiveProps\n *\n *\n *\n * The module should be configured with any number of different properties that change\n * based on breakpoints, plus (optional) breakpoint configuration, and then called\n * as a function. You must pass in an object with 'width' and 'screenHeight' properties.\n * This is the kind of thing which is returned from sszvis.bounds and sszvis.measureDimensions.\n *\n *\n * The return value of the function call is an object which has properties corresponding to\n * the properties you configured before. The property values are decided based on testing the breakpoints\n * against the measured values and finding the first one in which the measured values fit.\n *\n * Example usage:\n *\n * var queryProps = sszvis.responsiveProps()\n *   .breakpoints([\n *     { name: 'small', width:  400 },\n *     { name: 'medium', width:  800 },\n *     { name: 'large', width: 1000 }\n *   ])\n *   .prop('axisOrientation', {\n *     medium: 'left',\n *     _: 'bottom'\n *   })\n *   .prop('height', {\n *     small: function(w) { return w / (16 / 9); },\n *     medium: function(w) { return w / (20 / 9); },\n *     large: function(w) { return w / (28 / 9); },\n *     _: function(w) { return w / (38 / 9); }\n *   })\n *   .prop('numAxisTicks', {\n *     small: 4,\n *     medium: 8,\n *     large: 12,\n *     _: 16\n *   });\n *\n * var props = queryProps(sszvis.measureDimensions('#sszvis-chart'));\n * --- OR ---\n * var props = queryProps(sszvis.bounds({ ... }, '#sszvis-chart'));\n *\n * ... use props.axisOrientation, props.height, and props.numAxisTicks ...\n *\n * @returns {responsiveProps}\n */\n\nimport {\n  breakpointCreateSpec,\n  breakpointDefaultSpec,\n  breakpointFindByName,\n  breakpointMatch,\n} from \"./breakpoint.js\";\nimport * as fn from \"./fn.js\";\nimport * as logger from \"./logger.js\";\n\n/* Exported module\n----------------------------------------------- */\nexport function responsiveProps() {\n  let breakpointSpec = breakpointDefaultSpec();\n  const propsConfig = {};\n\n  /**\n   * Constructor\n   *\n   * @param   {{width: number, screenHeight: number}} arg1 Accepts a 'measurements' object with a\n   *          'width' property and a 'screenHeight' property. This makes it possible to pass\n   *          in a sszvis.bounds object or the result of sszvis.measureDimensions.\n   *\n   * @returns {Object.<string, any>} A map of all properties for the currently selected\n   *          breakpoint as defined by the parameter `arg1`\n   */\n  function _responsiveProps(measurement) {\n    if (!fn.isObject(measurement) || !isBounds(measurement)) {\n      logger.warn(\"Could not determine the current breakpoint, returning the default props\");\n      // We choose the _ option for all configured props as a default.\n      return Object.keys(propsConfig).reduce((memo, val, key) => {\n        memo[key] = val._;\n        return memo;\n      }, {});\n    }\n\n    // Finds out which breakpoints the provided measurements match up with\n    const matchingBreakpoints = breakpointMatch(breakpointSpec, measurement);\n\n    return Object.keys(propsConfig).reduce((memo, propKey) => {\n      const propSpec = propsConfig[propKey];\n\n      if (!validatePropSpec(propSpec, breakpointSpec)) {\n        logger.warn(\n          'responsiveProps was given an invalid propSpec for property: \"' +\n            propKey +\n            '\". The spec: ',\n          propSpec\n        );\n        return memo;\n      }\n\n      // Find the first breakpoint entry in the propSpec which matches one of the matched breakpoints\n      // This function should always at least find '_' at the end of the array.\n      const matchedBreakpoint = fn.find((bp) => fn.defined(propSpec[bp.name]), matchingBreakpoints);\n      // the value in the query object for that property equals the propSpec value as a functor,\n      // invoked if necessary with the current width. Providing the width allows aspect ratio\n      // calculations based on element width.\n      memo[propKey] = propSpec[matchedBreakpoint.name](measurement.width);\n\n      return memo;\n    }, {});\n  }\n\n  /**\n   * responsiveProps.prop\n   *\n   * Define a responsive property that can assume different values depending on the\n   * currently active breakpoint.\n   *\n   * @example\n   * var queryProps = sszvis.responsiveProps()\n   *   .prop('height', {\n   *     palm: function(width) { return width /  (4/3); },\n   *     lap:  function(width) { return width / (16/9); },\n   *     _: 600 // You must always define a default case\n   *   });\n   *\n   * The algorithm looks for the lowest applicable breakpoint. If a breakpoint's width or\n   * screenHeight are larger than the current container and screen dimensions, its properties\n   * will not apply. In case no breakpoint matches, the fallback value is used; it must always\n   * be provided with the key name '_'.\n   *\n   * Each value can be either a raw value or a function which takes the current width\n   * and returns a value for the property. These functions can be used to lazily calculate\n   * properties (they are only executed when the module is called as a function),\n   * and to change property values for a given breakpoint as a function of the width,\n   * for example to do height calculation with a custom aspect ratio.\n   *\n   * @param {string} propName The name of the property you want to define\n   * @param {Object.<string, (Function(number) -> *|*)>} propSpec A map of breakpoint names to\n   *        property values. Key names must be valid breakpoint names. These can either be the\n   *        default breakpoint names (see sszvis.breakpoint) or user-defined names that match up\n   *        to breakpoints you have provided. Additionally, the fallback key `_` must be defined;\n   *        its value will be used for screens larger than the largest breakpoint. You don't\n   *        have to define all breakpoints; if you skip a breakpoint, the next applicable breakpoint\n   *        in the test list will be used. Values can be either plain values or\n   *        functions that accept the current breakpoint width and return a value.\n   *\n   * @return {responsiveProps}\n   */\n  _responsiveProps.prop = function (propName, propSpec) {\n    propsConfig[propName] = functorizeValues(propSpec);\n    return _responsiveProps;\n  };\n\n  /**\n   * responsiveProps.breakpoints\n   *\n   * Configure custom breakpoints for the responsiveProps. You don't need to call\n   * this method; there are default breakpoints (see sszvis.breakpoint).\n   * You should provide an array of breakpoint specifiers, each one an object with at\n   * least a 'name' property (used as an identifier for the breakpoint), and one or both\n   * of a 'width' or 'screenHeight' property. When choosing a matching breakpoint, the\n   * 'width' will be compared to the provided container width, and the 'screenHeight'\n   * to the window.innerHeight. These values are inclusive, so if the measured value is\n   * equal to or less than the provided breakpoint value, that breakpoint matches.\n   *\n   * This component has default breakpoints which are equal to the ones described\n   * in the sszvis.breakpoint module. This method can also be called without arguments\n   * to get the breakpoints list.\n   *\n   * @param {Array.<Object.<string, (string|number)>>} [bps] Define the breakpoints to be used.\n   *                                                   Object format is:\n   *                                                     {\n   *                                                       name: breakpointname,\n   *                                                       width: (optional) container width of this bp\n   *                                                       screenHeight: (optional) window.innerHeight of this bp\n   *                                                     }\n   *                                                   if neither width nor screenHeight is provided, the breakpoint\n   *                                                   will match all possible dimensions.\n   *\n   * @example\n   * var queryProps = sszvis.responsiveProps()\n   * .breakpoints([\n   *   { name: 'small', width: 300 },\n   *   { name: 'medium', width: 500 },\n   *   { name: 'large', width: 700 }\n   * ])\n   */\n  _responsiveProps.breakpoints = function (bps) {\n    if (arguments.length === 0) {\n      return breakpointSpec;\n    }\n    breakpointSpec = breakpointCreateSpec(bps);\n    return _responsiveProps;\n  };\n\n  return _responsiveProps;\n}\n\n// Helpers\n\nfunction isBounds(arg1) {\n  return (\n    fn.defined(arg1) &&\n    fn.defined(arg1.width) &&\n    fn.defined(arg1.screenWidth) &&\n    fn.defined(arg1.screenHeight)\n  );\n}\n\n/**\n * functorizeValues\n * @prop    {object} obj Original key-value object\n * @returns {object} Same as input object but with all values transformed to fn.functors\n */\nfunction functorizeValues(obj) {\n  return Object.keys(obj).reduce((memo, key) => {\n    memo[key] = fn.functor(obj[key]);\n    return memo;\n  }, {});\n}\n\nfunction validatePropSpec(propSpec, breakpointSpec) {\n  // Ensure that the propSpec contains a '_' value.\n  // This is used as the default value when the test width\n  // is larger than any breakpoint.\n  if (!fn.defined(propSpec._)) {\n    return false;\n  }\n\n  // Validate the properties of the propSpec:\n  // each should be a valid breakpoint name, and its value should be defined\n  for (const breakpointName in propSpec) {\n    if (\n      Object.prototype.hasOwnProperty.call(propSpec, breakpointName) &&\n      breakpointName !== \"_\" &&\n      !fn.defined(breakpointFindByName(breakpointSpec, breakpointName))\n    ) {\n      return false;\n    }\n  }\n\n  // All checks passed, propSpec is valid\n  return true;\n}\n","/**\n * Sankey component\n *\n * This component is used for making sankey diagrams, also known as parallel sets diagrams. They\n * depict individual entities as bars, and flows between those entities as thick links connecting\n * those bars. The entities can be many things associated with flows, for example organizations,\n * geographic regions, or websites, while the links between them can represent many kinds of flows,\n * for example payments of money, movements of people, or referral of browsing traffic. In this component,\n * the entities are referred to as 'nodes', and the connections between them are referred to as 'links'.\n *\n * @module sszvis/component/sankey\n *\n * @property {Function} sizeScale                    A scale function for the size of the nodes. The domain and the range should\n *                                                   be configured using values returned by the sszvis.layout.sankey.computeLayout\n *                                                   function.\n * @property {Function} columnPosition               A scale function for the position of the columns of nodes.\n *                                                   Should be configured using a value returned by the sszvis.layout.sankey.computeLayout function.\n * @property {Number} nodeThickness                  A number for the horizontal thickness of the node bars.\n *                                                   Should be configured using a value returned by the sszvis.layout.sankey.computeLayout function.\n * @property {Number} nodePadding                    A number for padding between the nodes.\n *                                                   Should be configured using a value returned by the sszvis.layout.sankey.computeLayout function.\n * @property {Number, Function} columnPadding        A number, or function that takes a column index and returns a number,\n *                                                   for padding at the top of each column. Used to vertically center the columns.\n * @property {String, Function} columnLabel          A string, or a function that returns a string, for the label at the top of each column.\n * @property {Number} columnLabelOffset              A value for offsetting the column labels in the x axis. Used to move the column labels around if you\n *                                                   don't want them to be centered on the columns. This is useful in situations where the normal label would\n *                                                   overlap outer boundaries or otherwise be inconveniently positioned. You can usually forget this, except\n *                                                   perhaps in very narrow screen layouts.\n * @property {Number} linkCurvature                  A number to specify the amount of 'curvature' of the links. Should be between 0 and 1. Default 0.5.\n * @property {Color, Function} nodeColor             Color for the nodes. Can be a function that takes a node's data and returns a color.\n * @property {Color, Function} linkColor             Color for the links. Can be a function that takes a link's data and returns a color.\n * @property {Function} linkSort                     A function determining how to sort the links, which are rendered stacked on top of each other.\n *                                                   The default implementation stacks links in decresing order of value, i.e. larger, thicker links\n *                                                   are below smaller, thinner ones.\n * @property {String, Function} labelSide            A function determining the position of labels for the nodes. Should take a column index and\n *                                                   return a side ('left' or 'right'). Default is always 'left'.\n * @property {Boolean} labelSideSwitch               A boolean used to determine whether to switch the label side. When true, 'left' labels will be shown on\n *                                                   the right side, and 'right' labels on the left side. This is useful as a switch to be flipped in very\n *                                                   narrow screen layouts, when you want the labels to appear on the opposite side of the columns they refer to.\n * @property {Number} labelOpacity                   A value for the opacity of the column labels. You can change this to affect the visibility of the column\n *                                                   labels, for instance to hide them when they would overlap with user-triggered hover labels.\n * @property {Number} labelHitBoxSize                A number for the width of 'hit boxes' added underneath the labels. This should basically be\n *                                                   equal to the width of the widest label. For performance reasons, it doesn't make sense to calculate\n *                                                   this value at run time while the component is rendered. Far better is to position the chart so that the\n *                                                   labels are visible, find the value of the widest label, and use that.\n * @property {Function} nameLabel                    A function which takes the id of a node and should return the label for that node. Defaults tousing\n *                                                   the id directly.\n * @property {Array} linkSourceLabels                An array containing the data for links which should have labels on their 'source' end, that is the\n *                                                   end of the link which is connected to the source node. These data values should match the values\n *                                                   returned by sszvis.layout.sankey.prepareData. For performance reasons, you need to give the data\n *                                                   values themselves here. See the examples for an implementation of the most straightforward\n *                                                   mechanism for this.\n * @property {Array} linkTargetLabels                An array containing data for links which should have labels on their 'target' end, that is the\n *                                                   end of the link which is connected to the target node. Works the same as linkSourceLabels, but used\n *                                                   for another set of possible link labels.\n * @property {String, Function} linkLabel            A string or function returning a string to use for the label of each link. Function\n *                                                   versions should accept a link datum (like the ones passed into linkSourceLabels or linkTargetLabels)\n *                                                   and return text.\n *\n * @return {sszvis.component}\n */\n\nimport { select, interpolateNumber } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport tooltipAnchor from \"../annotation/tooltipAnchor.js\";\nimport { halfPixel } from \"../svgUtils/crisp.js\";\nimport translateString from \"../svgUtils/translateString.js\";\nimport bar from \"./bar.js\";\nimport { component } from \"../d3-component.js\";\n\nconst linkPathString = function (x0, x1, x2, x3, y0, y1) {\n  return \"M\" + x0 + \",\" + y0 + \"C\" + x1 + \",\" + y0 + \" \" + x2 + \",\" + y1 + \" \" + x3 + \",\" + y1;\n};\nconst linkBounds = function (x0, x1, y0, y1) {\n  return [x0, x1, y0, y1];\n};\n\nexport default function () {\n  return component()\n    .prop(\"sizeScale\")\n    .prop(\"columnPosition\")\n    .prop(\"nodeThickness\")\n    .prop(\"nodePadding\")\n    .prop(\"columnPadding\", fn.functor)\n    .prop(\"columnLabel\", fn.functor)\n    .columnLabel(\"\")\n    .prop(\"columnLabelOffset\", fn.functor)\n    .columnLabelOffset(0)\n    .prop(\"linkCurvature\")\n    .linkCurvature(0.5)\n    .prop(\"nodeColor\", fn.functor)\n    .prop(\"linkColor\", fn.functor)\n    .prop(\"linkSort\", fn.functor)\n    .linkSort((a, b) => a.value - b.value) // Default sorts in descending order of value\n    .prop(\"labelSide\", fn.functor)\n    .labelSide(\"left\")\n    .prop(\"labelSideSwitch\")\n    .prop(\"labelOpacity\", fn.functor)\n    .labelOpacity(1)\n    .prop(\"labelHitBoxSize\")\n    .labelHitBoxSize(0)\n    .prop(\"nameLabel\")\n    .nameLabel(fn.identity)\n    .prop(\"linkSourceLabels\")\n    .linkSourceLabels([])\n    .prop(\"linkTargetLabels\")\n    .linkTargetLabels([])\n    .prop(\"linkLabel\", fn.functor)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const idAcc = fn.prop(\"id\");\n\n      const getNodePosition = function (node) {\n        return Math.floor(\n          props.columnPadding(node.columnIndex) +\n            props.sizeScale(node.valueOffset) +\n            props.nodePadding * node.nodeIndex\n        );\n      };\n      const xPosition = function (node) {\n        return props.columnPosition(node.columnIndex);\n      };\n      const yPosition = function (node) {\n        return getNodePosition(node);\n      };\n      const xExtent = function () {\n        return Math.max(props.nodeThickness, 1);\n      };\n      const yExtent = function (node) {\n        return Math.ceil(Math.max(props.sizeScale(node.value), 1));\n      };\n\n      const linkPadding = 1; // Default value for padding between nodes and links - cannot be changed\n\n      // Draw the nodes\n      const barGen = bar()\n        .x(xPosition)\n        .y(yPosition)\n        .width(xExtent)\n        .height(yExtent)\n        .fill(props.nodeColor);\n\n      const barGroup = selection.selectGroup(\"nodes\").datum(data.nodes);\n\n      barGroup.call(barGen);\n\n      const barTooltipAnchor = tooltipAnchor().position((node) => [\n        xPosition(node) + xExtent() / 2,\n        yPosition(node) + yExtent(node) / 2,\n      ]);\n\n      barGroup.call(barTooltipAnchor);\n\n      // Draw the column labels\n      const columnLabelX = function (colIndex) {\n        return props.columnPosition(colIndex) + props.nodeThickness / 2;\n      };\n      const columnLabelY = -24;\n\n      const columnLabels = barGroup\n        .selectAll(\".sszvis-sankey-column-label\")\n        // One number for each column\n        .data(data.columnLengths)\n        .join(\"text\")\n        .attr(\"class\", \"sszvis-sankey-label sszvis-sankey-weak-label sszvis-sankey-column-label\");\n\n      columnLabels\n        .attr(\"transform\", (d, i) =>\n          translateString(columnLabelX(i) + props.columnLabelOffset(d, i), columnLabelY)\n        )\n        .text((d, i) => props.columnLabel(i));\n\n      const columnLabelTicks = barGroup\n        .selectAll(\".sszvis-sankey-column-label-tick\")\n        .data(data.columnLengths)\n        .join(\"line\")\n        .attr(\"class\", \"sszvis-sankey-column-label-tick\");\n\n      columnLabelTicks\n        .attr(\"x1\", (d, i) => halfPixel(columnLabelX(i)))\n        .attr(\"x2\", (d, i) => halfPixel(columnLabelX(i)))\n        .attr(\"y1\", halfPixel(columnLabelY + 8))\n        .attr(\"y2\", halfPixel(columnLabelY + 12));\n\n      // Draw the links\n      const linkPoints = function (link) {\n        const curveStart =\n            props.columnPosition(link.src.columnIndex) + props.nodeThickness + linkPadding,\n          curveEnd = props.columnPosition(link.tgt.columnIndex) - linkPadding,\n          startLevel =\n            getNodePosition(link.src) +\n            props.sizeScale(link.srcOffset) +\n            props.sizeScale(link.value) / 2,\n          endLevel =\n            getNodePosition(link.tgt) +\n            props.sizeScale(link.tgtOffset) +\n            props.sizeScale(link.value) / 2;\n\n        return [curveStart, curveEnd, startLevel, endLevel];\n      };\n\n      const linkPath = function (link) {\n        const points = linkPoints(link),\n          curveInterp = interpolateNumber(points[0], points[1]),\n          curveControlPtA = curveInterp(props.linkCurvature),\n          curveControlPtB = curveInterp(1 - props.linkCurvature);\n\n        return linkPathString(\n          points[0],\n          curveControlPtA,\n          curveControlPtB,\n          points[1],\n          points[2],\n          points[3]\n        );\n      };\n\n      const linkBoundingBox = function (link) {\n        const points = linkPoints(link);\n\n        return linkBounds(points[0], points[1], points[2], points[3]);\n      };\n\n      const linkThickness = function (link) {\n        return Math.max(props.sizeScale(link.value), 1);\n      };\n\n      // Render the links\n      const linksGroup = selection.selectGroup(\"links\");\n\n      const linksElems = linksGroup\n        .selectAll(\".sszvis-link\")\n        .data(data.links, idAcc)\n        .join(\"path\")\n        .attr(\"class\", \"sszvis-link\");\n\n      linksElems\n        .attr(\"fill\", \"none\")\n        .attr(\"d\", linkPath)\n        .attr(\"stroke-width\", linkThickness)\n        .attr(\"stroke\", props.linkColor)\n        .sort(props.linkSort);\n\n      linksGroup.datum(data.links);\n\n      const linkTooltipAnchor = tooltipAnchor().position((link) => {\n        const bbox = linkBoundingBox(link);\n        return [(bbox[0] + bbox[1]) / 2, (bbox[2] + bbox[3]) / 2];\n      });\n\n      linksGroup.call(linkTooltipAnchor);\n\n      // Render the link labels\n      const linkLabelsGroup = selection.selectGroup(\"linklabels\");\n\n      // If no props.linkSourceLabels are provided, most of this rendering is no-op\n      const linkSourceLabels = linkLabelsGroup\n        .selectAll(\".sszvis-sankey-link-source-label\")\n        .data(props.linkSourceLabels)\n        .join(\"text\")\n        .attr(\n          \"class\",\n          \"sszvis-sankey-label sszvis-sankey-strong-label sszvis-sankey-link-source-label\"\n        );\n\n      linkSourceLabels\n        .attr(\"transform\", (link) => {\n          const bbox = linkBoundingBox(link);\n          return translateString(bbox[0] + 6, bbox[2]);\n        })\n        .text(props.linkLabel);\n\n      // If no props.linkTargetLabels are provided, most of this rendering is no-op\n      const linkTargetLabels = linkLabelsGroup\n        .selectAll(\".sszvis-sankey-link-target-label\")\n        .data(props.linkTargetLabels)\n        .join(\"text\")\n        .attr(\n          \"class\",\n          \"sszvis-sankey-label sszvis-sankey-strong-label sszvis-sankey-link-target-label\"\n        );\n\n      linkTargetLabels\n        .attr(\"transform\", (link) => {\n          const bbox = linkBoundingBox(link);\n          return translateString(bbox[1] - 6, bbox[3]);\n        })\n        .text(props.linkLabel);\n\n      // Render the node labels and their hit boxes\n      const getLabelSide = function (colIndex) {\n        let side = props.labelSide(colIndex);\n        if (props.labelSideSwitch) {\n          side = side === \"left\" ? \"right\" : \"left\";\n        }\n        return side;\n      };\n\n      const nodeLabelsGroup = selection.selectGroup(\"nodelabels\");\n\n      const barLabels = nodeLabelsGroup\n        .selectAll(\".sszvis-sankey-node-label\")\n        .data(data.nodes)\n        .join(\"text\")\n        .attr(\"class\", \"sszvis-sankey-label sszvis-sankey-weak-label sszvis-sankey-node-label\");\n\n      barLabels\n        .text((node) => props.nameLabel(node.id))\n        .attr(\"text-align\", \"middle\")\n        .attr(\"text-anchor\", (node) =>\n          getLabelSide(node.columnIndex) === \"left\" ? \"end\" : \"start\"\n        )\n        .attr(\"x\", (node) =>\n          getLabelSide(node.columnIndex) === \"left\"\n            ? xPosition(node) - 6\n            : xPosition(node) + props.nodeThickness + 6\n        )\n        .attr(\"y\", (node) => yPosition(node) + yExtent(node) / 2)\n        .style(\"opacity\", props.labelOpacity);\n\n      const barLabelHitBoxes = nodeLabelsGroup\n        .selectAll(\".sszvis-sankey-hitbox\")\n        .data(data.nodes)\n        .join(\"rect\")\n        .attr(\"class\", \"sszvis-sankey-hitbox\");\n\n      barLabelHitBoxes\n        .attr(\"fill\", \"transparent\")\n        .attr(\n          \"x\",\n          (node) =>\n            xPosition(node) +\n            (getLabelSide(node.columnIndex) === \"left\" ? -props.labelHitBoxSize : 0)\n        )\n        .attr(\"y\", (node) => yPosition(node) - props.nodePadding / 2)\n        .attr(\"width\", props.labelHitBoxSize + props.nodeThickness)\n        .attr(\"height\", (node) => yExtent(node) + props.nodePadding);\n    });\n}\n","/**\n * Select control\n *\n * Control for switching top-level filter values. Use this control for changing between several\n * options which affect the state of the chart. This component should be rendered into an html layer.\n *\n * This control is part of the `optionSelectable` class of controls and can be used interchangeably\n * with other controls of this class (sszvis.control.buttonGroup).\n *\n * @module sszvis/control/select\n *\n * @property {array} values         an array of values which are the options available in the control.\n * @property {any} current          the currently selected value of the select control. Should be one of the options passed to .values()\n * @property {number} width         The total width of the select control. If text labels exceed this width they will be trimmed to fit using an ellipsis mark. (default: 300px)\n * @property {function} change      A callback/event handler function to call when the user clicks on a value.\n *                                  Note that clicking on a value does not necessarily change any state unless this callback function does something.\n *\n * @return {sszvis.component}\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"values\")\n    .prop(\"current\")\n    .prop(\"width\")\n    .width(300)\n    .prop(\"change\")\n    .change(fn.identity)\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      const wrapperEl = selection\n        .selectAll(\".sszvis-control-optionSelectable\")\n        .data([\"sszvis-control-select\"], (d) => d)\n        .join(\"div\")\n        .classed(\"sszvis-control-optionSelectable\", true)\n        .classed(\"sszvis-control-select\", true);\n\n      wrapperEl.style(\"width\", props.width + \"px\");\n\n      const metricsEl = wrapperEl\n        .selectDiv(\"selectMetrics\")\n        .classed(\"sszvis-control-select__metrics\", true);\n\n      const selectEl = wrapperEl\n        .selectAll(\".sszvis-control-select__element\")\n        .data([1])\n        .join(\"select\")\n        .classed(\"sszvis-control-select__element\", true)\n        .on(\"change\", function (e) {\n          // We store the index in the select's value instead of the datum\n          // because an option's value can only hold strings.\n          const i = select(this).property(\"value\");\n          props.change(e, props.values[i]);\n          // Prevent highlights on the select element after users have selected\n          // an option by moving away from it.\n          setTimeout(() => {\n            window.focus();\n          }, 0);\n        });\n\n      selectEl.style(\"width\", props.width + 30 + \"px\");\n\n      selectEl\n        .selectAll(\"option\")\n        .data(props.values)\n        .join(\"option\")\n        .attr(\"selected\", (d) => (d === props.current ? \"selected\" : null))\n        .attr(\"value\", (d, i) => i)\n        .text((d) => truncateToWidth(metricsEl, props.width - 40, d));\n    });\n}\n\nfunction truncateToWidth(metricsEl, maxWidth, originalString) {\n  const MAX_RECURSION = 1000;\n  const fitText = function (str, i) {\n    metricsEl.text(str);\n    const textWidth = Math.ceil(metricsEl.node().clientWidth);\n    return i < MAX_RECURSION && textWidth > maxWidth ? fitText(str.slice(0, -2) + \"…\", i + 1) : str;\n  };\n  return fitText(originalString, 0);\n}\n","/**\n * Stacked Area component\n *\n * Stacked area charts are useful for showing how component parts contribute to a total quantity\n *\n * The stackedArea component uses a [d3 stack layout](https://github.com/mbostock/d3/wiki/Stack-Layout) under the hood,\n * so some of its configuration properties are similar. This component requires an array of layer objects,\n * where each layer object represents a layer in the stack.\n *\n * @module sszvis/component/stackedArea\n *\n * @property {function} x                      Accessor function to read *x*-values from the data. Should return a value in screen pixels.\n *                                             Used to figure out which values share a vertical position in the stack.\n * @property {function} yAccessor              Accessor function to read raw *y*-values from the data. Should return a value which is in data-units,\n *                                             not screen pixels. The results of this function are used to compute the stack, and they are then\n *                                             passed into the yScale before display.\n * @property {function} yScale                 A y-scale for determining the vertical position of data quantities. Used to compute the\n *                                             bottom and top lines of the stack.\n * @property {string, function} fill           String or accessor function for the area fill. Passed a layer object.\n * @property {string, function} stroke         String or accessor function for the area stroke. Passed a layer object.\n * @property {function} key                    Specify a key function for use in the data join. The value returned by the key should be unique\n *                                             among stacks. This option is particularly important when creating a chart which transitions\n *                                             between stacked and separated views.\n * @property {function} valuesAccessor         Specify an accessor for the values of the layer objects. The default treats the layer object\n *                                             as an array of values. Use this if your layer objects should be treated as something other than\n *                                             arrays of values.\n *\n * @return {sszvis.component}\n */\n\nimport { select, area } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { defaultTransition } from \"../transition.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"x\")\n    .prop(\"y0\")\n    .prop(\"y1\")\n    .prop(\"fill\")\n    .prop(\"stroke\")\n    .prop(\"strokeWidth\")\n    .prop(\"defined\")\n    .prop(\"key\")\n    .key((d, i) => i)\n    .prop(\"transition\")\n    .transition(true)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      const defaultDefined = function () {\n        return fn.compose(fn.not(isNaN), props.y0) && fn.compose(fn.not(isNaN), props.y1);\n      };\n\n      const areaGen = area()\n        .defined(props.defined === undefined ? defaultDefined : props.defined)\n        .x(props.x)\n        .y0(props.y0)\n        .y1(props.y1);\n\n      let paths = selection\n        .selectAll(\"path.sszvis-path\")\n        .data(data, props.key)\n        .join(\"path\")\n        .classed(\"sszvis-path\", true);\n\n      if (props.transition) {\n        paths = paths.transition(defaultTransition());\n      }\n\n      paths\n        .attr(\"d\", areaGen)\n        .attr(\"fill\", props.fill)\n        .attr(\"stroke\", props.stroke || \"#ffffff\")\n        .attr(\"stroke-width\", props.strokeWidth === undefined ? 1 : props.strokeWidth);\n    });\n}\n","/**\n * Stacked Area Multiples component\n *\n * This component, like stackedArea, requires an array of layer objects, where each layer object is one of the multiples.\n * In addition to stackedArea, this chart's layers can be separated to provide two views on the data: a sum of all\n * elements as well as every element on its own.\n *\n * @module sszvis/component/stackedAreaMultiples\n *\n * @property {number, function} x             Accessor function for the *x*-values. Passed a data object and should return a value\n *                                            in screen pixels.\n * @property {number, function} y0            Accessor function for the *y0*-value (the baseline of the area). Passed a data object\n *                                            and should return a value in screen pixels.\n * @property {number, function} y1            Accessor function for the *y1*-value (the top line of the area). Passed a data object\n *                                            and should return a value in screen pixels.\n * @property {string, function} fill          Accessor function for the area fill. Passed a layer object.\n * @property {string, function} stroke        Accessor function for the area stroke. Passed a layer object.\n * @property {function} key                   Specify a key function for use in the data join. The value returned by the key should\n *                                            be unique among stacks. This option is particularly important when creating a chart\n *                                            which transitions between stacked and separated views.\n * @property {function} valuesAccessor        Specify an accessor for the values of the layer objects. The default treats the layer object\n *                                            as an array of values. Use this if your layer objects should be treated as something other than\n *                                            arrays of values.\n *\n * @return {sszvis.component}\n */\n\nimport { select, area } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { defaultTransition } from \"../transition.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"x\")\n    .prop(\"y0\")\n    .prop(\"y1\")\n    .prop(\"fill\")\n    .prop(\"stroke\")\n    .prop(\"strokeWidth\")\n    .prop(\"defined\")\n    .prop(\"key\")\n    .key((d, i) => i)\n    .prop(\"valuesAccessor\")\n    .valuesAccessor(fn.identity)\n    .prop(\"transition\")\n    .transition(true)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      //sszsch why reverse?\n      data = [...data].reverse();\n\n      const defaultDefined = function () {\n        return fn.compose(fn.not(isNaN), props.y0) && fn.compose(fn.not(isNaN), props.y1);\n      };\n\n      const areaGen = area()\n        .defined(props.defined === undefined ? defaultDefined : props.defined)\n        .x(props.x)\n        .y0(props.y0)\n        .y1(props.y1);\n\n      const paths = selection\n        .selectAll(\"path.sszvis-path\")\n        .data(data, props.key)\n        .join(\"path\")\n        .classed(\"sszvis-path\", true);\n\n      if (props.transition) {\n        paths.transition(defaultTransition());\n      }\n\n      paths\n        .attr(\"d\", fn.compose(areaGen, props.valuesAccessor))\n        .attr(\"fill\", props.fill)\n        .attr(\"stroke\", props.stroke)\n        .attr(\"stroke-width\", props.strokeWidth === undefined ? 1 : props.strokeWidth);\n    });\n}\n"],"names":["selection","prototype","selectDiv","key","this","selectAll","data","d","join","attr","style","selectGroup","identity","value","isString","val","Object","toString","call","isSelection","arity","n","fn","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","compose","_len","arguments","length","fns","Array","_key","start","i","_len2","args","_key2","result","Reflect","apply","defined","undefined","Number","isNaN","filledArray","len","arr","from","find","predicate","element","first","firstTouch","event","touches","changedTouches","isNull","isObject","last","not","f","_len3","_key3","prop","object","propOr","defaultVal","set","acc","accessor","reduce","m","computed","includes","stringEqual","a","b","functor","v","memoize","func","resolver","TypeError","memoized","cache","has","get","Map","ensureDefsElement","type","elementId","ensureDefsSelection","qualColorScale","colors","decorateOrdinalScale","scaleOrdinal","range","map","convertLab","unknown","darkBlue","mediumBlue","lightBlue","darkRed","mediumRed","lightRed","darkGreen","mediumGreen","lightGreen","darkBrown","mediumBrown","lightBrown","scaleQual12","scaleQual6","scaleQual6a","scaleQual6b","seqColorScale","decorateLinearScale","scaleLinear","scaleSeqBlu","scaleSeqRed","scaleSeqGrn","scaleSeqBrn","divColorScale","scale","nativeDomain","domain","dom","xDomain","push","quantile","interpolatedDivergentColorScale","reverse","copy","decorateDivScale","scaleDivVal","scaleDivValGry","scaleDivNtr","scaleDivNtrGry","greyColorScale","scaleLightGry","scalePaleGry","scaleGry","scaleDimGry","scaleMedGry","scaleDeepGry","darker","brighter","threeDomain","mean","interpolatedColorScale","lab","mapMissingValuePattern","lineStroke","append","mapLakePattern","pHeight","pWidth","mapLakeFadeGradient","mapLakeGradientMask","dataAreaPattern","component","props","selectionRenderer","renderer","sszvisComponent","clone","slice","each","__props__","setter","bind","delegate","renderSelection","callback","render","array","obj","hasOwnProperty","d3Selection","Error","size","_groups","halfPixel","pos","Math","floor","transformTranslateSubpixelShift","transformStr","roundNumber","vec","match","replace","split","vecRound","translateString","x","y","vectorToTranslateString","tooltipAnchor","position","select","debug","makeFlagDot","classed","cx","cy","dot","locale","decimal","thousands","grouping","currency","dateTime","date","time","periods","days","shortDays","months","shortMonths","timeFormat","timeFormatLocale","format","formatLocale","formatAxisTimeFormat","xs","getMilliseconds","getSeconds","getMinutes","getHours","Boolean","getDay","getDate","getMonth","formatMonth","toUpperCase","formatYear","formatNumber","p","dAbs","abs","min","decimalPlaces","stripTrailingZeroes","formatText","String","num","str","tooltipRenderer","orientation","dx","dy","opacity","tooltipData","datum","isDef","isSmall","header","body","tooltip","TIP_SIZE","enterBackground","enterBackgroundPath","window","SVGFEColorMatrixElement","SVG_FECOLORMATRIX_TYPE_SATURATE","filter","merge","enterContent","html","isArray","row","cell","tip","dimensions","node","getBoundingClientRect","width","height","bgHeight","bgWidth","radius","side","tooltipBackgroundGenerator","x0","y0","x1","y1","showTip","mx","my","end","defaultEase","easePolyOut","defaultTransition","d3Transition","ease","duration","slowTransition","NOTHING","Symbol","for","DRAFTABLE","DRAFT_STATE","die","error","getPrototypeOf","isDraft","isDraftable","isPlainObject","constructor","isMap","isSet","objectCtorString","proto","Ctor","Function","iter","getArchtype","ownKeys","forEach","entry","index","thing","state","type_","propOrOldValue","t","add","target","Set","latest","copy_","base_","shallowCopy","base","strict","isPlain","descriptors","getOwnPropertyDescriptors","keys","desc","writable","configurable","enumerable","create","assign","freeze","deep","isFrozen","defineProperties","dontMutateFrozenCollections","clear","delete","values","currentScope","plugins","getPlugin","pluginKey","plugin","getCurrentScope","usePatchesInScope","scope","patchListener","patches_","inversePatches_","patchListener_","revokeScope","leaveScope","drafts_","revokeDraft","parent_","enterScope","immer2","immer_","canAutoFreeze_","unfinalizedDrafts_","draft","revoke_","revoked_","processResult","baseDraft","modified_","finalize","maybeFreeze","generateReplacementPatches_","rootScope","path","childValue","finalizeProperty","scope_","finalized_","resultEach","isSet2","generatePatches_","parentState","targetObject","rootPath","targetIsSet","res","assigned_","concat","autoFreeze_","propertyIsEnumerable","objectTraps","source","getDescriptorFromProto","draft_","readPropFromProto","peek","prepareCopy","createProxy","current2","currentState","is","markChanged","deleteProperty","getOwnPropertyDescriptor","owner","defineProperty","setPrototypeOf","arrayTraps","useStrictShallowCopy_","parent","proxyMap_","proxySet_","isManual_","traps","revoke","proxy","Proxy","revocable","createProxyProxy","currentImpl","immer","config","produce","recipe","defaultBase","self","base2","hasError","ip","produceWithPatches","patches","inversePatches","autoFreeze","setAutoFreeze","useStrictShallowCopy","setUseStrictShallowCopy","createDraft","current","finishDraft","applyPatches","patch","op","applyPatchesImpl","applyPatches_","fallbackRender","selector","options","src","nanoThrottle","ms","trailing","Date","getTime","setTimeout","callbacks","resize","globalThis","on","throttle","trigger","name","evtArgs","viewport","cb","off","invariant","condition","message","isFunction","breakpointFind","breakpoints","partialMeasurement","measurement","parseMeasurement","bp","breakpointTest","breakpointFindByName","breakpoint","bpm","screenHeight","breakpointMatch","breakpointCreateSpec","spec","parseBreakpoint","breakpointDefaultSpec","DEFAULT_SPEC","breakpointPalm","makeTest","breakpointLap","widthOrInf","Infinity","screenHeightOrInf","aspectRatio","ar","aspectRatio4to3","aspectRatio16to10","aspectRatio12to5","MAX_HEIGHT","aspectRatioSquare","aspectRatioPortrait","defaultAspectRatios","palm","lap","_","aspectRatioAuto","warn","logger","console","msg","rangeExtent","stop","extent","textWrap","paddingRightLeft","paddingTopBottom","maxWidth","arrLineCreatedCount","text","words","word","line","lineNumber","parseFloat","createdLineCount","textAlign","parentNode","tspan","pop","getComputedTextLength","axis","orient","alignOuterLabels","hideBorderTickThreshold","hideLabelThreshold","showZeroY","vertical","yOffset","isBottom","axisDelegate","axisBottom","axisTop","axisLeft","axisRight","_scale","group","axisScale","tickGroups","tickTexts","subpixelShift","getAttribute","d3this","absDistance","tickLength","domainExtent","ticks","longLinePadding","max","lines","remove","alignmentBounds","slant","slantLabel","highlightTick","activeBounds","passiveBounds","bcr","bounds","top","right","bottom","left","active","passive","boundsOverlap","title","axisScaleExtent","titleProps","titleCenter","titleVertical","dxTitle","dyTitle","titleAnchor","contour","g","textNode","textContour","empty","cloneNode","insertBefore","textContent","setOrdinalTicks","count","step","round","l","tickValues","axisX","tickSizeInner","tickSizeOuter","tickPadding","tickFormat","ordinal","pyramid","s","extended","extendedDomain","extendedRange","axisY","newAxis","tickSize","boundsA","boundsB","horizontal","diagonal","move","dispatch","moveComponent","cancelScrolling","fireOnPanOnly","defaults","padding","xExtent","xScale","sort","ascending","yExtent","yScale","layer","draggable","e","doc","document","win","stopDragging","__dragging__","relatedTarget","toElement","nodeName","xy","pointer","scaleInvert","preventDefault","pan","panXY","panX","panY","panCancelScrolling","px","invert","paddingInner","paddingOuter","bandWidth","bandwidth","scaleRange","ranges","invertBandScale","invertPointScale","elementFromEvent","evt","elementFromPoint","clientX","clientY","datumFromPannableElement","MAX_INTERACTION_RADIUS_SQUARED","pow","eventNearPoint","point","measureDimensions","arg","screenWidth","innerWidth","innerHeight","measureText","context","createElement","getContext","fontSize","fontFace","font","measureAxisLabel","measureLegendLabel","arg1","arg2","_bounds","either","fallback","groupEach","cascade","_cascade","sorts","valuesSort","make","depth","sorter","grouped","keyFunc","groupBy","k","arrEach","objectBy","arrayBy","handleMissingVal","bar","transition","xAcc","yAcc","wAcc","hAcc","bars","fill","stroke","tooltipPosition","centerTooltip","uv","ta","lineComponent","mirror","lineGen","d3Line","barWidth","barPosition","stackAcc","fst","snd","stackedBarData","order","_stackAcc","seriesAcc","valueAcc","rows","stacks","d3Stack","stack","series","maxValue","stackedBarHorizontalData","stackOrderNone","stackedBarVerticalData","stackOrderReverse","stackedBar","barGen","horizontalStackedBarConfig","verticalStackedBarConfig","stackedBarVertical","dataAcc","rowAcc","stackComponent","stackElement","TWO_PI","PI","contains","legendColorOrdinal","rowHeight","columnWidth","columns","verticallyCentered","rightAlign","horizontalFloat","floatPadding","floatWidth","cols","ceil","groups","verticalOffset","rowPosition","horizontalPosition","translate","colorLegendDimensions","labels","containerWidth","labelCount","maxLabelWidth","labelWidth","totalLabelsWidth","sum","numCols","isHorizontal","legendWidth","label","totalWidth","newLinkId","id","unwrapNested","roll","_ref","sortFn","swissMapProjection","featureCollection","geoMercator","fitSize","featureBoundsCacheKey","swissMapPath","geoPath","projection","GEO_KEY_DEFAULT","prepareMergedGeoData","dataset","geoJson","keyName","groupedInputData","features","feature","getGeoJsonCenter","properties","cachedCenter","setCenter","center","geoCentroid","datumAcc","mapRendererBase","transitionColor","getMapFill","mapAreas","mergedData","mapPath","mapRendererHighlight","highlight","highlightStroke","highlightStrokeWidth","highlightBorders","groupedMapData","mergedHighlight","mapRendererMesh","borderColor","strokeWidth","mapRendererPatternedLakeOverlay","fadeOut","zurichSee","lakeFeature","lakePath","lakeBounds","lakePathColor","timeParse","parse","dateParser","yearParser","makeTextWithFormat","textBody","addLine","addWord","structuredText","makeText","newline","modularTextHTML","styles","plain","italic","bold","formatHTML","modularTextSVG","svg","formatSVG","r","caption","valuesAccessor","area","d3Area","x2","y2","vx","vy","angle","atan2","crispX","crispY0","crispY1","flip","middleY","marks","offset","removeStroke","total","totalNode","totalContour","annotationRuler","reduceOverlap","labelId","color","crispY","textSelection","THRESHOLD","ITERATIONS","labelBounds","labelBoundsIndex","item","firstLabel","entries","secondLabel","overlap","doing","init","actions","actionDispatchers","scheduleUpdate","effect","requestAnimationFrame","action","initialState","then","catch","change","buttonWidth","container","baseRenderer","meshRenderer","lakeRenderer","highlightRenderer","mapComponent","withLake","lakeFadeOut","borders","lakeFeatures","lakeBorders","anchoredShape","legendLabels","axisLabels","layout","legend","axisLabelPadding","sqrt","axisLabelHeight","legendPadding","bottomPadding","list","metadata","mkBounds","elementDataKey","root","description","seen","sValue","cValue","spaceWidth","squarePadding","numX","numY","chartPadding","availableChartWidth","paddedSide","tableWidth","padRatio","centeredOffset","numBars","computedBarSpace","barHeight","padHeight","outerRatio","axisOffset","barGroupHeight","totalHeight","TARGET_PADDING_RATIO","numPads","padWidth","barGroupWidth","dots","createElementNS","createSVGRect","lo","hi","flat","pattern","formatPreciseNumber","groupSpace","inGroupScale","scaleBand","groupSize","rangeRound","groupWidth","barUnits","__sszvisGroupedBarIndex__","unitsWithValue","groupScale","unitsWithoutValue","xTotal","tallest","handleTop","handleWidth","handleHeight","rectFill","crossStroke","cross1","cross2","defaultHeight","totalPadding","roundedBarHeight","barPos","positions","maxBarLength","unitWidth","paddingX","unitHeight","paddingY","horizontalCenter","verticalCenter","multiples","gx","gw","gy","gh","pct","bandHeight","level","labelFormat","displayValues","endpoints","innerRange","rectData","pPrev","w","segHeight","c","lineData","segments","segWidth","startEnd","labelText","maxRadius","getCircleEdge","anchoredCirclesComponent","strokeColor","radiusAcc","anchoredCircles","exit","geojsonComponent","dataKeyName","geoJsonKeyName","getDataKeyName","getMapKeyName","geoElements","over","out","click","sphericalCentroid","image","topLeft","geoBounds","bottomRight","cellSide","canvas","ctx","clearRect","fillStyle","fillRect","halfSide","hsl","nestedStackedBarsVertical","xLabel","xAxis","nestedGroups","stackedBars","panningComponent","elementSelector","trim","NaN","_a0","_a1","arcGen","arc","innerRadius","outerRadius","startAngle","endAngle","attrTween","angle0Interp","interpolate","angle1Interp","cos","sin","centerPoint","meterDistance","halfDegrees","projBounds","barFill","leftBar","rightBar","leftLine","rightLine","leftAccessor","rightAccessor","leftRefAccessor","rightRefAccessor","breakpointSpec","propsConfig","_responsiveProps","memo","matchingBreakpoints","propKey","propSpec","breakpointName","validatePropSpec","matchedBreakpoint","propName","bps","vecStr","cAcc","category","j","columnLabel","columnLabelOffset","linkCurvature","linkSort","labelSide","labelOpacity","labelHitBoxSize","nameLabel","linkSourceLabels","linkTargetLabels","idAcc","getNodePosition","columnPadding","columnIndex","sizeScale","valueOffset","nodePadding","nodeIndex","xPosition","columnPosition","yPosition","nodeThickness","nodeColor","barGroup","nodes","barTooltipAnchor","columnLabelX","colIndex","columnLengths","columnLabelY","linkPoints","link","tgt","srcOffset","tgtOffset","linkBoundingBox","points","linksGroup","links","curveInterp","interpolateNumber","curveControlPtA","curveControlPtB","x3","linkColor","linkTooltipAnchor","bbox","linkLabelsGroup","linkLabel","getLabelSide","labelSideSwitch","nodeLabelsGroup","columnTotals","columnHeight","computedPixPadding","colLength","colPadding","pixPerUnit","valuePadding","maxTotal","paddedHeights","maxPaddedHeight","columnPaddings","valueDomain","valueRange","numColumns","columnDomain","columnRange","mGetSource","mGetTarget","mGetValue","mColumnIds","byAscendingValue","byDescendingValue","descending","valueSortFunc","main","inputData","columnIdsList","linksFrom","linksTo","listOfLinks","srcId","tgtId","srcNode","tgtNode","listOfNodes","totals","fromTotal","toTotal","colIds","columnData","linkA","linkB","sumValue","descendingSort","ascendingSort","idLists","scaleGender3","scaleGender5Wedding","scaleGender6Origin","wrapperEl","metricsEl","selectEl","property","focus","originalString","MAX_RECURSION","fitText","textWidth","clientWidth","truncateToWidth","minorTicks","majorTicks","tickLabels","backgroundOffset","scaleDomain","alteredScale","bg","axisSelection","majorAxisText","numTicks","backgroundSelection","handle","sliderInteraction","onchange","areaGen","paths","leftStack","rightStack","sideAcc","_rowAcc","sides","angleScale","centerRadius","radiusScale","_x0","_x1","arcs","getColorRecursive","isSunburstRoot","pColor","x0Interp","x1Interp","arcTooltipAnchor","startA","endA","formattedData","numLayers","chartWidth","halfWidth","ringWidth","layers","nested","rollup","hierarchy","partition","flatten","children","calculate","accfn","sortFunc","visible","intoBCR","renderInto","thisBCR","voronoiComponent","delaunay","Delaunay","voronoi","polys","cellPolygons","cbox","datumIdx","touchEvent","panDatum","panCbox","cancelable","rgbColor","rgb"],"mappings":"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","x_google_ignoreList":[15,17]}