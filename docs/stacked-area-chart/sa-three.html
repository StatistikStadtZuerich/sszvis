<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Area Chart</title>

  <link href='../../sszvis.css' rel='stylesheet' />

  <script src="../../vendor/d3/d3.min.js"></script>
  <script src="../../sszvis.js"></script>
</head>
<body style="margin:0;padding:0;">
<div id="chart"></div>
<script>
(function() {

  var state = {
    data: []
  };

  d3.csv('data/SA_3Categories_yearly_zeroes.csv')
    .row(function(d) {
      return {
        category: d['Nationalit√§t'],
        year: sszvis.parse.year(d['Jahr']),
        value: sszvis.parse.number(d['Schweiz'])
      }
    })
    .get(function(error, data) {
      if (error) {
        console.log('error loading data: ', error);
        return;
      }
      state.data = data;
      render(state);
    });

    function render(state) {
      // concise example
      var bounds = sszvis.bounds({ width: 516, height: 442, top: 10, right: 10, bottom: 24, left: 10 }),
          xAcc = sszvis.fn.prop('year'),
          yAcc = sszvis.fn.prop('value'),
          cAcc = sszvis.fn.prop('category'),
          xScale = d3.time.scale()
            .domain(d3.extent(state.data.map(xAcc)))
            .range([0, bounds.innerWidth]),
          dateValues = state.data.reduce(function(dv, value) {
            var date = xAcc(value).toString();
            if (!dv[date]) {
              dv[date] = yAcc(value);
            } else {
              dv[date] += yAcc(value);
            }
            return dv;
          }, {}),
          maxStacked = d3.max(sszvis.fn.objectValues(dateValues)),
          yScale = d3.scale.linear()
            .domain([0, maxStacked])
            .range([bounds.innerHeight, 0]),
          categories = sszvis.fn.uniqueUnsorted(state.data.map(cAcc)),
          cScale = d3.scale.ordinal()
            .domain(categories)
            .range(sszvis.color.ranges.qualitative.qual3),
          stackedArea = sszvis.component.stacked.area()
            .xAccessor(xAcc)
            .xScale(xScale)
            .yAccessor(yAcc)
            .yScale(yScale)
            .categoryAccessor(cAcc)
            .fill(function(d, i) { return cScale(d.category); }),
          xAxis = sszvis.axis.x.time().scale(xScale).orient('bottom'),
          yAxis = sszvis.axis.y().scale(yScale).orient('right'),
          chart = sszvis.createChart('#chart', bounds)
            .datum(state.data),
          stacked = chart.selectGroup('areachart')
            .call(stackedArea),
          xAxisGroup = chart.selectGroup('xAxis')
            .attr('transform', 'translate(0, ' + bounds.innerHeight + ')')
            .call(xAxis),
          yAxisGroup = chart.selectGroup('yAxis')
            .call(yAxis);
    }

}());
</script>
</body>
</html>
