{"version":3,"file":"d3-component.js","sources":["../src/d3-component.js"],"sourcesContent":["import { selection as d3Selection } from \"d3\";\n\n/**\n * d3 plugin to simplify creating reusable charts. Implements\n * the reusable chart interface and can thus be used interchangeably\n * with any other reusable charts.\n *\n * @example\n * var myAxis = sszvis.component()\n *   .prop('ticks').ticks(10)\n *   .render(function(data, i, j) {\n *     var selection = select(this);\n *     var props = selection.props();\n *     var axis = d3.svg.axis().ticks(props.ticks);\n *     selection\n *       .append('g')\n *       .call(axis);\n *   })\n * console.log(myAxis.ticks()); //=> 10\n * select('svg').call(myAxis.ticks(3));\n *\n * @see http://bost.ocks.org/mike/chart/\n *\n * @property {function} prop Define a property accessor\n * @property {function} render The chart's body\n *\n * @return {sszvis.component} A d3 reusable chart\n */\nexport function component() {\n  const props = {};\n  let selectionRenderer = null;\n  let renderer = identity;\n\n  /**\n   * Constructor\n   *\n   * @param  {d3.selection} selection Passed in by d3\n   */\n  function sszvisComponent(selection) {\n    if (selectionRenderer) {\n      selection.props = () => clone(props);\n      selectionRenderer.apply(selection, slice(arguments));\n    }\n    selection.each(function () {\n      this.__props__ = clone(props);\n      renderer.apply(this, slice(arguments));\n    });\n  }\n\n  /**\n   * Define a property accessor with an optional setter\n   *\n   * @param  {String} prop The property's name\n   * @param  {Function} [setter] The setter's context will be bound to the\n   *         sszvis.component. Sets the returned value to the given property\n   * @return {sszvis.component}\n   */\n  sszvisComponent.prop = (prop, setter) => {\n    setter || (setter = identity);\n    sszvisComponent[prop] = accessor(props, prop, setter.bind(sszvisComponent)).bind(\n      sszvisComponent\n    );\n    return sszvisComponent;\n  };\n\n  /**\n   * Delegate a properties' accessors to a delegate object\n   *\n   * @param  {String} prop     The property's name\n   * @param  {Object} delegate The target having getter and setter methods for prop\n   * @return {sszvis.component}\n   */\n  sszvisComponent.delegate = (prop, delegate) => {\n    sszvisComponent[prop] = () => {\n      const result = delegate[prop].apply(delegate, slice(arguments));\n      return arguments.length === 0 ? result : sszvisComponent;\n    };\n    return sszvisComponent;\n  };\n\n  /**\n   * Creates a render context for the given component's parent selection.\n   * Use this, when you need full control over the rendering of the component\n   * and you need access to the full selection instead of just the selection\n   * of one datum.\n   *\n   * @param  {Function} callback\n   * @return {[sszvis.component]}\n   */\n  sszvisComponent.renderSelection = (callback) => {\n    selectionRenderer = callback;\n    return sszvisComponent;\n  };\n\n  /**\n   * Creates a render context for the given component. Implements the\n   * d3.selection.each interface.\n   *\n   * @see https://github.com/mbostock/d3/wiki/Selections#each\n   *\n   * @param  {Function} callback\n   * @return {sszvis.component}\n   */\n  sszvisComponent.render = (callback) => {\n    renderer = callback;\n    return sszvisComponent;\n  };\n\n  return sszvisComponent;\n}\n\n/**\n * d3.selection plugin to get the properties of a sszvis.component.\n * Works similarly to d3.selection.data, but for properties.\n *\n * @see https://github.com/mbostock/d3/wiki/Selections\n *\n * @return {Object} An object of properties for the given component\n */\nd3Selection.prototype.props = function () {\n  // It would be possible to make this work exactly like\n  // d3.selection.data(), but it would need some test cases,\n  // so we currently simplify to the most common use-case:\n  // getting props.\n  if (arguments.length > 0) throw new Error(\"selection.props() does not accept any arguments\");\n  if (this.size() != 1) throw new Error(\"only one group is supported\");\n  if (this._groups[0].length != 1) throw new Error(\"only one node is supported\");\n\n  const group = this._groups[0];\n  const node = group[0];\n  return node.__props__ || {};\n};\n\n/**\n * Creates an accessor function that either gets or sets a value, depending\n * on whether or not it is called with arguments.\n *\n * @param  {Object} props The props to get from or set to\n * @param  {String} attr The property to be accessed\n * @param  {Function} [setter] Transforms the data on set\n * @return {Function} The accessor function\n */\nfunction accessor(props, prop, setter) {\n  setter || (setter = identity);\n  return function () {\n    if (arguments.length === 0) return props[prop];\n\n    props[prop] = setter.apply(null, slice(arguments));\n    return this;\n  };\n}\n\nfunction identity(d) {\n  return d;\n}\n\nfunction slice(array) {\n  return Array.prototype.slice.call(array);\n}\n\nfunction clone(obj) {\n  const copy = {};\n  for (const attr in obj) {\n    if (Object.hasOwn(obj, attr)) copy[attr] = obj[attr];\n  }\n  return copy;\n}\n"],"names":["component","props","selectionRenderer","renderer","identity","sszvisComponent","selection","clone","apply","slice","arguments","each","__props__","prop","setter","accessor","bind","delegate","result","length","renderSelection","callback","render","d3Selection","prototype","Error","size","_groups","group","node","d","array","Array","call","obj","copy","attr","Object","hasOwn"],"mappings":"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"}