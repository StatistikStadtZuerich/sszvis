{"version":3,"file":"radius.js","sources":["../../src/legend/radius.js"],"sourcesContent":["/**\n * Radius size legend\n *\n * Use for showing how different radius sizes correspond to data values.\n *\n * @module sszvis/legend/radius\n *\n * @property {function} scale         A scale to use to generate the radius sizes\n * @property {function} [tickFormat]  Formatter function for the labels (default identity)\n * @property {array} [tickValues]     An array of domain values to be used as radii that the legend shows\n *\n * @returns {sszvis.component}\n */\n\nimport { select, mean } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { range } from \"../scale.js\";\nimport { halfPixel } from \"../svgUtils/crisp.js\";\nimport translateString from \"../svgUtils/translateString.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"scale\")\n    .prop(\"tickFormat\")\n    .tickFormat(fn.identity)\n    .prop(\"tickValues\")\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      const domain = props.scale.domain();\n      const tickValues = props.tickValues || [\n        domain[1],\n        props.scale.invert(mean(props.scale.range())),\n        domain[0],\n      ];\n      const maxRadius = range(props.scale)[1];\n\n      const group = selection\n        .selectAll(\"g.sszvis-legend__elementgroup\")\n        .data([0])\n        .join(\"g\")\n        .attr(\"class\", \"sszvis-legend__elementgroup\");\n\n      group.attr(\"transform\", translateString(halfPixel(maxRadius), halfPixel(maxRadius)));\n\n      const circles = group\n        .selectAll(\"circle.sszvis-legend__greyline\")\n        .data(tickValues)\n        .join(\"circle\")\n        .classed(\"sszvis-legend__greyline\", true);\n\n      function getCircleCenter(d) {\n        return maxRadius - props.scale(d);\n      }\n\n      function getCircleEdge(d) {\n        return maxRadius - 2 * props.scale(d);\n      }\n\n      circles.attr(\"r\", props.scale).attr(\"stroke-width\", 1).attr(\"cy\", getCircleCenter);\n\n      const lines = group\n        .selectAll(\"line.sszvis-legend__dashedline\")\n        .data(tickValues)\n        .join(\"line\")\n        .classed(\"sszvis-legend__dashedline\", true);\n\n      lines\n        .attr(\"x1\", 0)\n        .attr(\"y1\", getCircleEdge)\n        .attr(\"x2\", maxRadius + 15)\n        .attr(\"y2\", getCircleEdge);\n\n      const labels = group\n        .selectAll(\".sszvis-legend__label\")\n        .data(tickValues)\n        .join(\"text\")\n        .attr(\"class\", \"sszvis-legend__label sszvis-legend__label--small\");\n\n      labels\n        .attr(\"dx\", maxRadius + 18)\n        .attr(\"y\", getCircleEdge)\n        .attr(\"dy\", \"0.35em\") // vertically-center\n        .text(props.tickFormat);\n    });\n}\n"],"names":["component","prop","tickFormat","fn","render","selection","select","props","domain","scale","tickValues","invert","mean","range","maxRadius","group","selectAll","data","join","attr","translateString","halfPixel","circles","classed","getCircleCenter","d","getCircleEdge","lines","labels","text"],"mappings":"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"}