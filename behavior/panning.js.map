{"version":3,"file":"panning.js","sources":["../../src/behavior/panning.js"],"sourcesContent":["/**\n * Panning behavior\n *\n * This behavior is used for adding \"panning\" functionality to a set of chart elements.\n * The \"panning\" functionality refers to a combination of mouseover and touch responsiveness,\n * where on a mouse interaction an event is fired on hover, but the touch interaction is more\n * complex. The idea is to sort of imitate the way a hover interaction works, but with only a\n * finger. When a user starts a touch on an element which has this behavior enabled, the\n * default scrolling behavior of the browser will be canceled. The user can then move\n * their finger across the surface of the screen, onto other elements, and the scroll\n * will be canceled. When the finger moves onto other elements with this behavior attached,\n * the event will be fired. Meanwhile, if the user starts the interaction somewhere outside\n * an element, the scroll will happen as usual, and if they move onto an activated element,\n * no event will be fired and the scrolling will continue.\n *\n * This behavior is applied to all the children of a selection which match the elementSelector\n * property. Event listeners are attached to each of the child elements. The elementSelector\n * property is necessary to know which elements to attach to (and therefore to also avoid\n * attaching event listeners to elements which shouldn't be interaction-active).\n *\n * @module sszvis/behavior/panning\n *\n * @property {String} elementSelector    This should be a string selector that matches child\n *                                       elements of the selection on which this component\n *                                       is rendered using the .call(component) pattern. All\n *                                       child elements will have the panning event listeners\n *                                       attached to them.\n * @property {String, Function} on       The .on() method should specify an event name and a handler\n *                                       function for that event. The supported events are:\n *                                       'start' - when the interaction starts on an element.\n *                                       'pan' - when the user pans on the same element or onto another\n *                                       element (note, no 'start' event will be fired when the user\n *                                       pans with a touch from one element onto another, since this\n *                                       behavior is too difficult to test for and emulate).\n *                                       'end' - when the interaction with an element ends.\n *\n * @return {d3.component}\n */\n\nimport { select, dispatch } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { datumFromPanEvent } from \"./util.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  const event = dispatch(\"start\", \"pan\", \"end\");\n\n  const panningComponent = component()\n    .prop(\"elementSelector\")\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      const elements = selection.selectAll(props.elementSelector);\n\n      elements\n        .attr(\"data-sszvis-behavior-pannable\", \"\")\n        .classed(\"sszvis-interactive\", true)\n        .on(\"mouseenter\", function () {\n          event.apply(\"start\", this, arguments);\n        })\n        .on(\"mousemove\", function () {\n          event.apply(\"pan\", this, arguments);\n        })\n        .on(\"mouseleave\", function () {\n          event.apply(\"end\", this, arguments);\n        })\n        .on(\"touchstart\", function (e) {\n          e.preventDefault();\n          event.apply(\"start\", this, arguments);\n        })\n        .on(\"touchmove\", function (e) {\n          e.preventDefault();\n          const datum = datumFromPanEvent(fn.firstTouch(e));\n          if (datum === null) {\n            event.apply(\"end\", this, arguments);\n          } else {\n            event.apply(\"pan\", this, arguments);\n          }\n        })\n        .on(\"touchend\", function () {\n          event.apply(\"end\", this, arguments);\n        });\n    });\n\n  panningComponent.on = function () {\n    const value = event.on.apply(event, arguments);\n    return value === event ? panningComponent : value;\n  };\n\n  return panningComponent;\n}\n"],"names":["event","dispatch","panningComponent","component","prop","render","selection","select","props","elements","selectAll","elementSelector","attr","classed","on","apply","arguments","e","preventDefault","datum","datumFromPanEvent","fn","value"],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAQe,gBAAY,IAAA;EACzB,MAAMA,KAAK,GAAGC,QAAQ,CAAC,OAAO,EAAE,KAAK,EAAE,KAAK,CAAC;AAE7C,EAAA,MAAMC,gBAAgB,GAAGC,SAAS,EAAE,CACjCC,IAAI,CAAC,iBAAiB,CAAC,CACvBC,MAAM,CAAC,YAAY;AAClB,IAAA,MAAMC,SAAS,GAAGC,MAAM,CAAC,IAAI,CAAC;AAC9B,IAAA,MAAMC,KAAK,GAAGF,SAAS,CAACE,KAAK,EAAE;IAE/B,MAAMC,QAAQ,GAAGH,SAAS,CAACI,SAAS,CAACF,KAAK,CAACG,eAAe,CAAC;AAE3DF,IAAAA,QAAQ,CACLG,IAAI,CAAC,+BAA+B,EAAE,EAAE,CAAC,CACzCC,OAAO,CAAC,oBAAoB,EAAE,IAAI,CAAC,CACnCC,EAAE,CAAC,YAAY,EAAE,YAAY;MAC5Bd,KAAK,CAACe,KAAK,CAAC,OAAO,EAAE,IAAI,EAAEC,SAAS,CAAC;AACvC,KAAC,CAAC,CACDF,EAAE,CAAC,WAAW,EAAE,YAAY;MAC3Bd,KAAK,CAACe,KAAK,CAAC,KAAK,EAAE,IAAI,EAAEC,SAAS,CAAC;AACrC,KAAC,CAAC,CACDF,EAAE,CAAC,YAAY,EAAE,YAAY;MAC5Bd,KAAK,CAACe,KAAK,CAAC,KAAK,EAAE,IAAI,EAAEC,SAAS,CAAC;KACpC,CAAC,CACDF,EAAE,CAAC,YAAY,EAAE,UAAUG,CAAC,EAAE;MAC7BA,CAAC,CAACC,cAAc,EAAE;MAClBlB,KAAK,CAACe,KAAK,CAAC,OAAO,EAAE,IAAI,EAAEC,SAAS,CAAC;KACtC,CAAC,CACDF,EAAE,CAAC,WAAW,EAAE,UAAUG,CAAC,EAAE;MAC5BA,CAAC,CAACC,cAAc,EAAE;MAClB,MAAMC,KAAK,GAAGC,iBAAiB,CAACC,UAAa,CAACJ,CAAC,CAAC,CAAC;MACjD,IAAIE,KAAK,KAAK,IAAI,EAAE;QAClBnB,KAAK,CAACe,KAAK,CAAC,KAAK,EAAE,IAAI,EAAEC,SAAS,CAAC;AACrC,OAAC,MAAM;QACLhB,KAAK,CAACe,KAAK,CAAC,KAAK,EAAE,IAAI,EAAEC,SAAS,CAAC;AACrC;AACF,KAAC,CAAC,CACDF,EAAE,CAAC,UAAU,EAAE,YAAY;MAC1Bd,KAAK,CAACe,KAAK,CAAC,KAAK,EAAE,IAAI,EAAEC,SAAS,CAAC;AACrC,KAAC,CAAC;AACN,GAAC,CAAC;EAEJd,gBAAgB,CAACY,EAAE,GAAG,YAAY;IAChC,MAAMQ,KAAK,GAAGtB,KAAK,CAACc,EAAE,CAACC,KAAK,CAACf,KAAK,EAAEgB,SAAS,CAAC;AAC9C,IAAA,OAAOM,KAAK,KAAKtB,KAAK,GAAGE,gBAAgB,GAAGoB,KAAK;GAClD;AAED,EAAA,OAAOpB,gBAAgB;AACzB;;;;"}