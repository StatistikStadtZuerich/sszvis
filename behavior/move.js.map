{"version":3,"file":"move.js","sources":["../../src/behavior/move.js"],"sourcesContent":["/**\n * Move behavior\n *\n * The move behavior is used to add a mouseover and touchmove-based interface to a chart.\n *\n * Like other behavior components, this behavior adds an invisible layer over the chart,\n * which the users interact with using touch or mouse actions. The behavior component then interprets\n * these interactions, and calls the relevant event handler callback functions. These callback functions are\n * passed values which represent data-space information about the nature of the interaction.\n * That last sentence was intentionally vague, because different behaviors operate in slightly different ways.\n *\n * The move behavior requires scales to be passed to it as configuration, and when a user interacts with the behavior layer,\n * it inverts the pixel location of the interaction using these scales and passes the resulting data-space values to the callback\n * functions. This component extends a d3.dispatch instance.\n *\n * @module sszvis/behavior/move\n *\n * @property {boolean} debug                      Whether or not to render the component in debug mode, which reveals its position in the chart.\n * @property {function} xScale                    The x-scale for the component. The extent of this scale, plus component padding, is the width of the\n *                                                component's active area.\n * @property {function} yScale                    The y-scale for the component. The extent of this scale, plus component padding, is the height of the\n *                                                component's active area.\n * @property {boolean} draggable                  Whether or not this component is draggable. This changes certain display properties of the component.\n * @property {object} padding                     An object which specifies padding, in addition to the scale values, for the component. Defaults are all 0.\n *                                                The options are { top, right, bottom, left }\n * @property {boolean|function} cancelScrolling   A predicate function, or a constant boolean, that determines whether the browser's default scrolling\n *                                                behavior in response to a touch event should be canceled. In area charts and line charts, for example,\n *                                                you generally don't want to cancel scrolling, as this creates a scroll trap. However, in bar charts\n *                                                which use this behavior, you want to pass a predicate function here which will determine whether the touch\n *                                                event falls within the \"profile\" of the bar chart, and should therefore cancel scrolling and trigger an event.\n * @property {boolean} fireOnPanOnly              In response to touch events, whether to fire events only while \"panning\", that is only while performing\n *                                                a touch move where the default scrolling behavior is canceled, and not otherwise. In area and line charts, this\n *                                                should be false, since you want to fire events all the time, even while scrolling. In bar charts, we want to\n *                                                limit the firing of events (and therefore, the showing of tooltips) to only cases where the touch event has its\n *                                                default scrolling prevented, and the user is therefore \"panning\" across bars. So this should be true for bar charts.\n * @property {string and function} on             The .on() method of this component should specify an event name and an event handler function.\n *                                                Possible event names are:\n *                                                'start' - when the move action starts - mouseover or touchstart\n *                                                'move' - called when a 'moving' action happens - mouseover on the element\n *                                                'drag' - called when a 'dragging' action happens - mouseover with the mouse click down, or touchmove\n *                                                'end' - called when the event ends - mouseout or touchend\n *                                                Event handler functions, excepting end, are passed an x-value and a y-value, which are the data values,\n *                                                computed by inverting the provided xScale and yScale, which correspond to the screen pixel location of the event.\n *\n * @return {sszvis.component}\n */\n\nimport { ascending, dispatch, pointer, select } from \"d3\";\nimport { component } from \"../d3-component.js\";\nimport * as fn from \"../fn.js\";\nimport { range } from \"../scale.js\";\n\nexport default function () {\n  const event = dispatch(\"start\", \"move\", \"drag\", \"end\");\n\n  const moveComponent = component()\n    .prop(\"debug\")\n    .prop(\"xScale\")\n    .prop(\"yScale\")\n    .prop(\"draggable\")\n    .prop(\"cancelScrolling\", fn.functor)\n    .cancelScrolling(false)\n    .prop(\"fireOnPanOnly\", fn.functor)\n    .fireOnPanOnly(false)\n    .prop(\"padding\", (p) => {\n      const defaults = { top: 0, left: 0, bottom: 0, right: 0 };\n      for (const prop in p) {\n        defaults[prop] = p[prop];\n      }\n      return defaults;\n    })\n    .padding({})\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      const xExtent = range(props.xScale).sort(ascending);\n      const yExtent = range(props.yScale).sort(ascending);\n\n      xExtent[0] -= props.padding.left;\n      xExtent[1] += props.padding.right;\n      yExtent[0] -= props.padding.top;\n      yExtent[1] += props.padding.bottom;\n\n      const layer = selection\n        .selectAll(\"[data-sszvis-behavior-move]\")\n        .data([0])\n        .join(\"rect\")\n        .attr(\"data-sszvis-behavior-move\", \"\")\n        .attr(\"class\", \"sszvis-interactive\");\n\n      if (props.draggable) {\n        layer.classed(\"sszvis-interactive--draggable\", true);\n      }\n\n      layer\n        .attr(\"x\", xExtent[0])\n        .attr(\"y\", yExtent[0])\n        .attr(\"width\", xExtent[1] - xExtent[0])\n        .attr(\"height\", yExtent[1] - yExtent[0])\n        .attr(\"fill\", \"transparent\")\n        .on(\"mouseover\", function () {\n          event.apply(\"start\", this, arguments);\n        })\n        .on(\"mousedown\", function (e) {\n          const target = this;\n          const doc = select(document);\n          const win = select(globalThis);\n\n          const startDragging = () => {\n            target.__dragging__ = true;\n          };\n\n          const stopDragging = function () {\n            target.__dragging__ = false;\n            win.on(\"mousemove.sszvis-behavior-move\", null);\n            doc.on(\"mouseout.sszvis-behavior-move\", null);\n            event.apply(\"end\", this, arguments);\n          };\n\n          win.on(\"mouseup.sszvis-behavior-move\", stopDragging);\n          doc.on(\"mouseout.sszvis-behavior-move\", () => {\n            const from = e.relatedTarget || e.toElement;\n            if (!from || from.nodeName === \"HTML\") {\n              stopDragging();\n            }\n          });\n\n          startDragging();\n        })\n        .on(\"mousemove\", function (e) {\n          const xy = pointer(e);\n          const x = scaleInvert(props.xScale, xy[0]);\n          const y = scaleInvert(props.yScale, xy[1]);\n\n          if (this.__dragging__) {\n            event.apply(\"drag\", this, [e, x, y]);\n          } else {\n            event.apply(\"move\", this, [e, x, y]);\n          }\n        })\n        .on(\"mouseout\", function (e) {\n          event.apply(\"end\", this, [e]);\n        })\n        .on(\"touchstart\", function (e) {\n          const xy = fn.first(pointer(e));\n          const x = scaleInvert(props.xScale, xy[0]);\n          const y = scaleInvert(props.yScale, xy[1]);\n\n          const cancelScrolling = props.cancelScrolling(x, y);\n\n          if (cancelScrolling) {\n            e.preventDefault();\n          }\n\n          // if fireOnPanOnly => cancelScrolling must be true\n          // if !fireOnPanOnly => always fire events\n          // This is in place because this behavior needs to only fire\n          // events on a successful \"pan\" action in the bar charts, i.e.\n          // only when scrolling is prevented, but then it also needs to fire\n          // events all the time in the line and area charts, i.e. allow\n          // scrolling to continue as normal but also fire events.\n          // To configure the chart for use in the bar charts, you need\n          // to configure a cancelScrolling function for determining when to\n          // cancel scrolling, i.e. what constitutes a \"pan\" event, and also\n          // pass fireOnPanOnly = true, which flips this switch and relies on\n          // cancelScrolling to determine whether to fire the events.\n          if (!props.fireOnPanOnly() || cancelScrolling) {\n            event.apply(\"start\", this, [e, x, y]);\n            event.apply(\"drag\", this, [e, x, y]);\n            event.apply(\"move\", this, [e, x, y]);\n\n            const pan = function () {\n              const panXY = fn.first(pointer(e));\n              const panX = scaleInvert(props.xScale, panXY[0]);\n              const panY = scaleInvert(props.yScale, panXY[1]);\n\n              const panCancelScrolling = props.cancelScrolling(panX, panY);\n\n              if (panCancelScrolling) {\n                e.preventDefault();\n              }\n\n              // See comment above about the same if condition.\n              if (!props.fireOnPanOnly() || panCancelScrolling) {\n                event.apply(\"drag\", this, [e, panX, panY]);\n                event.apply(\"move\", this, [e, panX, panY]);\n              } else {\n                event.apply(\"end\", this, [e]);\n              }\n            };\n\n            const end = function () {\n              event.apply(\"end\", this, [e]);\n              select(this).on(\"touchmove\", null).on(\"touchend\", null);\n            };\n\n            select(this).on(\"touchmove\", pan).on(\"touchend\", end);\n          }\n        });\n\n      if (props.debug) {\n        layer.attr(\"fill\", \"rgba(255,0,0,0.2)\");\n      }\n    });\n\n  moveComponent.on = () => {\n    const value = event.on.apply(event, arguments);\n    return value === event ? moveComponent : value;\n  };\n\n  return moveComponent;\n}\n\nfunction scaleInvert(scale, px) {\n  const scaleType = scale.invert ? \"Linear\" : scale.paddingInner ? \"Band\" : \"Point\";\n  switch (scaleType) {\n    case \"Linear\": {\n      return scale.invert(px);\n    }\n    case \"Band\": {\n      return invertBandScale(scale, px);\n    }\n    case \"Point\": {\n      return invertPointScale(scale, px);\n    }\n    default: {\n      throw new Error(\"Unknown scale type, could not invert\");\n    }\n  }\n}\n\nfunction invertBandScale(scale, px) {\n  const step = scale.step();\n  const paddingOuter = scale.paddingOuter() * step;\n  const paddingInner = scale.paddingInner() * step;\n  const bandWidth = scale.bandwidth();\n  const scaleRange = scale.range();\n  const domain = scale.domain();\n\n  if (domain.length === 1) {\n    if (scaleRange[0] <= px && scaleRange[1] >= px) {\n      return domain[0];\n    }\n    return null;\n  }\n\n  const ranges = domain.map((d, i) => {\n    if (i === 0) {\n      return [scaleRange[0], scaleRange[0] + paddingOuter + bandWidth + paddingInner / 2];\n    } else if (i === domain.length - 1) {\n      return [scaleRange[1] - (paddingOuter + bandWidth + paddingInner / 2), scaleRange[1]];\n    } else {\n      return [\n        scaleRange[0] + paddingOuter + i * step - paddingInner / 2,\n        scaleRange[0] + paddingOuter + (i + 1) * step - paddingInner / 2,\n      ];\n    }\n  });\n  for (let i = 0, l = ranges.length; i < l; i++) {\n    if (ranges[i][0] < px && px <= ranges[i][1]) {\n      return domain[i];\n    }\n  }\n  return null;\n}\n\nfunction invertPointScale(scale, px) {\n  const step = scale.step();\n  const paddingOuter = scale.padding() * step;\n  const scaleRange = scale.range();\n  const domain = scale.domain();\n\n  if (domain.length === 1) {\n    if (scaleRange[0] <= px && scaleRange[1] >= px) {\n      return domain[0];\n    }\n    return null;\n  }\n\n  const ranges = domain.map((d, i) => {\n    if (i === 0) {\n      return [scaleRange[0], scaleRange[0] + paddingOuter + step / 2];\n    } else if (i === domain.length - 1) {\n      return [scaleRange[1] - (paddingOuter + step / 2), scaleRange[1]];\n    } else {\n      return [\n        scaleRange[0] + paddingOuter + i * step - step / 2,\n        scaleRange[0] + paddingOuter + i * step + step / 2,\n      ];\n    }\n  });\n  for (let i = 0, l = ranges.length; i < l; i++) {\n    if (ranges[i][0] < px && px <= ranges[i][1]) {\n      return domain[i];\n    }\n  }\n  return null;\n}\n"],"names":["event","dispatch","moveComponent","component","prop","fn","cancelScrolling","fireOnPanOnly","p","defaults","top","left","bottom","right","padding","render","selection","select","props","xExtent","range","xScale","sort","ascending","yExtent","yScale","layer","selectAll","data","join","attr","draggable","classed","on","apply","arguments","e","target","doc","document","win","globalThis","startDragging","__dragging__","stopDragging","from","relatedTarget","toElement","nodeName","xy","pointer","x","scaleInvert","y","preventDefault","pan","panXY","panX","panY","panCancelScrolling","end","debug","value","scale","px","scaleType","invert","paddingInner","invertBandScale","invertPointScale","Error","step","paddingOuter","bandWidth","bandwidth","scaleRange","domain","length","ranges","map","d","i","l"],"mappings":"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"}