!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react"),require("ramda"),require("jszip"),require("radium"),require("catalog")):"function"==typeof define&&define.amd?define(["react","ramda","jszip","radium","catalog"],t):e.ProjectSpecimen=t(e.Catalog.React,e.Catalog.R,e.JSZip,e.Catalog.Radium,e.Catalog)}(this,function(e,t,n,r,o){"use strict";function a(e,t){return t={exports:{}},e(t,t.exports),t.exports}function i(e){var t=e.width,n=e.height;return"number"==typeof n&&(n+="px"),"number"==typeof t&&(t+="px"),{width:t,height:n}}function u(e){return{button:c["extends"]({},x(e),{background:"#eee",color:e.brandColor,borderBottom:"none",cursor:"pointer",display:"inline-block","float":"left",textAlign:"center",minWidth:120,padding:10,borderRight:"1px solid transparent",":focus":{outline:"none"}}),active:{background:"white",borderRight:"1px solid #eee"},source:c["extends"]({},x(e,-.5),{fontWeight:400,background:"#fff",borderLeft:"none",borderBottom:"none",borderRight:"none",borderTop:"1px solid #eee",color:e.textColor,fontFamily:e.fontMono,lineHeight:1.4,clear:"both",display:"block",padding:20,height:"50vh",width:"100%",boxSizing:"border-box",":focus":{outline:"none"}})}}function s(e){return{container:{marginTop:"15px",marginBottom:"30px",overflow:"auto",flexBasis:"100%"},frame:{border:"1px solid #eee",display:"block",marginBottom:20,background:"#fff"},tabBar:{border:"1px solid #eee",minHeight:44},link:c["extends"]({},x(e),{padding:"10px 20px",color:e.linkColor,display:"inline-block","float":"right",textDecoration:"none"})}}var l="default"in e?e["default"]:e;t="default"in t?t["default"]:t,n="default"in n?n["default"]:n,r="default"in r?r["default"]:r;var c={};c["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},c.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},c.createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c["extends"]=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c.inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},c.possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},function(e){var t=e.prototype,n=t.parseFromString;try{if((new e).parseFromString("","text/html"))return}catch(r){}t.parseFromString=function(e,t){if(/^\s*text\/html\s*(?:;|$)/i.test(t)){var r=document.implementation.createHTMLDocument("");return e.toLowerCase().indexOf("<!doctype")>-1?r.documentElement.innerHTML=e:r.body.innerHTML=e,r}return n.apply(this,arguments)}}(DOMParser);var f=function(e){var t=e.split("/");return 0===t[0].length?(t.shift(),t.pop(),t.join("/")):(t.pop(),t.join("/"))},d=function(e){var t=e.split("/"),n=t.slice(-1)[0];return n},p=function(e,t){if(t.match(/^\//))return t;for(var n=e.split("/").reverse(),r=t.split("/").reverse(),o=[],a=0,i=r.length;i>a;a++){var u=r[a];switch(u){case".":o=o.concat(n),n=[];break;case"..":n.length>0?n.shift():o.push(u);break;default:u===n[0]&&n.shift(),o.push(u)}}return o.concat(n).reverse().join("/")},g={dirname:f,filename:d,normalizePath:p},m=m||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in r,a=function(n){var r=t.createEvent("MouseEvents");r.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(r)},i=e.webkitRequestFileSystem,u=e.requestFileSystem||i||e.mozRequestFileSystem,s=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l="application/octet-stream",c=0,f=10,d=function(t){var r=function(){"string"==typeof t?n().revokeObjectURL(t):t.remove()};e.chrome?r():setTimeout(r,f)},p=function(e,t,n){t=[].concat(t);for(var r=t.length;r--;){var o=e["on"+t[r]];if("function"==typeof o)try{o.call(e,n||e)}catch(a){s(a)}}},g=function(t,s){var f,g,m,h=this,b=t.type,v=!1,y=function(){p(h,"writestart progress write writeend".split(" "))},x=function(){if((v||!f)&&(f=n().createObjectURL(t)),g)g.location.href=f;else{var r=e.open(f,"_blank");void 0==r&&"undefined"!=typeof safari&&(e.location.href=f)}h.readyState=h.DONE,y(),d(f)},w=function(e){return function(){return h.readyState!==h.DONE?e.apply(this,arguments):void 0}},S={create:!0,exclusive:!1};return h.readyState=h.INIT,s||(s="download"),o?(f=n().createObjectURL(t),r.href=f,r.download=s,a(r),h.readyState=h.DONE,y(),void d(f)):(e.chrome&&b&&b!==l&&(m=t.slice||t.webkitSlice,t=m.call(t,0,t.size,l),v=!0),i&&"download"!==s&&(s+=".download"),(b===l||i)&&(g=e),u?(c+=t.size,void u(e.TEMPORARY,c,w(function(e){e.root.getDirectory("saved",S,w(function(e){var n=function(){e.getFile(s,S,w(function(e){e.createWriter(w(function(n){n.onwriteend=function(t){g.location.href=e.toURL(),h.readyState=h.DONE,p(h,"writeend",t),d(e)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&x()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=h["on"+e]}),n.write(t),h.abort=function(){n.abort(),h.readyState=h.DONE},h.readyState=h.WRITING}),x)}),x)};e.getFile(s,{create:!1},w(function(e){e.remove(),n()}),w(function(e){e.code===e.NOT_FOUND_ERR?n():x()}))}),x)}),x)):void x())},m=g.prototype,h=function(e,t){return new g(e,t)};return m.abort=function(){var e=this;e.readyState=e.DONE,p(e,"abort")},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,h}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content),h="index.html",b={name:"project",files:{},scrolling:"no",size:{height:500,width:"100%"}},v=function(e){var n=t.merge(b,e),r=null;if(n.index&&(console.warn('Deprecated: use "index.html" instead of "index"'),r=n.index,delete n.index),n[h]&&(r&&console.warn("Index document was already defined and will be overwritten"),r=n[h],delete n[h]),n.files[h]&&(r&&console.warn("Index document was already defined and will be overwritten"),r=n.files[h]),!r)throw new Error('"index.html" must be defined');n=t.assocPath(["files",h],r,n);var o=[],a=n.files;for(var u in a)if(u){var s=a[u],l="string"==typeof s?{source:s}:s;l.target||(l.target=u),l.template||(l.template=null),l.target===h&&(n.index=l),o.push(l)}return n.files=o,n.size=i(n.size),n},y=a(function(e,t){function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e){var t=arguments.length<=1||void 0===arguments[1]?"ol":arguments[1],a=arguments.length<=2||void 0===arguments[2]?0:arguments[2],u=arguments.length<=3||void 0===arguments[3]?0:arguments[3],l=3>u?r(e,t+" > li > ol",a,u+1):{};return o(n({},t,o({},i,c(e,a),{listStyle:"ordinal",marginTop:u>0?0:"16px",marginBottom:0})),s(e,t),l)}var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};Object.defineProperty(t,"__esModule",{value:!0}),t.orderedList=r;var a={fontStyle:"normal",fontWeight:400,lineHeight:1.5,textRendering:"optimizeLegibility",WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale"},i={width:"100%",marginLeft:0,paddingLeft:"2rem"},u=function(e){var t=e.baseFontSize,n=e.msRatio,r=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return t*Math.pow(n,r)+"px"},s=function(e){var t,r=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return t={},n(t,r+" i, em",{fontStyle:"italic"}),n(t,r+" b, strong",{fontWeight:600}),n(t,r+" a",{color:e.linkColor,textDecoration:"none"}),n(t,r+" a:hover",{textDecoration:"underline"}),n(t,r+" code",{background:e.bgLight,border:"1px solid #eee",borderRadius:1,display:"inline-block",fontFamily:e.fontMono,lineHeight:1,padding:"0.2em 0.2em",textIndent:0}),n(t,r+" img",{maxWidth:"100%"}),t},l=function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=arguments.length<=1||void 0===arguments[1]?"":arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return n({},e.map(function(e){return e+"+"+t}).join(","),r)},c=t.text=function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return o({},a,{color:e.textColor,fontFamily:e.fontFamily,fontSize:u(e,t)})},f=t.heading=function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return o({},a,{color:e.brandColor,fontFamily:e.fontHeading,fontSize:u(e,t),lineHeight:1.2})};t.textBlock=function(e){var t=arguments.length<=1||void 0===arguments[1]?"p":arguments[1],r=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return o(n({},t,o({},c(e,r),{flexBasis:"100%",margin:"16px 0 0 0"})),s(e,t+" >"))},t.headingBlock=function(e){var t=arguments.length<=1||void 0===arguments[1]?"h1":arguments[1],r=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return o(n({},t,o({},f(e,r),{flexBasis:"100%",margin:"48px 0 0 0"})),l(["blockquote","h1","h2","h3","h4","h5","h6"],t,{margin:"16px 0 0 0"}),s(e,t+" >"))},t.unorderedList=function d(e){var t=arguments.length<=1||void 0===arguments[1]?"ul":arguments[1],r=arguments.length<=2||void 0===arguments[2]?0:arguments[2],a=arguments.length<=3||void 0===arguments[3]?0:arguments[3],u=3>a?d(e,t+" > li > ul",r,a+1):{};return o(n({},t,o({},i,c(e,r),{listStyle:"disc",marginTop:a>0?0:"16px",marginBottom:0})),s(e,t),u)},t.blockquote=function(e){return{blockquote:{quotes:"none",margin:"48px 0 32px -20px",padding:"0 0 0 20px",borderLeft:"1px solid "+e.lightColor},"blockquote > :first-child":{marginTop:0},"blockquote > :last-child":{marginBottom:0},"blockquote::before, blockquote::after":{content:"none"}}}}),x=y.text,w=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},S=function(e,t,n){return t.map(function(t){var r=new RegExp("([\"'])([./a-z0-9]*"+w(g.filename(t.source))+")([\"'])","gi");n.replace(r,function(n,r,o,a){var i=t.source===g.normalizePath(e,o)?t.target:o;return r+i+a})}),n},k=function(e){function t(){c.classCallCheck(this,t);var e=c.possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return e.state={tab:null,sourceCode:null},e}return c.inherits(t,e),c.createClass(t,[{key:"componentDidMount",value:function(){this.loadSourceCode()}},{key:"componentDidUpdate",value:function(){this.state.sourceCode||this.state.error||this.loadSourceCode()}},{key:"render",value:function(){var e=this,t=this.props,n=t.sourceFiles,r=t.theme,o=u(r),a=n.length>1?n.map(function(t,n){var r=n===parseInt(e.state.tab,10)?o.active:void 0;return l.createElement("div",{onClick:e.selectTab.bind(e,e),key:n,"data-tab-id":n,style:[o.button,r]},t.target)}):null,i=this.state.tab?l.createElement("textarea",{style:o.source,value:this.state.sourceCode?this.state.sourceCode:"Loading …",readOnly:"true"}):null;return l.createElement("div",{className:"cg-Specimen-TabbedSourceView"},a,i)}},{key:"selectTab",value:function(e,t){var n=t.currentTarget.getAttribute("data-tab-id");e.setState({sourceCode:null,tab:n===this.state.tab?null:n})}},{key:"loadSourceCode",value:function(){var e=this,t=this.props.sourceFiles;if(this.state.tab){var n=t[this.state.tab];fetch(n.source).then(function(e){return e.text()}).then(function(t){var n=e.parseSourceCode(t);e.setState({sourceCode:S(e.props.rootPath,e.props.files,n)})})["catch"](function(t){e.setState({error:t,sourceCode:null})})}}},{key:"parseSourceCode",value:function(e,t){if(t){var n=(new DOMParser).parseFromString(e,"text/html"),r=n.querySelectorAll("[data-catalog-project-expose]");return r.map(function(e){e.removeAttribute("data-catalog-project-expose")}),t.replace("${yield}",n.body.innerHTML),t}return e}}]),t}(l.Component);k.propTypes={sourceFiles:e.PropTypes.array.isRequired,theme:e.PropTypes.object.isRequired};var O=r(k),j=/\.(jpe?g|gif|png)$/,C=function(e){return j.test(e)},E=function(e){function r(){return c.classCallCheck(this,r),c.possibleConstructorReturn(this,Object.getPrototypeOf(r).apply(this,arguments))}return c.inherits(r,e),c.createClass(r,[{key:"render",value:function(){var e=this.props,t=e.theme,n=e.body,r=v(n),o=r.index,a=r.scrolling,i=r.files,u=r.size,c=s(t),f=this.sourceViewFiles(r);return l.createElement("div",{className:"cg-Specimen-Project",style:c.container},l.createElement("iframe",{src:o.source,scrolling:a,marginHeight:"0",marginWidth:"0",style:[c.frame,u]}),l.createElement("div",{style:f.length>1?c.tabBar:null},l.createElement("a",{key:"new-window",style:c.link,href:o.source,target:"_blank"},"Open in new tab"),l.createElement("a",{key:"download",style:c.link,href:"#",onClick:this.download.bind(this,r)},"Download as .zip"),l.createElement(O,{rootPath:g.dirname(o.source),files:i,theme:t,sourceFiles:f})))}},{key:"sourceViewFiles",value:function(e){return e.files.filter(function(n){return t.contains(n.target,t.or(e.sourceView,[]))})}},{key:"filterMatching",value:function(e,t){}},{key:"parseExposedFiles",value:function(e){for(var t=(new DOMParser).parseFromString(e,"text/html"),n=[],r=t.querySelectorAll("[data-catalog-project-expose]"),o=0,a=r.length;a>o;o++){var i=r[o],u=i.getAttribute("data-catalog-project-expose");i.removeAttribute("data-catalog-project-expose"),n.push({path:u,content:i.innerHTML})}return n}},{key:"download",value:function(e,r){var o=this;r.preventDefault();var a=new n,i=a.folder(e.name),u=g.dirname(e.index.source),s=[],l=e.files.map(function(n){return new Promise(function(r,a){if(C(n.source)){var i=function(){var e=new XMLHttpRequest;return e.open("GET",n.source,!0),e.responseType="arraybuffer",e.onload=function(){return r({path:n.target,content:e.response})},e.onerror=a,{v:e.send(null)}}();if("object"===("undefined"==typeof i?"undefined":c["typeof"](i)))return i.v}return fetch(n.source,{headers:{Accept:"text/plain,*/*"}}).then(function(e){return e.text()}).then(function(a){var i=t.contains(o.sourceViewFiles(e),n)?S(u,e.files,a):a;return n===e.index?(s=s.concat(o.parseExposedFiles(i)),n.template?fetch(n.template,{headers:{Accept:"text/plain,*/*"}}).then(function(e){return e.text()}).then(function(e){for(var t=(new DOMParser).parseFromString(i,"text/html"),o=t.querySelectorAll("[data-catalog-project-expose]"),a=0,u=o.length;u>a;a++){var l=o[a],c=l.getAttribute("data-catalog-project-expose");l.removeAttribute("data-catalog-project-expose"),l.setAttribute("src",c),l.innerHTML=""}return s.push({path:g.filename(n.template),content:e.replace("${yield}",t.body.innerHTML)}),i=i.replace(/\s+data-catalog-project-expose=[\"\'].+?[\"\']/,""),r({path:n.target,content:i})}):(i=i.replace(/\s+data-catalog-project-expose=[\"\'].+?[\"\']/,""),r({path:n.target,content:i}))):r({path:n.target,content:i})})["catch"](a)})});Promise.all(l).then(function(t){t.forEach(function(e){return i.file(e.path,e.content,{binary:C(e.path)})}),s.forEach(function(e){return i.file(e.path,e.content,{binary:C(e.path)})});var n=a.generate({type:"blob"});return m(n,e.name+".zip")})["catch"](function(e){throw new Error("Preparing ZIP file failed",e)})}}]),r}(l.Component);E.propTypes={theme:e.PropTypes.object.isRequired,body:e.PropTypes.object.isRequired};var R=o.Specimen(function(e){return{body:e}})(r(E));return R});
