!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react"),require("ramda"),require("jszip"),require("radium"),require("catalog")):"function"==typeof define&&define.amd?define(["react","ramda","jszip","radium","catalog"],t):e.ProjectSpecimen=t(e.Catalog.React,e.Catalog.R,e.JSZip,e.Catalog.Radium,e.Catalog)}(this,function(e,t,n,r,o){"use strict";function i(e){if(e){var t=e.width,n=e.height;return"number"==typeof n&&(n+="px"),"number"==typeof t&&(t+="px"),{width:t,height:n}}return null}function a(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function l(e,t){return t={exports:{}},e(t,t.exports),t.exports}function c(e){return{button:d.extends({},k(e),{background:"#eee",color:e.brandColor,borderBottom:"none",cursor:"pointer",display:"inline-block",float:"left",textAlign:"center",minWidth:120,padding:10,borderRight:"1px solid transparent",":focus":{outline:"none"}}),active:{background:"white",borderRight:"1px solid #eee"},source:d.extends({},k(e,-.5),{fontWeight:400,background:"#fff",borderLeft:"none",borderBottom:"none",borderRight:"none",borderTop:"1px solid #eee",color:e.textColor,fontFamily:e.fontMono,lineHeight:1.4,clear:"both",display:"block",padding:20,height:"50vh",width:"100%",boxSizing:"border-box",":focus":{outline:"none"}})}}function s(e){return{container:{marginTop:"15px",marginBottom:"30px",overflow:"auto",flexBasis:"100%"},frame:{border:"1px solid #eee",display:"block",marginBottom:20,background:"#fff"},tabBar:{border:"1px solid #eee",minHeight:44},link:d.extends({},k(e),{padding:"10px 20px",color:e.linkColor,display:"inline-block",float:"right",textDecoration:"none"})}}function u(i){i||(i={}),i.sizes||(i.sizes=[{width:"100%",height:"700px"}]);var a=function(e){function r(){return d.classCallCheck(this,r),d.possibleConstructorReturn(this,Object.getPrototypeOf(r).apply(this,arguments))}return d.inherits(r,e),d.createClass(r,[{key:"render",value:function(){var e=this.props.catalog.theme,t=this.props.body,n=x(t),r=n.index,o=n.scrolling,a=n.files,l=n.size,c=s(e),u=this.sourceViewFiles(n);return f.createElement("div",{className:"cg-Specimen-Project",style:c.container},l&&f.createElement("iframe",{src:r.source,scrolling:o,marginHeight:"0",marginWidth:"0",style:[d.extends({},c.frame),l]})||f.createElement("div",{style:{display:"flex",flexFlow:"row wrap"}},i.sizes.map(function(e,t){var n=e.width,o=e.height;return f.createElement("iframe",{key:t,src:r.source,marginHeight:"0",marginWidth:"0",style:d.extends({},c.frame,{margin:"0 20px 20px 0",overflowY:"scroll",width:n||"100%",height:o||"700px"})})})),f.createElement("div",{style:u.length>1?c.tabBar:null},f.createElement("a",{key:"new-window",style:c.link,href:r.source,target:"_blank"},"Open in new tab"),f.createElement("a",{key:"responsive-testbed",style:c.link,href:"/tools/content_testbed.html?file="+r.source},"Open in responsive testbed"),f.createElement("a",{key:"download",style:c.link,href:"#",onClick:this.download.bind(this,n)},"Download as .zip"),f.createElement(E,{rootPath:m.dirname(r.source),files:a,theme:e,sourceFiles:u})))}},{key:"sourceViewFiles",value:function(e){return e.files.filter(function(n){return t.contains(n.target,t.or(e.sourceView,[]))})}},{key:"filterMatching",value:function(e,t){}},{key:"parseExposedFiles",value:function(e){for(var t=(new DOMParser).parseFromString(e,"text/html"),n=[],r=t.querySelectorAll("[data-catalog-project-expose]"),o=0,i=r.length;o<i;o++){var a=r[o],l=a.getAttribute("data-catalog-project-expose");a.removeAttribute("data-catalog-project-expose"),n.push({path:l,content:a.innerHTML})}return n}},{key:"download",value:function(e,r){var o=this;r.preventDefault();var i=new n,a=i.folder(e.name),l=m.dirname(e.index.source),c=[],s=e.files.map(function(n){return new Promise(function(r,i){if(R(n.source)){var a=function(){var e=new XMLHttpRequest;return e.open("GET",n.source,!0),e.responseType="arraybuffer",e.onload=function(){return r({path:n.target,content:e.response})},e.onerror=i,{v:e.send(null)}}();if("object"===("undefined"==typeof a?"undefined":d.typeof(a)))return a.v}return fetch(n.source,{headers:{Accept:"text/plain,*/*"}}).then(function(e){return e.text()}).then(function(i){var a=t.contains(o.sourceViewFiles(e),n)?O(l,e.files,i):i;return n===e.index?(c=c.concat(o.parseExposedFiles(a)),n.template?fetch(n.template,{headers:{Accept:"text/plain,*/*"}}).then(function(e){return e.text()}).then(function(e){for(var t=(new DOMParser).parseFromString(a,"text/html"),o=t.querySelectorAll("[data-catalog-project-expose]"),i=0,l=o.length;i<l;i++){var s=o[i],u=s.getAttribute("data-catalog-project-expose");s.removeAttribute("data-catalog-project-expose"),s.setAttribute("src",u),s.innerHTML=""}return c.push({path:m.filename(n.template),content:e.replace("${yield}",t.body.innerHTML)}),a=a.replace(/\s+data-catalog-project-expose=[\"\'].+?[\"\']/,""),r({path:n.target,content:a})}):(a=a.replace(/\s+data-catalog-project-expose=[\"\'].+?[\"\']/,""),r({path:n.target,content:a}))):r({path:n.target,content:a})}).catch(i)})});Promise.all(s).then(function(t){t.forEach(function(e){return a.file(e.path,e.content,{binary:R(e.path)})}),c.forEach(function(e){return a.file(e.path,e.content,{binary:R(e.path)})});var n=i.generate({type:"blob"});return v(n,e.name+".zip")}).catch(function(e){throw new Error("Preparing ZIP file failed",e)})}}]),r}(f.Component);return a.propTypes={theme:e.PropTypes.object.isRequired,body:e.PropTypes.object.isRequired},o.Specimen(function(e){return{body:e}})(r(a))}var f="default"in e?e.default:e;t="default"in t?t.default:t,n="default"in n?n.default:n,r="default"in r?r.default:r;var d={};d.typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},d.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},d.createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d.extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d.inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},d.possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},function(e){var t=e.prototype,n=t.parseFromString;try{if((new e).parseFromString("","text/html"))return}catch(e){}t.parseFromString=function(e,t){if(/^\s*text\/html\s*(?:;|$)/i.test(t)){var r=document.implementation.createHTMLDocument("");return e.toLowerCase().indexOf("<!doctype")>-1?r.documentElement.innerHTML=e:r.body.innerHTML=e,r}return n.apply(this,arguments)}}(DOMParser);var p=function(e){var t=e.split("/");return 0===t[0].length?(t.shift(),t.pop(),t.join("/")):(t.pop(),t.join("/"))},h=function(e){var t=e.split("/"),n=t.slice(-1)[0];return n},g=function(e,t){if(t.match(/^\//))return t;for(var n=e.split("/").reverse(),r=t.split("/").reverse(),o=[],i=0,a=r.length;i<a;i++){var l=r[i];switch(l){case".":o=o.concat(n),n=[];break;case"..":n.length>0?n.shift():o.push(l);break;default:l===n[0]&&n.shift(),o.push(l)}}return o.concat(n).reverse().join("/")},m={dirname:p,filename:h,normalizePath:g},v=v||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in r,i=function(n){var r=t.createEvent("MouseEvents");r.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(r)},a=e.webkitRequestFileSystem,l=e.requestFileSystem||a||e.mozRequestFileSystem,c=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},s="application/octet-stream",u=0,f=10,d=function(t){var r=function(){"string"==typeof t?n().revokeObjectURL(t):t.remove()};e.chrome?r():setTimeout(r,f)},p=function(e,t,n){t=[].concat(t);for(var r=t.length;r--;){var o=e["on"+t[r]];if("function"==typeof o)try{o.call(e,n||e)}catch(e){c(e)}}},h=function(t,c){var f,h,g,m=this,v=t.type,b=!1,y=function(){p(m,"writestart progress write writeend".split(" "))},x=function(){if(!b&&f||(f=n().createObjectURL(t)),h)h.location.href=f;else{var r=e.open(f,"_blank");void 0==r&&"undefined"!=typeof safari&&(e.location.href=f)}m.readyState=m.DONE,y(),d(f)},w=function(e){return function(){if(m.readyState!==m.DONE)return e.apply(this,arguments)}},k={create:!0,exclusive:!1};return m.readyState=m.INIT,c||(c="download"),o?(f=n().createObjectURL(t),r.href=f,r.download=c,i(r),m.readyState=m.DONE,y(),void d(f)):(e.chrome&&v&&v!==s&&(g=t.slice||t.webkitSlice,t=g.call(t,0,t.size,s),b=!0),a&&"download"!==c&&(c+=".download"),(v===s||a)&&(h=e),l?(u+=t.size,void l(e.TEMPORARY,u,w(function(e){e.root.getDirectory("saved",k,w(function(e){var n=function(){e.getFile(c,k,w(function(e){e.createWriter(w(function(n){n.onwriteend=function(t){h.location.href=e.toURL(),m.readyState=m.DONE,p(m,"writeend",t),d(e)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&x()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=m["on"+e]}),n.write(t),m.abort=function(){n.abort(),m.readyState=m.DONE},m.readyState=m.WRITING}),x)}),x)};e.getFile(c,{create:!1},w(function(e){e.remove(),n()}),w(function(e){e.code===e.NOT_FOUND_ERR?n():x()}))}),x)}),x)):void x())},g=h.prototype,m=function(e,t){return new h(e,t)};return g.abort=function(){var e=this;e.readyState=e.DONE,p(e,"abort")},g.readyState=g.INIT=0,g.WRITING=1,g.DONE=2,g.error=g.onwritestart=g.onprogress=g.onwrite=g.onabort=g.onerror=g.onwriteend=null,m}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||(void 0).content),b="index.html",y={name:"project",files:{},scrolling:"no",size:null},x=function(e){var n=t.merge(y,e),r=null;if(n.index&&(console.warn('Deprecated: use "index.html" instead of "index"'),r=n.index,delete n.index),n[b]&&(r&&console.warn("Index document was already defined and will be overwritten"),r=n[b],delete n[b]),n.files[b]&&(r&&console.warn("Index document was already defined and will be overwritten"),r=n.files[b]),!r)throw new Error('"index.html" must be defined');n=t.assocPath(["files",b],r,n);var o=[],a=n.files;for(var l in a)if(l){var c=a[l],s="string"==typeof c?{source:c}:c;s.target||(s.target=l),s.template||(s.template=null),s.target===b&&(n.index=s),o.push(s)}return n.files=o,n.size=i(n.size),n},w=l(function(e,t){function n(e){var t,o=arguments.length<=1||void 0===arguments[1]?"ol":arguments[1],a=arguments.length<=2||void 0===arguments[2]?0:arguments[2],c=arguments.length<=3||void 0===arguments[3]?0:arguments[3],u=c<3?n(e,o+" > li > ol",a,c+1):{};return r((t={},t[o]=r({},i,s(e,a),{listStyle:"ordinal",marginTop:c>0?0:"16px",marginBottom:0}),t),l(e,o),u)}t.__esModule=!0;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};t.orderedList=n;var o={fontStyle:"normal",fontWeight:400,textRendering:"optimizeLegibility",WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale"},i={width:"100%",marginLeft:0,paddingLeft:"2rem"},a=t.getFontSize=function(e){var t=e.baseFontSize,n=e.msRatio,r=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return t*Math.pow(n,r)+"px"},l=function(e){var t,n=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return t={},t[n+" i, em"]={fontStyle:"italic"},t[n+" b, strong"]={fontWeight:700},t[n+" a"]={color:e.linkColor,textDecoration:"none"},t[n+" a:hover"]={textDecoration:"underline"},t[n+" code"]={background:e.bgLight,border:"1px solid #eee",borderRadius:1,display:"inline-block",fontFamily:e.fontMono,lineHeight:1,padding:"0.12em 0.2em",textIndent:0},t[n+" img"]={maxWidth:"100%"},t},c=function(){var e,t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],n=arguments.length<=1||void 0===arguments[1]?"":arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return e={},e[t.map(function(e){return e+"+"+n}).join(",")]=r,e},s=t.text=function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return r({},o,{color:e.textColor,fontFamily:e.fontFamily,fontSize:a(e,t),lineHeight:e.msRatio*e.msRatio})},u=t.heading=function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return r({},o,{color:e.brandColor,fontFamily:e.fontHeading,fontSize:a(e,t),lineHeight:e.msRatio})};t.textBlock=function(e){var t,n=arguments.length<=1||void 0===arguments[1]?"p":arguments[1],o=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return r((t={},t[n]=r({},s(e,o),{flexBasis:"100%",margin:"16px 0 0 0"}),t),l(e,n+" >"))},t.headingBlock=function(e){var t,n=arguments.length<=1||void 0===arguments[1]?"h1":arguments[1],o=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return r((t={},t[n]=r({},u(e,o),{flexBasis:"100%",margin:"48px 0 0 0"}),t),c(["blockquote","h1","h2","h3","h4","h5","h6"],n,{margin:"16px 0 0 0"}),l(e,n+" >"))},t.unorderedList=function e(t){var n,o=arguments.length<=1||void 0===arguments[1]?"ul":arguments[1],a=arguments.length<=2||void 0===arguments[2]?0:arguments[2],c=arguments.length<=3||void 0===arguments[3]?0:arguments[3],u=c<3?e(t,o+" > li > ul",a,c+1):{};return r((n={},n[o]=r({},i,s(t,a),{listStyle:"disc",marginTop:c>0?0:"16px",marginBottom:0}),n),l(t,o),u)},t.blockquote=function(e){return{blockquote:{quotes:"none",margin:"48px 0 32px -20px",padding:"0 0 0 20px",borderLeft:"1px solid "+e.lightColor},"blockquote > :first-child":{marginTop:0},"blockquote > :last-child":{marginBottom:0},"blockquote::before, blockquote::after":{content:"none"}}}});a(w);var k=w.text,S=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},O=function(e,t,n){return t.map(function(t){var r=new RegExp("([\"'])([./a-z0-9]*"+S(m.filename(t.source))+")([\"'])","gi");n.replace(r,function(n,r,o,i){var a=t.source===m.normalizePath(e,o)?t.target:o;return r+a+i})}),n},C=function(e){function t(){d.classCallCheck(this,t);var e=d.possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return e.state={tab:null,sourceCode:null},e}return d.inherits(t,e),d.createClass(t,[{key:"componentDidMount",value:function(){this.loadSourceCode()}},{key:"componentDidUpdate",value:function(){this.state.sourceCode||this.state.error||this.loadSourceCode()}},{key:"render",value:function(){var e=this,t=this.props,n=t.sourceFiles,r=t.theme,o=c(r),i=n.length>1?n.map(function(t,n){var r=n===parseInt(e.state.tab,10)?o.active:void 0;return f.createElement("div",{onClick:e.selectTab.bind(e,e),key:n,"data-tab-id":n,style:[o.button,r]},t.target)}):null,a=this.state.tab?f.createElement("textarea",{style:o.source,value:this.state.sourceCode?this.state.sourceCode:"Loading â€¦",readOnly:"true"}):null;return f.createElement("div",{className:"cg-Specimen-TabbedSourceView"},i,a)}},{key:"selectTab",value:function(e,t){var n=t.currentTarget.getAttribute("data-tab-id");e.setState({sourceCode:null,tab:n===this.state.tab?null:n})}},{key:"loadSourceCode",value:function(){var e=this,t=this.props.sourceFiles;if(this.state.tab){var n=t[this.state.tab];fetch(n.source).then(function(e){return e.text()}).then(function(t){var n=e.parseSourceCode(t);e.setState({sourceCode:O(e.props.rootPath,e.props.files,n)})}).catch(function(t){e.setState({error:t,sourceCode:null})})}}},{key:"parseSourceCode",value:function(e,t){if(t){var n=(new DOMParser).parseFromString(e,"text/html"),r=n.querySelectorAll("[data-catalog-project-expose]");return r.map(function(e){e.removeAttribute("data-catalog-project-expose")}),t.replace("${yield}",n.body.innerHTML),t}return e}}]),t}(f.Component);C.propTypes={sourceFiles:e.PropTypes.array.isRequired,theme:e.PropTypes.object.isRequired};var E=r(C),j=/\.(jpe?g|gif|png)$/,R=function(e){return j.test(e)};return u});