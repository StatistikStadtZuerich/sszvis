{"version":3,"file":"handleRuler.js","sources":["../../src/control/handleRuler.js"],"sourcesContent":["/**\n * Ruler with a handle control\n *\n * The handle ruler component is very similar to the ruler component, except that it is rendered\n * with a 24-pixel tall handle at the top. It is moved and repositioned in the same manner as a ruler,\n * so the actual interaction with the handle is up to the developer to specify. This component also\n * creates dots for each data point it finds bound to its layer.\n *\n * @module sszvis/control/handleRuler\n *\n * @property {function} x                   A function or number which determines the x-position of the ruler\n * @property {function} y                   A function which determines the y-position of the ruler dots. Passed data values.\n * @property {number} top                   A number for the y-position of the top of the ruler.\n * @property {number} bottom                A number for the y-position of the bottom of the ruler.\n * @property {string, function} label       A string or string function for the labels of the ruler dots.\n * @property {string, function} color       A string or color for the fill color of the ruler dots.\n * @property {boolean, function} flip       A boolean or boolean function which determines whether the ruler should be flipped (they default to the right side)\n *\n * @returns {sszvis.component}\n */\n\nimport { select } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { halfPixel } from \"../svgUtils/crisp.js\";\nimport translateString from \"../svgUtils/translateString.js\";\nimport { component } from \"../d3-component.js\";\n\nexport default function () {\n  return component()\n    .prop(\"x\", fn.functor)\n    .prop(\"y\", fn.functor)\n    .prop(\"top\")\n    .prop(\"bottom\")\n    .prop(\"label\")\n    .label(fn.functor(\"\"))\n    .prop(\"color\")\n    .prop(\"flip\", fn.functor)\n    .flip(false)\n    .render(function (data) {\n      const selection = select(this);\n      const props = selection.props();\n\n      // Elements need to be placed on half-pixels in order to be rendered\n      // crisply across browsers. That's why we create this position accessor\n      // here that takes a datum as input, reads out its value (props.x) and\n      // then rounds this pixel value to half pixels (1px -> 1.5px, 1.2px -> 1.5px)\n      const crispX = fn.compose(halfPixel, props.x);\n      const crispY = fn.compose(halfPixel, props.y);\n\n      const bottom = props.bottom - 4;\n      const handleWidth = 10;\n      const handleHeight = 24;\n      const handleTop = props.top - handleHeight;\n\n      const group = selection\n        .selectAll(\".sszvis-handleRuler__group\")\n        .data([0])\n        .join(\"g\")\n        .classed(\"sszvis-handleRuler__group\", true);\n\n      group.append(\"line\").classed(\"sszvis-ruler__rule\", true);\n\n      group.append(\"rect\").classed(\"sszvis-handleRuler__handle\", true);\n\n      group.append(\"line\").classed(\"sszvis-handleRuler__handle-mark\", true);\n\n      group\n        .selectAll(\".sszvis-ruler__rule\")\n        .attr(\"x1\", crispX)\n        .attr(\"y1\", halfPixel(props.top))\n        .attr(\"x2\", crispX)\n        .attr(\"y2\", halfPixel(bottom));\n\n      group\n        .selectAll(\".sszvis-handleRuler__handle\")\n        .attr(\"x\", (d) => crispX(d) - handleWidth / 2)\n        .attr(\"y\", halfPixel(handleTop))\n        .attr(\"width\", handleWidth)\n        .attr(\"height\", handleHeight)\n        .attr(\"rx\", 2)\n        .attr(\"ry\", 2);\n\n      group\n        .selectAll(\".sszvis-handleRuler__handle-mark\")\n        .attr(\"x1\", crispX)\n        .attr(\"y1\", halfPixel(handleTop + handleHeight * 0.15))\n        .attr(\"x2\", crispX)\n        .attr(\"y2\", halfPixel(handleTop + handleHeight * 0.85));\n\n      const dots = group\n        .selectAll(\".sszvis-ruler__dot\")\n        .data(data)\n        .join(\"circle\")\n        .classed(\"sszvis-ruler__dot\", true);\n\n      dots.attr(\"cx\", crispX).attr(\"cy\", crispY).attr(\"r\", 3.5).attr(\"fill\", props.color);\n\n      selection\n        .selectAll(\".sszvis-ruler__label-outline\")\n        .data(data)\n        .join(\"text\")\n        .classed(\"sszvis-ruler__label-outline\", true);\n\n      selection\n        .selectAll(\".sszvis-ruler__label\")\n        .data(data)\n        .join(\"text\")\n        .classed(\"sszvis-ruler__label\", true);\n\n      // Update both labelOutline and labelOutline selections\n\n      selection\n        .selectAll(\".sszvis-ruler__label, .sszvis-ruler__label-outline\")\n        .attr(\"transform\", (d) => {\n          const x = fn.compose(halfPixel, props.x)(d);\n          const y = fn.compose(halfPixel, props.y)(d);\n\n          const dx = props.flip(d) ? -10 : 10;\n          const dy = y < props.top ? 2 * y : y > props.bottom ? 0 : 5;\n\n          return translateString(x + dx, y + dy);\n        })\n        .style(\"text-anchor\", (d) => (props.flip(d) ? \"end\" : \"start\"))\n        .html(props.label);\n    });\n}\n"],"names":["component","prop","fn","label","flip","render","data","selection","select","props","crispX","halfPixel","x","crispY","y","bottom","handleWidth","handleHeight","handleTop","top","group","selectAll","join","classed","append","attr","d","dots","color","dx","dy","translateString","style","html"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AASe,oBAAY,IAAA;AACzB,EAAA,OAAOA,SAAS,EAAE,CACfC,IAAI,CAAC,GAAG,EAAEC,OAAU,CAAC,CACrBD,IAAI,CAAC,GAAG,EAAEC,OAAU,CAAC,CACrBD,IAAI,CAAC,KAAK,CAAC,CACXA,IAAI,CAAC,QAAQ,CAAC,CACdA,IAAI,CAAC,OAAO,CAAC,CACbE,KAAK,CAACD,OAAU,CAAC,EAAE,CAAC,CAAC,CACrBD,IAAI,CAAC,OAAO,CAAC,CACbA,IAAI,CAAC,MAAM,EAAEC,OAAU,CAAC,CACxBE,IAAI,CAAC,KAAK,CAAC,CACXC,MAAM,CAAC,UAAUC,IAAI,EAAE;AACtB,IAAA,MAAMC,SAAS,GAAGC,MAAM,CAAC,IAAI,CAAC;AAC9B,IAAA,MAAMC,KAAK,GAAGF,SAAS,CAACE,KAAK,EAAE;;AAE/B;AACA;AACA;AACA;IACA,MAAMC,MAAM,GAAGR,OAAU,CAACS,SAAS,EAAEF,KAAK,CAACG,CAAC,CAAC;IAC7C,MAAMC,MAAM,GAAGX,OAAU,CAACS,SAAS,EAAEF,KAAK,CAACK,CAAC,CAAC;AAE7C,IAAA,MAAMC,MAAM,GAAGN,KAAK,CAACM,MAAM,GAAG,CAAC;IAC/B,MAAMC,WAAW,GAAG,EAAE;IACtB,MAAMC,YAAY,GAAG,EAAE;AACvB,IAAA,MAAMC,SAAS,GAAGT,KAAK,CAACU,GAAG,GAAGF,YAAY;IAE1C,MAAMG,KAAK,GAAGb,SAAS,CACpBc,SAAS,CAAC,4BAA4B,CAAC,CACvCf,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CACTgB,IAAI,CAAC,GAAG,CAAC,CACTC,OAAO,CAAC,2BAA2B,EAAE,IAAI,CAAC;IAE7CH,KAAK,CAACI,MAAM,CAAC,MAAM,CAAC,CAACD,OAAO,CAAC,oBAAoB,EAAE,IAAI,CAAC;IAExDH,KAAK,CAACI,MAAM,CAAC,MAAM,CAAC,CAACD,OAAO,CAAC,4BAA4B,EAAE,IAAI,CAAC;IAEhEH,KAAK,CAACI,MAAM,CAAC,MAAM,CAAC,CAACD,OAAO,CAAC,iCAAiC,EAAE,IAAI,CAAC;AAErEH,IAAAA,KAAK,CACFC,SAAS,CAAC,qBAAqB,CAAC,CAChCI,IAAI,CAAC,IAAI,EAAEf,MAAM,CAAC,CAClBe,IAAI,CAAC,IAAI,EAAEd,SAAS,CAACF,KAAK,CAACU,GAAG,CAAC,CAAC,CAChCM,IAAI,CAAC,IAAI,EAAEf,MAAM,CAAC,CAClBe,IAAI,CAAC,IAAI,EAAEd,SAAS,CAACI,MAAM,CAAC,CAAC;IAEhCK,KAAK,CACFC,SAAS,CAAC,6BAA6B,CAAC,CACxCI,IAAI,CAAC,GAAG,EAAGC,CAAC,IAAKhB,MAAM,CAACgB,CAAC,CAAC,GAAGV,WAAW,GAAG,CAAC,CAAC,CAC7CS,IAAI,CAAC,GAAG,EAAEd,SAAS,CAACO,SAAS,CAAC,CAAC,CAC/BO,IAAI,CAAC,OAAO,EAAET,WAAW,CAAC,CAC1BS,IAAI,CAAC,QAAQ,EAAER,YAAY,CAAC,CAC5BQ,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,CACbA,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC;IAEhBL,KAAK,CACFC,SAAS,CAAC,kCAAkC,CAAC,CAC7CI,IAAI,CAAC,IAAI,EAAEf,MAAM,CAAC,CAClBe,IAAI,CAAC,IAAI,EAAEd,SAAS,CAACO,SAAS,GAAGD,YAAY,GAAG,IAAI,CAAC,CAAC,CACtDQ,IAAI,CAAC,IAAI,EAAEf,MAAM,CAAC,CAClBe,IAAI,CAAC,IAAI,EAAEd,SAAS,CAACO,SAAS,GAAGD,YAAY,GAAG,IAAI,CAAC,CAAC;IAEzD,MAAMU,IAAI,GAAGP,KAAK,CACfC,SAAS,CAAC,oBAAoB,CAAC,CAC/Bf,IAAI,CAACA,IAAI,CAAC,CACVgB,IAAI,CAAC,QAAQ,CAAC,CACdC,OAAO,CAAC,mBAAmB,EAAE,IAAI,CAAC;AAErCI,IAAAA,IAAI,CAACF,IAAI,CAAC,IAAI,EAAEf,MAAM,CAAC,CAACe,IAAI,CAAC,IAAI,EAAEZ,MAAM,CAAC,CAACY,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC,CAACA,IAAI,CAAC,MAAM,EAAEhB,KAAK,CAACmB,KAAK,CAAC;IAEnFrB,SAAS,CACNc,SAAS,CAAC,8BAA8B,CAAC,CACzCf,IAAI,CAACA,IAAI,CAAC,CACVgB,IAAI,CAAC,MAAM,CAAC,CACZC,OAAO,CAAC,6BAA6B,EAAE,IAAI,CAAC;IAE/ChB,SAAS,CACNc,SAAS,CAAC,sBAAsB,CAAC,CACjCf,IAAI,CAACA,IAAI,CAAC,CACVgB,IAAI,CAAC,MAAM,CAAC,CACZC,OAAO,CAAC,qBAAqB,EAAE,IAAI,CAAC;;AAEvC;;IAEAhB,SAAS,CACNc,SAAS,CAAC,oDAAoD,CAAC,CAC/DI,IAAI,CAAC,WAAW,EAAGC,CAAC,IAAK;AACxB,MAAA,MAAMd,CAAC,GAAGV,OAAU,CAACS,SAAS,EAAEF,KAAK,CAACG,CAAC,CAAC,CAACc,CAAC,CAAC;AAC3C,MAAA,MAAMZ,CAAC,GAAGZ,OAAU,CAACS,SAAS,EAAEF,KAAK,CAACK,CAAC,CAAC,CAACY,CAAC,CAAC;AAE3C,MAAA,MAAMG,EAAE,GAAGpB,KAAK,CAACL,IAAI,CAACsB,CAAC,CAAC,GAAG,GAAG,GAAG,EAAE;MACnC,MAAMI,EAAE,GAAGhB,CAAC,GAAGL,KAAK,CAACU,GAAG,GAAG,CAAC,GAAGL,CAAC,GAAGA,CAAC,GAAGL,KAAK,CAACM,MAAM,GAAG,CAAC,GAAG,CAAC;MAE3D,OAAOgB,eAAe,CAACnB,CAAC,GAAGiB,EAAE,EAAEf,CAAC,GAAGgB,EAAE,CAAC;KACvC,CAAC,CACDE,KAAK,CAAC,aAAa,EAAGN,CAAC,IAAMjB,KAAK,CAACL,IAAI,CAACsB,CAAC,CAAC,GAAG,KAAK,GAAG,OAAQ,CAAC,CAC9DO,IAAI,CAACxB,KAAK,CAACN,KAAK,CAAC;AACtB,GAAC,CAAC;AACN;;;;"}