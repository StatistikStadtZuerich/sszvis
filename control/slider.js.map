{"version":3,"file":"slider.js","sources":["../../src/control/slider.js"],"sourcesContent":["/**\n * Slider control\n *\n * Control for use in filtering. Works very much like an interactive axis.\n * A d3 scale is its primary configuration, and it has a labeled handle which can be used to\n * select values on that scale. Ticks created using an sszvis.axis show the user where\n * data values lie.\n *\n * @module  sszvis/control/slider\n *\n * @property {function} scale                 A scale function which this slider represents. The values in the scale's domain\n *                                            are used as the possible values of the slider.\n * @property {array} minorTicks               An array of ticks which become minor (smaller and unlabeled) ticks on the slider's axis\n * @property {array} majorTicks               An array of ticks which become major (larger and labeled) ticks on the slider's axis\n * @property {function} tickLabels            A function to use to format the major tick labels.\n * @property {any} value                      The current value of the slider. Should be set whenever slider interaction causes the state to change.\n * @property {string, function} label         A string or function for the handle label. The datum associated with it is the current slider value.\n * @property {function} onchange              A callback function called whenever user interaction attempts to change the slider value.\n *                                            Note that this component will not change its own state. The callback function must affect some state change\n *                                            in order for this component's display to be updated.\n *\n * @returns {sszvis.component}\n */\n\nimport { select, scaleLinear } from \"d3\";\n\nimport * as fn from \"../fn.js\";\nimport { halfPixel } from \"../svgUtils/crisp.js\";\nimport translateString from \"../svgUtils/translateString.js\";\nimport { range } from \"../scale.js\";\nimport move from \"../behavior/move.js\";\nimport { axisX } from \"../axis.js\";\nimport { component } from \"../d3-component.js\";\n\nfunction contains(x, a) {\n  return a.includes(x);\n}\n\nexport default function () {\n  return component()\n    .prop(\"scale\")\n    .prop(\"value\")\n    .prop(\"onchange\")\n    .prop(\"minorTicks\")\n    .minorTicks([])\n    .prop(\"majorTicks\")\n    .majorTicks([])\n    .prop(\"tickLabels\", fn.functor)\n    .tickLabels(fn.identity)\n    .prop(\"label\", fn.functor)\n    .label(fn.identity)\n    .render(function () {\n      const selection = select(this);\n      const props = selection.props();\n\n      const axisOffset = 28; // vertical offset for the axis\n      const majorTickSize = 12;\n      const backgroundOffset = halfPixel(18); // vertical offset for the middle of the background\n      const handleWidth = 10; // the width of the handle\n      const handleHeight = 23; // the height of the handle\n      const bgWidth = 6; // the width of the background\n      const lineEndOffset = bgWidth / 2; // the amount by which to offset the ends of the background line\n      const handleSideOffset = handleWidth / 2 + 0.5; // the amount by which to offset the position of the handle\n\n      const scaleDomain = props.scale.domain();\n      const scaleRange = range(props.scale);\n      const alteredScale = props.scale\n        .copy()\n        .range([scaleRange[0] + handleSideOffset, scaleRange[1] - handleSideOffset]);\n\n      // the mostly unchanging bits\n      const bg = selection\n        .selectAll(\"g.sszvis-control-slider__backgroundgroup\")\n        .data([1])\n        .join(\"g\")\n        .classed(\"sszvis-control-slider__backgroundgroup\", true);\n\n      // create the axis\n      const axis = axisX()\n        .scale(alteredScale)\n        .orient(\"bottom\")\n        .hideBorderTickThreshold(0)\n        .tickSize(majorTickSize)\n        .tickPadding(6)\n        .tickValues(fn.set([...props.majorTicks, ...props.minorTicks]))\n        .tickFormat((d) => (contains(d, props.majorTicks) ? props.tickLabels(d) : \"\"));\n\n      const axisSelection = bg\n        .selectAll(\"g.sszvis-axisGroup\")\n        .data([1])\n        .join(\"g\")\n        .classed(\"sszvis-axisGroup sszvis-axis sszvis-axis--bottom sszvis-axis--slider\", true);\n\n      axisSelection.attr(\"transform\", translateString(0, axisOffset)).call(axis);\n\n      // adjust visual aspects of the axis to fit the design\n      axisSelection\n        .selectAll(\".tick line\")\n        .filter((d) => !contains(d, props.majorTicks))\n        .attr(\"y2\", 4);\n\n      const majorAxisText = axisSelection\n        .selectAll(\".tick text\")\n        .filter((d) => contains(d, props.majorTicks));\n      const numTicks = majorAxisText.size();\n      majorAxisText.style(\"text-anchor\", (d, i) =>\n        i === 0 ? \"start\" : i === numTicks - 1 ? \"end\" : \"middle\"\n      );\n\n      // create the slider background\n      const backgroundSelection = bg\n        .selectAll(\"g.sszvis-slider__background\")\n        .data([1])\n        .join(\"g\")\n        .classed(\"sszvis-slider__background\", true)\n        .attr(\"transform\", translateString(0, backgroundOffset));\n\n      backgroundSelection\n        .selectAll(\".sszvis-slider__background__bg1\")\n        .data([1])\n        .join(\"line\")\n        .classed(\"sszvis-slider__background__bg1\", true)\n        .style(\"stroke-width\", bgWidth)\n        .style(\"stroke\", \"#888\")\n        .style(\"stroke-linecap\", \"round\")\n        .attr(\"x1\", Math.ceil(scaleRange[0] + lineEndOffset))\n        .attr(\"x2\", Math.floor(scaleRange[1] - lineEndOffset));\n\n      backgroundSelection\n        .selectAll(\".sszvis-slider__background__bg2\")\n        .data([1])\n        .join(\"line\")\n        .classed(\"sszvis-slider__background__bg2\", true)\n        .style(\"stroke-width\", bgWidth - 1)\n        .style(\"stroke\", \"#fff\")\n        .style(\"stroke-linecap\", \"round\")\n        .attr(\"x1\", Math.ceil(scaleRange[0] + lineEndOffset))\n        .attr(\"x2\", Math.floor(scaleRange[1] - lineEndOffset));\n\n      backgroundSelection\n        .selectAll(\".sszvis-slider__backgroundshadow\")\n        .data([props.value])\n        .join(\"line\")\n        .attr(\"class\", \"sszvis-slider__backgroundshadow\")\n        .attr(\"stroke-width\", bgWidth - 1)\n        .style(\"stroke\", \"#E0E0E0\")\n        .style(\"stroke-linecap\", \"round\")\n        .attr(\"x1\", Math.ceil(scaleRange[0] + lineEndOffset))\n        .attr(\"x2\", fn.compose(Math.floor, alteredScale));\n\n      // draw the handle and the label\n      const handle = selection\n        .selectAll(\"g.sszvis-control-slider__handle\")\n        .data([props.value])\n        .join(\"g\")\n        .classed(\"sszvis-control-slider__handle\", true)\n        .attr(\"transform\", (d) => translateString(halfPixel(alteredScale(d)), 0.5));\n\n      handle.append(\"text\").classed(\"sszvis-control-slider--label\", true);\n\n      handle\n        .selectAll(\".sszvis-control-slider--label\")\n        .data((d) => [d])\n        .text(props.label)\n        .style(\"text-anchor\", (d) =>\n          fn.stringEqual(d, scaleDomain[0])\n            ? \"start\"\n            : fn.stringEqual(d, scaleDomain[1])\n              ? \"end\"\n              : \"middle\"\n        )\n        .attr(\"dx\", (d) =>\n          fn.stringEqual(d, scaleDomain[0])\n            ? -(handleWidth / 2)\n            : fn.stringEqual(d, scaleDomain[1])\n              ? handleWidth / 2\n              : 0\n        );\n\n      handle\n        .selectAll(\".sszvis-control-slider__handlebox\")\n        .data([1])\n        .join(\"rect\")\n        .classed(\"sszvis-control-slider__handlebox\", true)\n        .attr(\"x\", -(handleWidth / 2))\n        .attr(\"y\", backgroundOffset - handleHeight / 2)\n        .attr(\"width\", handleWidth)\n        .attr(\"height\", handleHeight)\n        .attr(\"rx\", 2)\n        .attr(\"ry\", 2);\n\n      const handleLineDimension = handleHeight / 2 - 4; // the amount by which to offset the small handle line within the handle\n\n      handle\n        .selectAll(\".sszvis-control-slider__handleline\")\n        .data([1])\n        .join(\"line\")\n        .classed(\"sszvis-control-slider__handleline\", true)\n        .attr(\"y1\", backgroundOffset - handleLineDimension)\n        .attr(\"y2\", backgroundOffset + handleLineDimension);\n\n      const sliderInteraction = move()\n        .xScale(props.scale)\n        // range goes from the text top (text is 11px tall) to the bottom of the axis\n        .yScale(scaleLinear().range([-11, axisOffset + majorTickSize]))\n        .draggable(true)\n        .on(\"drag\", props.onchange);\n\n      selection\n        .selectGroup(\"sliderInteraction\")\n        .classed(\"sszvis-control-slider--interactionLayer\", true)\n        .attr(\"transform\", translateString(0, 4))\n        .call(sliderInteraction);\n    });\n}\n"],"names":["contains","x","a","includes","component","prop","minorTicks","majorTicks","fn","tickLabels","label","render","selection","select","props","axisOffset","majorTickSize","backgroundOffset","halfPixel","handleWidth","handleHeight","bgWidth","lineEndOffset","handleSideOffset","scaleDomain","scale","domain","scaleRange","range","alteredScale","copy","bg","selectAll","data","join","classed","axis","axisX","orient","hideBorderTickThreshold","tickSize","tickPadding","tickValues","tickFormat","d","axisSelection","attr","translateString","call","filter","majorAxisText","numTicks","size","style","i","backgroundSelection","Math","ceil","floor","value","handle","append","text","handleLineDimension","sliderInteraction","move","xScale","yScale","scaleLinear","draggable","on","onchange","selectGroup"],"mappings":"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"}